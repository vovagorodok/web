import{g as t,be as r,ck as o,ao as e,r as s,cX as n,aN as a,p as i,o as c,y as h,G as d}from"./main.js";import{B as l}from"./Board-0ecb6fca.js";import{l as g}from"./layout-ae040024.js";const u="abcdefgh",p="12345678",v=3e4,m="coordinates";class CoordCtrl{constructor(){this.coords=[],this.wrongAnswer=!1,this.tempWrong=!1,this.score=0,this.progress=100,this.started=!1,this.orientation=this.getOrientation(t.coordinates.colorChoice()),this.chessground=new r({fen:o,orientation:this.orientation,coordinates:!1,movable:{free:!1,color:null},events:{select:t=>this.handleSelect(t)}}),e.get(m).then((t=>{t&&(this.averageScores=w(t),s())}))}getOrientation(t){return"random"===t?n():t}updateOrientation(){this.orientation=this.getOrientation(t.coordinates.colorChoice()),this.chessground.set({orientation:this.orientation}),s()}nextCoord(){return u[Math.round(7*Math.random())]+p[Math.round(7*Math.random())]}pushCoords(){for(;this.coords.length<3;){const t=this.nextCoord();-1===this.coords.indexOf(t)&&this.coords.push(t)}}handleSelect(t){this.started&&(t===this.coords[0]?(this.coords.shift(),this.pushCoords(),this.wrongAnswer=!1,this.tempWrong=!1,this.score++):(this.wrongAnswer=!0,this.tempWrong=!0,setTimeout((()=>{this.tempWrong=!1,s()}),350)),s())}startTraining(){if(!this.started){this.started=!0,this.pushCoords(),this.progress=0,this.score=0,this.wrongAnswer=!1,this.tempWrong=!1,this.updateOrientation();const t=performance.now(),r=setInterval((()=>{const o=Math.min(v,performance.now()-t);o>=v?(clearInterval(r),this.progress=100,this.started=!1,this.wrongAnswer=!1,this.tempWrong=!1,this.lastScore=this.score,this.coords=[],this.saveScore().then((t=>{this.averageScores=w(t),s()})),s()):(this.progress=100*o/v,s())}),50);s()}}saveScore(){return e.get(m).then((t=>{const r=(t=t||{})[this.orientation]||[];return r.length>=100&&r.shift(),r.push(this.score),t[this.orientation]=r,t})).then((t=>e.set(m,t)))}}function w(t){return{white:t.white?_(t.white):null,black:t.black?_(t.black):null}}function _(t){return Math.round(t.reduce(((t,r)=>t+r),0)/t.length*100)/100}var b={oninit(){this.coordCtrl=new CoordCtrl},oncreate:d,view(){return function(r){const o=t.coordinates;return g.board(a(i("coordinateTraining")),[c("div.coord-trainer__board_wrapper",[c("div.coord-trainer__progress",[c("div.coord-trainer__progress_bar",{className:r.wrongAnswer?"nope":"",style:{width:r.progress+"%"}})]),c("div.coord-trainer__coords",[...r.coords.map(((t,o)=>c("div.next_coord",{className:"coord"+(o+1)+(!0===r.tempWrong&&0===o?" nope":"")},t)))]),c(l,{variant:"standard",chessground:r.chessground})]),c("div.table.training-tableWrapper",[c("div.training-table.coord-trainer__table.native_scroller.box",[r.started?c("div.coord-trainer__score",{className:r.wrongAnswer?"nope":""},r.score):c.fragment({},[void 0!==r.lastScore?c("div.coord-trainer__previous",c.trust(i("lastScore",`<strong>${r.lastScore}</strong>`))):null,r.averageScores?c("div.coord-trainer__average",[c("div",c.trust(i("averageScoreAsWhiteX",`<strong>${null!==r.averageScores.white?r.averageScores.white:"?"}</strong>`))),c("div",c.trust(i("averageScoreAsBlackX",`<strong>${null!==r.averageScores.black?r.averageScores.black:"?"}</strong>`)))]):null,c("button.start.defaultButton.fat.wrap",{oncreate:h((()=>r.startTraining()))},i("startTraining"))])]),c("div.actions_bar.coord-trainer__colorChoice",["black","random","white"].map((t=>c("i.action_bar_button."+t,{className:t===o.colorChoice()?"selected":"",oncreate:h((()=>{r.started||(o.colorChoice(t),r.updateOrientation())}))}))))])])}(this.coordCtrl)}};export{b as default};
