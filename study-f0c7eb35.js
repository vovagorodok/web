import{aN as t,am as s,o as e,y as a,a4 as r,S as o,z as i,cV as n,cW as d,ch as l,E as u,m as c,F as m,aL as h,r as p,ac as b,bv as y,bu as f,aM as j,s as v,aJ as w}from"./main.js";import{l as M,C,E as g}from"./layout-ae040024.js";import{A as k,a as T,o as x,l as F}from"./AnalyseCtrl-79633987.js";import{c as N}from"./studyXhr-058f9d1a.js";import"./fen-f2d95e2d.js";import"./variant-c1af828f.js";import"./promotion-070b22ca.js";import"./toInteger-da417924.js";import"./TabView-408b9801.js";import"./chat-2370f74a.js";import"./html-1975aa10.js";import"./game-b6f212b0.js";import"./perfs-d8ca398c.js";import"./tree-3ccd4e65.js";import"./axis-de48d5f2.js";import"./Board-0ecb6fca.js";import"./chess-a4e99343.js";import"./vibrate-2d0ad158.js";import"./index-c70fdca8.js";var $={oninit({attrs:t}){const{studyCtrl:s}=t,e=Object.keys(s.data.members).length;this.showMembers=e<=5},onbeforeupdate:({attrs:t})=>t.studyCtrl.sideMenu.isOpen,view({attrs:t}){const{studyCtrl:s}=t,a=s.data,r=function(t){return Object.keys(t).map((s=>t[s])).sort(((t,s)=>"r"===t.role&&"w"===s.role?1:"w"===t.role&&"r"===s.role?-1:t.addedAt>s.addedAt?1:-1))}(a.members);return e("aside#studyMenu",{oncreate:({dom:t})=>{C(t,s.sideMenu)}},[e("div.native_scroller",[e("h2.study-menu-title.study-members",{oncreate:o((()=>this.showMembers=!this.showMembers))},[e("span",i("nbMembers",r.length)),this.showMembers?n:d]),this.showMembers?e("ul",r.map((t=>e("li.study-menu-link",{className:"w"===t.role?"contrib":"viewer"},[e("span.bullet.fa",{className:"w"===t.role?"fa-user":"fa-eye"}),e("span",t.user?l(t.user):"?")])))):null,e("h2.study-menu-title.study-chapters",i("nbChapters",a.chapters.length)),e("ol",{oncreate:o((t=>{const e=u(t),r=e&&e.dataset.id;r&&s.sideMenu.close().then((()=>{const t=s.analyseCtrl.currentTab(s.analyseCtrl.availableTabs()).id;c.set(`/study/${a.id}/${r}?tabId=${t}`,!0)}))}),void 0,u)},a.chapters.map(((t,s)=>e("li.study-menu-link",{"data-id":t.id,className:a.chapter.id===t.id?"current":""},[e("span.bullet",s+1),e("span",t.name)]))))])])}};var A={oninit(t){const s=t.attrs.id,e=t.attrs.chapterId,a=performance.now(),r=m(t.attrs.ply),o=t.attrs.tabId;h(),N(s,e).then((t=>{const s=performance.now()-a;setTimeout((()=>{this.ctrl=new k(t.analysis,t.study,"online",t.study.chapter.setup.orientation,!0,r||0,o),this.handlers=g(this.ctrl.study.sideMenu),p()}),Math.max(400-s,0))})).catch((t=>{404===t.status?(this.notFound=!0,p()):b(t)}))},oncreate(t){c.getPreviousPath().startsWith("/study/")?y(t.dom):f(t.dom)},onremove(){j(),v.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(o){if(this.notFound)return M.free(t(null,s("Not Found")),e("div"));const i=w(),n=this.ctrl;return n?M.board(function(o){const i=o.name,n=o.chapters.find((t=>t.id===o.chapter.id)).name;return t(null,s(e("div.main_header_title.withSub",{},[e("h1.header-gameTitle",{oncreate:a((()=>{r.show({text:`${i}: ${n}`,duration:"long",position:"top"})}))},i),e("h2.header-subTitle",n)])))}(n.study.data),T(n,i),void 0,[...x(n),e($,{studyCtrl:n.study}),e("div#studyMenu-backdrop.menu-backdrop",{oncreate:a((()=>n.study.sideMenu.close()))})],this.handlers):F(i,void 0,o.attrs.curFen)}};export{A as default};
