import{a5 as a,o as e,u as t,b as n,aO as o,y as r,p as s,aP as i,an as c,B as l,as as d,m as u,ah as m,r as p,k as f,z as b,aQ as h,ak as g,ac as v,aR as y,ax as k,g as w,q as N,aS as _,aT as T,aJ as O,K as C,a9 as A,aK as D,am as S,aU as B,aV as M,aW as j,s as P,aX as U,aY as L,aZ as x,a4 as G,n as R,a_ as V,a$ as $,b0 as I}from"./main.js";import{r as z,f as E,u as F,a as Z,g as H,m as W,b as K,p as q,c as Q,i as X,d as Y,t as J,e as aa,h as ea,j as ta,k as na}from"./game-b6f212b0.js";import{p as oa}from"./perfs-d8ca398c.js";import{e as ra}from"./fen-f2d95e2d.js";import{l as sa}from"./layout-ae040024.js";import{c as ia}from"./countries-a19495bf.js";import{G as ca}from"./GameTitle-fb417b3c.js";import{C as la}from"./CountdownTimer-c8587446.js";import{B as da}from"./Board-0ecb6fca.js";import{p as ua}from"./promotion-070b22ca.js";import{S as ma}from"./index-c70fdca8.js";import{w as pa}from"./tournamentXhr-291e93e6.js";import{g as fa,t as ba,n as ha,C as ga}from"./toInteger-da417924.js";import{c as va}from"./chat-2370f74a.js";var ya={view({attrs:m}){const{player:p,mini:f,isOpen:b,close:h,opponent:g,score:v}=m;return p.user?a("miniUserInfos",void 0,(()=>function(a,m,p,f){const b=m.user;if(!a||!b)return e("div",{className:"miniUser"},t.getVdom());const h=n.getUserId()===b.id,g=p.user,v=o(b),y=n.get(),k=y&&y.id,w=k&&a.crosstable&&a.crosstable.nbGames>0;return e("div",{className:"miniUser"},e("div",{className:"title"},e("div",{className:"username",oncreate:r((()=>u.set(`/@/${b.username}`)))},v),b.profile&&b.profile.country?e("p",{className:"country"},e("img",{className:"flag",src:d("images/flags/"+b.profile.country+".png")}),ia[b.profile.country]):null),b.tosViolation?e("div",{className:"warning"},b.tosViolation?s("thisAccountViolatedTos"):""):null,a.perfs?e("div",{className:"mini_perfs"},Object.keys(a.perfs).map((t=>{const n=a.perfs[t];return e("div",{className:"perf"},e("span",{"data-icon":l(t)}),n.games>0?n.rating+(n.prov?"?":""):"-")}))):null,void 0!==k&&w?e("div",{className:"score_wrapper"},c("yourScore",e("span",{className:"score"},`${a.crosstable.users[k]} - ${a.crosstable.users[b.id]}`))):null,!w&&g&&f&&f.nbGames>0?e("div",{className:"score_wrapper"},"Lifetime score ",e("em",null,"vs")," ",i(p),":",e("br",null),e("span",{className:"score"},f.users[b.id])," - ",e("span",{className:"score"},f.users[g.id])):null,h?null:e("div",{className:"mini_user_actions_wrapper"},e("button",{"data-icon":"1",oncreate:r((()=>{u.set(`/@/${b.id}/tv`)}))},s("watchGames"))))}(f,p,g,v)),b,h):null}};var ka={oninit({attrs:a}){const{ctrl:e,color:t}=a;this.clockOnCreate=({dom:a})=>{e.elements[t]=a,e.updateElement(t,e.millisOf(t))},this.clockOnUpdate=({dom:a})=>{e.elements[t]=a,e.updateElement(t,e.millisOf(t))}},view({attrs:a}){const{ctrl:t,color:n,isBerserk:o}=a,r=t.millisOf(n),s=n===t.times.activeColor,i=m({clock:!0,outoftime:!r,running:s,berserk:o});return e("div",{className:i,oncreate:this.clockOnCreate,onupdate:this.clockOnUpdate},_a(r,!1))}};const wa=":",Na=" ";function _a(a,e,t=!1){const n=new Date(a),o=n.getUTCMilliseconds(),r=Ta(n.getUTCMinutes()),s=Ta(n.getUTCSeconds());if(a>=36e5){return Ta(n.getUTCHours())+(t&&o<500?Na:wa)+r}if(e){let e=Math.floor(o/100).toString();return!t&&a<1e3&&(e+="<huns>"+Math.floor(o/10)%10+"</huns>"),r+wa+s+"<tenths>."+e+"</tenths>"}return r+wa+s}function Ta(a){return(a<10?"0":"")+a}function Oa(a){a.promoting&&a.reloadGameData(),a.promoting=null}var Ca={start:function(a,e,t,n){return!!ua.canPromote(a.chessground.state,t)&&(!(3===a.data.pref.autoQueen||2===a.data.pref.autoQueen&&n)&&(a.promoting={orig:e,dest:t,callback:(e,t,n)=>a.sendMove(e,t,n)},p(),!0))},view:a=>ua.view(a,Oa)},Aa={standard:(a,t,n,o,i,c)=>t(a.data)&&f()?e("button",{className:i,"data-icon":n,oncreate:r(c||(()=>{a.socket.iface.send(i)}))},s(o)):null,bookmark:a=>n.isConnected()?e("button",{oncreate:r(a.toggleBookmark),"data-icon":a.data.bookmarked?"t":"s"},[s("bookmarkThisGame")]):null,toggleZen:a=>a.zenAvailable()?e("button",{className:a.isZen()?"on":"",oncreate:r(a.toggleZenMode)},[e("span.fa.fa-volume-off"),s("zenMode")]):null,shareLink:a=>e("button",{oncreate:r((()=>{const e=a.chessground.state.orientation;ma.share({url:`${q(a.data)}/${e}#${a.vm.ply}`})}))},[s("shareGameUrl")]),sharePGN:a=>e("button",{oncreate:r((function(){fa(a.data.game.id).catch((a=>{throw v(a),a})).then((a=>ma.share({text:a})))}))},s("sharePgn")),submitMove:a=>e("div.negotiationButtonsWrapper",[e("p",s("moveConfirmation")),e("div.negotiationButtons",{className:a.vm.submitFeedback?"loading":""},[e("button.accept",{"data-icon":a.vm.submitFeedback?null:"E",oncreate:r((()=>a.submitMove(!0)))},a.vm.submitFeedback?t.getVdom("monochrome white"):null),e("button.decline",{"data-icon":"L",oncreate:r((()=>a.submitMove(!1)))})])]),resign:a=>z(a.data)&&!a.vm.confirmResign?e("button",{className:"resign","data-icon":"b",oncreate:r((()=>{a.vm.confirmResign=!0}))},s("resign")):null,resignConfirmation:a=>z(a.data)&&a.vm.confirmResign?e("div",{className:"negotiation"},e("div",{className:"binary_choice_wrapper"},e("button",{className:"binary_choice","data-icon":"E",oncreate:r((()=>{a.socket.iface.send("resign")}))},s("resign")),e("button",{className:"binary_choice","data-icon":"L",oncreate:r((()=>{a.vm.confirmResign=!1}))},s("cancel")))):null,forceResign:a=>E(a.data)?e("div.force_resign_zone",[e("div.notice",s("opponentLeftChoices")),e("div.binary_choice_wrapper",[e("button.binary_choice.left",{oncreate:r((()=>{a.socket.iface.send("resign-force")}))},s("forceResignation")),e("button.binary_choice.right",{oncreate:r((()=>{a.socket.iface.send("draw-force")}))},s("forceDraw"))])]):null,threefoldClaimDraw:a=>a.data.game.threefold?e("div.claim_draw_zone",[e("div.notice",s("threefoldRepetition")),e.trust("&nbsp;"),e("button[data-icon=E]",{oncreate:r((()=>{a.socket.iface.send("draw-claim")}))},s("claimADraw"))]):null,offerDraw:a=>a.vm.confirmDraw?null:e("button",{className:"draw-yes",oncreate:r((()=>{a.vm.confirmDraw=!0})),disabled:!a.canOfferDraw()},e("span","½"),s("offerDraw")),drawConfirmation:a=>a.canOfferDraw()&&a.vm.confirmDraw?e("div",{className:"negotiation"},e("div",{className:"binary_choice_wrapper"},e("button",{className:"binary_choice","data-icon":"E",oncreate:r((()=>{a.vm.confirmDraw=!1,a.offerDraw()}))},s("offerDraw")),e("button",{className:"binary_choice","data-icon":"L",oncreate:r((()=>{a.vm.confirmDraw=!1}))},s("cancel")))):null,cancelDrawOffer:a=>a.data.player.offeringDraw?e("div.negotiation",[e("div.notice",s("drawOfferSent"))]):null,answerOpponentDrawOffer:a=>a.data.opponent.offeringDraw?e("div.negotiation",[e("div.notice",s("yourOpponentOffersADraw")),e("div.binary_choice_wrapper",[e("button.binary_choice[data-icon=E]",{oncreate:r((()=>{a.socket.iface.send("draw-yes")}))},s("accept")),e("button.binary_choice[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("draw-no")}))},s("decline"))])]):null,cancelTakebackProposition:a=>a.data.player.proposingTakeback?e("div.negotiation",[e("div.notice",s("takebackPropositionSent")),e("button[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("takeback-no")}))},s("cancel"))]):null,answerOpponentTakebackProposition:a=>a.data.opponent.proposingTakeback?e("div.negotiation",[e("div.notice",s("yourOpponentProposesATakeback")),e("div.binary_choice_wrapper",[e("button.binary_choice[data-icon=E]",{oncreate:r((()=>{a.acceptTakeback()}))},s("accept")),e("button.binary_choice[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("takeback-no")}))},s("decline"))])]):null,analysisBoard(a){const t=a.data;return F(t)||Z(t)?e("button",{oncreate:r(a.goToAnalysis)},[e("span[data-icon=A].withIcon"),s("analysis")]):null},notes:a=>a.notes?e("button",{oncreate:r((()=>a.notes&&a.notes.open()))},[e("span.fa.fa-pencil.withIcon"),s("notes")]):null,analysisBoardIconOnly(a){const t=a.data;return F(t)||Z(t)?e("button.action_bar_button[data-icon=A]",{oncreate:r(a.goToAnalysis)}):null},newOpponent(a){const t=a.data,n=(H.finished(t)||H.aborted(t))&&("lobby"===t.game.source||"pool"===t.game.source);return!a.data.opponent.ai&&n?e("button[data-icon=r]",{oncreate:r((()=>{a.hideActions(),g.onNewOpponent(a.data)}))},s("newOpponent")):null},rematch(a){const t=a.data,n=!t.game.rematch&&(H.finished(t)||H.aborted(t))&&!t.game.tournamentId&&!t.game.boosted&&(t.opponent.onGame||!t.clock&&t.player.user&&t.opponent.user);return a.data.opponent.offeringRematch?e("div.negotiation",[e("div.notice",s("yourOpponentWantsToPlayANewGameWithYou")),e("div.binary_choice_wrapper",[e("button.binary_choice[data-icon=E]",{oncreate:r((()=>{a.socket.iface.send("rematch-yes")}))},s("joinTheGame")),e("button.binary_choice[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("rematch-no")}))},s("decline"))])]):a.data.player.offeringRematch?e("div.negotiation",[e("div.notice",s("rematchOfferSent")),e("div.notice",s("waitingForOpponent")),e("button[data-icon=L]",{oncreate:r((()=>{a.socket.iface.send("rematch-no")}))},s("cancelRematchOffer"))]):e("button",{oncreate:r((()=>{a.socket.iface.send("rematch-yes")})),disabled:!n},[e("span.fa.fa-refresh"),s("rematch")])},moretime:a=>W(a.data)?e("button[data-icon=O]",{oncreate:r(a.socket.moreTime)},b("giveNbSeconds",15)):null,flipBoard(a){const t=m({action_bar_button:!0,highlight:a.vm.flip});return e("button",{className:t,"data-icon":"B",oncreate:r(a.flip)})},first(a){const t=a.vm.ply-1,n=a.vm.ply!==t&&t>=a.firstPly(),o=m({action_bar_button:!0,fa:!0,"fa-fast-backward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpFirst)})},autocomplete(a){const t=a.chessground.state.peripheral,n=!t.isSynchronized&&t.isSettable,o=m({action_bar_button:!0,fa:!0,"fa-magic":!0,disabled:!n});return h.features().setState?e("button",{className:o,oncreate:r(h.onCentralSetState)}):null},backward(a){const t=a.vm.ply-1,n=a.vm.ply!==t&&t>=a.firstPly(),o=m({action_bar_button:!0,fa:!0,"fa-backward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpPrev,void 0,a.jumpPrev)})},forward(a){const t=a.vm.ply+1,n=a.vm.ply!==t&&t<=a.lastPly(),o=m({action_bar_button:!0,fa:!0,"fa-forward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpNext,void 0,a.jumpNext)})},last(a){const t=a.vm.ply+1,n=a.vm.ply!==t&&t<=a.lastPly(),o=m({action_bar_button:!0,fa:!0,"fa-fast-forward":!0,disabled:!n});return e("button",{className:o,oncreate:r(a.jumpLast)})},returnToTournament:a=>e("button",{oncreate:r((function(){a.hideActions();const e=`/tournament/${a.data.game.tournamentId}`;a.data.tv?u.set(e):u.set(e,!0)}))},e("span",{className:"fa fa-trophy"}),s("backToTournament")),withdrawFromTournament:(a,t)=>e("button",{oncreate:r((function(){a.hideActions(),pa(t),u.set(`/tournament/${t}`,!0)}))},e("span",{className:"fa fa-flag"}),"Pause"),goBerserk(a){if(!K(a.data))return null;if(a.vm.goneBerserk[a.data.player.color])return null;return e("button",{className:"berserk",oncreate:r((function(){a.hideActions(),a.goBerserk()}))},e("span",{"data-icon":"`"})," GO BERSERK!",e("br",null),e("small",null,"Half the time, bonus point"))}};function Da(a,e){return(a/Math.pow(10,e)).toFixed(e).substr(2)}function Sa(a){const e=new Date(a),t=Da(e.getUTCMinutes(),2),n=Da(e.getSeconds(),2);let o,r="";if(a>=864e5){const a=e.getUTCDate()-1;o=e.getUTCHours(),r+=b("nbDays",a),0!==o&&(r+=" "+b("nbHours",o))}else a>=36e5?(o=e.getUTCHours(),r+=Da(o,2)+":"+t):r+=t+":"+n;return r+(f()?"":"?")}function Ba(a,t,n){const o=a.data[t],r="correspondence clock "+m({outoftime:!o,running:n===t,emerg:o<a.data.emerg,offline:!f()});return e("div",{className:r},Sa(1e3*o))}function Ma(a){a&&y((()=>{const e=a.querySelector(".current");e&&(a.scrollTop=e.offsetTop-a.offsetHeight/2+e.offsetHeight/2)}))}function ja(a){a&&y((()=>{const e=a.querySelector(".current");e&&(a.scrollLeft=e.offsetLeft-a.offsetWidth/2+e.offsetWidth/2)}))}function Pa(a){const e=a.target;return"MOVE"===e.tagName?e:k(e,"move")}function Ua(a,e){const t=Pa(e);t&&t.dataset.ply&&a.jump(Number(t.dataset.ply))}const La={white:0,black:0};function xa(a){const t=w.game.pieceNotation();return!a.vm.moveList||a.isZen()?null:e("div.replay.box",{className:m({displayPieces:!!t}),oncreate:e=>{setTimeout((()=>Ma(e.dom)),100),N((e=>Ua(a,e)),void 0,Pa)(e)},onupdate:a=>Ma(a.dom)},Ra(a))}function Ga(a){const t=w.game.pieceNotation();return a.vm.moveList?e("div.replay_inline",{className:m({displayPieces:!!t,hidden:a.isZen()}),oncreate:e=>{setTimeout((()=>ja(e.dom)),100),_((e=>Ua(a,e)),void 0,Pa)(e)},onupdate:a=>ja(a.dom)},Ra(a)):null}function Ra(a){return a.data.steps.filter((a=>null!==a.san)).map((t=>{return e("move.replayMove",{className:t.ply===a.vm.ply?"current":"","data-ply":t.ply},[1&t.ply?(n=t.ply,o=!0,e("index",Va(n,o))):null,T(t.san)]);var n,o}))}function Va(a,e){return function(a){return Math.floor((a-1)/2)+1}(a)+(e?a%2==1?".":"...":"")}function $a(a){return a}var Ia=9007199254740991,za=4294967295,Ea=Math.min;function Fa(a,e){if((a=ba(a))<1||a>Ia)return[];var t,n=za,o=Ea(a,za);a-=za;for(var r=function(a,e){for(var t=-1,n=Array(a);++t<a;)n[t]=e(t);return n}(o,e="function"==typeof(t=e)?t:$a);++n<a;)e(n);return r}function Za(a){const t=O();return sa.board(function(a){let t;t=a.goingBack||!a.data.tv&&!a.data.userTV&&a.data.player.spectator?[S([qa(a),B(a.toggleBookmark,a.data.bookmarked)])]:[M(),qa(a)];return t.push(j()),e("nav",{key:"roundHeader",className:P.isConnected()?"":"reconnecting"},t)}(a),function(a,t){const n=C(),o=a.chessground.getMaterialDiff(),r=a.data.player.checks||a.data.opponent.checks?function(a,e){const t=Object.assign({},La);for(const n of a){if(e<n.ply)break;n.check&&(n.ply%2==1?t.white++:t.black++)}return t}(a.data.steps,a.vm.ply):La,s=!a.data.tv&&a.vm.flip,i=Ja(a,a.data.player,o[a.data.player.color],r[a.data.player.color],"player",s),c=Ja(a,a.data.opponent,o[a.data.opponent.color],r[a.data.opponent.color],"opponent",s),l=Q(a.data),d=X(a.data),u=e(da,{variant:a.data.game.variant.key,chessground:a.chessground},l?[d?null:Qa(a,"opponent",d),d?Qa(a,"player",d):null]:[]);return t?[D(n,t)?Ga(a):null,s?i:c,u,s?c:i,te(a)]:[u,e("section.table",[s?i:c,xa(a),te(a),s?c:i])]}(a,t),"round",function(a){let t=!a.data.opponent.user||a.data.player.spectator?s("chat"):a.data.opponent.user.username;const n=a.data.watchers;a.data.player.spectator&&n&&n.nb>=2?t=s("spectators")+" "+n.nb:a.data.player.spectator&&(t=s("spectatorRoom"));return[a.chat?va(a.chat,t):null,a.notes?ha(a.notes):null,Ca.view(a),ee(a),Xa(a),e(ya,{player:a.data.player,opponent:a.data.opponent,mini:a.vm.miniUser.player.data,score:a.score,isOpen:a.vm.miniUser.player.showing,close:()=>a.closeUserPopup("player")}),e(ya,{player:a.data.opponent,opponent:a.data.player,mini:a.vm.miniUser.opponent.data,score:a.score,isOpen:a.vm.miniUser.opponent.showing,close:()=>a.closeUserPopup("opponent")})]}(a),void 0,void 0,"roundView")}function Ha(a){return e.fragment({},[e("div.materials",Object.keys(a.pieces).map((t=>e("div.material",Fa(a.pieces[t],(a=>e("piece",{className:t}))))))),a.score>0?e("span",`+${a.score}`):null])}function Wa(a,t,n,o,r,s){const i=O(),c=C(),l=e("section",{className:"board_wrapper"+(r?" "+r:"")},e(A,{fen:a,lastMove:n,orientation:t,variant:o,customPieceTheme:s})),d=D(c,i)&&w.game.moveList()&&!w.game.zenMode();return i?e.fragment({},[d?e("div.replay_inline"):null,e("section.playTable.opponent"),l,e("section.playTable.player"),e("section.actions_bar")]):e.fragment({},[l,e("section.table")])}const Ka={view:()=>sa.board(V(),Wa(ra,"white"),"roundView")};function qa(a){const t=a.data,o=a.data.tournament;if(a.vm.offlineWatcher||P.isConnected()){const r=!t.player.spectator&&"correspondence"===t.game.speed;return a.data.tv?e("div.main_header_title.withSub",[e("h1.header-gameTitle",[ae(a)]),e("h2.header-subTitle",J(a.data))]):a.data.userTV?e("div.main_header_title.withSub",[e("h1.header-gameTitle",[e("span.withIcon[data-icon=1]"),a.data.userTV]),e("h2.header-subTitle",[e(`span.withIcon[data-icon=${l(a.data.game.perf)}]`),J(a.data)].concat(o?[" • ",e("span.fa.fa-trophy"),e(la,{seconds:o.secondsToFinish||0})]:[]))]):e(ca,{data:a.data,kidMode:n.isKidMode(),subTitle:o?"tournament":r?"corres":"date"})}return e("div",{className:"main_header_title reconnecting"},L)}function Qa(a,t,n){const o=a.data.expiration;if(!o)return null;const r=Math.max(0,o.movedAt-Date.now()+o.millisToMove);return e("div.round-expiration",{className:t},e(la,{seconds:Math.round(r/1e3),emergTime:n?8:void 0,textWrap:(a,e)=>b("nbSecondsToPlayTheFirstMove",a,`<strong>${e}</<strong>`),showOnlySecs:!0}))}function Xa(a){return a.vm.moveToSubmit||a.vm.dropToSubmit||a.vm.submitFeedback?e("div",{className:"overlay_popup_wrapper submitMovePopup"},e("div",{className:"overlay_popup"},Aa.submitMove(a))):null}function Ya(a,t,n,o,s,c,l){const d=t.user,u=function(a){var t,n,o;if(a.name||a.username||a.user){const r=a.name||a.username||(null===(t=a.user)||void 0===t?void 0:t.username);return e("span",[(null===(n=a.user)||void 0===n?void 0:n.title)?[e("span.userTitle"+("BOT"===(null===(o=a.user)||void 0===o?void 0:o.title)?".bot":""),a.user.title)," "]:[],r])}return a.ai?x({ai:a.ai}):"Anonymous"}(t),m=d?r(d?()=>a.openUserPopup(c,d.id):R,(()=>function(a,e,t){let n;n=a?`${t}: ${a.online?"connected to lichess":"offline"}; ${e.onGame?"currently on this game":"currently not on this game"}`:t;G.show({text:n,position:"center",duration:"short"})}(d,t,i(t)))):r(R,(()=>{var a;return G.show({text:t.name||t.username||(null===(a=t.user)||void 0===a?void 0:a.username),position:"center",duration:"short"})})),p=a.data.tournament&&a.data.tournament.ranks?"#"+a.data.tournament.ranks[t.color]+" ":null,f=a.vm.goneBerserk[t.color],b="threeCheck"===a.data.game.variant.key?o:void 0;return e("div",{className:"antagonistInfos"+(l?" crazy":"")+(a.isZen()?" zen":""),oncreate:m},e("h2",{className:"antagonistUser"},d&&d.patron?e("span",{className:"patron status "+(t.onGame?"ongame":"offgame"),"data-icon":""}):e("span",{className:"fa fa-circle status "+(t.onGame?"ongame":"offgame")}),p,u,f?e("span",{className:"berserk","data-icon":"`"}):null,l&&"opponent"===c&&d&&d.tosViolation?e("span",{className:"warning","data-icon":"j"}):null),l?null:e("div",{className:"ratingAndMaterial"},"opponent"===c&&d&&d.tosViolation?e("span",{className:"warning","data-icon":"j"}):null,d?e("h3",{className:"rating"},t.rating,t.provisional?"?":"",U(t)):null,void 0!==b?[...Array(b).keys()].map((a=>e("div.material",e("piece",{className:"king"})))):null,a.vm.showCaptured&&"horde"!==a.data.game.variant.key?Ha(n):null),l&&a.clock?[e(ka,{key:s.toString(),ctrl:a.clock,color:t.color,isBerserk:f})]:l&&a.correspondenceClock?Ba(a.correspondenceClock,t.color,a.data.game.player):null)}function Ja(a,t,n,o,r,s){const i=a.plyStep(a.vm.ply),c=!!i.crazy,l=m({playTable:!0,crazy:c,clockOnLeft:"left"===a.vm.clockPosition});return e("section",{className:l+" "+r},Ya(a,t,n,o,s,r,c),i.crazy?e(ga,{ctrl:a,crazyData:i.crazy,color:t.color,position:r}):null,!c&&a.clock?[e(ka,{key:s.toString(),ctrl:a.clock,color:t.color,isBerserk:a.vm.goneBerserk[t.color]})]:!c&&a.correspondenceClock?Ba(a.correspondenceClock,t.color,a.data.game.player):null)}function ae(a){const t=oa.filter((a=>"correspondence"!==a[0])).map((a=>[a[1],a[0]]));t.unshift(["Top rated","best"]),t.push(["Bot","bot"]),t.push(["Computer","computer"]);const n=w.tv.channel(),o=l(n);return e("div.select_input.main_header-selector.round-tvChannelSelector",[e("label",{for:"channel_selector"},[e(`i[data-icon=${o}]`),e("span",e.trust("&nbsp;")),e("span","Lichess TV")]),e("select#channel_selector",{value:n,onchange(e){const t=e.target.value;w.tv.channel(t),a.onFeatured&&a.onFeatured(),setTimeout(p,10)}},t.map((a=>e("option",{key:a[1],value:a[1]},a[0]))))])}function ee(t){const n=Q(t.data)?void 0:()=>function(a){const t=ta(a.data),n=na(a.data,a.data.game.winner),o=H.toLabel(a.data.game.status.name,a.data.game.turns,a.data.game.winner,a.data.game.variant.key)+(n?". "+s("white"===n.color?"whiteIsVictorious":"blackIsVictorious")+".":"");return(H.aborted(a.data)?[]:[e("strong",t),e("br")]).concat([e("em.resultStatus",o)])}(t);return a("player_controls",t.vm.showingShareActions?void 0:n,(()=>Q(t.data)?function(a){return e("div.gameControls",{key:"gameRunningActions"},a.data.player.spectator?[Aa.shareLink(a)]:[Aa.toggleZen(a),Aa.analysisBoard(a),Aa.notes(a),Aa.moretime(a),Aa.standard(a,aa,"L","abortGame","abort")].concat(E(a.data)?[Aa.forceResign(a)]:[Aa.standard(a,ea,"i","proposeATakeback","takeback-yes"),Aa.cancelTakebackProposition(a),Aa.offerDraw(a),Aa.drawConfirmation(a),Aa.cancelDrawOffer(a),Aa.threefoldClaimDraw(a),Aa.resign(a),Aa.resignConfirmation(a),Aa.goBerserk(a),Aa.answerOpponentDrawOffer(a),Aa.answerOpponentTakebackProposition(a)]))}(t):function(a){let t;const n=a.data.game.tournamentId,o=e("button",{oncreate:r(a.showShareActions)},[e("span.fa.fa-share"),s("shareAndExport")]);return t=a.vm.showingShareActions?[Aa.shareLink(a),Aa.sharePGN(a)]:n?a.data.player.spectator?[o,Aa.analysisBoard(a),Aa.returnToTournament(a)]:[o,Aa.analysisBoard(a),Aa.withdrawFromTournament(a,n),Aa.returnToTournament(a)]:a.data.player.spectator?[o,Aa.analysisBoard(a)]:[o,Aa.analysisBoard(a),Aa.notes(a),Aa.newOpponent(a),Aa.rematch(a)],e("div.game_controls",{key:"gameEndedActions"},e.fragment({key:a.vm.showingShareActions?"shareMenu":"menu"},t))}(t)),t.vm.showingActions,t.hideActions)}function te(a){const t=(a.data.opponent.proposingTakeback||a.data.opponent.offeringDraw)&&!H.finished(a.data)||E(a.data)||a.data.opponent.offeringRematch,n=(a.data.opponent.proposingTakeback?["fa","fa-mail-reply"]:a.data.opponent.offeringDraw?[]:["fa","fa-list"]).concat(["action_bar_button",t?"glow":""]).join(" ");return e("section",{className:"actions_bar"},e("button",{className:n,oncreate:r(a.showActions)},a.data.opponent.offeringDraw?"½":""),a.chat&&!a.isZen()?e("button",{className:"action_bar_button fa fa-comments withChip",oncreate:r(a.chat.open)},a.chat.nbUnread>0?e("span",{className:"chip"},a.chat.nbUnread<=99?a.chat.nbUnread:99):null):null,Y(a.data)?function(a){return e("button.action_bar_button[data-icon=A].withChip",{oncreate:r(a.goToAnalysis)},(a.data.forecastCount||0)>0?e("span.chip",a.data.forecastCount):null)}(a):null,Aa.flipBoard(a),Q(a.data)?null:Aa.analysisBoardIconOnly(a),Aa.autocomplete(a),Aa.backward(a),Aa.forward(a))}function ne(a,e){const t=[],n=new Map,o=$(e);for(let r=-1;r<2;r++)for(let s=-1;s<2;s++){const i=I([o[0]+r,o[1]+s]);if(i){t.push(i);const o=a.state.pieces.get(i);o&&(i===e||"pawn"!==o.role)&&n.set(i,null)}}a.setPieces(n),a.explode(t)}var oe={capture:ne,enpassant:function(a,e,t){const n=$(e),o=[n[0],n[1]+("white"===t?-1:1)];ne(a,I(o))}},re={drop(a,e,t,n){if(!a.game.offline&&!X(a))return!1;if("pawn"===e&&("1"===t[1]||"8"===t[1]))return!1;if(null==n)return!0;return-1!==(Array.isArray(n)?n:n.match(/.{2}/g)||[]).indexOf(t)}};export{Ka as L,oe as a,Ma as b,re as c,ja as d,Za as e,_a as f,Pa as g,Sa as h,Ua as o,Ca as p,Ha as r,Wa as v};
