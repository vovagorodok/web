const n="";function t(n){return n.length/2}function e(n){return n.slice(0,2)}function r(n){return n.slice(2)}function o(n){return n.slice(0,-2)}function c(n,t){return 0===n.indexOf(t)}function i(n){let t="";for(const e in n)t+=n[e].id;return t}function s(n,t){const e=function(n){return n.children[0]}(n);return e?t(e):void 0}function u(n,t){const e=[n];let r,o=n;for(;r=t(o);)e.push(r),o=r;return e}function d(n){return n.children[0]}function l(n,t){return n.children.find((n=>n.id===t))}function f(n){return n[n.length-1]}function h(n,t){let e="";for(const r in n){if(!t(n[r]))break;e+=n[r].id}return e}function a(n,t){n.children=n.children.filter((n=>n.id!==t))}function m(n){const t={nodes:1,comments:(n.comments||[]).length};return n.children.forEach((n=>{const e=m(n);t.nodes+=e.nodes,t.comments+=e.comments})),t}function p(n){const t=n[0];void 0!==t.crazy&&(t.crazyhouse=t.crazy,t.crazy=void 0),t.id="";const e=t;let r=e;for(let t=1,e=n.length;t<e;t++){const e=n[t];void 0!==e.crazy&&(e.crazyhouse=e.crazy,e.crazy=void 0);const o=e;r.children?r.children.unshift(o):r.children=[o],r=o}return r.children=r.children||[],e}function v(n,t){n.eval=t.eval,t.glyphs&&(n.glyphs=t.glyphs),t.comments&&t.comments.forEach((t=>{n.comments?n.comments.filter((n=>n.text===t.text)).length||n.comments.push(t):n.comments=[t]})),t.children.forEach((t=>{const e=l(n,t.id);e?v(e,t):n.children.push(t)}))}function g(n,t){return!!(t<=0||n.children[1])||!!n.children[0]&&g(n.children[0],t-1)}function y(n){return u(n,d)}function k(n,t){const e=n=>{t(n),n.children.forEach(e)};e(n)}function C(n){function t(){return function(n,t){const e=n=>t(n)?n:s(n,e);return e(n)}(n,(n=>!n.children.length))}function c(t){return i(n,t)}function i(n,t){if(""===t)return n;const o=l(n,e(t));return o?i(o,r(t)):n}function d(t){return f(n,t)}function f(n,t){if(""===t)return n;const o=l(n,e(t));return o?f(o,r(t)):void 0}function h(n,t){const o=e(t),c=l(n,o);return c?o+h(c,r(t)):""}function m(n,t){if(""===t)return!0;const o=e(t),c=n.children[0];return!(!c||c.id!==o)&&m(c,r(t))}function p(n,t){if(""===t)return n;const o=e(t),c=n.children[0];return c&&c.id===o?p(c,r(t)):n}function g(t){return u(n,(n=>{const o=e(t);if(""!==o)return t=r(t),l(n,o)}))}function C(n,t){const e=d(n);if(e)return t(e),e}function A(n,t){const e=t+n.id,r=d(e);return r?(void 0!==n.dests&&void 0===r.dests&&(r.dests=n.dests),void 0!==n.drops&&void 0===r.drops&&(r.drops=n.drops),e):C(t,(t=>t.children.push(n)))?e:void 0}function x(n,t){return C(t,(t=>{const e=(t.comments||[]).filter((t=>t.id!==n));t.comments=e.length?e:void 0}))}function z(n){return c(o(n))}return{root:n,firstPly:()=>n.ply,lastPly:()=>t().ply,lastNode:t,nodeAtPath:c,getNodeList:g,longestValidPath:t=>h(n,t),getOpening:function(n){let t;return n.forEach((n=>{t=n.opening||t})),t},updateAt:C,addNode:A,addNodes:function n(t,e){const r=t[0];if(!r)return e;const o=A(r,e);return o?n(t.slice(1),o):void 0},setShapes:(n,t)=>C(t,(t=>{t.shapes=n})),setCommentAt:function(n,t){return n.text?C(t,(t=>{t.comments=t.comments||[];const e=t.comments.find((t=>t.id===n.id));e?e.text=n.text:t.comments.push(n)})):x(n.id,t)},deleteCommentAt:x,setGlyphsAt:function(n,t){return C(t,(t=>{t.glyphs=n}))},setClockAt:function(n,t){return C(t,(t=>{t.clock=n}))},pathIsMainline:function(t){return m(n,t)},lastMainlineNode:t=>p(n,t),pathExists:function(n){return!!d(n)},deleteNodeAt:function(n){const t=z(n),e=function(n){return n.slice(-2)}(n);a(t,e)},promoteAt:function(n,t){const e=g(n);for(let n=e.length-2;n>=0;n--){const r=e[n+1],o=e[n];if(o.children[0].id!==r.id&&(a(o,r.id),o.children.unshift(r),!t))break}},getCurrentNodesAfterPly:function(n,t,e){const r=[];for(const o in n){const c=n[o];if(c.ply<=e&&t[o].id!==c.id)break;c.ply>e&&r.push(c)}return r},merge(t){v(n,t)},removeCeval(){k(n,(n=>{n.ceval=void 0,n.threat=void 0}))},removeComputerVariations(){y(n).forEach((n=>{n.children=n.children.filter((n=>!n.comp))}))},parentNode:z,getParentClock:function(n,t){if(!("parentClock"in n)){const e=t&&z(t);n.parentClock=e?"clock"in e?e.clock:void 0:n.clock}return n.parentClock}}}export{p as a,C as b,c,m as d,l as e,i as f,v as g,g as h,o as i,f as l,y as m,n as r,t as s,h as t,k as u,s as w};
