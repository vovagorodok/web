import{V as t,k as e,m as a,o as n,X as s,g as i,b8 as r,a1 as o,a3 as l,$ as c,F as u,cJ as m,cK as d,cL as p,ai as f,cM as v,P as b,r as h,cf as N,v as _,q as T,b as w,aC as g}from"./main.js";import{l as y}from"./layout-b3635a82.js";import{c as k,a as x}from"./tournamentXhr-ac80abd2.js";import{a as A,T as C}from"./TabView-f358fd2b.js";let S=!1;var P={open:function(){e.backbutton.stack.push(I),S=!0},close:I,view:c=>t("tournament_form_popup",void 0,(()=>function(t){return a("form",{id:"tournamentCreateForm",class:"tournamentForm",onsubmit:t=>(t.preventDefault(),function(t){const a=t[0].elements,n=a[0].value,s=a[1].value,r="1"===i.tournament.variant()?a[2].value:"---",o=a[3].value,c=a[4].value,u=a[5].value,m=a[6].value,d=a[7].value,p=a[8].checked?a[8].value:"",f=p?a[9].value:"";k(n,s,r,o,c,u,m,d,p,f).then((t=>{I(),e.set("/tournament/"+t.id)})).catch(l)}(t.target))},a("fieldset",null,a("div",{className:"select_input no_arrow_after"},a("div",{className:"text_input_container"},a("label",null,n("name")," "),a("input",{type:"text",id:"name",className:"textField",autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1}),"Arena")),a("div",{className:"tournament_name_warning"},n("safeTournamentName")," ",n("inappropriateNameWarning")," ",n("emptyTournamentName")),a("div",{className:"select_input"},s.renderSelect("Variant","variant",i.tournament.availableVariants,i.tournament.variant,!1)),void 0!==t.startPositions?a("div",{className:"select_input"+("1"!==i.tournament.variant()?" notVisible":"")},a("label",{for:"select_start_position"},"Position"),a("select",{id:"select_start_position",className:"positions"},a("option",{value:r},"Initial Position"),t.startPositions.map((t=>a("optgroup",{label:t.name},t.positions.map((t=>a("option",{value:t.fen},t.eco+" "+t.name)))))))):null,a("div",{className:"select_input"},s.renderSelect(n("mode"),"mode",i.tournament.availableModes,i.tournament.mode,!1)),a("div",{className:"select_input inline"},s.renderSelect(n("time"),"time",i.tournament.availableTimes,i.tournament.time,!1)),a("div",{className:"select_input inline no-margin"},s.renderSelect(n("increment"),"increment",i.tournament.availableIncrements.map((t=>o(Number(t)))),i.tournament.increment,!1)),a("div",{className:"select_input inline"},s.renderSelect(n("duration"),"duration",i.tournament.availableDurations.map((t=>o(Number(t)))),i.tournament.duration,!1)),a("div",{className:"select_input inline no-margin"},s.renderSelect("Time to Start","timeToStart",i.tournament.availableTimesToStart.map((t=>o(Number(t)))),i.tournament.timeToStart,!1)),a("div",{className:"select_input"},s.renderCheckbox(n("isPrivate"),"private",i.tournament.private)),a("div",{className:"select_input no_arrow_after"+(i.tournament.private()?"":" notVisible")},a("div",{className:"text_input_container"},a("label",null,"Password "),a("input",{type:"text",id:"password",className:"textField",autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1})))),a("div",{className:"popupActionWrapper"},a("button",{className:"popupAction",type:"submit"},a("span",{className:"fa fa-check"}),n("createANewTournament"))))}(c)),S,I)};function I(t){"backbutton"!==t&&S&&e.backbutton.stack.pop(),S=!1}const L=[{label:"In Progress"},{label:"Upcoming"},{label:"Completed"}];function V(t){const a=b(t),n=null==a?void 0:a.dataset;n.id&&e.set("/tournament/"+n.id)}function j(t){return a("ul.native_scroller.tournamentList",{oncreate:u(V,void 0,b)},t.map(B))}function B(t,e){const s=m(t.clock),i=t.rated?n("rated"):n("casual"),r=d(t.minutes),o="standard"!==t.variant.key?p(t.variant.short):"",l=e%2==0?" even ":" odd ",c=function(t){let e="";e=t.battle?"teamBattle":"lichess"!==t.createdBy?"user":t.hasMaxRating?"maxRating":t.schedule?t.schedule.freq:"";return e}(t);return a("li",{key:t.id,className:"list_item tournament_item"+l+c,"data-id":t.id},a("i",{className:"tournamentListIcon","data-icon":F(t)}),a("div",{className:"tournamentListName"},a("div",{className:"fullName"},t.fullName),a("small",{className:"infos"},s," ",o," ",i," â€¢ ",r)),a("div",{className:"tournamentListTime"},a("div",{className:"time"},M(t.startsAt)," ",a("strong",{className:"timeArrow"},"-")," ",M(t.finishesAt)),a("small",{className:"nbUsers withIcon","data-icon":"r"},t.nbPlayers)))}function F(t){var e;return"shield"===(null===(e=t.schedule)||void 0===e?void 0:e.freq)?"5":f(t.perf.key)}function M(t){const e=new Date(t);return v(e.getHours(),2)+":"+v(e.getMinutes(),2)}class TournamentsListCtrl{constructor(t){this.onTabChange=t=>{const e=window.location.search.replace(/\?tab=\w+$/,"");try{window.history.replaceState(window.history.state,"",e+"?tab="+t)}catch(t){}this.currentTab=t,h()},this.currentTab=t||0,x().then((t=>{t.started=t.started.filter(q),t.created=t.created.filter(q),t.finished=t.finished.filter(q),t.started.sort(D),t.finished.sort(z),this.tournaments=t,h()})).catch(l),N("data/positions.json").then((t=>{this.startPositions=t,h()}))}}function q(t){return-1!==i.game.supportedVariants.indexOf(t.variant.key)}function D(t,e){return"lichess"===t.createdBy&&"lichess"===e.createdBy?t.startsAt-e.startsAt:"lichess"===t.createdBy?-1:1}function z(t,e){return e.finishesAt-t.finishesAt}var H={oncreate:_,oninit({attrs:t}){this.ctrl=new TournamentsListCtrl(T(t.tab))},view(){const t=this.ctrl,e=function(t){if(!t.tournaments)return null;const e=[{id:"started",f:()=>t.tournaments?j(t.tournaments.started):null},{id:"created",f:()=>t.tournaments?j(t.tournaments.created):null},{id:"finished",f:()=>t.tournaments?j(t.tournaments.finished):null}];return[a("div.tabs-nav-header.subHeader",a(A,{buttons:L,selectedIndex:t.currentTab,onTabChange:t.onTabChange})),a(C,{selectedIndex:t.currentTab,tabs:e,onTabChange:t.onTabChange})]}(t),s=w.isConnected()?a("div",{className:"actions_bar"},a("button",{className:"action_create_button",oncreate:c(P.open)},a("span",{className:"fa fa-plus-circle"}),n("createANewTournament"))):void 0,i=P.view(t);return y.free(g(n("tournaments")),e,s,i)}};export{H as default};
