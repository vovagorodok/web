import{r as e,k as a,h as t,a3 as s,b as n,aC as r,m as o,o as i,$ as c,g as l,cq as h,cr as m,p as u,aD as d,P as b,q as p,v as g}from"./main.js";import{l as T}from"./layout-b3635a82.js";import{s as f,g as v,a as _}from"./teamsXhr-5a9ef5f8.js";import{a as S,T as w}from"./TabView-f358fd2b.js";class TeamsListCtrl{constructor(r){this.isSearchOpen=!1,this.onTabChange=a=>{const t=window.location.search.replace(/\?tab=\w+$/,"");try{window.history.replaceState(window.history.state,"",t+"?tab="+a)}catch(e){}this.currentTab=a,e()},this.closeSearch=e=>{"backbutton"!==e&&this.isSearchOpen&&a.backbutton.stack.pop(),this.isSearchOpen=!1},this.onInput=t((a=>{const t=a.target.value.trim();t.length>=3&&f(t).then((a=>{this.searchResults=a,e()}))}),1e3),this.goSearch=()=>{a.backbutton.stack.push(this.closeSearch),this.isSearchOpen=!0},this.goToTeam=e=>{a.set("/teams/"+e.id)},this.currentTab=r||0,v().then((a=>{this.allTeams=a,e()})).catch(s);const o=n.getUserId();o&&_(o).then((a=>{this.myTeams=a,e()})).catch(s)}}function y(e){const a=[{id:"allTeams",f:()=>function(e){if(!e.allTeams)return o("div.loader_container",[d.getVdom("monochrome")]);return o("ul.teamsSuggestion.native_scroller.page",{oncreate:u(C,void 0,b)},[e.allTeams.currentPageResults.map(k)])}(e)},{id:"myTeams",f:()=>function(e){if(!e.myTeams)return o("div.loader_container",[d.getVdom("monochrome")]);return o("ul.teamsSuggestion.native_scroller.page",{oncreate:u(C,void 0,b)},[e.myTeams.map(k)])}(e)}];return[o("div.tabs-nav-header.subHeader",o(S,{buttons:[{label:i("allTeams")},{label:i("myTeams")}],selectedIndex:e.currentTab,onTabChange:e.onTabChange})),o(w,{selectedIndex:e.currentTab,tabs:a,onTabChange:e.onTabChange})]}function C(e){const t=b(e),s=null==t?void 0:t.dataset;s.id&&a.set("/teams/"+s.id)}function k(e,a){return o("li.list_item.teamSuggestion.nav."+(a%2==0?"even":"odd"),{"data-id":e.id},[e.name,o("span.nbMembers",[e.nbMembers])])}var j={oninit({attrs:e}){this.ctrl=new TeamsListCtrl(p(e.tab))},oncreate:g,view(){const e=this.ctrl,a=function(e){return r(o("div.teams_main_header",[o("div.main_header_title",i("teams")),o("button.main_header_button[data-icon=y]",{oncreate:c(e.goSearch)})]))}(e),t=y(e),s=function(e){if(!e.isSearchOpen)return null;const a=["modal","show",l.general.theme.background()].join(" ");return o("div."+a,{id:"searchTeamsModal"},[o("header.main_header",[o("button.main_header_button",{oncreate:c((()=>e.closeSearch()))},[h]),o("div.search_input.allow_select",[o("input",{id:"searchTeams",type:"search",placeholder:i("search"),oninput:e.onInput,autocapitalize:"off",autocomplete:"off",oncreate:m})])]),o("ul.modal_content.native_scroller",{oncreate:u(C,void 0,b)},[e.searchResults?e.searchResults.currentPageResults.map(k):null])])}(e);return T.free(a,t,void 0,s)}};export{j as default};
