import{w as e,x as t,y as s,z as a,B as n,O as i,D as o,m as l,E as c,b as r,F as h,o as u,G as d,H as p,I as m,J as v,K as f,L as g,M as w,P as b,Q as k,R as M,r as N,S,T as E,U as _,g as T,V as X,k as y,X as Y,Y as D,_ as x,$ as I,a0 as L,a1 as C,a2 as O,a3 as P,C as G,a4 as V,a5 as A,a6 as B,a7 as F,a8 as z,a9 as H,aa as $,ab as R,ac as W,ad as j,ae as U,af as K}from"./main.js";class Gesture{constructor(e,t,s){this.element=e,this.vd=t,this.options=s,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[]},this.swipingDirection=null,this.startInputTimestamp=0,this.onTouchStart=e=>{e.changedTouches.length>1||(this.touchStartX=e.changedTouches[0].pageX,this.touchStartY=e.changedTouches[0].pageY,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.touchEndX=null,this.touchEndY=null,this.startInputTimestamp=performance.now(),this.fire("panstart",e))},this.onTouchMove=e=>{if(e.changedTouches.length>1)return;this.touchMoveX=e.changedTouches[0].pageX-this.touchStartX;const t=performance.now()-this.startInputTimestamp;this.velocityX=this.touchMoveX/t,this.touchMoveY=e.changedTouches[0].pageY-this.touchStartY,this.velocityY=this.touchMoveY/t;const s=Math.abs(this.touchMoveX),a=Math.abs(this.touchMoveY),n=s>this.swipeThresholdX,i=a>this.swipeThresholdY;this.swipingDirection=s>a?n?"horizontal":"pre-horizontal":i?"vertical":"pre-vertical",this.fire("panmove",e)},this.onTouchEnd=e=>{if(e.changedTouches.length>1)return;this.touchEndX=e.changedTouches[0].pageX,this.touchEndY=e.changedTouches[0].pageY,this.fire("panend",e);const t=this.touchEndX-this.touchStartX,s=Math.abs(t),a=this.touchEndY-this.touchStartY,n=Math.abs(a);if(s>this.swipeThresholdX||n>this.swipeThresholdY){const i=s>=n&&s>this.swipeThresholdX,o=n>s&&n>this.swipeThresholdY;i&&(t<0?this.velocityX<-this.opts.swipeVelocityThreshold&&this.fire("swipeleft",e):this.velocityX>this.opts.swipeVelocityThreshold&&this.fire("swiperight",e)),o&&(a<0?this.velocityY<-this.opts.swipeVelocityThreshold&&this.fire("swipeup",e):this.velocityY>this.opts.swipeVelocityThreshold&&this.fire("swipedown",e))}},this.swipeThresholdX=Q("x",t),this.swipeThresholdY=Q("y",t),this.element=e,this.opts=Object.assign({},q,s),this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.element.addEventListener("touchstart",this.onTouchStart,J),this.element.addEventListener("touchmove",this.onTouchMove,!!this.opts.passiveMove&&J),this.element.addEventListener("touchend",this.onTouchEnd,J)}destroy(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}on(e,t){if(this.handlers[e])return this.handlers[e].push(t),{type:e,fn:t,cancel:()=>this.off(e,t)}}off(e,t){if(this.handlers[e]){const s=this.handlers[e].indexOf(t);-1!==s&&this.handlers[e].splice(s,1)}}fire(e,t){for(let s=0;s<this.handlers[e].length;s++)this.handlers[e][s](t)}}function Q(e,t){return Math.max(25,Math.floor(.15*("x"===e?t.vw:t.vh)))}const q={swipeVelocityThreshold:.4,passiveMove:!0},J={passive:!0};function Z(o,l){const c=l.side,r=e(),h={backDropElement:null,isScrolling:!1,isClosing:!1},u=new Gesture(o,t(),{passiveMove:!1});u.on("panstart",(()=>{h.backDropElement=l.getBackdropEl(),h.isScrolling=!1,h.isClosing=!1})),u.on("panmove",(e=>{if(!h.isScrolling){if(h.isClosing)e.preventDefault();else if("left"===c&&u.touchMoveX<-5||"right"===c&&u.touchMoveX>5)e.preventDefault(),h.isClosing=!0;else if(h.isScrolling=Math.abs(u.touchMoveY)>5,h.isScrolling)return;"left"===c?u.touchMoveX<0&&u.touchMoveX>=-r&&(s(o,u.touchMoveX),a(h.backDropElement,(r+u.touchMoveX)/r*100/100*n)):u.touchMoveX>0&&u.touchMoveX<=r&&(s(o,u.touchMoveX),a(h.backDropElement,(r-u.touchMoveX)/r*100/100*n))}})),u.on("panend",(()=>{if(h.isScrolling)return;h.isScrolling=!1,h.isClosing=!1;const e=u.velocityX;0!==e&&("left"===c?e<0&&(u.touchMoveX<-(r-r*i)||e<-.4)?l.close():l.open():e>0&&(u.touchMoveX>r-r*i||e>.4)?l.close():l.open())}))}var ee={onbeforeupdate:()=>o.isOpen,view(){const e=r.get();return l("aside",{id:"side_menu",oncreate:({dom:e})=>{Z(e,o)}},function(e){const t=c()?"up":"down";return l("header",{className:"side_menu_header",oncreate:h(w)},r.isKidMode()?l("div",{className:"kiddo"},"ðŸ˜Š"):null,(f(),g(),u("networkLagBetweenYouAndLichess"),u("timeToProcessAMoveOnLichessServer"),l("div",{className:"pingServer"},function(e){const t=void 0===e?0:e<150?4:e<300?3:e<500?2:1,s=[];for(let e=1;e<=4;e++)s.push(l(e<=t?"i":"i.off"));return l("signal.q"+t,s)}(void 0),l("div",null,"Offline"),null)),null,e?l("h2",{className:"username"},e.username,l("i",{className:"fa fa-caret-"+t})):null)}(e),l("div",{className:"native_scroller side_menu_scroller"},e&&c()?function(e){const t={username:e.username};e.title&&(t.title=e.title);e.patron&&(t.patron="1");return l("ul",{className:"side_links profileActions",oncreate:h(se,void 0,b)},l("li",{className:"side_link","data-route":`/@/${e.id}`},e.patron?l("span",{className:"patron","data-icon":"î€™"}):l("span",{className:"fa fa-circle userStatus online"}),u("profile")),l("li",{className:"side_link","data-route":`/@/${e.id}/games?${v(t)}`},l("span",{className:"menu_icon_game"}),u("games")),l("li",{className:"side_link","data-route":"/inbox"},l("span",{className:"fa fa-envelope"}),u("inbox")+(null!==m()&&m()>0?" ("+m()+")":"")),l("li",{className:"side_link","data-route":"/account/preferences"},l("span",{"data-icon":"%"}),u("preferences")),l("li",{className:"side_link","data-action":"friends"},l("span",{"data-icon":"f"}),d("nbFriendsOnline",p.count())),l("li",{className:"side_link","data-nocloseaction":"logout"},l("span",{"data-icon":"w"}),u("logOut")))}(e):function(e){return l("ul",{className:"side_links",oncreate:h(se,void 0,b)},l("li",{className:"side_link","data-route":"/"},l("span",{className:"fa fa-home"}),u("home")),null,null,null,l("li",{className:"sep_link"},u("learnMenu")),null,e?l("li",{className:"side_link","data-route":"/training"},l("span",{"data-icon":"-"}),u("puzzles")):null,null,l("li",{className:"side_link","data-route":"/coord"},l("span",{className:"fa fa-thumb-tack"}),u("coordinates")),null,null,null,null,l("li",{className:"sep_link"},u("tools")),l("li",{className:"side_link","data-route":"/analyse"},l("span",{"data-icon":"A"}),u("analysis")),l("li",{className:"side_link","data-route":"/editor"},l("span",{className:"fa fa-pencil"}),u("boardEditor")),l("li",{className:"side_link","data-route":"/clock"},l("span",{className:"fa fa-clock-o"}),u("clock")),null,null,l("li",{className:"sep_link"},u("playOffline")),l("li",{className:"side_link","data-route":"/ai"},l("span",{className:"fa fa-cogs"}),u("computer")),l("li",{className:"side_link","data-route":"/otb"},l("span",{className:"fa fa-beer"}),u("overTheBoard")),l("li",{className:"hr"}),l("li",{className:"side_link","data-route":"/settings"},l("span",{className:"fa fa-cog"}),u("settings")),l("li",{className:"side_link","data-route":"/about"},l("span",{className:"fa fa-info-circle"}),u("about")))}(e)))}};const te={gamesMenu:()=>S.open(),createGame:()=>E.openRealTime(),friends:()=>_.open(),logout:()=>{r.logout(),c(!1)}};function se(e){e.stopPropagation();const t=b(e);if(t){const e=t.dataset;e.route?k(e.route)():t&&e.action?M(te[e.action])():t&&e.nocloseaction&&(te[e.nocloseaction](),N())}}let ae,ne=!1;var ie={open:oe,close:le,openAIFromPosition(e){T.gameSetup.ai.variant("3"),oe(),ae=e},view:()=>X("game_form_popup",void 0,(function(){return function(e,t,s,a){const n="1"===t.timeMode(),i=[l("div.select_input",[Y.renderSelect("side",e+"color",ce,t.color)]),l("div.select_input",[Y.renderSelect("variant",e+"variant",s,t.variant)]),"3"===t.variant()?l("div.setupPosition",[l("div.setupPositionInput",[l("input[type=text][name=fen]",{placeholder:u("pasteTheFenStringHere"),oninput:e=>{const t=e.target.value;ae=""===t?void 0:D(t).unwrap((e=>x(e)),(()=>!1)),N()}}),l("button.withIcon",{oncreate:I((()=>{le(),y.set("/editor")}))},l("span.fa.fa-pencil"))]),!1===ae?l("div.setupFenError","Invalid FEN"):null,void 0!==ae&&!1!==ae?[l("div",{style:{width:"100px",height:"100px"},oncreate:I((()=>{le(),ae&&y.set(`/editor/${encodeURIComponent(ae)}`)}))},[l(L,{fen:ae,orientation:"white"})])]:null]):null,l("div.select_input",[Y.renderSelect("level","ailevel",["1","2","3","4","5","6","7","8"].map(C),t.level)])],o=[l("div.select_input",[Y.renderSelect("clock",e+"timeMode",a,t.timeMode)])];n&&o.push(l("div.select_input.inline",[Y.renderSelect("time",e+"time",T.gameSetup.availableTimes,t.time,!1)]),l("div.select_input.inline",[Y.renderSelect("increment",e+"increment",T.gameSetup.availableIncrements.map(C),t.increment,!1)]));return l("form.game_form",{onsubmit:function(e){e.preventDefault(),T.gameSetup.isTimeValid(t)&&(le(),O(ae).then((e=>{y.set("/game"+e.url.round)})).catch(P))}},[l("fieldset",i),l("fieldset",o),l("div.popupActionWrapper",[l("button.defaultButton[type=submit]",u("playWithTheMachine"))])])}("ai",T.gameSetup.ai,T.gameSetup.ai.availableVariants,T.gameSetup.ai.availableTimeModes)}),ne,le)};function oe(){y.backbutton.stack.push(le),ae=void 0,ne=!0}function le(e){"backbutton"!==e&&ne&&y.backbutton.stack.pop(),ne=!1}const ce=[["randomColor","random"],["white","white"],["black","black"]];function re(o){const l=o.side,c=e(),r={menuElement:null,backDropElement:null,canSlide:!1};return{panstart:e=>s=>{const a=s.target;"PIECE"===a.nodeName||"SQUARE"===a.nodeName||a.className.startsWith&&a.className.startsWith("cg-board manipulable")||!function(e,t,s){return"left"===t?e<V:e>s-V}(e.touchStartX,l,t().vw)?r.canSlide=!1:(r.menuElement=o.getMenuEl(),r.backDropElement=o.getBackdropEl(),r.menuElement&&r.backDropElement&&(r.menuElement.style.visibility="visible",r.backDropElement.style.visibility="visible",r.canSlide=!0,N()))},panmove:e=>t=>{if(r.canSlide){"ios"===G.getPlatform()&&(t.defaultPrevented||t.preventDefault());const i=e.touchMoveX;"left"===l?i<=c&&(s(r.menuElement,-c+i),a(r.backDropElement,i/c*100/100*n)):i>=-c&&(s(r.menuElement,c+i),a(r.backDropElement,-i/c*100/100*n))}},panend:e=>()=>{const t=e.velocityX;if(r.canSlide&&0!==t){r.canSlide=!1;const s=e.touchMoveX;"left"===l?t>0&&(s>=c*i||t>.2)?o.open():o.close():t<0&&(s<=-c*i||t<-.2)?o.open():o.close()}}}}const he=F(!1);function ue(e){return e?l("div.announce",{className:he()?"expanded":""},[l("span.text",{oncreate:I((()=>{he(!he()),N()}))},e.msg),l("small",A(new Date(e.date),!0)),l("button.dismiss",{oncreate:I(z.dismiss)},B)]):null}var de={oninit(){this.boundHandlers=!1},oncreate({dom:e}){this.gesture=new Gesture(e,t());const s=re(o);for(const e in s)this.gesture.on(e,s[e](this.gesture))},onupdate({attrs:e}){if(!this.boundHandlers&&e.handlers){this.boundHandlers=!0;for(const t in e.handlers)this.gesture.on(t,e.handlers[t](this.gesture))}},view({attrs:e,children:t}){const{header:s,color:a}=e,n={righty:"right"===T.game.landscapeBoardSide()};return e.klass&&(n[e.klass]=!0),l("main#page",{className:a},[l("header.main_header.board",s),ue(z.get()),l("div.content_round",{className:H(n)},t),l("div#menu-close-overlay.menu-backdrop",{oncreate:$})])}},pe={board(e,t,s,a,n,i,o){const c=T.general.theme.background(),r=s?Object.assign({key:s},ve(c)):ve(c);return l("div.view-container",r,[l(de,{header:e,color:i,handlers:n,klass:o},t),l(ee),S.view(),R.view(),W.view(),E.view(),ie.view(),j.view(),_.view(),U.view(),a])},free(e,t,s,a,n){const i=T.general.theme.background();return l("div.view-container",ve(i),[l("main#page",{oncreate:me},[l("header.main_header",e),ue(z.get()),l("div#free_content.content.native_scroller",{className:s?"withFooter":"",oncreate:({dom:e})=>{n&&e.addEventListener("scroll",n)}},t),s?l("footer.main_footer",s):null,l("div#menu-close-overlay.menu-backdrop",{oncreate:$})]),l(ee),S.view(),R.view(),W.view(),E.view(),ie.view(),j.view(),_.view(),U.view(),a])},clock(e,t){const s=T.general.theme.background();return l("div.view-container",ve(s),[l("main#page",[l("div.content.fullScreen",e())]),t?t():null])}};function me({dom:e}){const s=new Gesture(e,t(),{passiveMove:"ios"!==G.getPlatform()}),a=re(o);for(const e in a)s.on(e,a[e](s))}function ve(e){return{className:(t=e,"dark"===t||"light"===t?t:"system"===t?K():"transp "+t)};var t}export{Z as C,re as E,Gesture as G,pe as l,ie as p};
