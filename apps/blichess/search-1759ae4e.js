import{f as e,J as a,g as n,r as s,aH as o,a3 as t,bv as r,c as l,m as i,h as c,o as m,aD as u,p,$ as d,cs as g,cp as h,k as y,v,u as f}from"./main.js";import{l as b}from"./layout-b3635a82.js";import{G as w}from"./GameItem-be98102b.js";import"./game-51118656.js";import"./perfs-d8ca398c.js";function k(a,n=1){return e("/games/search",{method:"GET",query:Object.assign({},a,{page:n})},!1)}let M;function _(e){let l=!1;const i={"players.a":"","players.b":"","players.white":"","players.black":"","players.winner":"",ratingMin:"",ratingMax:"",hasAi:"",source:"",perf:"",turnsMin:"",turnsMax:"",durationMin:"",durationMax:"","clock.initMin":"","clock.initMax":"","clock.incMin":"","clock.incMax":"",status:"",winnerColor:"",dateMin:"",dateMax:"","sort.field":"d","sort.order":"desc",analysed:""};Object.assign(i,e);const c=a(i),m=M&&c===M.queryString,u={paginator:void 0,games:[],scrollPos:0,queryString:c,searching:!1},p=n.general.theme.board(),d=()=>{M=u};function g(){u.searching||(u.searching=!0,s(),setTimeout((()=>{const e=document.getElementById("searchContent");e&&(e.scrollTop=99999)}),250),k(i).then(x).then((e=>{u.queryString=a(i),u.searching=!1,u.paginator=e.paginator,e.paginator?u.games=e.paginator.currentPageResults:u.games=[],function(){const e=`/search?${u.queryString}`;try{window.history.replaceState(window.history.state,"","?="+e)}catch(e){}}(),d(),setTimeout(s,500)})).catch((e=>{u.searching=!1,s(),t(e)})))}return m?setTimeout((()=>{Object.assign(u,M),s()}),300):Object.keys(e).length>0&&g(),{searchState:u,query:i,search:g,toggleBookmark:function(e){r(e).then((()=>{const a=u.games.findIndex((a=>a.id===e)),n=u.games[a];if(n){const e=Object.assign({},n,{bookmarked:!n.bookmarked});u.games[a]=e,s()}}))},more:function(){const e=u.paginator;e&&e.nextPage&&k(i,e.nextPage).then(x).then((e=>{u.paginator=e.paginator,u.paginator&&(u.games=u.games.concat(u.paginator.currentPageResults),s()),d()})).catch(t)},boardTheme:p,handleChange:e=>a=>{const n=a.target.value.trim();Object.assign(i,{[e]:n}),s()},toggleAnalysis:()=>{i.analysed="1"===i.analysed?"":"1",s()},onScroll:e=>{const a=e.target;u.scrollPos=a.scrollTop,d()},onGamesLoaded:()=>{m&&!l&&o((()=>{const e=document.getElementById("searchContent");e&&(e.scrollTop=M.scrollPos),l=!0}))}}}function x(e){return e.paginator&&e.paginator.currentPageResults&&e.paginator.currentPageResults.forEach((e=>{e.date=l(new Date(e.timestamp))})),e}function S(e){const a=function(e){const a=[],n=e["players.a"],s=e["players.b"];n&&a.push({value:n,label:n});s&&a.push({value:s,label:s});return a}(e.query),n="1"===e.query.hasAi;return i("div",{id:"searchContent",className:"native_scroller searchWraper",onscroll:c(e.onScroll,30)},i("form",{id:"advancedSearchForm",onsubmit:a=>{a.preventDefault(),e.search()}},i("div",{className:"game_search_row"},i("label",null,"Players"),i("div",{className:"game_search_input_wrapper"},i("div",{className:"game_search_input"},i("input",{type:"text",name:"players.a",value:e.query["players.a"],oninput:c(e.handleChange("players.a"),200),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1})),i("div",{className:"game_search_input"},i("input",{type:"text",name:"players.b",value:e.query["players.b"],oninput:c(e.handleChange("players.b"),200),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1})))),T(e,m("white"),!!a.length,{name:"players.white",options:a}),T(e,m("black"),!!a.length,{name:"players.black",options:a}),T(e,m("winner"),!!a.length,{name:"players.winner",options:a}),T(e,m("ratingRange"),!0,{name:"ratingMin",options:q,placeholder:"From"},{name:"ratingMax",options:q,placeholder:"To"}),T(e,m("opponent"),!0,{name:"hasAi",options:F}),T(e,m("aiNameLevelAiLevel","A.I.","").trim(),n,{name:"aiLevelMin",options:P,placeholder:"From"},{name:"aiLevelMax",options:P,placeholder:"To"}),T(e,"Source",!0,{name:"source",options:A}),T(e,m("variant"),!0,{name:"perf",options:j}),T(e,"Turns",!0,{name:"turnsMin",options:B,placeholder:"From"},{name:"turnsMax",options:B,placeholder:"To"}),T(e,m("duration"),!0,{name:"durationMin",options:E,placeholder:"From"},{name:"durationMax",options:E,placeholder:"To"}),T(e,m("time"),!0,{name:"clock.initMin",options:L,placeholder:"From"},{name:"clock.initMax",options:L,placeholder:"To"}),T(e,m("increment"),!0,{name:"clock.incMin",options:R,placeholder:"From"},{name:"clock.incMax",options:R,placeholder:"To"}),T(e,"Result",!0,{name:"status",options:G}),T(e,m("winner"),!0,{name:"winnerColor",options:O}),T(e,"Date",!0,{name:"dateMin",options:D,placeholder:"From",noEmpty:!0},{name:"dateMax",options:D,placeholder:"To"}),T(e,"Sort",!0,{name:"sort.field",options:I,noEmpty:!0},{name:"sort.order",options:z,noEmpty:!0}),i("div",{className:"game_search_row"},i("label",null,"Analysis"),i("div",{className:"game_search_input_wrapper"},i("div",{className:"game_search_input full"},i("div",{className:"check_container"},i("input",{type:"checkbox",name:"analysed",checked:"1"===e.query.analysed,onchange:e.toggleAnalysis}))))),i("button",{className:"fatButton",type:"submit"},i("span",{className:"fa fa-search"}),m("search"))),function(e){const a=e.searchState.searching?u.getVdom("monochrome"):void 0===e.searchState.paginator?null:0===e.searchState.games.length?i("div.search-empty",m("noGameFound")):i.fragment({oncreate:e.onGamesLoaded},[e.searchState.games.map(((a,n)=>i(w,{key:a.id,g:a,index:n,boardTheme:e.boardTheme})))]);return i("ul.searchGamesList",{className:e.searchState.searching?"searching":"",oncreate:p((a=>function(e,a){const n=function(e){const a=e.target;return"BUTTON"===a.tagName?a:void 0}(a),s=h(a,".userGame"),o=(null==s?void 0:s.dataset).id;if(n)e.toggleBookmark(o);else if(o){e.searchState.games.find((e=>e.id===o))&&y.set(`/analyse/online/${o}`)}}(e,a)),void 0,g(".userGame"))},a)}(e),function(e){return e.searchState.paginator&&e.searchState.paginator.nextPage?i("div.moreButton",[i("button",{oncreate:d(e.more)},i("span.fa.fa-arrow-down"))]):null}(e))}function T(e,a,n,s,o){if(!n)return null;const t=e.query[s.name];return i("div",{className:"game_search_row"},i("label",null,a),i("div",{className:"game_search_input_wrapper"},i("div",{className:"game_search_select"+(o?"":" full")},i("label",null,""===t&&s.placeholder?s.placeholder:""),i("select",{value:t,name:s.name,onchange:e.handleChange(s.name)},s.noEmpty?null:i("option",{value:""}),s.options.map(N))),o?i("div",{className:"game_search_select"},i("label",null,""===e.query[o.name]&&o.placeholder?o.placeholder:""),i("select",{value:e.query[o.name],name:o.name,onchange:e.handleChange(o.name)},o.noEmpty?null:i("option",{value:""}),o.options.map(N))):null))}function N(e){return i("option",{key:e.value,value:e.value},e.label)}const C={ratings:["800","900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100","2200","2300","2400","2500","2600","2700","2800","2900"],aiLevels:["1","2","3","4","5","6","7","8"],sources:[["1","Lobby"],["2","Friend"],["3","Ai"],["6","Position"],["7","Import"],["5","Tournament"],["10","Simul"],["12","Pool"]],perfs:[["0","UltraBullet"],["1","Bullet"],["2","Blitz"],["6","Rapid"],["3","Classical"],["4","Correspondence"],["18","Crazyhouse"],["11","Chess960"],["12","King of the Hill"],["15","Three-check"],["13","Antichess"],["14","Atomic"],["16","Horde"],["17","Racing Kings"]],turns:["1","2","3","4","5","10","15","20","25","30","35","40","45","50","60","70","80","90","100","125","150","175","200","225","250","275","300"],durations:[["30","30 seconds"],["60","1 minute"],["120","2 minutes"],["300","5 minutes"],["600","10 minutes"],["900","15 minutes"],["1200","20 minutes"],["1800","30 minutes"],["3600","1 hour"],["10800","3 hours"],["86400","1 day"],["259200","3 days"],["604800","1 week"],["1209600","2 weeks"],["2592000","1 month"],["7776000","3 months"],["15552000","6 months"],["31536000","1 year"]],times:[["0","0 seconds"],["30","30 seconds"],["45","45 seconds"],["60","1 minute"],["120","2 minutes"],["180","3 minutes"],["300","5 minutes"],["600","10 minutes"],["900","15 minutes"],["1200","20 minutes"],["1800","30 minutes"],["2700","45 minutes"],["3600","60 minutes"],["5400","90 minutes"],["7200","120 minutes"],["9000","150 minutes"],["10800","180 minutes"]],increments:[["0","0 seconds"],["1","1 second"],["2","2 seconds"],["3","3 seconds"],["5","5 seconds"],["10","10 seconds"],["15","15 seconds"],["30","30 seconds"],["45","45 seconds"],["60","60 seconds"],["90","90 seconds"],["120","120 seconds"],["150","150 seconds"],["180","180 seconds"]],results:[["30","Mate"],["31","Resign"],["32","Stalemate"],["34","Draw"],["35","Clock Flag"],["60","Variant End"]],winners:[["1","white"],["2","black"],["3","none"]],dates:[["0d","Now"],["1h","1 hour ago"],["2h","2 hours ago"],["6h","6 hours ago"],["1d","1 day ago"],["2d","2 days ago"],["3d","3 days ago"],["4d","4 days ago"],["5d","5 days ago"],["6d","6 days ago"],["1w","1 week ago"],["2w","2 weeks ago"],["3w","3 weeks ago"],["4w","4 weeks ago"],["5w","5 weeks ago"],["6w","6 weeks ago"],["1m","1 month ago"],["2m","2 months ago"],["3m","3 months ago"],["4m","4 months ago"],["5m","5 months ago"],["6m","6 months ago"],["1y","1 year ago"],["2y","2 years ago"],["3y","3 years ago"],["4y","4 years ago"],["5y","5 years ago"]],sortFields:[["d","Date"],["t","Moves"],["a","Rating"]],sortOrders:[["desc","Descending"],["asc","Ascending"]]},q=C.ratings.map((e=>({value:e,label:e}))),F=[["0",m("human")+" "+m("opponent")],["1",m("computer")+" "+m("opponent")]].map((e=>({value:e[0],label:e[1]}))),P=C.aiLevels.map((e=>({value:e,label:m("level")+" "+e}))),A=C.sources.map((e=>({value:e[0],label:e[1]}))),j=C.perfs.map((e=>({value:e[0],label:e[1]}))),B=C.turns.map((e=>({value:e,label:e}))),E=C.durations.map((e=>({value:e[0],label:e[1]}))),L=C.times.map((e=>({value:e[0],label:e[1]}))),R=C.increments.map((e=>({value:e[0],label:e[1]}))),G=C.results.map((e=>({value:e[0],label:e[1]}))),O=C.winners.map((e=>({value:e[0],label:m(e[1])}))),D=C.dates.map((e=>({value:e[0],label:e[1]}))),I=C.sortFields.map((e=>({value:e[0],label:e[1]}))),z=C.sortOrders.map((e=>({value:e[0],label:e[1]})));var H={oncreate:v,oninit({attrs:e}){this.ctrl=_(e)},view(){return b.free(f(m("advancedSearch")),S(this.ctrl))}};export{H as default};
