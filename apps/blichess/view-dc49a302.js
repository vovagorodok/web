import{b5 as e,g as t,b6 as a,ax as n,b7 as o,b as i,o as s,b8 as r,aw as l,ak as c,m as u,$ as d,p,aJ as h,aG as m,a9 as f,aK as v}from"./main.js";import{l as g,g as y,j as b,c as M}from"./game-51118656.js";import{m as k,d as w,t as N,p as _}from"./chess-1c1bcc98.js";import{r as C,b as T,d as P,g as D,o as j}from"./crazyValid-6d95db62.js";import{C as S}from"./toInteger-62ca6ec9.js";function x(e,i){const s=i.uciMoves.length?i.uciMoves[i.uciMoves.length-1]:null,r=t.game.pieceMove();return{variant:e.game.variant.key,fen:i.fen,orientation:a(e),turnColor:i.player,lastMove:s?n(s):null,check:i.check,otb:"offline_otb"===e.game.id,coordinates:t.game.coords(),otbMode:t.otb.flipPieces()?"flip":"facing",symmetricCoordinates:"offline_otb"===e.game.id,autoCastle:!0,highlight:{lastMove:t.game.highlights(),check:t.game.highlights()},movable:{free:!1,color:g(e)?i.player:null,showDests:t.game.pieceDestinations(),dests:i.dests,rookCastle:1===t.game.rookCastle()},animation:{enabled:!!t.game.animations(),duration:o(t.game.animations())},premovable:{enabled:!1},draggable:{enabled:"drag"===r||"both"===r,centerPiece:e.pref.centerPiece,distance:3,magnified:t.game.magnified()},selectable:{enabled:"tap"===r||"both"===r}}}var F={make:function(t,a,n,o,i,s){const r=x(t,a);return r.movable.events={after:n,afterNewPiece:o},r.events={move:i,dropNewPiece:s},new e(r)},reload:function(e,t,a){e.reconfigure(x(t,a))},end:function(e){e.stop()},changeOTBMode:function(e,t){e.setOtbMode(t?"flip":"facing")}};const R={key:"standard",name:"Standard",short:"STD",title:"Standard rules of chess (FIDE)"};function z(e){const a=e.color||"white",n={color:a,username:"offline_ai"===e.id?i.appUser(s(a)):s(a),spectator:!1};return{game:{id:e.id,offline:!0,variant:e.variant||R,initialFen:e.initialFen||r,source:"offline",fen:e.fen||r,player:e.player||"white",turns:0,startedAtTurn:0,status:{id:20,name:"created"},speed:"unlimited",createdAt:Date.now()},player:n,opponent:{color:l(a),username:s(l(a))},pref:{animationDuration:o(t.game.animations()),centerPiece:e.pref&&e.pref.centerPiece||!1},steps:[],offlineClock:e.clock}}function A(e,t,a){var n;const o=null===(n=e.replay)||void 0===n?void 0:n.situation();e.data.game.status=t||{id:20,name:"started"},e.data.game.winner=a||(null==o?void 0:o.winner)}class Replay{constructor(e,t,a,n,o,i){this.situation=()=>this.situations[this.ply],this.addMove=(e,t,a)=>{const n=this.situation();k({variant:this.variant,fen:n.fen,pgnMoves:n.pgnMoves,uciMoves:n.uciMoves,promotion:a,orig:e,dest:t}).then(this.addMoveOrDrop).catch(console.error.bind(console))},this.addDrop=(e,t)=>{const a=this.situation();w({variant:this.variant,fen:a.fen,pgnMoves:a.pgnMoves,uciMoves:a.uciMoves,role:e,pos:t}).then(this.addMoveOrDrop).catch(console.error.bind(console))},this.claimDraw=()=>{const e=this.situation();N({variant:this.variant,initialFen:this.initialFen,pgnMoves:e.pgnMoves}).then((e=>{e.threefoldRepetition?this.onThreefoldRepetition(e.status):c.show({text:s("incorrectThreefoldClaim"),position:"center",duration:"short"})})).catch(console.error.bind(console))},this.pgn=(e,t)=>{const a=this.situation();return _({variant:this.variant,initialFen:this.initialFen,pgnMoves:a.pgnMoves,white:e,black:t})},this.addMoveOrDrop=e=>{this.ply++,this.ply<this.situations.length&&(this.situations=this.situations.slice(0,this.ply)),this.situations.push(e.situation),this.onReplayAdded(this.situation())},this.init(e,t,a,n),this.onReplayAdded=o,this.onThreefoldRepetition=i}init(e,t,a,n){this.variant=e,this.initialFen=t,this.situations=a,this.ply=n||0}}function U(e,t,a,n,o,i,s){var r;const c=null===(r=e.replay)||void 0===r?void 0:r.situation(),d=!!(null==c?void 0:c.crazyhouse),p=("player"===n?e.data.player:e.data.opponent).color,h=["playTable","offline",n,d?"crazy":"",void 0!==o?o?"mode_flip":"mode_facing":"",e.chessground.state.turnColor===e.data.player.color?"player_turn":"opponent_turn"].join(" ");return u("section",{id:n+"_info",className:h},u("div",{className:"antagonistInfos offline"+(d?" crazy":"")},u("div",{className:"antagonistUser"},t,d&&s?Z(s,p):""),d?null:u("div",{className:"ratingAndMaterial"},"horde"===e.data.game.variant.key?null:C(a),"threeCheck"===e.data.game.variant.key?u("div",{className:"checkCount"}," +",function(e,t){var a;const n=null===(a=e.replay)||void 0===a?void 0:a.situation();return(null==n?void 0:n.checkCount)?"white"===l(t)?n.checkCount.white:n.checkCount.black:0}(e,p)):null)),(null==c?void 0:c.crazyhouse)?u(S,{ctrl:e,crazyData:c.crazyhouse,color:p,position:n,customPieceTheme:i}):s?Z(s,p):null)}function I(e){return u("section",{className:"actions_bar"},u("button",{className:"action_bar_button fa fa-list",oncreate:d(e.actions.open)}),u("button",{className:"action_bar_button fa fa-plus-circle",oncreate:d(e.newGameMenu.open,(()=>c.show({text:s("createAGame"),duration:"short",position:"bottom"})))}),u("button",{className:"fa fa-share-alt action_bar_button",oncreate:d(e.sharePGN,(()=>c.show({text:s("sharePgn"),duration:"short",position:"bottom"})))}),u("button",{className:"action_bar_button","data-icon":"A",oncreate:d(e.goToAnalysis)}),B(e),H(e),K(e))}function O(e){if(!e.replay)return null;const t=e.replay.situation();if(y.finished(e.data)){const a=b(e.data),n=t.winner,o=y.toLabel(e.data.game.status.name,e.data.game.turns,e.data.game.winner,e.data.game.variant.key)+(n?". "+s("white"===n?"whiteIsVictorious":"blackIsVictorious")+".":"");return u("div",{className:"result"},a,u("br",null),u("em",{className:"resultStatus"},o))}return null}function G(e){return M(e.data)?u("button.draw-yes",{oncreate:d((()=>{var t;return null===(t=e.replay)||void 0===t?void 0:t.claimDraw()}))},u("span","½"),s("threefoldRepetition")):null}function L(e){const a=t.game.pieceNotation();return e.replay?u("div.replay.box",{className:a?" displayPieces":"",oncreate:t=>{setTimeout((()=>T(t.dom)),100),p((t=>j(e,t)),void 0,D)(t)},onupdate:e=>T(e.dom)},$(e.replay)):null}function V(e){const a=t.game.pieceNotation();return e.replay&&e.moveList?u("div.replay_inline",{className:a?" displayPieces":"",oncreate:t=>{setTimeout((()=>P(t.dom)),100),h((t=>j(e,t)),void 0,D)(t)},onupdate:e=>P(e.dom)},$(e.replay)):null}function B(e){const t=e.chessground.state.peripheral,a=!t.isSynchronized&&t.isSettable;return m.features().setState?u("button.action_bar_button.fa.fa-magic",{oncreate:d(m.onCentralSetState),className:f({disabled:!a})}):null}function E(e){return e.replay&&e.replay.ply>e.firstPly()}function H(e){return e.replay?u("button.action_bar_button.fa.fa-chevron-left",{oncreate:d((()=>{E(e)&&e.jumpPrev()}),(()=>{E(e)&&e.jumpFirst()})),className:f({disabled:!E(e)})}):null}function J(e){return e.replay&&e.replay.ply<e.lastPly()}function K(e){return e.replay?u("button.action_bar_button.fa.fa-chevron-right",{oncreate:d((()=>{J(e)&&e.jumpNext()}),(()=>{J(e)&&e.jumpLast()})),className:f({disabled:!J(e)})}):null}function $(e){return e.situations.filter((e=>void 0!==e.san)).map((t=>{return u("move.replayMove",{className:t.ply===e.ply?"current":"","data-ply":t.ply},[1&t.ply?u("index",(a=t.ply,n=!0,u("index",q(a,n)))):null,v(t.san)]);var a,n}))}function q(e,t){return function(e){return Math.floor((e-1)/2)+1}(e)+(t?e%2==1?".":"...":"")}function Q(e){return(e<10?"0":"")+e}const W=":",X=" ";function Y(e,t=!1){const a=new Date(e),n=a.getUTCMilliseconds(),o=Q(a.getUTCMinutes()),i=Q(a.getUTCSeconds());if(e>=36e5){return Q(a.getUTCHours())+(t&&n<500?X:W)+o}if(e<1e4){const e=Math.floor(n/100).toString();return[o+W+i,u("tenths","."+e)]}return o+W+i}function Z(e,t){const a=e.activeSide(),n=e.getTime(t),o=a===t,i="stage"===e.clockType?e.getMoves(t):null;return u("div",{className:f({clock:!0,outoftime:!n,running:o,offlineClock:!0,stageClock:!!i})},[Y(n,o),i?u("div.clockMoves","Moves: "+i):null])}export{Replay as R,G as a,L as b,V as c,z as d,U as e,K as f,F as g,H as h,B as i,I as j,O as r,A as s};
