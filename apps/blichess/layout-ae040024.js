import{J as e,K as t,L as a,M as s,O as n,P as i,Q as o,o as l,R as c,b as r,k as u,S as h,p as d,z as p,T as m,U as v,V as f,X as g,Y as N,s as k,_ as w,$ as b,E as _,a0 as M,a1 as S,r as E,a2 as y,C as T,a3 as X,a4 as Y,g as D,a5 as I,m as x,a6 as C,a7 as P,a8 as G,y as L,a9 as O,aa as V,ab as A,ac as B,I as z,ad as $,v as F,ae as R,af as j,ag as H,ah as K,ai as W,aj as U,D as q,ak as Q,al as J}from"./main.js";class Gesture{constructor(e,t,a){this.element=e,this.vd=t,this.options=a,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[]},this.swipingDirection=null,this.startInputTimestamp=0,this.onTouchStart=e=>{e.changedTouches.length>1||(this.touchStartX=e.changedTouches[0].pageX,this.touchStartY=e.changedTouches[0].pageY,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.touchEndX=null,this.touchEndY=null,this.startInputTimestamp=performance.now(),this.fire("panstart",e))},this.onTouchMove=e=>{if(e.changedTouches.length>1)return;this.touchMoveX=e.changedTouches[0].pageX-this.touchStartX;const t=performance.now()-this.startInputTimestamp;this.velocityX=this.touchMoveX/t,this.touchMoveY=e.changedTouches[0].pageY-this.touchStartY,this.velocityY=this.touchMoveY/t;const a=Math.abs(this.touchMoveX),s=Math.abs(this.touchMoveY),n=a>this.swipeThresholdX,i=s>this.swipeThresholdY;this.swipingDirection=a>s?n?"horizontal":"pre-horizontal":i?"vertical":"pre-vertical",this.fire("panmove",e)},this.onTouchEnd=e=>{if(e.changedTouches.length>1)return;this.touchEndX=e.changedTouches[0].pageX,this.touchEndY=e.changedTouches[0].pageY,this.fire("panend",e);const t=this.touchEndX-this.touchStartX,a=Math.abs(t),s=this.touchEndY-this.touchStartY,n=Math.abs(s);if(a>this.swipeThresholdX||n>this.swipeThresholdY){const i=a>=n&&a>this.swipeThresholdX,o=n>a&&n>this.swipeThresholdY;i&&(t<0?this.velocityX<-this.opts.swipeVelocityThreshold&&this.fire("swipeleft",e):this.velocityX>this.opts.swipeVelocityThreshold&&this.fire("swiperight",e)),o&&(s<0?this.velocityY<-this.opts.swipeVelocityThreshold&&this.fire("swipeup",e):this.velocityY>this.opts.swipeVelocityThreshold&&this.fire("swipedown",e))}},this.swipeThresholdX=Z("x",t),this.swipeThresholdY=Z("y",t),this.element=e,this.opts=Object.assign({},ee,a),this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.element.addEventListener("touchstart",this.onTouchStart,te),this.element.addEventListener("touchmove",this.onTouchMove,!!this.opts.passiveMove&&te),this.element.addEventListener("touchend",this.onTouchEnd,te)}destroy(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}on(e,t){if(this.handlers[e])return this.handlers[e].push(t),{type:e,fn:t,cancel:()=>this.off(e,t)}}off(e,t){if(this.handlers[e]){const a=this.handlers[e].indexOf(t);-1!==a&&this.handlers[e].splice(a,1)}}fire(e,t){for(let a=0;a<this.handlers[e].length;a++)this.handlers[e][a](t)}}function Z(e,t){return Math.max(25,Math.floor(.15*("x"===e?t.vw:t.vh)))}const ee={swipeVelocityThreshold:.4,passiveMove:!0},te={passive:!0};function ae(o,l){const c=l.side,r=e(),u={backDropElement:null,isScrolling:!1,isClosing:!1},h=new Gesture(o,t(),{passiveMove:!1});h.on("panstart",(()=>{u.backDropElement=l.getBackdropEl(),u.isScrolling=!1,u.isClosing=!1})),h.on("panmove",(e=>{if(!u.isScrolling){if(u.isClosing)e.preventDefault();else if("left"===c&&h.touchMoveX<-5||"right"===c&&h.touchMoveX>5)e.preventDefault(),u.isClosing=!0;else if(u.isScrolling=Math.abs(h.touchMoveY)>5,u.isScrolling)return;"left"===c?h.touchMoveX<0&&h.touchMoveX>=-r&&(a(o,h.touchMoveX),s(u.backDropElement,(r+h.touchMoveX)/r*100/100*n)):h.touchMoveX>0&&h.touchMoveX<=r&&(a(o,h.touchMoveX),s(u.backDropElement,(r-h.touchMoveX)/r*100/100*n))}})),h.on("panend",(()=>{if(u.isScrolling)return;u.isScrolling=!1,u.isClosing=!1;const e=h.velocityX;0!==e&&("left"===c?e<0&&(h.touchMoveX<-(r-r*i)||e<-.4)?l.close():l.open():e>0&&(h.touchMoveX>r-r*i||e>.4)?l.close():l.open())}))}var se={onbeforeupdate:()=>o.isOpen,view(){const e=r.get();return l("aside",{id:"side_menu",oncreate:({dom:e})=>{ae(e,o)}},function(e){const t=c()?"up":"down";return l("header",{className:"side_menu_header",oncreate:h(b)},r.isKidMode()?l("div",{className:"kiddo"},"ðŸ˜Š"):null,function(e){const t=g(),a=N(),s=`PING: ${d("networkLagBetweenYouAndLichess")}; SERVER: ${d("timeToProcessAMoveOnLichessServer")}`,n=e=>{e.stopPropagation(),Y.show({text:s,duration:"long",position:"top"})};return l("div",{className:"pingServer"},function(e){const t=void 0===e?0:e<150?4:e<300?3:e<500?2:1,a=[];for(let e=1;e<=4;e++)a.push(l(e<=t?"i":"i.off"));return l("signal.q"+t,a)}(u()?t:void 0),u()?l("div",null,l("div",null,l("span",{className:"pingKey"},"PingÂ Â Â "),l("strong",{className:"pingValue"},k.isConnected()&&t?t:"?")," ms"),e?l("div",null,l("span",{className:"pingKey"},"ServerÂ "),l("strong",{className:"pingValue"},k.isConnected()&&a?a:"?")," ms"):null):l("div",null,"Offline"),u()?l("i",{className:"fa fa-question-circle-o",oncreate:h(n)}):null)}(e),u()&&!e?l("button",{className:"signInButton",oncreate:h(w.open)},d("signIn")):null,e?l("h2",{className:"username"},e.username,l("i",{className:"fa fa-caret-"+t})):null)}(e),l("div",{className:"native_scroller side_menu_scroller"},e&&c()?function(e){const t={username:e.username};e.title&&(t.title=e.title);e.patron&&(t.patron="1");return l("ul",{className:"side_links profileActions",oncreate:h(ie,void 0,_)},l("li",{className:"side_link","data-route":`/@/${e.id}`},e.patron?l("span",{className:"patron","data-icon":"î€™"}):l("span",{className:"fa fa-circle userStatus online"}),d("profile")),l("li",{className:"side_link","data-route":`/@/${e.id}/games?${f(t)}`},l("span",{className:"menu_icon_game"}),d("games")),l("li",{className:"side_link","data-route":"/inbox"},l("span",{className:"fa fa-envelope"}),d("inbox")+(null!==v()&&v()>0?" ("+v()+")":"")),l("li",{className:"side_link","data-route":"/account/preferences"},l("span",{"data-icon":"%"}),d("preferences")),l("li",{className:"side_link","data-action":"friends"},l("span",{"data-icon":"f"}),p("nbFriendsOnline",m.count())),l("li",{className:"side_link","data-nocloseaction":"logout"},l("span",{"data-icon":"w"}),d("logOut")))}(e):function(e){const t=u();return l("ul",{className:"side_links",oncreate:h(ie,void 0,_)},l("li",{className:"side_link","data-route":"/"},l("span",{className:"fa fa-home"}),d("home")),t?l("li",{className:"sep_link"},d("playOnline")):null,t&&!r.hasCurrentBan()?l("li",{className:"side_link","data-action":"createGame"},l("span",{className:"fa fa-plus-circle"}),d("createAGame")):null,t?l("li",{className:"side_link","data-route":"/tournament"},l("span",{className:"fa fa-trophy"}),d("tournaments")):null,l("li",{className:"sep_link"},d("learnMenu")),t?l("li",{className:"side_link","data-route":"/training"},l("span",{"data-icon":"-"}),d("puzzles")):null,!t&&e?l("li",{className:"side_link","data-route":"/training"},l("span",{"data-icon":"-"}),d("puzzles")):null,t?l("li",{className:"side_link","data-route":"/study"},l("span",{"data-icon":"4"}),d("studyMenu")):null,l("li",{className:"side_link","data-route":"/coord"},l("span",{className:"fa fa-thumb-tack"}),d("coordinates")),t?l("li",{className:"sep_link"},d("watch")):null,t?l("li",{className:"side_link","data-route":"/tv"},l("span",{"data-icon":"1"}),d("watchGames")):null,t?l("li",{className:"sep_link"},d("community")):null,t?l("li",{className:"side_link","data-route":"/players"},l("span",{className:"fa fa-at"}),d("players")):null,l("li",{className:"sep_link"},d("tools")),l("li",{className:"side_link","data-route":"/analyse"},l("span",{"data-icon":"A"}),d("analysis")),l("li",{className:"side_link","data-route":"/editor"},l("span",{className:"fa fa-pencil"}),d("boardEditor")),l("li",{className:"side_link","data-route":"/clock"},l("span",{className:"fa fa-clock-o"}),d("clock")),t?l("li",{className:"side_link","data-route":"/importer"},l("span",{className:"fa fa-cloud-upload"}),d("importGame")):null,t?l("li",{className:"side_link","data-route":"/search"},l("span",{className:"fa fa-search"}),d("advancedSearch")):null,l("li",{className:"sep_link"},d("playOffline")),l("li",{className:"side_link","data-route":"/ai"},l("span",{className:"fa fa-cogs"}),d("computer")),l("li",{className:"side_link","data-route":"/otb"},l("span",{className:"fa fa-beer"}),d("overTheBoard")),l("li",{className:"hr"}),l("li",{className:"side_link","data-route":"/settings"},l("span",{className:"fa fa-cog"}),d("settings")),l("li",{className:"side_link","data-route":"/about"},l("span",{className:"fa fa-info-circle"}),d("about")))}(e)))}};const ne={gamesMenu:()=>y.open(),createGame:()=>T.openRealTime(),friends:()=>X.open(),logout:()=>{r.logout(),c(!1)}};function ie(e){e.stopPropagation();const t=_(e);if(t){const e=t.dataset;e.route?M(e.route)():t&&e.action?S(ne[e.action])():t&&e.nocloseaction&&(ne[e.nocloseaction](),E())}}let oe,le=!1;var ce={open:re,close:ue,openAIFromPosition(e){D.gameSetup.ai.variant("3"),re(),oe=e},view:()=>I("game_form_popup",void 0,(function(){return function(e,t,a,s){const n="1"===t.timeMode(),i=[l("div.select_input",[C.renderSelect("side",e+"color",he,t.color)]),l("div.select_input",[C.renderSelect("variant",e+"variant",a,t.variant)]),"3"===t.variant()?l("div.setupPosition",[l("div.setupPositionInput",[l("input[type=text][name=fen]",{placeholder:d("pasteTheFenStringHere"),oninput:e=>{const t=e.target.value;oe=""===t?void 0:P(t).unwrap((e=>G(e)),(()=>!1)),E()}}),l("button.withIcon",{oncreate:L((()=>{ue(),x.set("/editor")}))},l("span.fa.fa-pencil"))]),!1===oe?l("div.setupFenError","Invalid FEN"):null,void 0!==oe&&!1!==oe?[l("div",{style:{width:"100px",height:"100px"},oncreate:L((()=>{ue(),oe&&x.set(`/editor/${encodeURIComponent(oe)}`)}))},[l(O,{fen:oe,orientation:"white"})])]:null]):null,l("div.select_input",[C.renderSelect("level","ailevel",["1","2","3","4","5","6","7","8"].map(V),t.level)])],o=[l("div.select_input",[C.renderSelect("clock",e+"timeMode",s,t.timeMode)])];n&&o.push(l("div.select_input.inline",[C.renderSelect("time",e+"time",D.gameSetup.availableTimes,t.time,!1)]),l("div.select_input.inline",[C.renderSelect("increment",e+"increment",D.gameSetup.availableIncrements.map(V),t.increment,!1)]));return l("form.game_form",{onsubmit:function(e){e.preventDefault(),D.gameSetup.isTimeValid(t)&&(ue(),A(oe).then((e=>{x.set("/game"+e.url.round)})).catch(B))}},[l("fieldset",i),l("fieldset",o),l("div.popupActionWrapper",[l("button.defaultButton[type=submit]",d("playWithTheMachine"))])])}("ai",D.gameSetup.ai,D.gameSetup.ai.availableVariants,D.gameSetup.ai.availableTimeModes)}),le,ue)};function re(){x.backbutton.stack.push(ue),oe=void 0,le=!0}function ue(e){"backbutton"!==e&&le&&x.backbutton.stack.pop(),le=!1}const he=[["randomColor","random"],["white","white"],["black","black"]];function de(o){const l=o.side,c=e(),r={menuElement:null,backDropElement:null,canSlide:!1};return{panstart:e=>a=>{const s=a.target;"PIECE"===s.nodeName||"SQUARE"===s.nodeName||s.className.startsWith&&s.className.startsWith("cg-board manipulable")||!function(e,t,a){return"left"===t?e<$:e>a-$}(e.touchStartX,l,t().vw)?r.canSlide=!1:(r.menuElement=o.getMenuEl(),r.backDropElement=o.getBackdropEl(),r.menuElement&&r.backDropElement&&(r.menuElement.style.visibility="visible",r.backDropElement.style.visibility="visible",r.canSlide=!0,E()))},panmove:e=>t=>{if(r.canSlide){"ios"===z.getPlatform()&&(t.defaultPrevented||t.preventDefault());const i=e.touchMoveX;"left"===l?i<=c&&(a(r.menuElement,-c+i),s(r.backDropElement,i/c*100/100*n)):i>=-c&&(a(r.menuElement,c+i),s(r.backDropElement,-i/c*100/100*n))}},panend:e=>()=>{const t=e.velocityX;if(r.canSlide&&0!==t){r.canSlide=!1;const a=e.touchMoveX;"left"===l?t>0&&(a>=c*i||t>.2)?o.open():o.close():t<0&&(a<=-c*i||t<-.2)?o.open():o.close()}}}}const pe=j(!1);function me(e){return e?l("div.announce",{className:pe()?"expanded":""},[l("span.text",{oncreate:L((()=>{pe(!pe()),E()}))},e.msg),l("small",F(new Date(e.date),!0)),l("button.dismiss",{oncreate:L(H.dismiss)},R)]):null}var ve={oninit(){this.boundHandlers=!1},oncreate({dom:e}){this.gesture=new Gesture(e,t());const a=de(o);for(const e in a)this.gesture.on(e,a[e](this.gesture))},onupdate({attrs:e}){if(!this.boundHandlers&&e.handlers){this.boundHandlers=!0;for(const t in e.handlers)this.gesture.on(t,e.handlers[t](this.gesture))}},view({attrs:e,children:t}){const{header:a,color:s}=e,n={righty:"right"===D.game.landscapeBoardSide()};return e.klass&&(n[e.klass]=!0),l("main#page",{className:s},[l("header.main_header.board",a),me(H.get()),l("div.content_round",{className:K(n)},t),l("div#menu-close-overlay.menu-backdrop",{oncreate:W})])}},fe={board(e,t,a,s,n,i,o){const c=D.general.theme.background(),r=a?Object.assign({key:a},Ne(c)):Ne(c);return l("div.view-container",r,[l(ve,{header:e,color:i,handlers:n,klass:o},t),l(se),y.view(),w.view(),U.view(),T.view(),ce.view(),q.view(),X.view(),Q.view(),s])},free(e,t,a,s,n){const i=D.general.theme.background();return l("div.view-container",Ne(i),[l("main#page",{oncreate:ge},[l("header.main_header",e),me(H.get()),l("div#free_content.content.native_scroller",{className:a?"withFooter":"",oncreate:({dom:e})=>{n&&e.addEventListener("scroll",n)}},t),a?l("footer.main_footer",a):null,l("div#menu-close-overlay.menu-backdrop",{oncreate:W})]),l(se),y.view(),w.view(),U.view(),T.view(),ce.view(),q.view(),X.view(),Q.view(),s])},clock(e,t){const a=D.general.theme.background();return l("div.view-container",Ne(a),[l("main#page",[l("div.content.fullScreen",e())]),t?t():null])}};function ge({dom:e}){const a=new Gesture(e,t(),{passiveMove:"ios"!==z.getPlatform()}),s=de(o);for(const e in s)a.on(e,s[e](a))}function Ne(e){return{className:(t=e,"dark"===t||"light"===t?t:"system"===t?J():"transp "+t)};var t}export{ae as C,de as E,Gesture as G,fe as l,ce as p};
