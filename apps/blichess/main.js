/*! Capacitor: https://capacitorjs.com/ - MIT License */
var e;!function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(e||(e={}));class CapacitorException extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const t=t=>{const n=t.CapacitorCustomPlatform||null,r=t.Capacitor||{},i=r.Plugins=r.Plugins||{},a=()=>null!==n?n.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(t),o=e=>{var t;return null===(t=r.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))},s=new Map;return r.convertFileSrc||(r.convertFileSrc=e=>e),r.getPlatform=a,r.handleError=e=>t.console.error(e),r.isNativePlatform=()=>"web"!==a(),r.isPluginAvailable=e=>{const t=s.get(e);return!!(null==t?void 0:t.platforms.has(a()))||!!o(e)},r.registerPlugin=(t,c={})=>{const l=s.get(t);if(l)return l.proxy;const u=a(),d=o(t);let h;const p=i=>{let a;const o=(...o)=>{const s=(async()=>(!h&&u in c?h=h="function"==typeof c[u]?await c[u]():c[u]:null!==n&&!h&&"web"in c&&(h=h="function"==typeof c.web?await c.web():c.web),h))().then((n=>{const s=((n,i)=>{var a,o;if(!d){if(n)return null===(o=n[i])||void 0===o?void 0:o.bind(n);throw new CapacitorException(`"${t}" plugin is not implemented on ${u}`,e.Unimplemented)}{const e=null==d?void 0:d.methods.find((e=>i===e.name));if(e)return"promise"===e.rtype?e=>r.nativePromise(t,i.toString(),e):(e,n)=>r.nativeCallback(t,i.toString(),e,n);if(n)return null===(a=n[i])||void 0===a?void 0:a.bind(n)}})(n,i);if(s){const e=s(...o);return a=null==e?void 0:e.remove,e}throw new CapacitorException(`"${t}.${i}()" is not implemented on ${u}`,e.Unimplemented)}));return"addListener"===i&&(s.remove=async()=>a()),s};return o.toString=()=>`${i.toString()}() { [capacitor code] }`,Object.defineProperty(o,"name",{value:i,writable:!1,configurable:!1}),o},m=p("addListener"),f=p("removeListener"),g=(e,t)=>{const n=m({eventName:e},t),r=async()=>{const r=await n;f({eventName:e,callbackId:r},t)},i=new Promise((e=>n.then((()=>e({remove:r})))));return i.remove=async()=>{await r()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?g:m;case"removeListener":return f;default:return p(t)}}});return i[t]=v,s.set(t,{name:t,proxy:v,platforms:new Set([...Object.keys(c),...d?[u]:[]])}),v},r.Exception=CapacitorException,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},n=(e=>e.Capacitor=t(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),r=n.registerPlugin;class WebPlugin{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(t);const r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),n&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,n){const r=this.listeners[e];if(r)r.forEach((e=>e(t)));else if(n){let n=this.retainedEventArguments[e];n||(n=[]),n.push(t),this.retainedEventArguments[e]=n}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(t="not implemented"){return new n.Exception(t,e.Unimplemented)}unavailable(t="not available"){return new n.Exception(t,e.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const r=n.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach((t=>{this.notifyListeners(e,t)})))}}const i=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),a=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class CapacitorCookiesPluginWeb extends WebPlugin{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach((e=>{if(e.length<=0)return;let[n,r]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=a(n).trim(),r=a(r).trim(),t[n]=r})),t}async setCookie(e){try{const t=i(e.key),n=i(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${r}; path=${a}; ${o};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}r("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});const o=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),r=((e={})=>{const t=Object.keys(e);return Object.keys(e).map((e=>e.toLocaleLowerCase())).reduce(((n,r,i)=>(n[r]=e[t[i]],n)),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(r.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,r]of Object.entries(e.data||{}))t.set(n,r);n.body=t.toString()}else if(r.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach(((e,n)=>{t.append(n,e)}));else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const r=new Headers(n.headers);r.delete("content-type"),n.headers=r}else(r.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n};class CapacitorHttpPluginWeb extends WebPlugin{async request(e){const t=o(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce(((e,n)=>{const[r,i]=n;let a,o;return Array.isArray(i)?(o="",i.forEach((e=>{a=t?encodeURIComponent(e):e,o+=`${r}=${a}&`})),o.slice(0,-1)):(a=t?encodeURIComponent(i):i,o=`${r}=${a}`),`${e}&${o}`}),"").substr(1):null)(e.params,e.shouldEncodeUrlParams),r=n?`${e.url}?${n}`:e.url,i=await fetch(r,t),a=i.headers.get("content-type")||"";let s,c,{responseType:l="text"}=i.ok?e:{};switch(a.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":c=await i.blob(),s=await(async e=>new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},r.onerror=e=>n(e),r.readAsDataURL(e)})))(c);break;case"json":s=await i.json();break;default:s=await i.text()}const u={};return i.headers.forEach(((e,t)=>{u[t]=e})),{data:s,headers:u,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}r("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb});const s=r("App",{web:()=>import("./web-1a890167.js").then((e=>new e.AppWeb))}),c=r("Device",{web:()=>import("./web-e09665a1.js").then((e=>new e.DeviceWeb))}),l=r("SplashScreen",{web:()=>import("./web-45163d28.js").then((e=>new e.SplashScreenWeb))}),u=r("Network",{web:()=>import("./web-e1058c85.js").then((e=>new e.NetworkWeb))});var d,h;!function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(d||(d={})),function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"}(h||(h={}));const p=r("Keyboard");function m(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var f="object"==typeof global&&global&&global.Object===Object&&global,g="object"==typeof self&&self&&self.Object===Object&&self,v=f||g||Function("return this")(),b=function(){return v.Date.now()},w=/\s/;var y=/^\s+/;function k(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&w.test(e.charAt(t)););return t}(e)+1).replace(y,""):e}var S=v.Symbol,C=Object.prototype,T=C.hasOwnProperty,P=C.toString,E=S?S.toStringTag:void 0;var O=Object.prototype.toString;var x="[object Null]",_="[object Undefined]",M=S?S.toStringTag:void 0;function N(e){return null==e?void 0===e?_:x:M&&M in Object(e)?function(e){var t=T.call(e,E),n=e[E];try{e[E]=void 0;var r=!0}catch(e){}var i=P.call(e);return r&&(t?e[E]=n:delete e[E]),i}(e):function(e){return O.call(e)}(e)}var j="[object Symbol]";var D=NaN,L=/^[-+]0x[0-9a-f]+$/i,I=/^0b[01]+$/i,q=/^0o[0-7]+$/i,R=parseInt;function A(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&N(e)==j}(e))return D;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=k(e);var n=I.test(e);return n||q.test(e)?R(e.slice(2),n?2:8):L.test(e)?D:+e}var B="Expected a function",$=Math.max,F=Math.min;function U(e,t,n){var r,i,a,o,s,c,l=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError(B);function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n)}function f(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=a}function g(){var e=b();if(f(e))return v(e);s=setTimeout(g,function(e){var n=t-(e-c);return d?F(n,a-(e-l)):n}(e))}function v(e){return s=void 0,h&&r?p(e):(r=i=void 0,o)}function w(){var e=b(),n=f(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(g,t),u?p(e):o}(c);if(d)return clearTimeout(s),s=setTimeout(g,t),p(c)}return void 0===s&&(s=setTimeout(g,t)),o}return t=A(t)||0,m(n)&&(u=!!n.leading,a=(d="maxWait"in n)?$(A(n.maxWait)||0,t):a,h="trailing"in n?!!n.trailing:h),w.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=i=s=void 0},w.flush=function(){return void 0===s?o:v(b())},w}const z=r("Toast",{web:()=>import("./web-63f737bc.js").then((e=>new e.ToastWeb))});var W=6e4;function H(e){return e.getTime()%W}function V(e){var t=new Date(e.getTime()),n=Math.ceil(t.getTimezoneOffset());t.setSeconds(0,0);var r=n>0?(W+H(t))%W:H(t);return n*W+r}function G(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function K(e){G(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}function Y(e,t){G(2,arguments);var n=function(e,t){G(2,arguments);var n=K(e),r=K(t);return n.getTime()-r.getTime()}(e,t)/1e3;return n>0?Math.floor(n):Math.ceil(n)}function X(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e)}var Q={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function J(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var Z={date:J({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:J({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:J({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ee={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function te(e){return function(t,n){var r,i=n||{};if("formatting"===(i.context?String(i.context):"standalone")&&e.formattingValues){var a=e.defaultFormattingWidth||e.defaultWidth,o=i.width?String(i.width):a;r=e.formattingValues[o]||e.formattingValues[a]}else{var s=e.defaultWidth,c=i.width?String(i.width):e.defaultWidth;r=e.values[c]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function ne(e){return function(t,n){var r=String(t),i=n||{},a=i.width,o=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],s=r.match(o);if(!s)return null;var c,l=s[0],u=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth];return c="[object Array]"===Object.prototype.toString.call(u)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(u,(function(e){return e.test(l)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(u,(function(e){return e.test(l)})),c=e.valueCallback?e.valueCallback(c):c,{value:c=i.valueCallback?i.valueCallback(c):c,rest:r.slice(l.length)}}}var re,ie={code:"en-US",formatDistance:function(e,t,n){var r;return n=n||{},r="string"==typeof Q[e]?Q[e]:1===t?Q[e].one:Q[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:Z,formatRelative:function(e,t,n,r){return ee[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:te({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:te({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:te({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:te({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:te({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(re={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),r=t||{},i=n.match(re.matchPattern);if(!i)return null;var a=i[0],o=n.match(re.parsePattern);if(!o)return null;var s=re.valueCallback?re.valueCallback(o[0]):o[0];return{value:s=r.valueCallback?r.valueCallback(s):s,rest:n.slice(a.length)}}),era:ne({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ne({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ne({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ne({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ne({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},ae=1440,oe=43200,se=525600;function ce(e,t,n){G(2,arguments);var r=n||{},i=r.locale||ie;if(!i.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var a=function(e,t){G(2,arguments);var n=K(e),r=K(t),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}(e,t);if(isNaN(a))throw new RangeError("Invalid time value");var o,s,c=X(r);c.addSuffix=Boolean(r.addSuffix),c.comparison=a,a>0?(o=K(t),s=K(e)):(o=K(e),s=K(t));var l,u=null==r.roundingMethod?"round":String(r.roundingMethod);if("floor"===u)l=Math.floor;else if("ceil"===u)l=Math.ceil;else{if("round"!==u)throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");l=Math.round}var d,h=Y(s,o),p=l((h-(V(s)-V(o))/1e3)/60);if("second"===(d=null==r.unit?p<1?"second":p<60?"minute":p<ae?"hour":p<oe?"day":p<se?"month":"year":String(r.unit)))return i.formatDistance("xSeconds",h,c);if("minute"===d)return i.formatDistance("xMinutes",p,c);if("hour"===d){var m=l(p/60);return i.formatDistance("xHours",m,c)}if("day"===d){var f=l(p/ae);return i.formatDistance("xDays",f,c)}if("month"===d){var g=l(p/oe);return i.formatDistance("xMonths",g,c)}if("year"===d){var v=l(p/se);return i.formatDistance("xYears",v,c)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function le(e){G(1,arguments);var t=K(e);return t.setHours(0,0,0,0),t}var ue=864e5;function de(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function he(e,t){G(2,arguments);var n=K(e).getTime(),r=de(t);return new Date(n+r)}function pe(e,t){return G(2,arguments),he(e,-de(t))}function me(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var fe={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return me("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):me(n+1,2)},d:function(e,t){return me(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.toUpperCase();case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return me(e.getUTCHours()%12||12,t.length)},H:function(e,t){return me(e.getUTCHours(),t.length)},m:function(e,t){return me(e.getUTCMinutes(),t.length)},s:function(e,t){return me(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return me(Math.floor(r*Math.pow(10,n-3)),t.length)}};function ge(e){G(1,arguments);var t=K(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function ve(e){G(1,arguments);var t=K(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=ge(r),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var o=ge(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function be(e){G(1,arguments);var t=K(e),n=ge(t).getTime()-function(e){G(1,arguments);var t=ve(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),ge(n)}(t).getTime();return Math.round(n/6048e5)+1}function we(e,t){G(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.weekStartsOn,a=null==i?0:de(i),o=null==n.weekStartsOn?a:de(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=K(e),c=s.getUTCDay(),l=(c<o?7:0)+c-o;return s.setUTCDate(s.getUTCDate()-l),s.setUTCHours(0,0,0,0),s}function ye(e,t){G(1,arguments);var n=K(e,t),r=n.getUTCFullYear(),i=t||{},a=i.locale,o=a&&a.options&&a.options.firstWeekContainsDate,s=null==o?1:de(o),c=null==i.firstWeekContainsDate?s:de(i.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=new Date(0);l.setUTCFullYear(r+1,0,c),l.setUTCHours(0,0,0,0);var u=we(l,t),d=new Date(0);d.setUTCFullYear(r,0,c),d.setUTCHours(0,0,0,0);var h=we(d,t);return n.getTime()>=u.getTime()?r+1:n.getTime()>=h.getTime()?r:r-1}function ke(e,t){G(1,arguments);var n=K(e),r=we(n,t).getTime()-function(e,t){G(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.firstWeekContainsDate,a=null==i?1:de(i),o=null==n.firstWeekContainsDate?a:de(n.firstWeekContainsDate),s=ye(e,t),c=new Date(0);return c.setUTCFullYear(s,0,o),c.setUTCHours(0,0,0,0),we(c,t)}(n,t).getTime();return Math.round(r/6048e5)+1}var Se="midnight",Ce="noon",Te="morning",Pe="afternoon",Ee="evening",Oe="night",xe={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return fe.y(e,t)},Y:function(e,t,n,r){var i=ye(e,r),a=i>0?i:1-i;return"YY"===t?me(a%100,2):"Yo"===t?n.ordinalNumber(a,{unit:"year"}):me(a,t.length)},R:function(e,t){return me(ve(e),t.length)},u:function(e,t){return me(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return me(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return me(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return fe.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return me(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=ke(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):me(i,t.length)},I:function(e,t,n){var r=be(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):me(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):fe.d(e,t)},D:function(e,t,n){var r=function(e){G(1,arguments);var t=K(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):me(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return me(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return me(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return me(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?Ce:0===i?Se:i/12>=1?"pm":"am",t){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?Ee:i>=12?Pe:i>=4?Te:Oe,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return fe.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):fe.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):me(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):me(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):fe.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):fe.s(e,t)},S:function(e,t){return fe.S(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return Me(i);case"XXXX":case"XX":return Ne(i);default:return Ne(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return Me(i);case"xxxx":case"xx":return Ne(i);default:return Ne(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+_e(i,":");default:return"GMT"+Ne(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+_e(i,":");default:return"GMT"+Ne(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return me(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return me((r._originalDate||e).getTime(),t.length)}};function _e(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),a=r%60;if(0===a)return n+String(i);var o=t||"";return n+String(i)+o+me(a,2)}function Me(e,t){return e%60==0?(e>0?"-":"+")+me(Math.abs(e)/60,2):Ne(e,t)}function Ne(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+me(Math.floor(i/60),2)+n+me(i%60,2)}var je=xe;function De(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}}function Le(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}}var Ie={p:Le,P:function(e,t){var n,r=e.match(/(P+)(p+)?/),i=r[1],a=r[2];if(!a)return De(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",De(i,t)).replace("{{time}}",Le(a,t))}},qe=Ie,Re=["D","DD"],Ae=["YY","YYYY"];function Be(e){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===e)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===e)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===e)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}var $e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ue=/^'([^]*?)'?$/,ze=/''/g,We=/[a-zA-Z]/;function He(e,t,n){G(2,arguments);var r=String(t),i=n||{},a=i.locale||ie,o=a.options&&a.options.firstWeekContainsDate,s=null==o?1:de(o),c=null==i.firstWeekContainsDate?s:de(i.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=a.options&&a.options.weekStartsOn,u=null==l?0:de(l),d=null==i.weekStartsOn?u:de(i.weekStartsOn);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!a.localize)throw new RangeError("locale must contain localize property");if(!a.formatLong)throw new RangeError("locale must contain formatLong property");var h=K(e);if(!function(e){G(1,arguments);var t=K(e);return!isNaN(t)}(h))throw new RangeError("Invalid time value");var p=pe(h,V(h)),m={firstWeekContainsDate:c,weekStartsOn:d,locale:a,_originalDate:h};return r.match(Fe).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,qe[t])(e,a.formatLong,m):e})).join("").match($e).map((function(e){if("''"===e)return"'";var t=e[0];if("'"===t)return e.match(Ue)[1].replace(ze,"'");var n,r=je[t];if(r)return i.useAdditionalWeekYearTokens||(n=e,-1===Ae.indexOf(n))||Be(e),!i.useAdditionalDayOfYearTokens&&function(e){return-1!==Re.indexOf(e)}(e)&&Be(e),r(p,e,a.localize,m);if(t.match(We))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return e})).join("")}function Ve(e,t,n){G(2,arguments);var r=K(e),i=K(t),a=n||{},o=a.locale||ie;if(!o.localize)throw new RangeError("locale must contain localize property");if(!o.formatLong)throw new RangeError("locale must contain formatLong property");if(!o.formatRelative)throw new RangeError("locale must contain formatRelative property");var s,c=function(e,t){G(2,arguments);var n=le(e),r=le(t),i=n.getTime()-V(n),a=r.getTime()-V(r);return Math.round((i-a)/ue)}(r,i);if(isNaN(c))throw new RangeError("Invalid time value");s=c<-6?"other":c<-1?"lastWeek":c<0?"yesterday":c<1?"today":c<2?"tomorrow":c<7?"nextWeek":"other";var l=pe(r,V(r)),u=pe(i,V(i));return He(r,o.formatRelative(s,l,u,a),a)}function Ge(e,t){return G(2,arguments),he(e,1e3*de(t))}const Ke=r("Preferences",{web:()=>import("./web-eded98d3.js").then((e=>new e.PreferencesWeb))});var Ye={get:function(e){return Ke.get({key:e}).then((({value:e})=>null!==e?JSON.parse(e):e))},set:function(e,t){return Ke.set({key:e,value:JSON.stringify(t)}).then((()=>t))},remove:e=>Ke.remove({key:e}),async migrate(){await Ke.migrate()}};const Xe=Object.prototype.hasOwnProperty;function Qe(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++)if(!Xe.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}function Je(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function Ze(e,t,n){if("string"==typeof t&&(t=t.split(".")),t.length>1){const r=t.shift();null!==e[r]&&"object"==typeof e[r]||(e[r]={}),Ze(e[r],t,n)}else e[t[0]]=n}function et(e,t){return Object.assign({},t.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:e[n]})),{}))}function tt(e){return[e.toString(),e.toString()]}function nt(e,t,n=1){const r=[];for(let i=e;i<=t;i+=n)r.push(i.toString());return r}function rt(e,t,n=1){return nt(e,t,n).map(tt)}const it="settings",at=[["Standard","standard"],["Crazyhouse","crazyhouse"],["Chess960","chess960"],["King of the Hill","kingOfTheHill"],["Three-check","threeCheck"],["Antichess","antichess"],["Atomic","atomic"],["Horde","horde"],["Racing Kings","racingKings"]],ot=[["Sudden Death","simple"],["Increment","increment"],["Increment with Handicap","handicapInc"],["Simple Delay","delay"],["Bronstein Delay","bronstein"],["Hourglass","hourglass"],["Stage","stage"]],st=[...Array(11).keys()].map((e=>50*e)),ct={};var lt={general:{locale:ut("lang",null),sound:ut("sound",!0),theme:{availableBackgroundThemes:[{key:"dark",name:"dark",ext:""},{key:"light",name:"light",ext:""},{key:"system",name:"bgThemeSyncWithSystem",ext:""},{key:"bgshapes",name:"Shapes",ext:"jpg"},{key:"anthracite",name:"Anthracite",ext:"jpg"},{key:"blue-maze",name:"Blue Maze",ext:"jpg"},{key:"red-maze",name:"Red Maze",ext:"jpg"},{key:"checkerboard",name:"Checkerboard",ext:"png"},{key:"wood",name:"Wood",ext:"jpg"},{key:"space",name:"Space",ext:"jpg"}],availableBoardThemes:[{key:"blue",name:"Blue",ext:"svg"},{key:"blue2",name:"Blue 2",ext:"jpg"},{key:"blue3",name:"Blue 3",ext:"jpg"},{key:"blue-marble",name:"Blue Marble",ext:"jpg"},{key:"canvas",name:"Canvas",ext:"jpg"},{key:"wood",name:"Wood",ext:"jpg"},{key:"wood2",name:"Wood 2",ext:"jpg"},{key:"wood3",name:"Wood 3",ext:"jpg"},{key:"wood4",name:"Wood 4",ext:"jpg"},{key:"maple",name:"Maple",ext:"jpg"},{key:"maple2",name:"Maple 2",ext:"jpg"},{key:"brown",name:"Brown",ext:"svg"},{key:"leather",name:"Leather",ext:"jpg"},{key:"green",name:"Green",ext:"svg"},{key:"marble",name:"Marble",ext:"jpg"},{key:"green-plastic",name:"Green Plastic",ext:"png"},{key:"grey",name:"Grey",ext:"jpg"},{key:"metal",name:"Metal",ext:"jpg"},{key:"olive",name:"Olive",ext:"jpg"},{key:"newspaper",name:"Newspaper",ext:"png"},{key:"purple",name:"Purple",ext:"svg"},{key:"purple-diag",name:"Purple 2",ext:"png"},{key:"pink",name:"Pink",ext:"png"},{key:"ic",name:"IC",ext:"svg"},{key:"horsey",name:"horsey",ext:"jpg"}],bundledBoardThemes:["brown","blue","green","purple","ic"],availablePieceThemes:[["cburnett","Colin M.L. Burnett"],["merida"],["pirouetti"],["chessnut"],["chess7"],["alpha"],["reilly"],["companion"],["riohacha"],["kosal"],["leipzig"],["fantasy"],["spatial"],["california"],["pixel"],["maestro"],["fresca"],["cardinal"],["gioco"],["tatiana"],["staunty"],["governor"],["symmetric"],["dubrovny"],["icpieces"],["libra"],["shapes"],["letter"],["horsey"],["anarcandy"]],background:ut("bgTheme","system"),board:ut("theme.board","brown"),piece:ut("theme.piece","cburnett")},vibrateOnGameEvents:ut("vibrateOnGameEvents",!1),bluetooth:{useDevice:ut("bluetooth.useDevice",!1),deviceId:ut("bluetooth.deviceId",void 0)},notifications:{enable:ut("notifications",!0),vibrate:ut("notifications.vibrate",!0),sound:ut("notifications.sound",!0)}},game:{supportedVariants:["standard","chess960","antichess","fromPosition","kingOfTheHill","threeCheck","atomic","horde","racingKings","crazyhouse"],animations:ut("gameAnimations",!0),highlights:ut("boardHighlights",!0),pieceDestinations:ut("pieceDestinations",!0),coords:ut("coords",!0),magnified:ut("pieceMagnified",!0),pieceNotation:ut("pieceNotation",!0),zenMode:ut("zenMode",!1),blindfoldChess:ut("blindfoldChess",!1),clockPosition:ut("game.inversedClockPos","right"),pieceMove:ut("game.pieceMove","both"),rookCastle:ut("game.rookCastle",1),moveList:ut("game.moveList",!0),landscapeBoardSide:ut("game.landscapeBoardSide","left")},analyse:{supportedVariants:["standard","chess960","antichess","fromPosition","kingOfTheHill","threeCheck","atomic","horde","racingKings","crazyhouse"],availableVariants:at,syntheticVariant:ut("analyse.syntheticVariant","standard"),enableCeval:ut("analyse.enableCeval",!1),cevalMultiPvs:ut("ceval.multipv",1),cevalCores:ut("ceval.cores",1),cevalHashSize:ut("ceval.hashSize",16),cevalUseNNUE:ut("ceval.useNNUE",!0),cevalInfinite:ut("ceval.infinite",!1),cevalMaxDepth:ut("ceval.maxDepth",18),showBestMove:ut("analyse.showBestMove",!0),showComments:ut("analyse.showComments",!0),smallBoard:ut("analyse.smallBoard",!0),explorer:{db:ut("analyse.explorer.db","lichess"),availableRatings:[1600,1800,2e3,2200,2500],rating:ut("analyse.explorer.rating",[1600,1800,2e3,2200,2500]),availableSpeeds:["bullet","blitz","rapid","classical"],speed:ut("analyse.explorer.speed",["bullet","blitz","rapid","classical"])}},ai:{availableOpponents:[["Stockfish","1"],["Stockfish","2"],["Stockfish","3"],["Stockfish","4"],["Stockfish","5"],["Stockfish","6"],["Stockfish","7"],["Stockfish","8"]],color:ut("ai.color","white"),opponent:ut("ai.opponent","1"),variant:ut("ai.variant","standard"),availableVariants:at},otb:{flipPieces:ut("otb.flipPieces",!1),useSymmetric:ut("otb.useSymmetric",!1),variant:ut("otb.variant","standard"),availableVariants:at,whitePlayer:ut("otb.whitePlayer","White"),blackPlayer:ut("otb.blackPlayer","Black"),clockType:ut("otb.clockType","none"),availableClocks:[["None","none"]].concat(ot)},clock:{availableClocks:ot,clockType:ut("clock.clockType","simple"),simple:{time:ut("clock.simple.time","5")},increment:{time:ut("clock.increment.time","3"),increment:ut("clock.increment.increment","2")},handicapInc:{topTime:ut("clock.handicapInc.topTime","3"),topIncrement:ut("clock.handicapInc.topIncrement","2"),bottomTime:ut("clock.handicapInc.bottomTime","3"),bottomIncrement:ut("clock.handicapInc.bottomIncrement","2")},delay:{time:ut("clock.delay.time","3"),increment:ut("clock.delay.increment","2")},bronstein:{time:ut("clock.bronstein.time","3"),increment:ut("clock.bronstein.increment","2")},hourglass:{time:ut("clock.hourglass.time","5")},stage:{stages:ut("clock.stage.stages",[{time:"120",moves:"40"},{time:"60",moves:null}]),increment:ut("clock.stage.increment","30")},availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableMoves:["5","10","15","20","25","30","35","40","45","50","55","60"]},gameSetup:{availableTimes:[["0","0"],["¼","0.25"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableDays:["1","2","3","5","7","10","14"],isTimeValid:function(e){return"1"!==e.timeMode()||"0"!==e.time()||"0"!==e.increment()},ai:{color:ut("game.ai.color","random"),availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"],["From Position","3"]],variant:ut("game.ai.variant","1"),availableTimeModes:[["unlimited","0"],["realTime","1"]],timeMode:ut("game.ai.clock","1"),time:ut("game.ai.time","10"),increment:ut("game.ai.increment","0"),days:ut("game.ai.days","2"),level:ut("game.ai.aiLevel","3")},human:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"]],availableRatingRanges:{min:[...st].reverse().map((e=>["-"+e,"-"+e])),max:st.map((e=>["+"+e,"+"+e]))},ratingRangeMin:ut("game.human.rating.range_min","-500"),ratingRangeMax:ut("game.human.rating.range_max","+500"),color:ut("game.human.color","random"),variant:ut("game.human.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:ut("game.human.clock","1"),time:ut("game.human.time","5"),increment:ut("game.human.increment","0"),days:ut("game.human.days","2"),mode:ut("game.human.mode","0"),preset:ut("game.human.preset","quick"),pool:ut("game.human.pool","")},challenge:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"],["From Position","3"]],color:ut("game.invite.color","random"),variant:ut("game.invite.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:ut("game.invite.clock","1"),time:ut("game.invite.time","5"),increment:ut("game.invite.increment","0"),days:ut("game.invite.days","2"),mode:ut("game.invite.mode","0")}},tournament:{availableVariants:[["Standard","1"],["Crazyhouse","10"],["Chess960","2"],["King of the Hill","4"],["Three-check","5"],["Antichess","6"],["Atomic","7"],["Horde","8"],["Racing Kings","9"]],availableModes:[["Casual","0"],["Rated","1"]],availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["1.5","1.5"]].concat(rt(2,7,1)).concat(rt(10,25,5)).concat(rt(30,60,10)),availableIncrements:nt(0,7,1).concat(nt(10,25,5)).concat(nt(30,60,10)),availableDurations:nt(20,55,5).concat(nt(60,110,10)).concat(nt(120,360,30)).concat(nt(420,540,60)).concat(["600","720"]),availableTimesToStart:["1","2","3","5","10","15","20","30","45","60"],variant:ut("tournament.variant","1"),mode:ut("tournament.mode","0"),time:ut("tournament.time","5"),increment:ut("tournament.increment","0"),duration:ut("tournament.duration","45"),timeToStart:ut("tournament.timeToStart","15"),position:ut("tournament.timeToStart","15"),private:ut("tournament.private",!1),join:{lastTeam:ut("tournament.join.lastTeam","")}},tv:{channel:ut("tv.channel","best")},importer:{analyse:ut("importer.analyse",!1)},training:{puzzleBufferLen:50,ratingDiffThreshold:100},coordinates:{colorChoice:ut("coordinates.colorChoice","random")},study:{tour:ut("study.tour",null)}};function ut(e,t){return function(n){if(void 0!==n)return Ze(ct,e,n),Ye.set(it,ct).then((()=>{})),n;const r=Je(ct,e);return void 0!==r?r:t}}const dt="en-GB",ht={},pt={day:"2-digit",month:"long",year:"numeric"},mt=Object.assign(Object.assign({},pt),{hour:"2-digit",minute:"2-digit"});let ft,gt=dt,vt={},bt=new Intl.NumberFormat,wt=new Intl.DateTimeFormat(void 0,pt),yt=new Intl.DateTimeFormat(void 0,mt);function kt(e,...t){const n=vt[e]||Bt[e];return n?Tt(n,...t):e}function St(e,...t){const n=vt[e]||Bt[e];return n?function(e,...t){const n=e.split(/(%(?:\d\$)?s)/g);for(let e=1;e<=t.length;e++){const r=n.indexOf("%"+e+"$s");-1!==r&&(n[r]=t[e-1])}for(let e=0;e<t.length;e++){const r=n.indexOf("%s");if(-1===r)break;n[r]=t[e]}return n}(n,...t):e}function Ct(e,t,n){const r=e+":"+function(e,t){const n=t%100,r=t%10;switch(Nt(e)){case"fr":case"ff":case"kab":return t<2?"one":"other";case"cs":case"sk":return 1===t?"one":t>=2&&t<=4?"few":"other";case"hr":case"ru":case"sr":case"uk":case"be":case"bs":case"sh":return 1===r&&11!==n?"one":r>=2&&r<=4&&!(n>=12&&n<=14)?"few":0===r||r>=5&&r<=9||n>=11&&n<=14?"many":"other";case"lv":return 0===t?"zero":t%10==1&&t%100!=11?"one":"other";case"lt":return 1!==r||n>=11&&n<=19?r>=2&&r<=9&&!(n>=11&&n<=19)?"few":"other":"one";case"pl":return 1===t?"one":r>=2&&r<=4&&!(n>=12&&n<=14)?"few":"other";case"ro":case"mo":return 1===t?"one":0===t||n>=1&&n<=19?"few":"other";case"sl":return 1===n?"one":2===n?"two":n>=3&&n<=4?"few":"other";case"ar":return 0===t?"zero":1===t?"one":2===t?"two":n>=3&&n<=10?"few":n>=11&&n<=99?"many":"other";case"mk":return t%10==1&&11!==t?"one":"other";case"cy":case"br":return 0===t?"zero":1===t?"one":2===t?"two":3===t?"few":6===t?"many":"other";case"mt":return 1===t?"one":0===t||n>=2&&n<=10?"few":n>=11&&n<=19?"many":"other";case"ga":case"se":case"sma":case"smi":case"smj":case"smn":case"sms":return 1===t?"one":2===t?"two":"other";case"ak":case"am":case"bh":case"fil":case"tl":case"guw":case"hi":case"ln":case"mg":case"nso":case"ti":case"wa":return 0===t||1===t?"one":"other";case"az":case"bm":case"fa":case"ig":case"hu":case"ja":case"kde":case"kea":case"ko":case"my":case"ses":case"sg":case"to":case"tr":case"vi":case"wo":case"yo":case"zh":case"bo":case"dz":case"id":case"jv":case"ka":case"km":case"kn":case"ms":case"th":case"tp":case"io":case"ia":return"other";default:return 1===t?"one":"other"}}(gt,t),i=vt[r]||vt[e+":other"]||vt[e];return i?Tt(i,void 0!==n?n:t):e}function Tt(e,...t){let n=e;if(t.length){if(n.includes("$s"))for(let e=1;e<4;e++)n=n.replace("%"+e+"$s",String(t[e-1]));for(const e of t)n=n.replace("%s",String(e))}return n}function Pt(e){return bt.format(e)}function Et(e){return wt.format(e)}function Ot(e){return yt.format(e)}function xt(e){const t=new Date(0);return ce(t,Ge(t,e),{locale:ft})}function _t(e){return Ve(e,new Date,{locale:ft})}function Mt(e,t=!1){return function(e,t){return G(1,arguments),ce(e,Date.now(),t)}(e,{locale:ft,addSuffix:t})}function Nt(e){return e.split("-")[0]}function jt(e){return At[e]||Rt.find((t=>Nt(t)===e))}function Dt(){return gt}function Lt(e){return function(e){const t=qt[e]?e:dt;return import("./i18n/"+t+".js").then((({default:e})=>(gt=t,vt=Object.assign(Object.assign({},ht),e),bt=new Intl.NumberFormat(t),wt=new Intl.DateTimeFormat(t,pt),yt=new Intl.DateTimeFormat(t,mt),t)))}(e).then(lt.general.locale).then((()=>function(e){if(e===dt)return Promise.resolve(e);const t=It.includes(e)?e:Nt(e);return import(`./i18n/date/${t}.js`).then((t=>(ft=t.default||void 0,e))).catch((()=>(ft=void 0,e)))}(e)))}const It=["ar-DZ","ar-MA","ar-SA","en-AU","en-CA","en-GB","en-IN","en-US","fa-IR","fr-CA","fr-CH","nl-BE","pt-BR","zh-CN","zh-TW"];const qt={"af-ZA":"Afrikaans","an-ES":"aragonés","ar-SA":"العربية","as-IN":"অসমীয়া","az-AZ":"Azərbaycanca","be-BY":"Беларуская","bg-BG":"български език","bn-BD":"বাংলা","br-FR":"brezhoneg","bs-BA":"bosanski","ca-ES":"Català, valencià","cs-CZ":"čeština","cv-CU":"чӑваш чӗлхи","cy-GB":"Cymraeg","da-DK":"Dansk","de-CH":"Schwiizerdüütsch","de-DE":"Deutsch","el-GR":"Ελληνικά","en-GB":"English","en-US":"English (US)","eo-UY":"Esperanto","es-ES":"español","et-EE":"eesti keel","eu-ES":"Euskara","fa-IR":"فارسی","fi-FI":"suomen kieli","fo-FO":"føroyskt","fr-FR":"français","frp-IT":"arpitan","fy-NL":"Frysk","ga-IE":"Gaeilge","gd-GB":"Gàidhlig","gl-ES":"Galego","gu-IN":"ગુજરાતી","he-IL":"עִבְרִית","hi-IN":"हिन्दी, हिंदी","hr-HR":"hrvatski","hu-HU":"Magyar","hy-AM":"Հայերեն","ia-IA":"Interlingua","id-ID":"Bahasa Indonesia","io-EN":"Ido","is-IS":"Íslenska","it-IT":"Italiano","ja-JP":"日本語","jbo-EN":"lojban","jv-ID":"basa Jawa","ka-GE":"ქართული","kab-DZ":"Taqvaylit","kk-KZ":"қазақша","kmr-TR":"Kurdî (Kurmancî)","kn-IN":"ಕನ್ನಡ","ko-KR":"한국어","ky-KG":"кыргызча","la-LA":"lingua Latina","lb-LU":"Lëtzebuergesch","lt-LT":"lietuvių kalba","lv-LV":"latviešu valoda","mg-MG":"fiteny malagasy","mk-MK":"македонски јази","ml-IN":"മലയാളം","mn-MN":"монгол","mr-IN":"मराठी","nb-NO":"Norsk bokmål","ne-NP":"नेपाली","nl-NL":"Nederlands","nn-NO":"Norsk nynorsk","pi-IN":"पालि","pl-PL":"polski","ps-AF":"پښتو","pt-PT":"Português","pt-BR":"Português (BR)","ro-RO":"Română","ru-RU":"русский язык","sa-IN":"संस्कृत","sk-SK":"slovenčina","sl-SI":"slovenščina","sq-AL":"Shqip","sr-SP":"Српски језик","sv-SE":"svenska","sw-KE":"Kiswahili","ta-IN":"தமிழ்","tg-TJ":"тоҷикӣ","th-TH":"ไทย","tk-TM":"Türkmençe","tl-PH":"Tagalog","tp-TP":"toki pona","tr-TR":"Türkçe","uk-UA":"українська","ur-PK":"اُردُو","uz-UZ":"oʻzbekcha","vi-VN":"Tiếng Việt","yo-NG":"Yorùbá","zh-CN":"中文","zh-TW":"繁體中文","zu-ZA":"isiZulu"},Rt=Object.keys(qt),At={de:"de-DE",en:"en-US",pt:"pt-PT",zh:"zh-CN"},Bt={apiUnsupported:"Your version of lichess app is too old! Please upgrade for free to the latest version.",apiDeprecated:"Upgrade for free to the latest lichess app! Support for this version will be dropped on %s.",playerisInvitingYou:"%s is inviting you",unsupportedVariant:"Variant %s is not supported in this version",notesSynchronizationHasFailed:"Notes synchronization with lichess has failed, please try later.",localEvalCaution:"Caution: intensive usage will drain battery.",incorrectThreefoldClaim:"Incorrect threefold repetition claim.",useBluetoothDevice:"Use bluetooth device",resetToDefault:"Reset to default",deviceOptions:"Device options",vibrateOnGameEvents:"Vibrate on game events",offline:"Offline"},$t=Object.assign({},{apiVersion:5,fetchTimeoutMs:15e3},window.lichess);var Ft="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ut(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var zt=Ut((function(e){
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
!function(t){function n(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function r(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}n.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,i){var a,o=this._indexOfListener(e,r);if(-1!==o){if((a=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else a=new n(this,e,t,r,i),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return r(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return r(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){r(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=i;a.Signal=i,e.exports?e.exports=a:t.signals=a}(Ft)})),Wt={redraw:new zt.Signal,afterLogin:new zt.Signal,afterLogout:new zt.Signal,sessionRestored:new zt.Signal,homePong:new zt.Signal,gameBackButton:new zt.Signal};let Ht=new Set,Vt=!1;function Gt(e){Ht.add(e),Vt||(Vt=!0,requestAnimationFrame((e=>{const t=Ht;Vt=!1,Ht=new Set,t.forEach((t=>t(e)))})))}function Kt(e){Ht.delete(e)}const Yt=Wt.redraw.dispatch;function Xt(){Gt(Yt)}let Qt,Jt;function Zt(){return Qt||en()}function en(){const e=window.crypto.getRandomValues(new Uint8Array(9));return Qt=btoa(String.fromCharCode(...e)).replace(/[/+]/g,"_"),Qt}function tn(e){return new Promise(((t,n)=>{const r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.onreadystatechange=()=>{4===r.readyState&&(0===r.status||200===r.status?t(JSON.parse(r.responseText)):n(r))},r.send(null)}))}function nn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("script");for(let n=0,r=t.length;n<r;n++)if(t[n].getAttribute("src")===e)return!0;return!1}(e))setTimeout(t,0);else{const r=document.createElement("script");r.src=e,r.onload=()=>t(),r.onerror=()=>n(),document.head.appendChild(r)}}))}function rn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("link");for(let n=0,r=t.length;n<r;n++)if(t[n].getAttribute("href")===e)return!0;return!1}(e))setTimeout(t,0);else{const r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.onload=()=>t(),r.onerror=()=>n(),document.head.appendChild(r)}}))}function an(e){const t=e();return Xt(),t}function on(){return Jt.connected}function sn(e){const t=e.status,n=e.body;let r;r=t&&0!==t?401===t?"You are not authorized to do that.":404===t?"Resource not found.":503===t?"lichess.org is temporarily down for maintenance.":t>=500?"Server error.":"Something went wrong.":"lichess.org is unreachable.",n&&("string"==typeof n?r+=` ${n}`:"string"==typeof n.error?r+=` ${n.error}`:n.global&&n.global.constructor===Array&&(r+=` ${kt(n.global[0])}`)),z.show({text:r,duration:"short"})}function cn(e){let t="";return Object.keys(e).forEach((n=>{const r=e[n];null!=r&&(""!==t&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(r))})),t}function ln(){}u.addListener("networkStatusChange",(e=>{Jt=e})),u.getStatus().then((e=>{Jt=e}));const un={bullet:"T",blitz:")",rapid:"#",classical:"+",correspondence:";",chess960:"'",kingOfTheHill:"(",threeCheck:".",antichess:"@",atomic:">",puzzle:"-",horde:"_",fromPosition:"*",racingKings:"",crazyhouse:"",ultraBullet:"{",computer:"n",bot:"n"};function dn(e){return e&&un[e]||"8"}function hn(e){return 0===e?e:e/60}function pn(e){return"white"===e?"black":"white"}function mn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function fn(e,t){return Math.random()*(t-e)+e}function gn(e,t){return"racingKings"===e.game.variant.key?t?"black":"white":t?e.opponent.color:e.player.color}function vn(e,t){let n=e+"";for(;n.length<t;)n="0"+n;return n}function bn(e,t="hour_min_secs"){let n="";const r=Math.floor(e/60/60),i=Math.floor(e/60)-60*r,a=e%60;return n="hour_min_secs"===t?r>0?r+":"+vn(i,2)+":"+vn(a,2):i+":"+vn(a,2):vn(a,2),n}function wn(e){const t=Math.floor(e/60),n=Math.floor(e-60*t);return(t?t+"H ":"")+(n?n+"M":"")}function yn(e){if(e){const t=hn(e.limit);return(.25===t?"¼":.5===t?"½":.75===t?"¾":t.toString())+"+"+e.increment}return"∞"}function kn(e){return null!=e}function Sn(e){return`${$t.apiEndPoint}/assets/${e}`}function Cn(e){const t=Number(e);return isNaN(t)?void 0:t}function Tn(e){if(!(void 0===e||e.length>7||0===e.length||/[^a-zA-Z0-9]/.exec(e)))return e.split("").reduce(((e,t,n)=>e+function(e){const t=e.charCodeAt(0);return t>96?t-71:t>64?t-65:t+4}(t)*Math.pow(62,n)),0)}const Pn=window.requestIdleCallback||window.setTimeout;function En(e){let t=e;return e=>(void 0!==e&&(t=e),t)}function On(e){return e?250:0}function xn(){return Math.random()>.5?"white":"black"}function _n(e,t){return"1"===e&&-1!==["5","6","7","8","9"].indexOf(t)?[["randomColor","random"]]:[["randomColor","random"],["white","white"],["black","black"]]}function Mn(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return m(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),U(e,t,{leading:r,maxWait:t,trailing:i})}function Nn(e){try{return window.localStorage?e(window.localStorage):null}catch(e){}}var jn={get:function(e){return Nn((t=>{const n=t.getItem(e);return n?JSON.parse(n):null}))},set:function(e,t){Nn((n=>{try{n.setItem(e,JSON.stringify(t))}catch(r){n.removeItem(e),n.setItem(e,JSON.stringify(t))}}))},remove:function(e){Nn((t=>{t.removeItem(e)}))}};function Dn(e,t,n,r,i,a){return{tag:e,key:t,attrs:n,children:r,text:i,dom:a,domSize:void 0,state:void 0,events:void 0,instance:void 0}}Dn.normalize=function(e){return Array.isArray(e)?Dn("[",void 0,void 0,Dn.normalizeChildren(e),void 0,void 0):null==e||"boolean"==typeof e?null:"object"==typeof e?e:Dn("#",void 0,void 0,String(e),void 0,void 0)},Dn.normalizeChildren=function(e){var t=[];if(window.lichess&&"dev"===window.lichess.mode&&e.length)for(var n=null!=e[0]&&null!=e[0].key,r=1;r<e.length;r++)if((null!=e[r]&&null!=e[r].key)!==n)throw new TypeError(!n||null==e[r]&&"boolean"!=typeof e[r]?"In fragments, vnodes must either all have keys or none have keys.":"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.");for(r=0;r<e.length;r++)t[r]=Dn.normalize(e[r]);return t};var Ln=Dn,In=function(){var e,t=arguments[this],n=this+1;if(null==t?t={}:("object"!=typeof t||null!=t.tag||Array.isArray(t))&&(t={},n=this),arguments.length===n+1)e=arguments[n],Array.isArray(e)||(e=[e]);else for(e=[];n<arguments.length;)e.push(arguments[n++]);return Ln("",t.key,t,e)},qn={}.hasOwnProperty,Rn=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,An={};function Bn(e){for(var t in e)if(qn.call(e,t))return!1;return!0}var $n=function(e){if(null==e||"string"!=typeof e&&"function"!=typeof e&&"function"!=typeof e.view)throw Error("The selector must be either a string or a component.");var t=In.apply(1,arguments);return"string"==typeof e&&(t.children=Ln.normalizeChildren(t.children),"["!==e)?function(e,t){var n=t.attrs,r=Ln.normalizeChildren(t.children),i=qn.call(n,"class"),a=i?n.class:n.className;if(t.tag=e.tag,t.attrs=null,t.children=void 0,!Bn(e.attrs)&&!Bn(n)){var o={};for(var s in n)qn.call(n,s)&&(o[s]=n[s]);n=o}for(var s in e.attrs)qn.call(e.attrs,s)&&"className"!==s&&!qn.call(n,s)&&(n[s]=e.attrs[s]);for(var s in null==a&&null==e.attrs.className||(n.className=null!=a?null!=e.attrs.className?String(e.attrs.className)+" "+String(a):a:null!=e.attrs.className?e.attrs.className:null),i&&(n.class=null),n)if(qn.call(n,s)&&"key"!==s){t.attrs=n;break}return Array.isArray(r)&&1===r.length&&null!=r[0]&&"#"===r[0].tag?t.text=r[0].children:t.children=r,t}(An[e]||function(e){for(var t,n="div",r=[],i={};t=Rn.exec(e);){var a=t[1],o=t[2];if(""===a&&""!==o)n=o;else if("#"===a)i.id=o;else if("."===a)r.push(o);else if("["===t[3][0]){var s=t[6];s&&(s=s.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===t[4]?r.push(s):i[t[4]]=""===s?s:s||!0}}return r.length>0&&(i.className=r.join(" ")),An[e]={tag:n,attrs:i}}(e),t):(t.tag=e,t)};$n.trust=function(e){return null==e&&(e=""),Ln("<",void 0,void 0,e,void 0,void 0)},$n.fragment=function(){var e=In.apply(0,arguments);return e.tag="[",e.children=Ln.normalizeChildren(e.children),e};var Fn=$n;let Un;var zn={spin(){if(void 0!==Un||document.getElementById("globalSpinner"))return;const e=document.createElement("div");e.id="globalSpinner",e.className="spinner globalSpinner";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 40 40");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","20"),n.setAttribute("cy","20"),n.setAttribute("r","18"),n.setAttribute("fill","none"),t.appendChild(n),e.appendChild(t),Un=setTimeout((()=>{document.body.appendChild(e)}),200)},stop(){clearTimeout(Un),Un=void 0;const e=document.getElementsByClassName("globalSpinner");e.length&&setTimeout((function(){for(;e[0];)document.body.removeChild(e[0])}),500)},getVdom:e=>Fn("div.spinner",{className:e||""},[Fn("svg",{viewBox:"0 0 40 40"},[Fn("circle",{cx:"20",cy:"20",r:"18",fill:"none"})])]),getHtml:()=>'<div class="spinner monochrome"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>'};function Wn(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e.toString():"";default:return""}}function Hn(e,t,n,r){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((r=>{const i=encodeURIComponent(Wn(r))+n;return Array.isArray(e[r])?e[r].map((e=>i+encodeURIComponent(Wn(e)))).join(t):i+encodeURIComponent(Wn(e[r]))})).join(t):r?encodeURIComponent(Wn(r))+n+encodeURIComponent(Wn(e)):""}var Vn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Gn="sessionId",Kn=$t.apiEndPoint;function Yn(e,t,n,r=!1){let i;function a(){clearTimeout(i),r&&zn.stop()}const o=new Headers({"X-Requested-With":"XMLHttpRequest",Accept:"application/vnd.lichess.v"+$t.apiVersion+"+json"}),s=jn.get(Gn);null!=s&&o.append(Gn,s);const c={method:"GET",credentials:"include"};let l;if(void 0!==n){const{headers:t,query:r,timeout:i}=n,a=Vn(n,["headers","query","timeout"]);if(l=i,r){const t=Hn(r);""!==t&&(e=function(e,t){const n=e.indexOf("?")<0?"?":"&";return e+n+t}(e,t))}Object.assign(c,a),t&&Object.keys(t).forEach((e=>{const n=t[e];"__delete"!==n?o.set(e,n):o.delete(e)}))}"POST"!==c.method&&"PUT"!==c.method||o.has("Content-Type")||(o.set("Content-Type","application/json; charset=UTF-8"),c.body||(c.body="{}"));const u=e.indexOf("http")>-1?e:Kn+e,d=new Promise(((e,t)=>{i=setTimeout((()=>t(new Error("Request timeout."))),l||$t.fetchTimeoutMs)})),h=Promise.race([fetch(u,Object.assign(Object.assign({},c),{headers:o})),d]);return r&&zn.spin(),new Promise(((e,n)=>{h.then((r=>{a(),r.ok?e(r[t]()):r.text().then((e=>{try{n({status:r.status,body:JSON.parse(e)})}catch(e){n({status:r.status,body:r.statusText})}}))})).catch((e=>{a(),n({status:0,body:e.message})}))}))}function Xn(e,t,n=!1){return Yn(e,"json",t,n)}function Qn(e,t,n=!1){return Yn(e,"text",t,n)}var Jn={isStub:!0,init(){},register:async()=>Promise.resolve(),unregister:()=>Promise.resolve("")};const Zn=new Map;var er={list:()=>[...Zn.values()].sort(((e,t)=>{return r=t,(n=e).name.toLowerCase()<r.name.toLowerCase()?-1:n.name.toLowerCase()>r.name.toLowerCase()?1:0;var n,r})),count:()=>Zn.size,reset(e,t,n){Zn.clear(),e.forEach((e=>{const[r,i]=tr(e),a=r.toLowerCase(),o=t.includes(a),s=n.includes(a);Zn.set(e,{name:r,title:i,playing:o,patron:s})}))},set(e,t,n){const[r,i]=tr(e);Zn.set(e,{name:r,title:i,playing:t,patron:n})},playing(e){const t=Zn.get(e);t&&Zn.set(e,Object.assign(Object.assign({},t),{playing:!0}))},stoppedPlaying(e){const t=Zn.get(e);t&&Zn.set(e,Object.assign(Object.assign({},t),{playing:!1}))},remove(e){Zn.delete(e)},clear(){Zn.clear()}};function tr(e){const t=e.split(" ");return[t.length>1?t[1]:t[0],t.length>1?t[0]:void 0]}const nr=r("SoundEffect",{web:()=>import("./web-2293305a.js").then((e=>new e.SoundEffectWeb))});let rr=!0;function ir(){return rr}let ar=void 0!==window.AudioContext?new AudioContext:null;var or={load:()=>Promise.all([cr("move"),cr("capture"),cr("explosion"),cr("lowtime"),cr("dong"),cr("berserk"),cr("clock"),cr("confirmation")]).then((()=>{})),resume(){null!=ar&&(ar.close(),ar=new AudioContext)},move(){lr("move")},throttledMove:Mn((()=>{lr("move")}),50),capture(){lr("capture")},throttledCapture:Mn((()=>{lr("capture")}),50),explosion(){lr("explosion")},throttledExplosion:Mn((()=>{lr("explosion")}),50),lowtime(){lr("lowtime")},dong(){lr("dong")},berserk(){lr("berserk")},clock(){lr("clock")},confirmation(){lr("confirmation")}};const sr={};async function cr(e){const t=`sounds/${e}.mp3`;"ios"===n.getPlatform()&&null!=ar?window.fetch(t).then((e=>e.arrayBuffer())).then((e=>ar.decodeAudioData(e))).then((t=>sr[e]=t)):nr.loadSound({id:e,path:t})}function lr(e){if(lt.general.sound()&&ir())if("ios"===n.getPlatform()&&null!=ar){const t=ar.createBufferSource();t.buffer=sr[e],t.connect(ar.destination),t.start()}else nr.play({id:e})}const ur=r("Dialog",{web:()=>import("./web-3a996da2.js").then((e=>new e.DialogWeb))});function dr(e){return{mode:Number(e.mode()),variant:Number(e.variant()),timeMode:Number(e.timeMode()),time:Number(e.time()),increment:Number(e.increment()),days:Number(e.days()),color:e.color(),ratingRangeMin:Number(e.ratingRangeMin()),ratingRangeMax:Number(e.ratingRangeMax())}}function hr(e,t){const{ratingRangeMin:n,ratingRangeMax:r}=t;let i="correspondence";switch(t.variant){case 1:case 3:if(1===t.timeMode){const e=60*t.time+40*t.increment;i=e<30?"ultraBullet":e<180?"bullet":e<480?"blitz":e<1500?"rapid":"classical"}break;case 2:i="chess960";break;case 4:i="kingOfTheHill";break;case 5:i="threeCheck";break;case 6:i="antichess";break;case 7:i="atomic";break;case 8:i="horde";break;case 9:i="racingKings";break;case 10:i="crazyhouse"}const a=e.perfs[i];return a&&void 0!==n&&void 0!==r?`${a.rating+n}-${a.rating+r}`:null}var pr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function mr(e){const t=lt.gameSetup.ai,n={variant:t.variant(),timeMode:t.timeMode(),days:t.days(),time:t.time(),increment:t.increment(),level:t.level(),color:t.color()};return e&&(n.fen=e),Xn("/setup/ai",{method:"POST",body:JSON.stringify(n)},!0)}function fr(e){const t=pr(e,["ratingRangeMin","ratingRangeMax"]),n=Zr.get(),r=n?hr(n,e):null,i=r?Object.assign(Object.assign({},t),{ratingRange:r}):Object.assign({},t);return Xn("/setup/hook/"+Zt(),{method:"POST",body:JSON.stringify(i)},!0)}function gr(){return Xn("/challenge")}function vr(e){return Xn(`/challenge/${e}`,{},!0)}function br(e){return Qn(`/challenge/${e}/cancel`,{method:"POST"},!0)}function wr(e){return Qn(`/challenge/${e}/decline`,{method:"POST"},!0)}function yr(e){return Xn(`/challenge/${e}/accept`,{method:"POST"},!0)}let kr=[];function Sr(e){return Xn("/",void 0,e).then((e=>(void 0!==e.lobby.pools&&(kr=e.lobby.pools),e)))}function Cr(e){return Xn("/lobby/seeks",{query:{_:Date.now()}},e)}function Tr(e,t){let n="/"+e;return t&&(n+="/"+t),Xn(n)}function Pr(e){return Qn("/bookmark/"+e,{method:"POST"})}function Er(e,t){return Xn("/tv/"+e,t?{query:{flip:1}}:{})}function Or(e,t){return Xn(`/import/master/${e}/${t}`)}function xr(e){return Zr.isConnected()?Xn("/translation/select",{method:"POST",body:JSON.stringify({lang:e})}).then((()=>{})):Promise.resolve()}function _r(e){return Xn(`/@/${e}/mini`)}function Mr(){return Xn("/timeline",{query:{nb:10}},!1)}let Nr=[],jr=[];function Dr(e){return-1!==lt.game.supportedVariants.indexOf(e.variant.key)&&"created"===e.status}function Lr(e){e.in.length>Nr.length&&or.dong(),Nr=e.in,jr=e.out}var Ir={all:()=>Nr.filter(Dr).concat(jr.filter(Dr)),incoming:()=>Nr.filter(Dr),sending:()=>jr.filter(Dr),set:Lr,refresh:()=>Mn(gr,1e3)().then(Lr),remove(e){Nr=Nr.filter((t=>t.id!==e)),jr=jr.filter((t=>t.id!==e))},isPersistent:e=>"correspondence"===e.timeControl.type||"unlimited"===e.timeControl.type,challengeTime:e=>function(e){return"clock"===e.type}(e.timeControl)?e.timeControl.show:function(e){return"correspondence"===e.type}(e.timeControl)?Ct("nbDays",e.timeControl.daysPerTurn):"∞"};const qr="announce";let Rr;function Ar(e){return e.date}function Br(e){return new Date(e)<new Date}var $r={get:function(){return Rr&&Br(Rr.date)&&(Rr=void 0),Rr},set:async function(e){if(e){const t=Ar(e),n=await Ye.get(qr);if(null==n?void 0:n.includes(t))return}Rr=e,Xt()},dismiss:async function(){if(void 0===Rr)return;const e=Ar(Rr);Rr=void 0,Xt();const t=(await Ye.get(qr)||[]).filter((e=>!Br(e)));t.push(e),await Ye.set(qr,t)}};let Fr;function Ur(){return void 0!==Fr}function zr(e){Ye.set("session",e)}function Wr(){Ye.remove("session"),jn.remove(Gn),Wt.afterLogout.dispatch()}function Hr(){return(Fr&&Fr.nowPlaying||[]).filter((e=>-1!==lt.game.supportedVariants.indexOf(e.variant.key)))}function Vr(e){return z.show({text:"✓ lichess.org: "+kt("yourPreferencesHaveBeenSaved"),position:"center",duration:"short"}),e}function Gr(e){return!0===e?"1":!1===e?"0":String(e)}function Kr(e){return function(t,[n,r]){return Object.assign(Object.assign({},t),{[e+n]:Gr(r)})}}const Yr=Mn((()=>{const e=Fr&&Fr.prefs||{},t=Object.entries(et(e,["animation","captured","highlight","destination","coords","replay","blindfold"])).reduce(Kr("display."),{}),n=Object.entries(et(e,["premove","takeback","autoQueen","autoThreefold","submitMove","confirmResign","moretime"])).reduce(Kr("behavior."),{}),r=Object.entries(et(e,["clockTenths","clockBar","clockSound","follow","challenge","message","insightShare"])).reduce(Kr(""),{});return Qn("/account/preferences",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"},body:cn(Object.assign(Object.assign(Object.assign({},r),t),n))},!0).then(Vr)}),1e3);function Xr(e){return void 0!==e.id}async function Qr(){try{const e=await Xn("/account/info",{cache:"reload"});Fr=e,zr(e),$r.set(e.announce),Fr.nbChallenges!==Ir.incoming().length&&Ir.refresh().then(Xt),Xt()}catch(e){void 0!==Fr&&401===e.status&&(Fr=void 0,Wr(),Xt(),z.show({text:"You have been signed out",position:"center",duration:"short"}))}}function Jr(){c.getId().then((({identifier:e})=>{"web"!==e&&Qn(`/auth/set-fp/${e}/0`,{method:"POST"})}))}var Zr={isConnected:Ur,isKidMode:function(){return!(!Fr||!Fr.kid)},isShadowban:function(){return!(!Fr||!Fr.troll)},logout:function(){return Jn.unregister().then((()=>Xn("/logout",{method:"POST"},!0).then((()=>{Fr=void 0,Wr(),er.clear(),Xt()})))).catch(sn)},signup:function(e,t,n){return Xn("/signup",{method:"POST",body:JSON.stringify({username:e,email:t,password:n,"can-confirm":!0})},!0).then((e=>(Xr(e)&&(Fr=e,Fr.sessionId&&jn.set(Gn,Fr.sessionId),Jr()),e)))},login:Mn((function(e,t,n){return Xn("/login",{method:"POST",body:JSON.stringify({username:e,password:t,token:n})},!0).then((e=>{if(Xr(e))return Fr=e,Fr.sessionId&&jn.set(Gn,Fr.sessionId),zr(e),Jr(),Fr;throw{ipban:!0}}))}),1e3),rememberLogin:Mn((function(){return Xn("/account/info").then((e=>(Fr=e,zr(e),e)))}),1e3),restoreStoredSession:function(){Ye.get("session").then((e=>{Fr=e||void 0,null!==e&&(Wt.sessionRestored.dispatch(),Xt())}))},refresh:Mn(Qr,1e3),backgroundRefresh:Mn((async function(){if(on()&&Ur()){const e=await Xn("/account/info");Fr=e,zr(e),$r.set(e.announce),Fr.nbChallenges!==Ir.incoming().length&&Ir.refresh().then(Xt)}}),1e3),get:function(){return Fr},getUserId:function(){return Fr&&Fr.id},appUser:e=>Fr?Fr&&Fr.username:e,nowPlaying:Hr,myTurnGames:function(){return Hr().filter((e=>e.isMyTurn))},lichessBackedProp:function(e,t){return function(...n){if(n.length){let t;Fr&&(t=Je(Fr,e),Ze(Fr,e,n[0])),Yr().catch((n=>{Fr&&Ze(Fr,e,t),on()&&sn(n)}))}return Fr?Je(Fr,e):t}},setKidMode:function(e,t){return Qn(`/account/kid?v=${e}`,{method:"POST",body:new URLSearchParams(t),headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"}},!0).then(Qr)},confirmEmail:function(e){return Xn(`/signup/confirm/${e}`,void 0,!0).then((e=>(Fr=e,zr(e),Fr)))},hasCurrentBan:()=>void 0!==(null==Fr?void 0:Fr.playban)};const ei="transition",ti="transitionend";function ni(e,t,n,r,i){var a=arguments,o=arguments.length;return 0===o||2===o||o>5?Promise.reject(new Error("Zanimo invalid arguments")):e instanceof Promise?e.then((function(e){return ni.apply(this,[e].concat(Array.prototype.slice.call(a,1)))})):function(e){try{return e&&e.nodeType}catch(e){return!1}}(e)?1===o?Promise(e):3===o?function(e,t,n){e._zanimo&&Object.prototype.hasOwnProperty.call(e._zanimo,t);return function(e,t,n){return requestAnimationFrame((function(){e.style[t]=n})),Promise(e)}(e,t,n)}(e,t,n):window.isNaN(parseInt(r,10))?Promise.reject(new Error("Zanimo transition: duration must be an integer!")):function(e,t,n,r,i){var a,o=t,s=new Promise((function(s,c){function l(t){t.propertyName===o&&(u(!0),s(e))}function u(n){a&&(clearTimeout(a),a=null),function(e,t){e.style[ei]=e.style[ei].split(",").filter((function(e){return!e.match(t)})).join(",")}(e,t),e.removeEventListener(ti,l),n&&delete e._zanimo[t]}e.addEventListener(ti,l),requestAnimationFrame((function(){!function(e,t,n,r,i){var a=e.style[ei];e.style[ei]=a?a+", "+ri(t,r,i):ri(t,r,i);e.style[t]=n}(e,t,n,r,i),a=setTimeout((function(){u(!0),s(e)}),r+20),e._zanimo=e._zanimo||{},e._zanimo[t],e._zanimo[t]={value:n}}))}));return s}(e,t,n,r,i):Promise.reject(new Error("Zanimo require an HTMLElement, or a promise of an HTMLElement"))}function ri(e,t,n){return e+" "+t+"ms "+(n||"linear")}var ii=Ut((function(e){!function(t,n){var r=t.define;r&&r.amd?r("rlite",[],n):e.exports?e.exports=n():t.Rlite=n()}(Ft,(function(){return function(){var e={},t=decodeURIComponent;function n(e){return e}function r(r){var i=function(e){return~e.indexOf("/?")&&(e=e.replace("/?","?")),"/"==e[0]&&(e=e.slice(1)),"/"==e[e.length-1]&&(e=e.slice(0,-1)),e}(r).split("?"),a=~r.indexOf("%")?t:n;return function(e,t,n){if(e&&t.cb)for(var r=e.indexOf("#"),i=(r<0?e:e.slice(0,r)).split("&"),a=0;a<i.length;++a){var o=i[a].split("=");t.params[o[0]]=n(o[1])}return t}(i[1],function(t,n){for(var r=t.split("/"),i=e,a={},o=0;o<r.length&&i;++o){var s=n(r[o]);(i=i[s.toLowerCase()]||i[":"])&&i["~"]&&(a[i["~"]]=s)}return i&&{cb:i["@"],params:a}}(i[0],a)||{},a)}return{add:function(t,n){for(var r=t.split("/"),i=e,a=0;a<r.length;++a){var o=r[a],s=":"==o[0]?":":o.toLowerCase();i=i[s]||(i[s]={}),":"==s&&(i["~"]=o.slice(1))}i["@"]=n},exists:function(e){return!!r(e).cb},lookup:r,run:function(e){var t=r(e);return t.cb&&t.cb({url:e,params:t.params}),!!t.cb}}}}))})),ai=function(e){var t,n=e&&e.document,r={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(e){return e.attrs&&e.attrs.xmlns||r[e.tag]}function a(e,t){if(e.state!==t)throw new Error("'vnode.state' must not be modified.")}function o(e){var t=e.state;try{return this.apply(t,arguments)}finally{a(e,t)}}function s(){try{return n.activeElement}catch(e){return null}}function c(e,t,n,r,i,a,o){for(var s=n;s<r;s++){var c=t[s];null!=c&&l(e,c,i,o,a)}}function l(e,t,r,i,a){var o=t.tag;if("string"==typeof o)switch(t.state={},null!=t.attrs&&F(t.attrs,t,r),o){case"#":!function(e,t,r){t.dom=n.createTextNode(t.children),C(e,t.dom,r)}(e,t,a);break;case"<":d(e,t,i,a);break;case"[":!function(e,t,r,i,a){var o=n.createDocumentFragment();if(null!=t.children){var s=t.children;c(o,s,0,s.length,r,null,i)}t.dom=o.firstChild,t.domSize=o.childNodes.length,C(e,o,a)}(e,t,r,i,a);break;default:h(e,t,r,i,a)}else!function(e,t,n,r,i){p(t,n),null!=t.instance?(l(e,t.instance,n,r,i),t.dom=t.instance.dom,t.domSize=null!=t.dom?t.instance.domSize:0):t.domSize=0}(e,t,r,i,a)}var u={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function d(e,t,r,i){var a=t.children.match(/^\s*?<(\w+)/im)||[],o=n.createElement(u[a[1]]||"div");"http://www.w3.org/2000/svg"===r?(o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",o=o.firstChild):o.innerHTML=t.children,t.dom=o.firstChild,t.domSize=o.childNodes.length,t.instance=[];for(var s,c=n.createDocumentFragment();s=o.firstChild;)t.instance.push(s),c.appendChild(s);C(e,c,i)}function h(e,t,r,a,o){var s=t.tag,l=t.attrs,u=l&&l.is,d=(a=i(t)||a)?u?n.createElementNS(a,s,{is:u}):n.createElementNS(a,s):u?n.createElement(s,{is:u}):n.createElement(s);if(t.dom=d,null!=l&&function(e,t,n){for(var r in t)M(e,r,null,t[r],n)}(t,l,a),C(e,d,o),!T(t)&&(null!=t.text&&(""!==t.text?d.textContent=t.text:t.children=[Ln("#",void 0,void 0,t.text,void 0,void 0)]),null!=t.children)){var h=t.children;c(d,h,0,h.length,r,null,a),"select"===t.tag&&null!=l&&function(e,t){if("value"in t)if(null===t.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var n=""+t.value;e.dom.value===n&&-1!==e.dom.selectedIndex||(e.dom.value=n)}"selectedIndex"in t&&M(e,"selectedIndex",null,t.selectedIndex,void 0)}(t,l)}}function p(e,t){var n;if("function"==typeof e.tag.view){if(e.state=Object.create(e.tag),null!=(n=e.state.view).$$reentrantLock$$)return;n.$$reentrantLock$$=!0}else{if(e.state=void 0,null!=(n=e.tag).$$reentrantLock$$)return;n.$$reentrantLock$$=!0,e.state=null!=e.tag.prototype&&"function"==typeof e.tag.prototype.view?new e.tag(e):e.tag(e)}if(F(e.state,e,t),null!=e.attrs&&F(e.attrs,e,t),e.instance=Ln.normalize(o.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");n.$$reentrantLock$$=null}function m(e,t,n,r,i,a){if(t!==n&&(null!=t||null!=n))if(null==t||0===t.length)c(e,n,0,n.length,r,i,a);else if(null==n||0===n.length)P(e,t,0,t.length);else{var o=null!=t[0]&&null!=t[0].key,s=null!=n[0]&&null!=n[0].key,u=0,d=0;if(!o)for(;d<t.length&&null==t[d];)d++;if(!s)for(;u<n.length&&null==n[u];)u++;if(null===s&&null==o)return;if(o!==s)P(e,t,d,t.length),c(e,n,u,n.length,r,i,a);else if(s){for(var h,p,m,g,v,S=t.length-1,C=n.length-1;S>=d&&C>=u&&(m=t[S],g=n[C],m.key===g.key);)m!==g&&f(e,m,g,r,i,a),null!=g.dom&&(i=g.dom),S--,C--;for(;S>=d&&C>=u&&(h=t[d],p=n[u],h.key===p.key);)d++,u++,h!==p&&f(e,h,p,r,y(t,d,i),a);for(;S>=d&&C>=u&&u!==C&&h.key===g.key&&m.key===p.key;)k(e,m,v=y(t,d,i)),m!==p&&f(e,m,p,r,v,a),++u<=--C&&k(e,h,i),h!==g&&f(e,h,g,r,i,a),null!=g.dom&&(i=g.dom),d++,m=t[--S],g=n[C],h=t[d],p=n[u];for(;S>=d&&C>=u&&m.key===g.key;)m!==g&&f(e,m,g,r,i,a),null!=g.dom&&(i=g.dom),C--,m=t[--S],g=n[C];if(u>C)P(e,t,d,S+1);else if(d>S)c(e,n,u,C+1,r,i,a);else{var T,O,x=i,_=C-u+1,M=new Array(_),N=0,j=0,D=2147483647,L=0;for(j=0;j<_;j++)M[j]=-1;for(j=C;j>=u;j--){null==T&&(T=b(t,d,S+1));var I=T[(g=n[j]).key];null!=I&&(D=I<D?I:-1,M[j-u]=I,m=t[I],t[I]=null,m!==g&&f(e,m,g,r,i,a),null!=g.dom&&(i=g.dom),L++)}if(i=x,L!==S-d+1&&P(e,t,d,S+1),0===L)c(e,n,u,C+1,r,i,a);else if(-1===D)for(O=function(e){var t=[0],n=0,r=0,i=0,a=w.length=e.length;for(i=0;i<a;i++)w[i]=e[i];for(i=0;i<a;++i)if(-1!==e[i]){var o=t[t.length-1];if(e[o]<e[i])w[i]=o,t.push(i);else{for(n=0,r=t.length-1;n<r;){var s=(n>>>1)+(r>>>1)+(n&r&1);e[t[s]]<e[i]?n=s+1:r=s}e[i]<e[t[n]]&&(n>0&&(w[i]=t[n-1]),t[n]=i)}}n=t.length,r=t[n-1];for(;n-- >0;)t[n]=r,r=w[r];return w.length=0,t}(M),N=O.length-1,j=C;j>=u;j--)p=n[j],-1===M[j-u]?l(e,p,r,a,i):O[N]===j-u?N--:k(e,p,i),null!=p.dom&&(i=n[j].dom);else for(j=C;j>=u;j--)p=n[j],-1===M[j-u]&&l(e,p,r,a,i),null!=p.dom&&(i=n[j].dom)}}else{var q=t.length<n.length?t.length:n.length;for(u=u<d?u:d;u<q;u++)(h=t[u])===(p=n[u])||null==h&&null==p||(null==h?l(e,p,r,a,y(t,u+1,i)):null==p?E(e,h):f(e,h,p,r,y(t,u+1,i),a));t.length>q&&P(e,t,u,t.length),n.length>q&&c(e,n,u,n.length,r,i,a)}}}function f(e,t,n,r,i,a){var s=t.tag;if(s===n.tag){if(n.state=t.state,n.events=t.events,function(e,t){do{var n;if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate)if(void 0!==(n=o.call(e.attrs.onbeforeupdate,e,t))&&!n)break;if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate)if(void 0!==(n=o.call(e.state.onbeforeupdate,e,t))&&!n)break;return!1}while(0);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}(n,t))return;if("string"==typeof s)switch(null!=n.attrs&&U(n.attrs,n,r),s){case"#":!function(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children);t.dom=e.dom}(t,n);break;case"<":!function(e,t,n,r,i){t.children!==n.children?(O(e,t),d(e,n,r,i)):(n.dom=t.dom,n.domSize=t.domSize,n.instance=t.instance)}(e,t,n,a,i);break;case"[":!function(e,t,n,r,i,a){m(e,t.children,n.children,r,i,a);var o=0,s=n.children;if(n.dom=null,null!=s){for(var c=0;c<s.length;c++){var l=s[c];null!=l&&null!=l.dom&&(null==n.dom&&(n.dom=l.dom),o+=l.domSize||1)}1!==o&&(n.domSize=o)}}(e,t,n,r,i,a);break;default:g(t,n,r,a)}else v(e,t,n,r,i,a)}else E(e,t),l(e,n,r,a,i)}function g(e,t,n,r){var a=t.dom=e.dom;r=i(t)||r,"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),function(e,t,n,r){if(null!=n)for(var i in n)M(e,i,t&&t[i],n[i],r);var a;if(null!=t)for(var i in t)null==(a=t[i])||null!=n&&null!=n[i]||N(e,i,a,r)}(t,e.attrs,t.attrs,r),T(t)||(null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[Ln("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[Ln("#",void 0,void 0,t.text,void 0,void 0)]),m(a,e.children,t.children,n,null,r)))}function v(e,t,n,r,i,a){if(n.instance=Ln.normalize(o.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");U(n.state,n,r),null!=n.attrs&&U(n.attrs,n,r),null!=n.instance?(null==t.instance?l(e,n.instance,r,a,i):f(e,t.instance,n.instance,r,i,a),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?(E(e,t.instance),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function b(e,t,n){for(var r=Object.create(null);t<n;t++){var i=e[t];if(null!=i){var a=i.key;null!=a&&(r[a]=t)}}return r}var w=[];function y(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function k(e,t,r){var i=n.createDocumentFragment();S(e,i,t),C(e,i,r)}function S(e,t,n){for(;null!=n.dom&&n.dom.parentNode===e;){if("string"!=typeof n.tag){if(null!=(n=n.instance))continue}else if("<"===n.tag)for(var r=0;r<n.instance.length;r++)t.appendChild(n.instance[r]);else if("["!==n.tag)t.appendChild(n.dom);else if(1===n.children.length){if(null!=(n=n.children[0]))continue}else for(r=0;r<n.children.length;r++){var i=n.children[r];null!=i&&S(e,t,i)}break}}function C(e,t,n){null!=n?e.insertBefore(t,n):e.appendChild(t)}function T(e){if(null==e.attrs||null==e.attrs.contenteditable&&null==e.attrs.contentEditable)return!1;var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var n=t[0].children;e.dom.innerHTML!==n&&(e.dom.innerHTML=n)}else if(null!=e.text||null!=t&&0!==t.length)throw new Error("Child node of a contenteditable must be trusted.");return!0}function P(e,t,n,r){for(var i=n;i<r;i++){var a=t[i];null!=a&&E(e,a)}}function E(e,t){var n,r,i,s=0,c=t.state;"string"!=typeof t.tag&&"function"==typeof t.state.onbeforeremove&&(null!=(i=o.call(t.state.onbeforeremove,t))&&"function"==typeof i.then&&(s=1,n=i));t.attrs&&"function"==typeof t.attrs.onbeforeremove&&(null!=(i=o.call(t.attrs.onbeforeremove,t))&&"function"==typeof i.then&&(s|=2,r=i));if(a(t,c),s){if(null!=n){var l=function(){1&s&&((s&=2)||u())};n.then(l,l)}if(null!=r){l=function(){2&s&&((s&=1)||u())};r.then(l,l)}}else _(t),x(e,t);function u(){a(t,c),_(t),x(e,t)}}function O(e,t){for(var n=0;n<t.instance.length;n++)e.removeChild(t.instance[n])}function x(e,t){for(;null!=t.dom&&t.dom.parentNode===e;){if("string"!=typeof t.tag){if(null!=(t=t.instance))continue}else if("<"===t.tag)O(e,t);else{if("["!==t.tag&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(1===t.children.length){if(null!=(t=t.children[0]))continue}else for(var n=0;n<t.children.length;n++){var r=t.children[n];null!=r&&x(e,r)}}break}}function _(e){if("string"!=typeof e.tag&&"function"==typeof e.state.onremove&&o.call(e.state.onremove,e),e.attrs&&"function"==typeof e.attrs.onremove&&o.call(e.attrs.onremove,e),"string"!=typeof e.tag)null!=e.instance&&_(e.instance);else{var t=e.children;if(Array.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];null!=r&&_(r)}}}function M(e,t,r,i,a){if("key"!==t&&"is"!==t&&null!=i&&!j(t)&&(r!==i||function(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===s()||"option"===e.tag&&e.dom.parentNode===n.activeElement}(e,t)||"object"==typeof i)){if("o"===t[0]&&"n"===t[1])return $(e,t,i);if("xlink:"===t.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),i);else if("style"===t)A(e.dom,r,i);else if(D(e,t,a)){if("value"===t){if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+i&&e.dom===s())return;if("select"===e.tag&&null!==r&&e.dom.value===""+i)return;if("option"===e.tag&&null!==r&&e.dom.value===""+i)return}"input"===e.tag&&"type"===t?e.dom.setAttribute(t,i):e.dom[t]=i}else"boolean"==typeof i?i?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute("className"===t?"class":t,i)}}function N(e,t,n,r){if("key"!==t&&"is"!==t&&null!=n&&!j(t))if("o"!==t[0]||"n"!==t[1]||j(t))if("style"===t)A(e.dom,n,null);else if(!D(e,t,r)||"className"===t||"value"===t&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===s())||"input"===e.tag&&"type"===t){var i=t.indexOf(":");-1!==i&&(t=t.slice(i+1)),!1!==n&&e.dom.removeAttribute("className"===t?"class":t)}else e.dom[t]=null;else $(e,t,void 0)}function j(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function D(e,t,n){return void 0===n&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==t&&"list"!==t&&"form"!==t&&"width"!==t&&"height"!==t)&&t in e.dom}var L,I=/[A-Z]/g;function q(e){return"-"+e.toLowerCase()}function R(e){return"-"===e[0]&&"-"===e[1]?e:"cssFloat"===e?"float":e.replace(I,q)}function A(e,t,n){if(t===n);else if(null==n)e.style.cssText="";else if("object"!=typeof n)e.style.cssText=n;else if(null==t||"object"!=typeof t)for(var r in e.style.cssText="",n){null!=(i=n[r])&&e.style.setProperty(R(r),String(i))}else{for(var r in n){var i;null!=(i=n[r])&&(i=String(i))!==String(t[r])&&e.style.setProperty(R(r),i)}for(var r in t)null!=t[r]&&null==n[r]&&e.style.removeProperty(R(r))}}function B(){this._=t}function $(e,t,n){if(null!=e.events){if(e.events[t]===n)return;null==n||"function"!=typeof n&&"object"!=typeof n?(null!=e.events[t]&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0):(null==e.events[t]&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}else null==n||"function"!=typeof n&&"object"!=typeof n||(e.events=new B,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}function F(e,t,n){"function"==typeof e.oninit&&o.call(e.oninit,t),"function"==typeof e.oncreate&&n.push(o.bind(e.oncreate,t))}function U(e,t,n){"function"==typeof e.onupdate&&n.push(o.bind(e.onupdate,t))}return B.prototype=Object.create(null),B.prototype.handleEvent=function(e){var t,n=this["on"+e.type];"function"==typeof n?t=n.call(e.currentTarget,e):"function"==typeof n.handleEvent&&n.handleEvent(e),this._&&!1!==e.redraw&&(0,this._)(),!1===t&&(e.preventDefault(),e.stopPropagation())},function(e,n,r){if(!e)throw new TypeError("DOM element being rendered to does not exist.");if(null!=L&&e.contains(L))throw new TypeError("Node is currently being rendered to and thus is locked.");var i=t,a=L,o=[],c=s(),l=e.namespaceURI;L=e,t="function"==typeof r?r:void 0;try{null==e.vnodes&&(e.textContent=""),n=Ln.normalizeChildren(Array.isArray(n)?n:[n]),m(e,e.vnodes,n,o,null,"http://www.w3.org/1999/xhtml"===l?void 0:l),e.vnodes=n,null!=c&&s()!==c&&"function"==typeof c.focus&&c.focus();for(var u=0;u<o.length;u++)o[u]()}finally{t=i,L=a}}}(window);function oi(e){if(!m(e))return!1;var t=N(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}const si=function(){let e=0;return()=>e++}(),ci=new ii;let li=0,ui="fwd",di="/";const hi=document.body;function pi(e,t){const n={view:()=>Ln(e,void 0,t)};function r(){ai(hi,Ln(n))}Wt.redraw.removeAll(),Wt.redraw.add(r);try{r()}catch(e){throw Wt.redraw.removeAll(),e}}function mi(e){e&&e.state&&(ui=e.state.id<li?"bwd":"fwd",li=e.state.id),di=yi();const t=window.location.search||"?=";ci.run(t.slice(2))||ci.run("/")}const fi={replaceState(e,t){try{const n=e?Object.assign({},window.history.state,e):window.history.state;void 0!==t?window.history.replaceState(n,"","?="+t):window.history.replaceState(n,"")}catch(e){}},pushState(e){const t=si();li=t,ui="fwd";try{window.history.pushState({id:t},"","?="+e)}catch(e){}}};function gi(e,t=!1){const n=(window.location.search||"?=/").substring(2).replace(/\?.+$/,"")+`?${cn(e)}`;t?wi(n,!0):fi.replaceState(void 0,n)}function vi(){const e=yi(),t=/\?.+$/.exec(e),n={};if(t&&t[0])for(const[e,r]of new URLSearchParams(t[0]))n[e]=r;return n}const bi=(()=>{const e=()=>{const t=e.stack.pop();oi(t)?(t("backbutton"),Xt()):/^\/$/.test(yi())?s.exitApp():/^\/game\/[a-zA-Z0-9]{12}/.test(yi())?Wt.gameBackButton.dispatch(event):ki()};return e.stack=[],e})();function wi(e,t=!1){setTimeout((()=>function(e,t=!1){bi.stack=[],di=yi(),t?fi.replaceState(void 0,e):fi.pushState(e),ci.run(e)||ci.run("/")}(e,t)),0)}function yi(){const e=window.location.search||"?=/";return decodeURIComponent(e.substring(2))}function ki(){window.history.go(-1)}window.backButton=bi;var Si={get:yi,set:wi,reload(){wi(yi(),!0)},setQueryParams:gi,getQueryParams:vi,deleteQueryParam:function(e,t=!1){const n=vi();n&&(delete n[e],gi(n,t))},History:fi,backHistory:ki,getViewSlideDirection:()=>ui,backbutton:bi,getPreviousPath:()=>di};const Ci=600,Ti=4,Pi=4,Ei="active";function Oi(e,t,n,r,i,a,o,s=!0){let c,l,u,d,h,p,m,f=e;if("function"!=typeof t)throw new Error("ButtonHandler 2nd argument must be a function!");if(n&&"function"!=typeof n)throw new Error("ButtonHandler 3rd argument must be a function!");if(r&&"function"!=typeof r)throw new Error("ButtonHandler 4rd argument must be a function!");function g(){r()&&Gt(g),Yt()}const v={passive:!0};e.addEventListener("touchstart",(function(t){const i=t.changedTouches[0];if(f=o?o(t):e,!f)return;if(!0===f.disabled)return;const a=f.getBoundingClientRect();c=i.clientX,l=i.clientY,u={minX:a.left,maxX:a.right,minY:a.top,maxY:a.bottom},d=!0,clearTimeout(m),f.classList.add(Ei),h=setTimeout((()=>function(e){n&&(n(e),d=!1,f&&f.classList.remove(Ei))}(t)),Ci),r&&(p=setTimeout((()=>{Gt(g)}),500))}),v),e.addEventListener("touchmove",(function(e){if(d&&f){const t=e.changedTouches[0];d=function(e){const t=e.clientX,n=e.clientY,r=u;let o=0,s=0;i&&(o=Math.abs(t-c));a&&(s=Math.abs(n-l));return t<r.maxX&&t>r.minX&&n<r.maxY&&n>r.minY&&o<Ti&&s<Pi}(t),d||(clearTimeout(h),clearTimeout(p),Kt(g),f.classList.remove(Ei))}}),v),e.addEventListener("touchend",(function(e){e.cancelable&&s&&e.preventDefault(),clearTimeout(p),Kt(g),d&&f&&(clearTimeout(h),m=setTimeout((()=>f&&f.classList.remove(Ei)),80),t(e),d=!1)}),!1),e.addEventListener("touchcancel",(function(){clearTimeout(h),clearTimeout(p),Kt(g),d=!1,f&&f.classList.remove(Ei)}),!1),e.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation()}),!1)}let xi,_i=null;const Mi=56;function Ni(e){return({dom:t})=>e(t)}function ji(e,t=250,n="0.5",r="1"){let i;function a(){clearTimeout(i),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",a,!1))}e.style.opacity=n,e.style.transition=`opacity ${t}ms ease-out`,setTimeout((()=>{e.style.opacity=r})),e.addEventListener("transitionend",a,!1),i=setTimeout(a,t+10)}function Di(e){let t;function n(){clearTimeout(t),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",n,!1))}const r="fwd"===Si.getViewSlideDirection()?"100%":"-100%";e.style.transform=`translate3d(${r},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",n,!1),t=setTimeout(n,270)}function Li(e,t){let n;function r(){clearTimeout(n),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",r,!1))}const i="left"===t?"100%":"-100%";e.style.transform=`translate3d(${i},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",r,!1),n=setTimeout(r,270)}function Ii(e,t){return e.closest(t)||e}function qi(){if(_i)return _i;const e=document.documentElement;return _i={vw:e.clientWidth,vh:e.clientHeight}}const Ri=Ni(Di),Ai=Ni(ji);function Bi(e){const t=e.dom;return t.style.transform="translateY(100%)",e.state.lol=t.offsetHeight,ni(t,"transform","translateY(0)",250,"ease-out").catch(console.log.bind(console))}function $i(e,t){return function(n){const r=document.getElementById(t);r&&ni(r,"transform","translateY(100%)",250,"ease-out").then((()=>an((()=>e(n))))).catch(console.log.bind(console))}}function Fi(e,t){return function(n){const r=document.getElementById(t);r&&ni(r,"transform","translateX(100%)",250,"ease-out").then((()=>an((()=>e(n))))).catch(console.log.bind(console))}}function Ui(e){const t=e.dom;return t.style.transform="translateX(100%)",e.state.lol=t.offsetHeight,ni(t,"transform","translateX(0)",250,"ease-out").catch(console.log.bind(console))}function zi(e,t,n,r=150){e.stopPropagation();const i=n?Ii(e.target,n):e.target;i?ni(i,"opacity",0,r).then((()=>an(t))).catch(console.log.bind(console)):(t(),Xt())}function Wi(e,t,n,r,i,a,o){return function(s){Oi(s.dom,(t=>{e(t),Xt()}),t?e=>an((()=>t(e))):void 0,n,r,i,a,o)}}function Hi(e){return t=>{t.dom.addEventListener("touchstart",e)}}function Vi(e,t,n,r){return Wi(e,t,n,!1,!1,r)}function Gi(e,t,n){return Wi(e,t,void 0,!0,!1,n)}function Ki(e,t,n,r=!0){return Wi(e,t,void 0,!1,!0,n,r)}function Yi(e,t,n,r=!0){return Wi(e,t,void 0,!0,!0,n,r)}function Xi(e){return 0===e?null:Fn("span",{className:"progress "+(e>0?"positive":"negative"),"data-icon":e>0?"N":"M"},String(Math.abs(e)))}function Qi(e){const t=[];for(const n in e)e[n]&&t.push(n);return t.join(" ")}function Ji(){const{vw:e,vh:t}=qi();return e>=768&&t>=768}function Zi(){return void 0!==xi||(xi=window.matchMedia("(orientation: portrait)").matches),xi}let ea=null;function ta(e){const t=/\d{1,3}/.exec(e),n=t&&t[0],r=Number(n);return isNaN(r)?0:r}function na(e,t){const{vh:n,vw:r}=e,i=function(){if(!ea){const e=getComputedStyle(document.documentElement);return ea={top:ta(e.getPropertyValue("--sat")),right:ta(e.getPropertyValue("--sar")),bottom:ta(e.getPropertyValue("--sab")),left:ta(e.getPropertyValue("--sal"))},ea}return ea}(),a=Ji();if(t){if(a){const e=.94*r;return{width:e,height:e}}return{width:r,height:r}}if(a){const e=n-Mi-.06*n-i.top;return{width:e,height:e}}{const e=n-Mi-i.top;return{width:e,height:e}}}function ra(e,t){const n=na(e,t);return e.vh-n.height-56-45-110>=25}function ia(e){e.dom.focus()}function aa(e){return void 0===e.ratingDiff?null:0===e.ratingDiff?Fn("span.rp.null"," +0"):e.ratingDiff>0?Fn("span.rp.up"," +"+e.ratingDiff):e.ratingDiff<0?Fn("span.rp.down"," "+e.ratingDiff):null}function oa(e){const t=e.target;return"BUTTON"===t.tagName?t:t.closest("button")}function sa(e){const t=e.target;return"LI"===t.tagName?t:t.closest("li")}function ca(e){const t=e.target;return"TR"===t.tagName?t:t.closest("tr")}function la(e,t){var n;return null===(n=e.target)||void 0===n?void 0:n.closest(t)}function ua(e){return t=>{var n;return null===(n=t.target)||void 0===n?void 0:n.closest(e)}}const da=r("KeepAwake",{web:()=>import("./web-b115ccdd.js").then((e=>new e.KeepAwakeWeb))}),ha=9e5,pa=27e5;let ma,fa;function ga(){da.keepAwake(),void 0!==fa&&fa(),fa=function(e,t,n){const r=["touchstart"];let i,a=!1,o=!0,s=performance.now();const c=()=>{o||n(),o=!0,s=performance.now(),u()},l=()=>{a||(r.forEach((e=>{document.addEventListener(e,c)})),a=!0)},u=()=>{a&&(r.forEach((e=>{document.removeEventListener(e,c)})),a=!1)},d=()=>{clearInterval(i),u()};return i=setInterval((()=>{o&&performance.now()-s>e&&(t(),o=!1),l()}),3e4),d}(ha,(()=>{ma=setTimeout((()=>{da.allowSleep()}),pa)}),(()=>{clearTimeout(ma)}))}function va(){void 0!==fa&&(fa(),fa=void 0),da.allowSleep()}function ba(e,t,n){void 0!==n?e.postMessage({topic:t,payload:n}):e.postMessage({topic:t})}function wa(e,t){return new Promise(((n,r)=>{e.addEventListener("message",(function i(a){a.data.topic!==t.topic||void 0!==t.reqid&&a.data.reqid!==t.reqid?"error"!==a.data.topic||a.data.payload.callerTopic!==t.topic||void 0!==t.reqid&&a.data.reqid!==t.reqid||(e.removeEventListener("message",i),r(a.data.payload.error)):(e.removeEventListener("message",i),n(a.data.payload))})),e.postMessage(t)}))}const ya="seekLobby",ka=new Worker("socketWorker.js");let Sa,Ca=!1,Ta=0,Pa=2e3;const Ea={following_onlines:function(e,t){const n=t.playing,r=t.patrons;er.reset(e,n,r),Xt()},following_enters:(e,t)=>an((()=>er.set(e,t.playing||!1,t.patron||!1))),following_leaves:e=>an((()=>er.remove(e))),following_playing:e=>an((()=>er.playing(e))),following_stopped_playing:e=>an((()=>er.stoppedPlaying(e))),challenges:e=>{Ir.set(e),Xt()},mlat:e=>{Ta=e},deployPost(){ba(ka,"deploy")},resync(){Si.reload()},announce:e=>{const t=e;t.date?$r.set(t):$r.set(void 0)}};function Oa(e,t){const n=jn.get(Gn);null!==n?e.opts.params?e.opts.params[Gn]=n:e.opts.params={[Gn]:n}:e.opts.params&&delete e.opts.params.sessionId,e.opts.options.isAuth=!!n,ka.onmessage=e=>{switch(e.data.topic){case"onOpen":t.onOpen&&t.onOpen();break;case"disconnected":Ca&&(Ca=!1,Xt());break;case"connected":Ca||(Ca=!0,Xt());break;case"onError":t.onError&&t.onError();break;case"resync":Si.reload();break;case"handle":{const n=t.events[e.data.payload.t];n&&n(e.data.payload.d,e.data.payload);break}case"pingInterval":Pa=e.data.payload}},Sa={setup:e,handlers:t},ba(ka,"create",e)}function xa(e){return{send:(t,n,r)=>function(e,t,n,r){ba(ka,"send",[e,t,n,r])}(e,t,n,r),ask:(t,n,r,i)=>function(e,t,n,r,i){return new Promise(((a,o)=>{let s;function c(e){"handle"===e.data.topic&&e.data.payload.t===n&&(clearTimeout(s),ka.removeEventListener("message",c),a(e.data.payload.d))}ka.addEventListener("message",c),ba(ka,"ask",{msg:[e,t,r,i],listenTo:n}),s=setTimeout((()=>{ka.removeEventListener("message",c),o()}),3e3)}))}(e,t,n,r,i)}}function _a(){Sa?Oa(Sa.setup,Sa.handlers):ba(ka,"connect")}Wt.afterLogout.add(_a);var Ma={createGame:function(e,t,n,r,i){let a=!1;const o={onError:function(){a||(a=!0,Tr(r.substring(1)).catch((e=>{401===e.status&&(z.show({text:"Access is unauthorised.",position:"center",duration:"short"}),Si.set("/"))})))},onOpen:Zr.backgroundRefresh,events:Object.assign({},Ea,n)},s={options:{name:"game",debug:"dev"===$t.mode,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(o.events)}};return i&&(s.params={userTv:i}),Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:e,version:t,opts:s},o),xa(e)},createChallenge:function(e,t,n,r){const i={onOpen:()=>{Zr.backgroundRefresh(),n()},events:Object.assign({},Ea,r)},a=`/challenge/${e}/socket/v${$t.apiVersion}`,o={options:{name:"challenge",debug:"dev"===$t.mode,ignoreUnknownMessages:!0,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(i.events)}};return Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:a,version:t,opts:o},i),xa(a)},createLobby:function(e,t,n){const r={onOpen:()=>{Zr.refresh(),t()},events:Object.assign({},Ea,n)},i={options:{name:e,debug:"dev"===$t.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(r.events)}},a=`/lobby/socket/v${$t.apiVersion}`;return Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:a,opts:i},r),xa(a)},createTournament:function(e,t,n,r){const i="/tournament/"+e+`/socket/v${$t.apiVersion}`,a={events:Object.assign({},Ea,n),onOpen:Zr.backgroundRefresh},o={options:{name:"tournament",debug:"dev"===$t.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"},{t:"startWatching",d:r}],registeredEvents:Object.keys(a.events)}};return Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:i,version:t,opts:o},a),xa(i)},createDefault:function(){if(on()){const e={events:Ea,onOpen:Zr.backgroundRefresh},t={options:{name:"default",debug:"dev"===$t.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(e.events)}};Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:`/socket/v${$t.apiVersion}`,opts:t},e)}},createAnalysis:function(e){const t={events:Object.assign(Object.assign({},Ea),e),onOpen:Zr.backgroundRefresh},n={options:{name:"analysis",debug:"dev"===$t.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(t.events)}},r=`/analysis/socket/v${$t.apiVersion}`;return Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:r,opts:n},t),xa(r)},createStudy:function(e,t){const n={events:Object.assign(Object.assign({},Ea),t),onOpen:Zr.backgroundRefresh},r={options:{name:"study",debug:"dev"===$t.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(n.events)}},i=`/study/${e}/socket/v${$t.apiVersion}`;return Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:i,opts:r},n),xa(i)},createChat:function(e,t){const n={events:Object.assign(Object.assign({},Ea),e),onOpen:()=>{Zr.backgroundRefresh(),t&&t()}},r={options:{name:"chat",debug:"dev"===$t.mode,pingDelay:2500,registeredEvents:Object.keys(n.events)}},i=`/socket/v${$t.apiVersion}`;return Oa({clientId:en(),socketEndPoint:$t.socketEndPoint,url:i,opts:r},n),xa(i)},redirectToGame:function(e){let t;if("string"==typeof e)t=e;else if(t=e.url,e.cookie){const t=document.domain.replace(/^.+(\.[^.]+\.[^.]+)$/,"$1"),n=[encodeURIComponent(e.cookie.name)+"="+e.cookie.value,"; max-age="+e.cookie.maxAge,"; path=/","; domain="+t].join("");document.cookie=n}Si.set("/game"+t)},sendWithNoCheck(e,t,n){["moveLat"].includes(e)&&ba(ka,"send",["noCheck",e,t,n])},setVersion(e){ba(ka,"setVersion",e)},connect(){ba(ka,"connect")},reconnectCurrent:_a,disconnect(){ba(ka,"disconnect")},delayedDisconnect(e){ba(ka,"delayedDisconnect",e)},cancelDelayedDisconnect(){ba(ka,"cancelDelayedDisconnect")},isConnected:()=>Ca,destroy(){ba(ka,"destroy")},getVersion:()=>wa(ka,{topic:"getVersion"}),getCurrentPing:()=>wa(ka,{topic:"averageLag"}),getCurrentMoveLatency:()=>Ta,getCurrentPingInterval:()=>Pa,terminate(){ka&&ka.terminate()}};function Na(e){return void 0!==e.id}function ja(e){return void 0!==e.timeMode}function Da(e){return void 0!==e.steps}async function La(e){return Fa(await Xn(`/inbox/${e}`))}async function Ia(e,t){return Fa(await Xn(`/inbox/${e}?before=${t.getTime()}`))}async function qa(){return Fa(await Xn("/inbox"))}async function Ra(e){const t=await Xn(`/inbox/search?q=${e}`);return Object.assign(Object.assign({},t),{contacts:t.contacts.map(Wa)})}function Aa(e){return Xn(`/rel/block/${e}`,{method:"POST"})}function Ba(e){return Xn(`/rel/unblock/${e}`,{method:"POST"})}async function $a(e){return Xn(`/inbox/${e}/delete`,{method:"POST"}).then(Fa)}class MessageSocket{constructor(e){const t=function(e){return{msgNew:t=>{e.receive(Object.assign(Object.assign({},Ua(t)),{read:!1}))},msgType:e.receiveTyping,blockedBy:e.changeBlockBy,unblockedBy:e.changeBlockBy}}(e);this.socket=Ma.createChat(t)}post(e,t){this.socket.send("msgSend",{dest:e,text:t})}setRead(e){this.socket.send("msgRead",e)}typing(e){this.socket.send("msgType",e)}}function Fa(e){return Object.assign(Object.assign({},e),{convo:e.convo&&(t=e.convo,Object.assign(Object.assign({},t),{user:za(t.user),msgs:t.msgs.map(Ua)})),contacts:e.contacts.map(Wa)});var t}function Ua(e){return Object.assign(Object.assign({},e),{date:new Date(e.date)})}function za(e){return Object.assign(Object.assign({},e),{id:e.name.toLowerCase()})}function Wa(e){return Object.assign(Object.assign({},e),{user:za(e.user),lastMsg:Ua(e.lastMsg)})}const Ha=.6,Va=25,Ga=.7;function Ka(){const e=qi().vw;return e*(e>=960?.35:e>=500?.5:.85)}function Ya(e,t){e.style.transform=`translate3d(${t}px, 0, 0)`}function Xa(e,t){e.style.opacity=`${t}`}class SideMenuCtrl{constructor(e,t,n,r,i){this.isOpen=!1,this.open=()=>{this.isOpen=!0,Si.backbutton.stack.push(this.close);const e=document.getElementById(this.menuID),t=document.getElementById(this.backdropID);return this.onOpen&&this.onOpen(),Promise.all([ni(t,"visibility","visible",0),ni(t,"opacity",.7,250,"linear"),ni(e,"visibility","visible",0),ni(e,"transform","translate3d(0,0,0)",250,"ease-out")]).then(Xt).catch(console.error.bind(console))},this.close=e=>{"backbutton"!==e&&this.isOpen&&Si.backbutton.stack.pop(),this.isOpen=!1;const t=document.getElementById(this.menuID),n=document.getElementById(this.backdropID);return this.onClose&&this.onClose(),Promise.all([ni(n,"opacity",0,250,"linear"),ni(t,"transform",this.closeTranslate(),250,"ease-out")]).then((()=>Promise.all([ni(t,"visibility","hidden",0),ni(n,"visibility","hidden",0)]))).catch(console.error.bind(console))},this.toggle=e=>{e.stopPropagation(),this.isOpen?this.close():this.open()},this.closeTranslate=()=>"left"===this.side?"translate3d(-100%,0,0)":"translate3d(100%,0,0)",this.side=e,this.menuID=t,this.backdropID=n,this.onOpen=r,this.onClose=i}getMenuEl(){return document.getElementById(this.menuID)}getBackdropEl(){return document.getElementById(this.backdropID)}}let Qa;const Ja=En(0),Za=En(!1),eo=En(0),to=En(0);const no=new SideMenuCtrl("left","side_menu","menu-close-overlay",(function(){on()&&Ma.sendWithNoCheck("moveLat",!0),Qa=setTimeout(oo,2e3)}),(function(){Za(!1),clearTimeout(Qa),on()&&Ma.sendWithNoCheck("moveLat",!1)}));function ro(e){return function(){return no.close().then((()=>Si.set(e)))}}function io(e){return function(){return no.close().then((()=>{e(),Xt()}))}}function ao(){const e=!Za();e&&Xn("/inbox/unread-count",{},!1).then((e=>{Ja(e),Xt()})),Za(e)}function oo(){on()&&Ma.getCurrentPing().then((e=>{to(e),eo(Ma.getCurrentMoveLatency()),no.isOpen&&(Xt(),setTimeout(oo,2e3))}))}const so=Vi((e=>{e.stopPropagation(),no.close()})),co=Symbol("newer"),lo=Symbol("older");class LRUMap{constructor(e,t){"number"!=typeof e&&(t=e,e=0),this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[co]&&(e===this.oldest&&(this.oldest=e[co]),e[co][lo]=e[lo]),e[lo]&&(e[lo][co]=e[co]),e[co]=void 0,e[lo]=this.newest,this.newest&&(this.newest[co]=e),this.newest=e)}assign(e){let t,n=this.limit||Number.MAX_VALUE;this._keymap.clear();let r=e[Symbol.iterator]();for(let e=r.next();!e.done;e=r.next()){let r=new uo(e.value[0],e.value[1]);if(this._keymap.set(r.key,r),t?(t[co]=r,r[lo]=t):this.oldest=r,t=r,0==n--)throw new Error("overflow")}this.newest=t,this.size=this._keymap.size}get(e){var t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}set(e,t){var n=this._keymap.get(e);return n?(n.value=t,this._markEntryAsUsed(n),this):(this._keymap.set(e,n=new uo(e,t)),this.newest?(this.newest[co]=n,n[lo]=this.newest):this.oldest=n,this.newest=n,++this.size,this.size>this.limit&&this.shift(),this)}shift(){var e=this.oldest;if(e)return this.oldest[co]?(this.oldest=this.oldest[co],this.oldest[lo]=void 0):(this.oldest=void 0,this.newest=void 0),e[co]=e[lo]=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]}toJSON(){for(var e=new Array(this.size),t=0,n=this.oldest;n;)e[t++]=[n.key,n.value],n=n[co];return e}}function uo(e,t){this.key=e,this.value=t,this[co]=void 0,this[lo]=void 0}const ho=new LRUMap(100);function po(e,t){return e?(e.title?e.title+" "+e.name:e.name)+(t?" ("+e.rating+")":""):"Anonymous"}function mo(e,t=!1,n=!1,r){if(e.name||e.username||e.user){let o=e.name||e.username||e.user.username;return e.user&&e.user.title&&(o=e.user.title+" "+o),n&&(a=r||100,o=(i=o).length>a?i.slice(0,a)+"…":i),t&&(e.user||e.rating)&&(o+=" ("+(e.rating||e.user.rating),e.provisional&&(o+="?"),o+=")"),o}var i,a;return e.ai?fo(e):"Anonymous"}function fo(e){return kt("aiNameLevelAiLevel","Stockfish",e.ai)}const go="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",vo={standard:{name:"Standard",tinyName:"Std",id:1,link:"https://en.wikipedia.org/wiki/Rules_of_chess",title:"Standard rules of chess (FIDE)"},chess960:{name:"Chess960",tinyName:"960",id:2,link:"https://lichess.org/variant/chess960",alert:"This is a Chess960 game!\n\nThe starting position of the pieces on the players' home ranks is randomized.",title:"Starting position of the home rank pieces is randomized."},fromPosition:{name:"From position",shortName:"Fen",tinyName:"Fen",id:3,title:"Custom starting position"},kingOfTheHill:{name:"King of the Hill",shortName:"KotH",tinyName:"KotH",id:4,link:"https://lichess.org/variant/kingOfTheHill",alert:"This is a King of the Hill game!\n\nThe game can be won by bringing the king to the center.",title:"Bring your King to the center to win the game."},threeCheck:{name:"Three-check",shortName:"3-check",tinyName:"3+",id:5,link:"https://lichess.org/variant/threeCheck",alert:"This is a Three-check game!\n\nThe game can be won by checking the opponent 3 times.",title:"Check your opponent 3 times to win the game.",initialFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1 +0+0"},antichess:{name:"Antichess",tinyName:"Anti",id:6,link:"https://lichess.org/variant/antichess",alert:"This is an antichess chess game!\n\n If you can take a piece, you must. The game can be won by losing all your pieces.",title:"Lose all your pieces (or reach a stalemate) to win the game."},atomic:{name:"Atomic",tinyName:"Atom",id:7,link:"https://lichess.org/variant/atomic",alert:"This is an atomic chess game!\n\nCapturing a piece causes an explosion, taking out your piece and surrounding non-pawns. Win by mating or exploding your opponent's king.",title:"Nuke your opponent's king to win."},horde:{name:"Horde",tinyName:"Horde",id:8,link:"https://lichess.org/variant/horde",alert:"This is a horde chess game!\n\nBlack must take all white pawns to win. White must checkmate black king.",title:"Destroy the horde to win!",initialFen:"rnbqkbnr/pppppppp/8/1PP2PP1/PPPPPPPP/PPPPPPPP/PPPPPPPP/PPPPPPPP w kq - 0 1"},racingKings:{name:"Racing Kings",shortName:"Racing",tinyName:"Racing",id:9,link:"https://lichess.org/variant/racingKings",alert:"Race to the eighth rank to win.",title:"Race your King to the eighth rank to win.",initialFen:"8/8/8/8/8/8/krbnNBRK/qrbnNBRQ w - - 0 1"},crazyhouse:{name:"Crazyhouse",tinyName:"Crazy",id:10,link:"https://lichess.org/variant/crazyhouse",alert:"This is a crazyhouse game!\n\nEvery time a piece is captured the capturing player gets a piece of the same type and of their color in their pocket.",title:"Captured pieces can be dropped back on the board instead of moving a piece.",initialFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR/ w KQkq - 0 1"}};function bo(e){return vo[e]}function wo(e){const t=vo[e];return{key:e,name:t.name,short:t.shortName||t.tinyName||t.name,title:t.title}}function yo(e){return vo[e].initialFen||go}function ko(e){switch(e){case"fromPosition":case"standard":case"chess960":return"chess";case"threeCheck":return"3check";default:return e.toLowerCase()}}const So=new Set(["crazyhouse","threeCheck"]),Co=new Set(["standard","crazyhouse","threeCheck","kingOfTheHill"]);class Siema{constructor(e){if(this.config=Siema.mergeSettings(e),this.selector="string"==typeof this.config.selector?document.querySelector(this.config.selector):this.config.selector,null===this.selector)throw new Error("Something wrong with your selector ??");this.resolveSlidesNumber(),this.selectorWidth=this.selector.offsetWidth,this.innerElements=[].slice.call(this.selector.children),this.currentSlide=Math.max(0,Math.min(this.config.startIndex,this.innerElements.length-this.perPage)),this.transformProperty="transform",["resizeHandler","touchstartHandler","touchendHandler","touchmoveHandler"].forEach((e=>{this[e]=this[e].bind(this)})),this.init()}static mergeSettings(e){const t={selector:".siema",duration:200,easing:"ease-out",perPage:1,startIndex:0,draggable:!0,threshold:20,rtl:!1,onInit:()=>{},onChange:()=>{}},n=e;for(const e in n)t[e]=n[e];return t}attachEvents(){if(window.addEventListener("resize",this.resizeHandler),this.config.draggable){this.pointerDown=!1,this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:!1};const e={passive:!0};this.selector.addEventListener("touchstart",this.touchstartHandler,e),this.selector.addEventListener("touchend",this.touchendHandler,e),this.selector.addEventListener("touchmove",this.touchmoveHandler,e)}}detachEvents(){window.removeEventListener("resize",this.resizeHandler),this.selector.removeEventListener("touchstart",this.touchstartHandler),this.selector.removeEventListener("touchend",this.touchendHandler),this.selector.removeEventListener("touchmove",this.touchmoveHandler)}init(){this.attachEvents(),this.selector.style.overflow="hidden",this.selector.style.direction=this.config.rtl?"rtl":"ltr",this.buildSliderFrame(),this.config.onInit.call(this)}buildSliderFrame(){const e=this.selectorWidth/this.perPage,t=this.innerElements.length;this.sliderFrame=document.createElement("div"),this.sliderFrame.style.width=e*t+"px";const n=document.createDocumentFragment();for(let e=0;e<this.innerElements.length;e++){const t=this.buildSliderFrameItem(this.innerElements[e]);n.appendChild(t)}this.sliderFrame.appendChild(n),this.selector.innerHTML="",this.selector.appendChild(this.sliderFrame),this.slideToCurrent()}buildSliderFrameItem(e){const t=document.createElement("div");return t.style.cssFloat=this.config.rtl?"right":"left",t.style.float=this.config.rtl?"right":"left",t.style.width=100/this.innerElements.length+"%",t.appendChild(e),t}resolveSlidesNumber(){if("number"==typeof this.config.perPage)this.perPage=this.config.perPage;else if("object"==typeof this.config.perPage){this.perPage=1;for(const e in this.config.perPage)window.innerWidth>=e&&(this.perPage=this.config.perPage[e])}}prev(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.max(this.currentSlide-e,0),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}next(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(this.currentSlide+e,this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}goTo(e){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(Math.max(e,0),this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}slideToCurrent(){const e=this.currentSlide,t=(this.config.rtl?1:-1)*e*(this.selectorWidth/this.perPage);ni(this.sliderFrame,"transform",`translate3d(${t}px, 0, 0)`,this.config.duration,this.config.easing)}updateAfterDrag(){const e=(this.config.rtl?-1:1)*(this.drag.endX-this.drag.startX),t=Math.abs(e);e>0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide-1>=0?this.prev(1):e<0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide+1<=this.innerElements.length-this.perPage?this.next(1):this.slideToCurrent()}resizeHandler(){this.resolveSlidesNumber(),this.currentSlide+this.perPage>this.innerElements.length&&(this.currentSlide=this.innerElements.length<=this.perPage?0:this.innerElements.length-this.perPage),this.selectorWidth=this.selector.offsetWidth,this.buildSliderFrame()}clearDrag(){this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:this.drag.preventClick}}touchstartHandler(e){-1!==["TEXTAREA","OPTION","INPUT","SELECT"].indexOf(e.target.nodeName)||(e.stopPropagation(),this.pointerDown=!0,this.drag.startX=e.touches[0].pageX,this.drag.startY=e.touches[0].pageY)}touchendHandler(e){e.stopPropagation(),this.pointerDown=!1,this.drag.endX&&this.updateAfterDrag(),this.clearDrag()}touchmoveHandler(e){if(e.stopPropagation(),null===this.drag.letItGo&&(this.drag.letItGo=Math.abs(this.drag.startY-e.touches[0].pageY)<Math.abs(this.drag.startX-e.touches[0].pageX)),this.pointerDown&&this.drag.letItGo){this.drag.endX=e.touches[0].pageX;const t=this.currentSlide*(this.selectorWidth/this.perPage),n=this.drag.endX-this.drag.startX,r=this.config.rtl?t+n:t-n;this.sliderFrame.style[this.transformProperty]=`translate3d(${(this.config.rtl?1:-1)*r}px, 0, 0)`}}remove(e,t){if(e<0||e>=this.innerElements.length)throw new Error("Item to remove doesn't exist ??");const n=e<this.currentSlide,r=this.currentSlide+this.perPage-1===e;(n||r)&&this.currentSlide--,this.innerElements.splice(e,1),this.buildSliderFrame(),t&&t.call(this)}insert(e,t,n){if(t<0||t>this.innerElements.length+1)throw new Error("Unable to inset it at this index ??");if(-1!==this.innerElements.indexOf(e))throw new Error("The same item in a carousel? Really? Nope ??");const r=t<=this.currentSlide>0&&this.innerElements.length;this.currentSlide=r?this.currentSlide+1:this.currentSlide,this.innerElements.splice(t,0,e),this.buildSliderFrame(),n&&n.call(this)}prepend(e,t){this.insert(e,0),t&&t.call(this)}append(e,t){this.insert(e,this.innerElements.length+1),t&&t.call(this)}destroy(e=!1,t){if(this.detachEvents(),this.selector.style.cursor="auto",e){const e=document.createDocumentFragment();for(let t=0;t<this.innerElements.length;t++)e.appendChild(this.innerElements[t]);this.selector.innerHTML="",this.selector.appendChild(e),this.selector.removeAttribute("style")}t&&t.call(this)}}function To(e,...t){e&&setTimeout((()=>e(...t)),1)}function Po(){}const Eo=["a","b","c","d","e","f","g","h"],Oo=Eo.slice().reverse(),xo=[1,2,3,4,5,6,7,8],_o=[8,7,6,5,4,3,2,1];function Mo(e,t){return Math.round(e*t)/t}function No(e){return Eo[e[0]-1]+e[1]}function jo(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]}function Do(e,t,n){return[(t?e[0]-1:8-e[0])*n.width/8,(t?8-e[1]:e[1]-1)*n.height/8]}(()=>{const e=[];_o.forEach((t=>{xo.forEach((n=>{e.push([n,t])}))}))})();const Lo=Array.prototype.concat(...Eo.map((e=>xo.map((t=>e+t)))));function Io(e){return"white"===e?"black":"white"}function qo(e,t){return void 0!==e&&-1!==e.indexOf(t)}function Ro(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Ao(e,t,n){if(e.otb){const r=e.orientation,i=e.otbMode,a=e.turnColor;return"facing"===i&&"white"===r&&"black"===t||"facing"===i&&"black"===r&&"white"===t||"flip"===i&&"white"===r&&"black"===a||"flip"===i&&"black"===r&&"white"===a?n+" rotate(180deg)":n}return n}function Bo(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function $o(e){return"translate3d("+e[0]+"px,"+e[1]+"px, 0)"}Lo.slice(0).reverse();const Fo=Bo([-99999,-99999]),Uo=$o([-99999,-99999]);function zo(e){const t=e.targetTouches[0];return[t.clientX,t.clientY]}function Wo(e,t,n){const r=jo(n);return"white"!==e&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function Ho(e,t){let n=e.board.firstChild;for(;n;){if("PIECE"===n.tagName&&n.cgKey===t)return n;n=n.nextSibling}return null}function Vo(e,t){return Math.abs(e-t)}const Go=(e,t,n,r)=>{const i=Vo(e,n),a=Vo(t,r);return 1===i&&2===a||2===i&&1===a},Ko=(e,t,n,r)=>Vo(e,n)===Vo(t,r),Yo=(e,t,n,r)=>e===n||t===r,Xo=(e,t,n,r)=>Ko(e,t,n,r)||Yo(e,t,n,r);function Qo(e,t,n){const r=e.get(t);if(!r)return[];const i=jo(t);let a;switch(r.role){case"pawn":o=r.color,a=(e,t,n,r)=>Vo(e,n)<2&&("white"===o?r===t+1||t<=2&&r===t+2&&e===n:r===t-1||t>=7&&r===t-2&&e===n);break;case"knight":a=Go;break;case"bishop":a=Ko;break;case"rook":a=Yo;break;case"queen":a=Xo;break;case"king":a=function(e,t,n){return(r,i,a,o)=>Vo(r,a)<2&&Vo(i,o)<2||n&&i===o&&i===("white"===e?1:8)&&(5===r&&(3===a||7===a)||qo(t,a))}(r.color,function(e,t){const n=[];for(const[r,i]of e)i&&i.color===t&&"rook"===i.role&&n.push(jo(r)[0]);return n}(e,r.color),n)}var o;return Lo.map(jo).filter((e=>(i[0]!==e[0]||i[1]!==e[1])&&a(i[0],i[1],e[0],e[1]))).map(No)}function Jo(e){e.orientation=Io(e.orientation)}function Zo(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function es(e,t){if(e.check=null,!0===t&&(t=e.turnColor),t)for(const[n,r]of e.pieces)"king"===r.role&&r.color===t&&(e.check=n)}function ts(e){e.premovable.current&&(e.premovable.current=null,To(e.premovable.events.unset))}function ns(e){e.predroppable.current&&(e.predroppable.current=null,To(e.predroppable.events.unset))}function rs(e,t,n,r){if(ls(e,t,n)){if(fs(e,t,n))return os(e,null),To(e.movable.events.after,t,n,{premove:!1,promote:r}),!0}else!function(e,t,n){return t!==n&&us(e,t)&&qo(Qo(e.pieces,t,e.premovable.castle),n)}(e,t,n)?cs(e,n)||us(e,n)?os(e,n):ss(e):(!function(e,t,n){ns(e),e.premovable.current=[t,n],To(e.premovable.events.set,t,n)}(e,t,n),os(e,null));return!1}function is(e,t,n,r=!1){const i=e.pieces.get(t);i&&(function(e,t,n){const r=e.pieces.get(t);return!!r&&n&&(t===n||!e.pieces.has(n))&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}(e,t,n)||r)?(e.pieces.delete(t),ms(e,i,n,r),To(e.movable.events.afterNewPiece,i.role,n,{predrop:!1})):i&&function(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&n&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}(e,t,n)?function(e,t,n){ts(e),e.predroppable.current={role:t,key:n},To(e.predroppable.events.set,t,n)}(e,i.role,n):(ts(e),ns(e)),e.pieces.delete(t),os(e,null)}function as(e,t){e.selected?e.selected!==t||e.draggable.enabled?e.selectable.enabled&&e.selected!==t&&rs(e,e.selected,t):ss(e):(cs(e,t)||us(e,t))&&os(e,t),To(e.events.select,t)}function os(e,t){e.selected=t,t&&us(e,t)?e.premovable.dests=Qo(e.pieces,t,e.premovable.castle):e.premovable.dests=null}function ss(e){e.selected=null,e.premovable.dests=null}function cs(e,t){const n=e.pieces.get(t);return!!n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function ls(e,t,n){return t!==n&&cs(e,t)&&(e.movable.free||null!==e.movable.dests&&qo(e.movable.dests[t],n))}function us(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function ds(e){const t=e.premovable.current;if(!t)return;const n=t[0],r=t[1];ls(e,n,r)&&fs(e,n,r)&&To(e.movable.events.after,n,r,{premove:!0}),ts(e)}function hs(e){ts(e),ns(e),os(e,null)}function ps(e,t,n){const r=e.pieces.get(t);if(t===n||!r)return!1;const i=e.pieces.get(n),a=i&&i.color!==r.color?i:void 0;return To(e.events.move,t,n,a),function(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;const i=jo(t),a=jo(n);if(1!==i[1]&&8!==i[1]||i[1]!==a[1])return!1;5!==i[0]||e.pieces.has(n)||(7===a[0]?n=No([8,a[1]]):3===a[0]&&(n=No([1,a[1]])));const o=e.pieces.get(n);if(!o||o.color!==r.color||"rook"!==o.role)return!1;e.pieces.delete(t),e.pieces.delete(n),i[0]<a[0]?(e.pieces.set(No([7,a[1]]),r),e.pieces.set(No([6,a[1]]),o)):(e.pieces.set(No([3,a[1]]),r),e.pieces.set(No([4,a[1]]),o));return!0}(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=null,To(e.events.change),!0}function ms(e,t,n,r=!1){if(e.pieces.has(n)){if(!r)return!1;e.pieces.delete(n)}return To(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n,n],e.check=null,To(e.events.change),e.movable.dests={},e.turnColor=Io(e.turnColor),!0}function fs(e,t,n){const r=ps(e,t,n);return r&&(e.movable.dests=null,e.turnColor=Io(e.turnColor),e.animation.current=null),r}function gs(){return{variant:"standard",pieces:new Map,orientation:"white",turnColor:"white",check:null,lastMove:null,lastPromotion:null,selected:null,coordinates:!0,symmetricCoordinates:!1,otb:!1,otbMode:"facing",shift:null,shiftView:null,autoCastle:!0,viewOnly:!1,fixed:!1,edit:!1,exploding:null,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200,current:null},movable:{free:!0,color:"both",dests:null,dropped:null,showDests:!0,rookCastle:!0,events:{}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:null,current:null,events:{}},predroppable:{enabled:!1,current:null,events:{}},draggable:{enabled:!0,distance:3,magnified:!0,centerPiece:!1,preventDefault:!0,showGhost:!0,deleteOnDropOff:!1,current:null},selectable:{enabled:!0},events:{},prev:{orientation:null,bounds:null,turnColor:null,otbMode:null},peripheral:{isMoveRejected:!1,lastMove:null,lastPromotion:null,isVariantSupported:!1,isSynchronized:!0,isGettable:!1,isSettable:!1,pieces:new Map}}}const vs={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king",m:"unsupport",d:"unsupport",P:"pawn",R:"rook",N:"knight",B:"bishop",Q:"queen",K:"king",M:"unsupport",D:"unsupport"},bs={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k",unsupport:"p"};var ws={convertFenToPeripheralPieces:function(e){const t=new Map;let n=8,r=0;for(let i=0;i<e.length;i++){const a=e[i];switch(a){case" ":return t;case"/":if(--n,0===n)return t;r=0;break;default:{const e=~~a;if(e)r+=e;else{++r;const e=a.toLowerCase();t.set(No([r,n]),{role:"u?".includes(e)?void 0:vs[e],color:"?"===e?void 0:a===e?"black":"white"})}}}}return t},convertFenToPieces:function(e){"start"===e&&(e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR");const t=new Map;let n=8,r=0;for(let i=0;i<e.length;i++){const a=e[i];switch(a){case" ":return t;case"/":if(--n,0===n)return t;r=0;break;case"~":{const e=No([r,n]),i=t.get(e);i&&(i.promoted=!0,t.set(e,i));break}default:{const e=~~a;if(e)r+=e;else{++r;const e=a.toLowerCase();t.set(No([r,n]),{role:vs[e],color:a===e?"black":"white"})}}}}return t},convertPeripheralPiecesToFen:function(e){return[8,7,6,5,4,3,2].reduce((function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),String(t))}),_o.map((t=>xo.map((n=>{const r=e.get(No([n,t]));if(r){if(r.role){const e=bs[r.role];return"white"===r.color?e.toUpperCase():e}return r.color?"white"===r.color?"U":"u":"?"}return"1"})).join(""))).join("/"))},convertPiecesToFen:function(e){return[8,7,6,5,4,3,2].reduce((function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),String(t))}),_o.map((t=>xo.map((n=>{const r=e.get(No([n,t]));if(r){const e=bs[r.role];return"white"===r.color?e.toUpperCase():e}return"1"})).join(""))).join("/"))}};function ys(e,t){t&&(t.movable&&t.movable.dests&&(e.movable.dests=null),Cs(e,t),t.variant&&(e.variant=t.variant),t.fen&&(e.pieces=ws.convertFenToPieces(t.fen)),Object.prototype.hasOwnProperty.call(t,"check")&&es(e,t.check||!1),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove&&(e.lastMove=null),e.selected&&os(e,e.selected),t.edit&&(e.edit=t.edit),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),Ss(e))}function ks(e,t){t&&(t.variant&&(e.variant=t.variant),t.fen&&(e.pieces=ws.convertFenToPieces(t.fen)),void 0!==t.orientation&&(e.orientation=t.orientation),void 0!==t.turnColor&&(e.turnColor=t.turnColor),void 0!==t.otb&&(e.otb=t.otb),void 0!==t.shift&&(e.shift=t.shift),void 0!==t.shiftView&&(e.shiftView=t.shiftView),void 0!==t.dests&&(e.movable.dests=t.dests),void 0!==t.movableColor&&(e.movable.color=t.movableColor),Object.prototype.hasOwnProperty.call(t,"check")&&es(e,t.check||!1),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove?e.lastMove=null:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&os(e,e.selected),Ss(e))}function Ss(e){if(!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?1:8,n="e"+t,r=e.movable.dests[n],i=e.pieces.get(n);if(!r||!i||"king"!==i.role)return;e.movable.dests[n]=r.filter((e=>!(e==="a"+t&&-1!==r.indexOf("c"+t)||e==="h"+t&&-1!==r.indexOf("g"+t))))}}function Cs(e,t){for(const n in t)Ts(e[n])&&Ts(t[n])?Cs(e[n],t[n]):e[n]=t[n]}function Ts(e){return e&&"object"==typeof e}function Ps(e,t){const n=t.board,r="white"===e.orientation,i=e.fixed?xs:Os(t.bounds),a=e.prev.orientation&&e.prev.orientation!==e.orientation;e.prev.orientation=e.orientation;const o=e.prev.bounds&&e.prev.bounds!==t.bounds;e.prev.bounds=t.bounds;const s=o||a,c=e.pieces,l=e.animation.current&&e.animation.current.plan.anims,u=e.animation.current&&e.animation.current.plan.captured,d=function(e){const t=new Map,n=e.pieces,r=e.peripheral.pieces,i=!r.size;if(e.peripheral.isSynchronized||i)e.lastMove&&e.highlight.lastMove&&(qs(t,e.lastMove[0],"last-move"),qs(t,e.lastMove[1],"last-move")),e.check&&e.highlight.check&&qs(t,e.check,"check"),e.peripheral.isVariantSupported&&e.peripheral.isMoveRejected&&e.peripheral.lastMove&&(qs(t,e.peripheral.lastMove[0],"rejected-move"),qs(t,e.peripheral.lastMove[1],"rejected-move"));else if(e.peripheral.isVariantSupported){for(const[e,i]of n){const n=r.get(e);n?(n.role&&n.role!==i.role||n.color&&n.color!==i.color)&&qs(t,e,"piece-replace"):qs(t,e,"piece-add")}for(const e of r.keys())n.has(e)||qs(t,e,"piece-remove")}if(e.selected&&(qs(t,e.selected,"selected"),e.movable.showDests)){const n=e.movable.dests&&e.movable.dests[e.selected];if(n)for(let r=0,i=n.length;r<i;r++){const i=n[r];qs(t,i,"move-dest"+(e.pieces.has(i)?" occupied":""))}const r=e.premovable.dests;if(r)for(let n=0,i=r.length;n<i;n++){const i=r[n];qs(t,i,"premove-dest"+(e.pieces.has(i)?" occupied":""))}}const a=e.premovable.current;a&&(qs(t,a[0],"current-premove"),qs(t,a[1],"current-premove"));if(e.exploding)for(const n of e.exploding.keys)qs(t,n,"exploding"+e.exploding.stage);return t}(e),h=new Set,p=new Set,m=new Map,f=new Map;let g,v,b,w,y,k,S,C,T,P,E=!1;e.otb&&(T=e.prev.turnColor&&e.prev.turnColor!==e.turnColor,P=e.prev.otbMode&&e.prev.otbMode!==e.otbMode,e.prev.otbMode=e.otbMode,e.prev.turnColor=e.turnColor,E=!(!T&&!P));let O=t.board.firstChild;for(;O;){const t=O.cgKey;if(Ns(O))if(v=c.get(t),g=d.get(t),b=l&&l.get(t),w=u&&u.get(t),k=O.cgPiece,!O.cgDragging||e.draggable.current&&e.draggable.current.orig===t||(O.classList.remove("dragging"),O.classList.remove("magnified"),y=i(jo(t),r),_s(e,O,O.cgColor,y),O.cgDragging=!1),!w&&O.cgCaptured&&(O.cgCaptured=!1,O.classList.remove("captured")),v){const n=Ds(v);b&&O.cgAnimating&&k===n?(y=i(jo(t),r),y[0]+=b[1][0],y[1]+=b[1][1],O.classList.add("anim"),_s(e,O,O.cgColor,y)):O.cgAnimating&&(y=i(jo(t),r),_s(e,O,O.cgColor,y),O.classList.remove("anim"),O.cgAnimating=!1),k!==n||s||E||w&&O.cgCaptured?w&&Ds(w)===k?(O.classList.add("captured"),O.cgCaptured=!0):Is(m,k,O):h.add(t)}else Is(m,k,O);else js(O)&&(s||g!==O.className?Is(f,O.className,O):p.add(t));O=O.nextSibling}for(const[t,a]of d)if(!p.has(t))if(S=f.get(a),C=S&&S.pop(),C)C.cgKey=t,y=i(jo(t),r),Ms(e,C,y);else{const o=document.createElement("square");o.className=a,o.cgKey=t,y=i(jo(t),r),Ms(e,o,y),n.insertBefore(o,n.firstChild)}for(const[t,a]of c){const o=a.role+a.color;if(b=l&&l.get(t),!h.has(t))if(S=m.get(o),C=S&&S.pop(),C)C.cgKey=t,y=i(jo(t),r),b&&(C.cgAnimating=!0,y[0]+=b[1][0],y[1]+=b[1][1]),_s(e,C,C.cgColor,y);else{const o=document.createElement("piece"),s=Ds(a);o.className=s,o.cgPiece=s,o.cgColor=a.color,o.cgKey=t,y=i(jo(t),r),b&&(o.cgAnimating=!0,y[0]+=b[1][0],y[1]+=b[1][1]),_s(e,o,a.color,y),n.appendChild(o)}}for(const e of m.values())Ls(t,e);for(const e of f.values())Ls(t,e)}function Es(e,t,n,r){return[(t?e[0]-1:8-e[0])*n,(t?8-e[1]:e[1]-1)*r]}const Os=e=>{const t=e.width/8,n=e.height/8;return(e,r)=>Es(e,r,t,n)},xs=(e,t)=>Es(e,t,12.5,12.5);function _s(e,t,n,r){e.fixed?(t.style.left=r[0]+"%",t.style.top=r[1]+"%"):t.style.transform=Ao(e,n,Bo(r))}function Ms(e,t,n){e.fixed?(t.style.left=n[0]+"%",t.style.top=n[1]+"%"):t.style.transform=Bo(n)}function Ns(e){return"PIECE"===e.tagName}function js(e){return"SQUARE"===e.tagName}function Ds(e){return e.role+" "+e.color}function Ls(e,t){for(const n of t)e.board.removeChild(n)}function Is(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function qs(e,t,n){e.set(t,(e.get(t)||"")+" "+n)}function Rs(e,t){const n=document.createElement("li-coords");return n.className=t,e.forEach(((e,t)=>{const r=document.createElement("li-coord");r.className=t%2==0?"coord-odd":"coord-even",r.textContent=String(e),n.appendChild(r)})),n}function As(e,t){return t.state.animation.enabled?function(e,t){const n=t.state,r=new Map(n.pieces),i=e(n),a=void 0!==t.dom?function(e,t,n){const r=n.bounds,i=r.width/8,a=r.height/8,o=new Map,s=[],c=new Map,l=[],u=[],d=new Map,h="white"===t.orientation;for(const[t,n]of e)d.set(t,$s(t,n));for(let e=0,n=Lo.length;e<n;e++){const n=Lo[e],r=t.pieces.get(n),i=d.get(n);r?i?Fs(r,i.piece)||(l.push(i),u.push($s(n,r))):u.push($s(n,r)):i&&l.push(i)}for(const e of u){const t=Us(e,l.filter((t=>Fs(e.piece,t.piece))));if(t){const n=h?t.pos:e.pos,r=h?e.pos:t.pos,c=[(n[0]-r[0])*i,(r[1]-n[1])*a];o.set(e.key,[c,c]),s.push(t.key)}}for(const e of l)qo(s,e.key)||c.set(e.key,e.piece);return{anims:o,captured:c}}(r,n,t.dom):void 0;if(void 0!==a&&(a.anims.size||a.captured.size)){const e=n.animation.current&&null!==n.animation.current.start;n.animation.current={start:null,duration:n.animation.duration,plan:a},e||Gt(t.applyAnim)}else t.redraw();return i}(e,t):Bs(e,t)}function Bs(e,t){const n=e(t.state);return t.redraw(),n}function $s(e,t){return{key:e,pos:jo(e),piece:t}}function Fs(e,t){return e.role===t.role&&e.color===t.color}function Us(e,t){return t.sort(((t,n)=>Ro(e.pos,t.pos)-Ro(e.pos,n.pos)))[0]}function zs(e,t){if(t.touches&&t.touches.length>1)return;const n=e.state;n.draggable.preventDefault&&t.preventDefault();const r=n.draggable.current;r&&r.orig&&(r.epos=zo(t),!r.started&&Ro(r.epos,r.rel)>=n.draggable.distance&&(r.started=!0,Gs(e)))}function Ws(e,t){const n=e.state,r=n.draggable,i=r.current;if(!i)return;if(i.originTarget!==t.target&&!i.newPiece)return;n.draggable.preventDefault&&t.preventDefault();const a=i.over;ts(n),ns(n),i.started&&a?i.newPiece?is(n,i.orig,a,i.force):rs(n,i.orig,a):i.started&&r.deleteOnDropOff?(n.pieces.delete(i.orig),setTimeout(n.events.change||Po,0)):i.newPiece&&n.pieces.delete(i.orig),(!i||i.orig!==i.previouslySelected||i.orig!==a&&a)&&n.selectable.enabled||ss(n),n.draggable.current=null,Gt((()=>Ks(e.dom))),e.redraw()}function Hs(e){const t=e.state;e.dom&&Ks(e.dom),t.draggable.current&&(t.draggable.current=null,ss(t))}function Vs(e,t,n){if("object"!=typeof n)throw new Error("function getKeyAtDomPos require bounds object arg");const r="white"===e.orientation,i=Math.ceil((t[0]-n.left)/n.width*8),a=r?i:9-i,o=Math.ceil(8-(t[1]-n.top)/n.height*8),s=r?o:9-o;return a>0&&a<9&&s>0&&s<9?No([a,s]):null}function Gs(e){const t=e.state,n=e.dom,r=t.draggable.current;r&&(r.scheduledAnimationFrame||(r.scheduledAnimationFrame=!0,requestAnimationFrame((()=>{const i=n.bounds,a="white"===t.orientation;if(r.scheduledAnimationFrame=!1,r.orig){if(t.pieces.get(r.orig)!==r.piece)return void Hs(e);t.animation.current&&t.animation.current.plan.anims.get(r.orig)&&(t.animation.current=null);const o=r.element;if(r.started&&o){if(!o.cgDragging){o.cgDragging=!0,o.classList.add("dragging"),t.draggable.magnified&&o.classList.add("magnified");const e=n.elements.ghost;if(e&&r.showGhost){e.className=`ghost ${r.piece.color} ${r.piece.role}`;const n=Do(jo(r.orig),"white"===t.orientation,i);e.style.transform=Ao(t,r.piece.color,Bo(n))}}r.pos=[r.epos[0]-r.rel[0],r.epos[1]-r.rel[1]],r.over=Vs(t,r.epos,i);const e=Do(r.origPos,a,i);e[0]+=r.pos[0]+r.dec[0],e[1]+=r.pos[1]+r.dec[1],o.style.transform=Ao(t,r.piece.color,$o(e));const s=n.elements.shadow;if(s){if(r.over&&r.over!==r.prevOver){const e=i.width/8,t=Do(jo(r.over),a,i);s.style.transform=$o([t[0]-e/2,t[1]-e/2])}else r.over||(s.style.transform=Uo);r.prevOver=r.over}}Gs(e)}}))))}function Ks(e){e.elements.shadow&&(e.elements.shadow.style.transform=Uo),e.elements.ghost&&(e.elements.ghost.style.transform=Fo)}var Ys,Xs;function Qs(e){return new DataView(Uint8Array.from(e).buffer)}function Js(e){return Array.from(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function Zs(e){const t=[];let n,r,i=1,a=0;for(n=0;n<e.length;n++)r=e.charCodeAt(n),(r>47&&r<58||r>64&&r<71||r>96&&r<103)&&(a=a<<4^15&(r>64?r+9:r),(i^=1)&&t.push(255&a));return Qs(t)}function ec(e){return Js(e).map((e=>{let t=e.toString(16);return 1==t.length&&(t="0"+t),t})).join("")}function tc(e){if("string"==typeof e)return e;if("number"==typeof e)return`0000${e.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`;throw new Error("Invalid UUID")}function nc(e){const t={};if(e)return e.forEach(((e,n)=>{t[n.toString()]=e})),t}!function(e){e[e.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",e[e.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",e[e.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"}(Ys||(Ys={})),function(e){e[e.CONNECTION_PRIORITY_BALANCED=0]="CONNECTION_PRIORITY_BALANCED",e[e.CONNECTION_PRIORITY_HIGH=1]="CONNECTION_PRIORITY_HIGH",e[e.CONNECTION_PRIORITY_LOW_POWER=2]="CONNECTION_PRIORITY_LOW_POWER"}(Xs||(Xs={}));const rc=r("BluetoothLe",{web:()=>import("./web-1d283ad1.js").then((e=>new e.BluetoothLeWeb))});function ic(e){return e?(()=>{let e=Promise.resolve();return t=>new Promise(((n,r)=>{e=e.then((()=>t())).then(n).catch(r)}))})():e=>e()}function ac(e){if("string"!=typeof e)throw new Error(`Invalid UUID type ${typeof e}. Expected string.`);if(!((e=e.toLowerCase()).search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${e}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return e}const oc=new class BleClientClass{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=ic(!0)}enableQueue(){this.queue=ic(!0)}disableQueue(){this.queue=ic(!1)}async initialize(e){await this.queue((async()=>{await rc.initialize(e)}))}async isEnabled(){return await this.queue((async()=>(await rc.isEnabled()).value))}async requestEnable(){await this.queue((async()=>{await rc.requestEnable()}))}async enable(){await this.queue((async()=>{await rc.enable()}))}async disable(){await this.queue((async()=>{await rc.disable()}))}async startEnabledNotifications(e){await this.queue((async()=>{var t;const n="onEnabledChanged";await(null===(t=this.eventListeners.get(n))||void 0===t?void 0:t.remove());const r=await rc.addListener(n,(t=>{e(t.value)}));this.eventListeners.set(n,r),await rc.startEnabledNotifications()}))}async stopEnabledNotifications(){await this.queue((async()=>{var e;const t="onEnabledChanged";await(null===(e=this.eventListeners.get(t))||void 0===e?void 0:e.remove()),this.eventListeners.delete(t),await rc.stopEnabledNotifications()}))}async isLocationEnabled(){return await this.queue((async()=>(await rc.isLocationEnabled()).value))}async openLocationSettings(){await this.queue((async()=>{await rc.openLocationSettings()}))}async openBluetoothSettings(){await this.queue((async()=>{await rc.openBluetoothSettings()}))}async openAppSettings(){await this.queue((async()=>{await rc.openAppSettings()}))}async setDisplayStrings(e){await this.queue((async()=>{await rc.setDisplayStrings(e)}))}async requestDevice(e){e=e?this.validateRequestBleDeviceOptions(e):void 0;return await this.queue((async()=>await rc.requestDevice(e)))}async requestLEScan(e,t){e=this.validateRequestBleDeviceOptions(e),await this.queue((async()=>{var n;await(null===(n=this.scanListener)||void 0===n?void 0:n.remove()),this.scanListener=await rc.addListener("onScanResult",(e=>{const n=Object.assign(Object.assign({},e),{manufacturerData:this.convertObject(e.manufacturerData),serviceData:this.convertObject(e.serviceData),rawAdvertisement:e.rawAdvertisement?this.convertValue(e.rawAdvertisement):void 0});t(n)})),await rc.requestLEScan(e)}))}async stopLEScan(){await this.queue((async()=>{var e;await(null===(e=this.scanListener)||void 0===e?void 0:e.remove()),this.scanListener=null,await rc.stopLEScan()}))}async getDevices(e){if(!Array.isArray(e))throw new Error("deviceIds must be an array");return this.queue((async()=>(await rc.getDevices({deviceIds:e})).devices))}async getConnectedDevices(e){if(!Array.isArray(e))throw new Error("services must be an array");return e=e.map(ac),this.queue((async()=>(await rc.getConnectedDevices({services:e})).devices))}async getBondedDevices(){return this.queue((async()=>(await rc.getBondedDevices()).devices))}async connect(e,t,n){await this.queue((async()=>{var r;if(t){const n=`disconnected|${e}`;await(null===(r=this.eventListeners.get(n))||void 0===r?void 0:r.remove());const i=await rc.addListener(n,(()=>{t(e)}));this.eventListeners.set(n,i)}await rc.connect(Object.assign({deviceId:e},n))}))}async createBond(e,t){await this.queue((async()=>{await rc.createBond(Object.assign({deviceId:e},t))}))}async isBonded(e){return await this.queue((async()=>(await rc.isBonded({deviceId:e})).value))}async disconnect(e){await this.queue((async()=>{await rc.disconnect({deviceId:e})}))}async getServices(e){return await this.queue((async()=>(await rc.getServices({deviceId:e})).services))}async discoverServices(e){await this.queue((async()=>{await rc.discoverServices({deviceId:e})}))}async getMtu(e){return await this.queue((async()=>(await rc.getMtu({deviceId:e})).value))}async requestConnectionPriority(e,t){await this.queue((async()=>{await rc.requestConnectionPriority({deviceId:e,connectionPriority:t})}))}async readRssi(e){return await this.queue((async()=>{const t=await rc.readRssi({deviceId:e});return parseFloat(t.value)}))}async read(e,t,n,r){t=ac(t),n=ac(n);return await this.queue((async()=>{const i=await rc.read(Object.assign({deviceId:e,service:t,characteristic:n},r));return this.convertValue(i.value)}))}async write(e,t,r,i,a){return t=ac(t),r=ac(r),this.queue((async()=>{if(!(null==i?void 0:i.buffer))throw new Error("Invalid data.");let o=i;"web"!==n.getPlatform()&&(o=ec(i)),await rc.write(Object.assign({deviceId:e,service:t,characteristic:r,value:o},a))}))}async writeWithoutResponse(e,t,r,i,a){t=ac(t),r=ac(r),await this.queue((async()=>{if(!(null==i?void 0:i.buffer))throw new Error("Invalid data.");let o=i;"web"!==n.getPlatform()&&(o=ec(i)),await rc.writeWithoutResponse(Object.assign({deviceId:e,service:t,characteristic:r,value:o},a))}))}async readDescriptor(e,t,n,r,i){t=ac(t),n=ac(n),r=ac(r);return await this.queue((async()=>{const a=await rc.readDescriptor(Object.assign({deviceId:e,service:t,characteristic:n,descriptor:r},i));return this.convertValue(a.value)}))}async writeDescriptor(e,t,r,i,a,o){return t=ac(t),r=ac(r),i=ac(i),this.queue((async()=>{if(!(null==a?void 0:a.buffer))throw new Error("Invalid data.");let s=a;"web"!==n.getPlatform()&&(s=ec(a)),await rc.writeDescriptor(Object.assign({deviceId:e,service:t,characteristic:r,descriptor:i,value:s},o))}))}async startNotifications(e,t,n,r,i){t=ac(t),n=ac(n),await this.queue((async()=>{var a;const o=`notification|${e}|${t}|${n}`;await(null===(a=this.eventListeners.get(o))||void 0===a?void 0:a.remove());const s=await rc.addListener(o,(e=>{r(this.convertValue(null==e?void 0:e.value))}));this.eventListeners.set(o,s),await rc.startNotifications(Object.assign({deviceId:e,service:t,characteristic:n},i))}))}async stopNotifications(e,t,n){t=ac(t),n=ac(n),await this.queue((async()=>{var r;const i=`notification|${e}|${t}|${n}`;await(null===(r=this.eventListeners.get(i))||void 0===r?void 0:r.remove()),this.eventListeners.delete(i),await rc.stopNotifications({deviceId:e,service:t,characteristic:n})}))}validateRequestBleDeviceOptions(e){return e.services&&(e.services=e.services.map(ac)),e.optionalServices&&(e.optionalServices=e.optionalServices.map(ac)),e}convertValue(e){return"string"==typeof e?Zs(e):void 0===e?new DataView(new ArrayBuffer(0)):e}convertObject(e){if(void 0===e)return;const t={};for(const n of Object.keys(e))t[n]=this.convertValue(e[n]);return t}};class DummyFeatures{get getState(){return!1}get setState(){return!1}get option(){return!1}}class DummyVariants{get standard(){return!1}get chess960(){return!1}get threeCheck(){return!1}get atomic(){return!1}get kingOfTheHill(){return!1}get antiChess(){return!1}get horde(){return!1}get racingKings(){return!1}get crazyHouse(){return!1}}const sc=[][Symbol.iterator]();const cc=new class DummyProtocol{constructor(){this._features=new DummyFeatures,this._variants=new DummyVariants}init(){}features(){return this._features}variants(){return this._variants}options(){return sc}onPeripheralCommand(){}onCentralStateCreated(){}onCentralStateChanged(){}onCentralStateShifted(){}onCentralStateEnded(){}onMoveRejectedByCentral(){}onCentralGetState(){}onCentralSetState(){}onCentralOptionsReset(){}};class BaseProtocol{transitionTo(e){this.state=e,this.state.setContext(this),this.state.onEnter()}init(e){}features(){return cc.features()}variants(){return cc.variants()}options(){return cc.options()}onPeripheralCommand(e){var t;null===(t=this.state)||void 0===t||t.onPeripheralCommand(e)}onCentralStateCreated(e){var t;null===(t=this.state)||void 0===t||t.onCentralStateCreated(e)}onCentralStateChanged(){var e;null===(e=this.state)||void 0===e||e.onCentralStateChanged()}onCentralStateShifted(e){var t;null===(t=this.state)||void 0===t||t.onCentralStateShifted(e)}onCentralStateEnded(e){var t;null===(t=this.state)||void 0===t||t.onCentralStateEnded(e)}onMoveRejectedByCentral(){var e;null===(e=this.state)||void 0===e||e.onMoveRejectedByCentral()}onCentralGetState(){var e;null===(e=this.state)||void 0===e||e.onCentralGetState()}onCentralSetState(){var e;null===(e=this.state)||void 0===e||e.onCentralSetState()}onCentralOptionsReset(){var e;null===(e=this.state)||void 0===e||e.onCentralOptionsReset()}}const lc=new BaseProtocol;class BaseState{constructor(){this.context=lc}setContext(e){this.context=e}transitionTo(e){this.context.transitionTo(e)}onEnter(){}onPeripheralCommand(e){}onCentralStateCreated(e){}onCentralStateChanged(){}onCentralStateShifted(e){}onCentralStateEnded(e){}onMoveRejectedByCentral(){}onCentralGetState(){}onCentralSetState(){}onCentralOptionsReset(){}}const uc={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k",unsupport:"p"},dc={P:"pawn",B:"bishop",N:"knight",R:"rook",Q:"queen",K:"king",M:"unsupport",D:"unsupport",p:"pawn",b:"bishop",n:"knight",r:"rook",q:"queen",k:"king",m:"unsupport",d:"unsupport"},hc={P:"pawn",N:"knight",B:"bishop",R:"rook",Q:"queen"},pc={e1a1:"e1c1",e1h1:"e1g1",e8a8:"e8c8",e8h8:"e8g8"};function mc(e){return[e.substr(0,2),e.substr(2,2)]}function fc(e){return"@"===e[1]?[e.substr(2,2),e.substr(2,2)]:[e.substr(0,2),e.substr(2,2)]}function gc(e){const t=e.substr(4,1);return dc[t]}function vc(e){return e.substr(2,2)}function bc(e){return dc[e.substr(0,1)]}function wc(e){return[e.substr(2,2),e.substr(2,2)]}function yc(e){return"P"===e[0]?e.slice(1):e}function kc(e){return[e.slice(0,2),e.slice(2,4),e.slice(4,5)]}function Sc(e){if(void 0===e)return null;if(function(e){return m(e)}(e))return e;const t={};return e&&function(e){return"string"==typeof e}(e)&&e.split(" ").forEach((e=>{t[Cc[e[0]]]=e.split("").slice(1).map((e=>Cc[e]))})),t}const Cc={a:"a1",b:"b1",c:"c1",d:"d1",e:"e1",f:"f1",g:"g1",h:"h1",i:"a2",j:"b2",k:"c2",l:"d2",m:"e2",n:"f2",o:"g2",p:"h2",q:"a3",r:"b3",s:"c3",t:"d3",u:"e3",v:"f3",w:"g3",x:"h3",y:"a4",z:"b4",A:"c4",B:"d4",C:"e4",D:"f4",E:"g4",F:"h4",G:"a5",H:"b5",I:"c5",J:"d5",K:"e5",L:"f5",M:"g5",N:"h5",O:"a6",P:"b6",Q:"c6",R:"d6",S:"e6",T:"f6",U:"g6",V:"h6",W:"a7",X:"b7",Y:"c7",Z:"d7",0:"e7",1:"f7",2:"g7",3:"h7",4:"a8",5:"b8",6:"c8",7:"d8",8:"e8",9:"f8","!":"g8","?":"h8"};function Tc(e){return"white"===e.turnColor?"w":"b"}function Pc(e){return[ws.convertPiecesToFen(e.pieces),Tc(e)].join(" ")}function Ec(e,t){e.peripheral.isMoveRejected=t}function Oc(e,t){e.peripheral.isSynchronized=t}function xc(e,t){e.peripheral.isGettable=t}function _c(e,t){e.peripheral.isSettable=t}function Mc(e,t){e.peripheral.pieces=ws.convertFenToPeripheralPieces(t)}function Nc(e){return t=e.lastMove[0],n=e.lastMove[1],(r=e.lastPromotion?e.lastPromotion:void 0)?t+n+uc[r]:t+n;var t,n,r}function jc(e){Kc.sendCommandToPeripheral(e)}function Dc(){Qc.sendStateChangeToCentral()}function Lc(){Qc.sendOptionsUpdateToCentral()}function Ic(e){return e.substring(e.indexOf(" ")+1)}function*qc(e){for(const t of Object.keys(e))yield e[t]}var Rc,Ac,Bc,$c,Fc,Uc,zc,Wc;!function(e){e.LastMove="last_move",e.Check="check",e.Msg="msg",e.UndoRedo="undo_redo",e.Side="side",e.GetState="get_state",e.SetState="set_state",e.Option="option"}(Rc||(Rc={})),function(e){e.Standard="standard",e.Chess960="chess_960",e.ThreeCheck="3_check",e.Atomic="atomic",e.KingOfTheHill="king_of_the_hill",e.AntiChess="anti_chess",e.Horde="horde",e.RacingKings="racing_kings",e.CrazyHouse="crazy_house"}(Ac||(Ac={})),function(e){e.Ok="ok",e.Nok="nok",e.Feature="feature",e.Variant="variant",e.SetVariant="set_variant",e.Begin="begin",e.State="state",e.Sync="sync",e.Unsync="unsync",e.UnsyncSettable="unsync_settable",e.End="end",e.Move="move",e.Promote="promote",e.Err="err",e.LastMove="last_move",e.Check="check",e.Msg="msg",e.Undo="undo",e.Redo="redo",e.Side="side",e.GetState="get_state",e.SetState="set_state",e.OptionsBegin="options_begin",e.OptionsEnd="options_end",e.OptionsReset="options_reset",e.Option="option",e.SetOption="set_option"}(Bc||(Bc={})),function(e){e.Undefined="undefined",e.Checkmate="checkmate",e.Draw="draw",e.Timeout="timeout",e.Resign="resign",e.Abort="abort"}($c||($c={})),function(e){e.White="w",e.Black="b",e.Both="?"}(Fc||(Fc={})),function(e){e.Bool="bool",e.Enum="enum",e.Str="str",e.Int="int",e.Float="float"}(Uc||(Uc={})),function(e){e.True="true",e.False="false"}(zc||(zc={}));class Support{constructor(e){this.name=e,this.isSupported=!1}}class CppFeatures{constructor(){this.lastMove=new Support(Rc.LastMove),this.check=new Support(Rc.Check),this.msg=new Support(Rc.Msg),this.undoRedo=new Support(Rc.UndoRedo),this.side=new Support(Rc.Side),this.getState=new Support(Rc.GetState),this.setState=new Support(Rc.SetState),this.option=new Support(Rc.Option)}}class CppWrappedFeatures{constructor(e){this._features=e}get getState(){return this._features.getState.isSupported}get setState(){return this._features.setState.isSupported}get option(){return this._features.option.isSupported}}class CppVariants{constructor(){this.standard=new Support(Ac.Standard),this.chess960=new Support(Ac.Chess960),this.threeCheck=new Support(Ac.ThreeCheck),this.atomic=new Support(Ac.Atomic),this.kingOfTheHill=new Support(Ac.KingOfTheHill),this.antiChess=new Support(Ac.AntiChess),this.horde=new Support(Ac.Horde),this.racingKings=new Support(Ac.RacingKings),this.crazyHouse=new Support(Ac.CrazyHouse)}}class CppWrappedVariants{constructor(e){this._variants=e}get standard(){return this._variants.standard.isSupported}get chess960(){return this._variants.chess960.isSupported}get threeCheck(){return this._variants.threeCheck.isSupported}get atomic(){return this._variants.atomic.isSupported}get kingOfTheHill(){return this._variants.kingOfTheHill.isSupported}get antiChess(){return this._variants.antiChess.isSupported}get horde(){return this._variants.horde.isSupported}get racingKings(){return this._variants.racingKings.isSupported}get crazyHouse(){return this._variants.crazyHouse.isSupported}}!function(e){e[e.Bool=0]="Bool",e[e.Enum=1]="Enum",e[e.Str=2]="Str",e[e.Int=3]="Int",e[e.Float=4]="Float"}(Wc||(Wc={}));class TimerWrapper{start(e,t){this.stop(),this._handle=setTimeout((()=>{this._handle=void 0,e()}),t)}stop(){void 0!==this._handle&&(clearTimeout(this._handle),this._handle=void 0)}isActive(){return void 0!==this._handle}}class CppTypedOption{constructor(e,t){this._name=e,this._value=t,this._defaultValue=t,this._timer=new TimerWrapper,this._isHandled=!1}get name(){return this._name}get value(){return this._value}set value(e){this._value=e,this._timer.isActive()?this._isHandled=!1:this._handleValue()}set peripheralValue(e){this._value=e,this._timer.stop()}reset(){this._value=this._defaultValue,this._timer.stop()}_handleValue(){this._isHandled=!0,this._timer.start((()=>this._handleTimeout()),100),jc(`${Bc.SetOption} ${this._name} ${this.valueString}`)}_handleTimeout(){this._isHandled||this._handleValue()}}class CppBoolOption extends CppTypedOption{constructor(e,t){super(e,t)}get valueString(){return this._value?zc.True:zc.False}get type(){return Wc.Bool}}class CppEnumOption extends CppTypedOption{constructor(e,t,n){super(e,t),this._values=n}get valueString(){return this._value}get type(){return Wc.Enum}get values(){return this._values}}class CppStrOption extends CppTypedOption{constructor(e,t){super(e,t)}get valueString(){return this._value}get type(){return Wc.Str}}class CppNumOption extends CppTypedOption{constructor(e,t,n,r,i){super(e,t),this._min=n,this._max=r,this._step=i}get min(){return this._min}get max(){return this._max}get step(){return this._step}}class CppIntOption extends CppNumOption{constructor(e,t,n,r,i){super(e,t,n,r,i)}get valueString(){return this._value.toString()}get type(){return Wc.Int}}class CppFloatOption extends CppNumOption{constructor(e,t,n,r,i){super(e,t,n,r,i)}get valueString(){return this._value.toFixed(2)}get type(){return Wc.Float}}class CppOptions{constructor(){this._map=new Map}get iterator(){return this._map.values()}add(e){try{const t=e.split(" "),n=t[0],r=t[1];return r===Uc.Bool?this._add(new CppBoolOption(n,t[2]===zc.True)):r===Uc.Enum?this._add(new CppEnumOption(n,t[2],t.slice(3))):r===Uc.Str?this._add(new CppStrOption(n,t.slice(2).join(" "))):r===Uc.Int?this._add(new CppIntOption(n,parseInt(t[2],10),parseInt(t[3],10),parseInt(t[4],10),t.length>5?parseInt(t[5],10):void 0)):r===Uc.Float&&this._add(new CppFloatOption(n,parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]),t.length>5?parseFloat(t[5]):void 0)),!0}catch(e){return!1}}set(e){try{const t=e.split(" "),n=t[0],r=t[1],i=this._map.get(n);return i instanceof CppBoolOption?i.peripheralValue=r===zc.True:i instanceof CppEnumOption?i.peripheralValue=r:i instanceof CppStrOption?i.peripheralValue=t.slice(1).join(" "):i instanceof CppIntOption?i.peripheralValue=parseInt(r,10):i instanceof CppFloatOption&&(i.peripheralValue=parseFloat(r)),!0}catch(e){return!1}}reset(){this._map.forEach((e=>{e.reset()}))}_add(e){this._map.set(e.name,e)}}class BleChessState extends BaseState{setState(e){this.context._roundState=e}getState(){return this.context._roundState}getFeatures(){return this.context._features}getVariants(){return this.context._variants}getOptions(){return this.context._options}getVariant(e){return this.context._variantsMap[e]||this.context._variants.standard}getEndReason(e){return(null==e?void 0:e.name)&&this.context._endReasonsMap[e.name]}onPeripheralCommand(e){e.startsWith(Bc.Msg)||e.startsWith(Bc.Err)?z.show({text:Ic(e)}):e.startsWith(Bc.SetOption)?(this.getOptions().set(Ic(e))||z.show({text:`${kt("unexpected")}: ${e}`}),Lc()):e.startsWith(Bc.OptionsReset)?(this.getOptions().reset(),Lc()):z.show({text:`${kt("unexpected")}: ${this.constructor.name}: ${e}`})}onCentralStateCreated(e){this.setState(e)}onCentralOptionsReset(){this.getOptions().reset(),jc(Bc.OptionsReset)}}class Init extends BleChessState{onEnter(){const e=new CheckSupportsIteration(qc(this.getVariants()),Bc.Variant,new CheckOptions),t=new CheckSupportsIteration(qc(this.getFeatures()),Bc.Feature,e);this.transitionTo(t)}}class CheckSupportsIteration extends BleChessState{constructor(e,t,n){super(),this.iterator=e,this.current=e.next(),this.command=t,this.nextState=n}onEnter(){this.handleCurrent()}onPeripheralCommand(e){e===Bc.Ok?(this.current.value.isSupported=!0,this.current=this.iterator.next(),this.handleCurrent()):e===Bc.Nok?(this.current.value.isSupported=!1,this.current=this.iterator.next(),this.handleCurrent()):super.onPeripheralCommand(e)}handleCurrent(){this.current.done?this.transitionTo(this.nextState):jc(`${this.command} ${this.current.value.name}`)}}class CheckOptions extends BleChessState{onEnter(){this.getFeatures().option.isSupported?jc(Bc.OptionsBegin):this.transitionTo(new Initialized)}onPeripheralCommand(e){e.startsWith(Bc.OptionsEnd)?(this.transitionTo(new Initialized),Lc()):e.startsWith(Bc.Option)?this.getOptions().add(Ic(e))||z.show({text:`${kt("unexpected")}: ${e}`}):e.startsWith(Bc.SetOption)?this.getOptions().set(Ic(e))||z.show({text:`${kt("unexpected")}: ${e}`}):super.onPeripheralCommand(e)}}class Initialized extends BleChessState{onEnter(){const e=0!==this.getState().pieces.size;this.transitionTo(e?new RoundBegin:new Idle)}}class Idle extends BleChessState{onCentralStateCreated(e){this.setState(e),this.transitionTo(new RoundBegin)}onCentralGetState(){this.transitionTo(new GetState)}}class GetState extends Idle{onEnter(){jc(`${Bc.GetState}`),xc(this.getState(),!1),Dc()}onPeripheralCommand(e){if(e.startsWith(Bc.State)){const t=this.getState();Mc(t,Ic(e)),xc(t,function(e){const t=e.peripheral.pieces;for(const e of t.values())if(void 0===e.role||void 0===e.color)return!1;return!0}(t)),Dc()}else super.onPeripheralCommand(e)}}class Round extends Idle{onCentralStateShifted(e){const t=this.getState();if(Ec(t,!1),!this.getFeatures().undoRedo.isSupported)return this.transitionTo(new Idle),jc(`${Bc.End} ${$c.Abort}`),void z.show({text:kt("shiftUnsupported")});jc(`${"undo"==e?Bc.Undo:Bc.Redo} ${Pc(t)}`),this.getFeatures().lastMove.isSupported&&t.lastMove&&jc(`${Bc.LastMove} ${Nc(t)}`),this.getFeatures().check.isSupported&&t.check&&jc(`${Bc.Check} ${t.check}`)}onCentralStateEnded(e){const t=this.getEndReason(e);t&&(this.transitionTo(new Idle),jc(`${Bc.End} ${t}`))}onCentralSetState(){jc(`${Bc.SetState}`),_c(this.getState(),!1),Dc()}onPeripheralCommand(e){if(e.startsWith(Bc.State)){const t=this.getState();Mc(t,Ic(e)),Ec(t,!1),Dc()}else if(e.startsWith(Bc.Sync)){const t=this.getState();Mc(t,Ic(e)),Oc(t,!0),_c(t,!1),Ec(t,!1),Dc(),z.show({text:kt("synchronized")})}else if(e.startsWith(Bc.UnsyncSettable)){const t=this.getState(),n=t.peripheral.isSynchronized;Mc(t,Ic(e)),Oc(t,!1),_c(t,!0),Ec(t,!1),Dc(),n&&z.show({text:kt("unsynchronized")})}else if(e.startsWith(Bc.Unsync)){const t=this.getState(),n=t.peripheral.isSynchronized;Mc(t,Ic(e)),Oc(t,!1),_c(t,!1),Ec(t,!1),Dc(),n&&z.show({text:kt("unsynchronized")})}else super.onPeripheralCommand(e)}}class RoundBegin extends Round{onEnter(){const e=this.getState(),t=this.getVariant(e.variant);var n,r;if(jc(`${Bc.SetVariant} ${t.name}`),n=e,r=t.isSupported,n.peripheral.isVariantSupported=r,!t.isSupported)return this.transitionTo(new Idle),void z.show({text:kt("variantUnsupported")});if(this.transitionTo(new RoundOngoing),this.getFeatures().side.isSupported){const t=e.otb?Fc.Both:"white"===e.orientation?Fc.White:Fc.Black;jc(`${Bc.Side} ${t}`)}jc(`${Bc.Begin} ${Pc(e)}`),this.getFeatures().lastMove.isSupported&&e.lastMove&&jc(`${Bc.LastMove} ${Nc(e)}`),this.getFeatures().check.isSupported&&e.check&&jc(`${Bc.Check} ${e.check}`)}}class RoundOngoing extends Round{onCentralStateChanged(){const e=this.getState();jc(`${Bc.Move} ${Nc(e)}`),this.getFeatures().check.isSupported&&e.check&&jc(`${Bc.Check} ${e.check}`),Ec(e,!1),Dc()}onPeripheralCommand(e){if(e.startsWith(Bc.Move)){const t=this.getState(),n=Ic(e);Ec(t,!1),function(e,t){const n=mc(t),r=gc(t);e.peripheral.lastMove=n,e.peripheral.lastPromotion=r||null}(t,n),this.transitionTo(new CheckPeripheralMove),function(e){const t=mc(e),n=gc(e);Qc.sendMoveToCentral(t[0],t[1],n)}(n)}else super.onPeripheralCommand(e)}}class CheckPeripheralMove extends Round{onCentralStateChanged(){const e=this.getState();this.transitionTo(new RoundOngoing),e.lastPromotion&&!e.peripheral.lastPromotion?jc(`${Bc.Promote} ${Nc(e)}`):jc(Bc.Ok),this.getFeatures().check.isSupported&&e.check&&jc(`${Bc.Check} ${e.check}`)}onMoveRejectedByCentral(){const e=this.getState();this.transitionTo(new RoundOngoing),jc(Bc.Nok),Ec(e,!0),Dc(),z.show({text:kt("rejected")})}}const Hc=[{uuids:{srv:"f5351050-b2c9-11ec-a0c0-b3bc53b08d33",txCh:"f53513ca-b2c9-11ec-a0c1-639b8957db99",rxCh:"f535147e-b2c9-11ec-a0c2-8bbd706ec4e6"},protocol:class CppProtocol extends BaseProtocol{constructor(){super(...arguments),this._roundState=gs(),this._features=new CppFeatures,this._wrappedFeatures=new CppWrappedFeatures(this._features),this._variants=new CppVariants,this._wrappedVariants=new CppWrappedVariants(this._variants),this._variantsMap={standard:this._variants.standard,chess960:this._variants.chess960,antichess:this._variants.antiChess,kingOfTheHill:this._variants.kingOfTheHill,threeCheck:this._variants.threeCheck,atomic:this._variants.atomic,horde:this._variants.horde,racingKings:this._variants.racingKings,crazyhouse:this._variants.crazyHouse},this._endReasonsMap={mate:$c.Checkmate,stalemate:$c.Draw,draw:$c.Draw,timeout:$c.Timeout,outoftime:$c.Timeout,resign:$c.Resign,aborted:$c.Abort,noStart:$c.Undefined,unknownFinish:$c.Undefined,cheat:$c.Undefined,variantEnd:$c.Undefined},this._options=new CppOptions}init(e){this._roundState=e,this.transitionTo(new Init)}features(){return this._wrappedFeatures}variants(){return this._wrappedVariants}options(){return this._options.iterator}}}],Vc={uuids:{srv:"0000180f-0000-1000-8000-00805f9b34fb",levelCh:"00002a19-0000-1000-8000-00805f9b34fb"},level:void 0};const Gc=new class BluetoothConnection{constructor(){this.isConnected=!1,this.protocol=cc,this.centralState=gs(),this.lastMove=null,this.batteryService=Vc}getDeviceId(){return lt.general.bluetooth.deviceId()}async onDisconnect(e){this.isConnected&&(this.isConnected=!1,this.protocol=cc,this.batteryService.level=void 0,Xt(),z.show({text:kt("disconnectedFromBluetoothDevice")}),lt.general.bluetooth.useDevice()&&this.connect())}async requestDevice(){return await oc.requestDevice({services:Hc.map((e=>e.uuids.srv))})}async setupChessService(){const e=await oc.getServices(this.getDeviceId());for(const t of Hc)if(e.some((e=>t.uuids.srv===e.uuid)))return this.uuids=t.uuids,void(this.protocol=new t.protocol)}async setupBatteryService(){if((await oc.getServices(this.getDeviceId())).some((e=>this.batteryService.uuids.srv===e.uuid))){const e=await oc.read(this.getDeviceId(),this.batteryService.uuids.srv,this.batteryService.uuids.levelCh);this.batteryService.level=e.getUint8(0),await this.registerBatteryCallback()}}async connect(){await oc.connect(this.getDeviceId(),(e=>this.onDisconnect(e))),await this.setupChessService(),await this.registerChessCallback(),await this.setupBatteryService(),this.protocol.init(this.centralState),this.isConnected=!0,Xt(),z.show({text:kt("connectedToBluetoothDevice")})}async disconnect(){this.isConnected&&(await this.unregisterChessCallback(),await this.unregisterBatteryCallback(),await oc.disconnect(this.getDeviceId()))}async sendCommandToPeripheral(e){var t;await oc.write(this.getDeviceId(),this.uuids.srv,this.uuids.txCh,(t=e,Qs(t.split("").map((e=>e.charCodeAt(0))))))}async reciveData(e){var t;this.protocol.onPeripheralCommand((t=e,String.fromCharCode(...Js(t))))}async registerChessCallback(){await oc.startNotifications(this.getDeviceId(),this.uuids.srv,this.uuids.rxCh,(e=>this.reciveData(e)))}async unregisterChessCallback(){await oc.stopNotifications(this.getDeviceId(),this.uuids.srv,this.uuids.rxCh)}async registerBatteryCallback(){await oc.startNotifications(this.getDeviceId(),this.batteryService.uuids.srv,this.batteryService.uuids.levelCh,(e=>{this.batteryService.level=e.getUint8(0),Xt()}))}async unregisterBatteryCallback(){void 0!==this.batteryService.level&&await oc.stopNotifications(this.getDeviceId(),this.batteryService.uuids.srv,this.batteryService.uuids.levelCh)}};var Kc={protocol:()=>Gc.protocol,saveCentralState(e){Gc.centralState=e,this.saveLastMove()},saveLastMove(){Gc.lastMove=Gc.centralState.lastMove},isRepeatedLastMove:()=>Gc.lastMove===Gc.centralState.lastMove,sendCommandToPeripheral(e){Gc.sendCommandToPeripheral(e)},state:()=>Gc.centralState,features:()=>Gc.protocol.features(),variants:()=>Gc.protocol.variants(),options:()=>Gc.protocol.options(),isConnected:()=>Gc.isConnected,batteryLevel:()=>Gc.batteryService.level,init(){lt.general.bluetooth.useDevice()&&(oc.initialize({androidNeverForLocation:!0}),Gc.connect())},onSettingChange(e){e?(oc.initialize({androidNeverForLocation:!0}),Gc.requestDevice().then((e=>{lt.general.bluetooth.deviceId(e.deviceId),Gc.connect()})).catch((()=>{lt.general.bluetooth.useDevice(!1),Xt()}))):Gc.disconnect()},updateSettings(){Xt()}};let Yc,Xc;var Qc={onCentralStateCreated(e){Kc.protocol().onCentralStateCreated(e),Kc.saveCentralState(e)},onCentralStateChanged(){Kc.isRepeatedLastMove()||(Kc.state().shiftView?Kc.state().shiftView=null:(Kc.state().shift?(Kc.protocol().onCentralStateShifted(Kc.state().shift),Kc.state().shift=null):Kc.protocol().onCentralStateChanged(),Kc.saveLastMove()))},onCentralStateEnded(e){Kc.protocol().onCentralStateEnded(e)},onMoveRejectedByCentral(){Kc.protocol().onMoveRejectedByCentral()},onCentralGetState(){Kc.protocol().onCentralGetState()},onCentralSetState(){Kc.protocol().onCentralSetState()},sendMoveToCentral(e,t,n){null==Yc||Yc(e,t,n)},sendStateChangeToCentral(){null==Xc||Xc(),(this.features().getState||this.features().setState)&&Xt()},sendOptionsUpdateToCentral(){Kc.updateSettings()},state:()=>Kc.state(),features:()=>Kc.features(),variants:()=>Kc.variants(),options:()=>Kc.options(),subscribe(e,t){Yc=e,Xc=t},unsubscribe(){Yc=void 0,Xc=void 0},isConnected:()=>Kc.isConnected(),batteryLevel:()=>Kc.batteryLevel()};const Jc={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};class Chessground{constructor(e){this.detach=()=>{this.dom=void 0,window.removeEventListener("resize",this.onOrientationChange)},this.applyAnim=e=>{const t=this.state,n=t.animation.current;if(null===n)return void this.redrawSync();null===n.start&&(n.start=e);const r=1-(e-n.start)/n.duration;if(r<=0)t.animation.current=null,this.redrawSync();else{const e=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}(r);for(const t of n.plan.anims.values())t[1]=[Mo(t[0][0]*e,10),Mo(t[0][1]*e,10)];this.redrawSync(),Gt(this.applyAnim)}},this.setBounds=e=>{this.dom&&(this.dom.bounds=e)},this.redrawSync=()=>{this.dom&&Ps(this.state,this.dom)},this.redraw=()=>{Gt(this.redrawSync)},this.getFen=()=>ws.convertPiecesToFen(this.state.pieces),this.toggleOrientation=()=>{As(Jo,this)},this.externalMove=(e,t,n)=>{As((r=>rs(r,e,t,n)),this)||Qc.onMoveRejectedByCentral()},this.playPremove=()=>{if(this.state.premovable.current){if(Boolean(As(ds,this)))return!0;this.redraw()}return!1},this.playPredrop=e=>{if(this.state.predroppable.current){const t=function(e,t){const n=e.predroppable.current;if(!n)return!1;let r=!1;t(n)&&ms(e,{role:n.role,color:e.movable.color},n.key)&&(To(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0}),r=!0);return ns(e),r}(this.state,e);return this.redraw(),t}return!1},this.cancelPremove=()=>{Bs(ts,this)},this.cancelPredrop=()=>{Bs(ns,this)},this.setCheck=e=>{Bs((t=>es(t,e)),this)},this.cancelMove=()=>{Hs(this),Bs((e=>hs(e)),this)},this.stop=e=>{Hs(this),Bs((e=>function(e){e.movable.color=null,e.movable.dests={},hs(e)}(e)),this),Qc.onCentralStateEnded(e)},this.explode=e=>{this.dom&&(this.state.exploding={stage:1,keys:e},this.redraw(),setTimeout((()=>{this.state.exploding&&(this.state.exploding.stage=2,this.redraw()),setTimeout((()=>{this.state.exploding=null,this.redraw()}),120)}),120))},this.onOrientationChange=()=>{const e=this.dom;e&&requestAnimationFrame((()=>{e.bounds=e.board.getBoundingClientRect(),this.redraw()}))},this.state=function(e){const t=gs();return ys(t,e||{}),t}(e)}attach(e,t){const n=this.state.fixed||this.state.viewOnly,r=this.state.edit,i=document.createElement("div");if(i.className="cg-board",i.className+=n?" view-only":" manipulable",e.appendChild(i),this.dom={board:i,elements:{},bounds:t},this.redrawSync(),!n){const t=document.createElement("div");t.className="cg-square-target",t.style.transform=Uo,e.appendChild(t),this.dom.elements.shadow=t}if(!n&&this.state.draggable.showGhost){const t=document.createElement("piece");t.className="ghost",t.style.transform=Fo,e.appendChild(t),this.dom.elements.ghost=t}this.state.coordinates&&(function(e,t){const n=document.createDocumentFragment();n.appendChild(Rs(xo,"ranks")),n.appendChild(Rs(Eo,"files"+(t?" withSymm":""))),e.appendChild(n)}(e,!!this.state.symmetricCoordinates),this.state.symmetricCoordinates&&function(e){const t=document.createDocumentFragment();t.appendChild(Rs(_o,"ranks symm")),t.appendChild(Rs(Oo,"files symm")),e.appendChild(t)}(e)),n||(i.addEventListener("touchstart",(e=>function(e,t){if(!t.isTrusted||t.touches&&t.touches.length>1)return;t.preventDefault();const n=e.state,r=e.dom,i=r.bounds,a=zo(t),o=Vs(n,a,i);if(!o)return;const s=n.selected,c=!!n.premovable.current,l=!!n.predroppable.current;n.selected&&ls(n,n.selected,o)?As((e=>as(e,o)),e):as(n,o);const u=n.selected===o,d=n.pieces.get(o);if(d&&u&&function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(n,o)){const c=Wo(n.orientation,i,o),l=jo(o);n.draggable.current={previouslySelected:s,orig:o,piece:d,rel:a,epos:a,pos:[0,0],origPos:l,dec:n.draggable.magnified?[a[0]-(c.left+c.width),a[1]-(c.top+2*c.height)]:[a[0]-(c.left+c.width/2),a[1]-(c.top+c.height/2)],started:!1===n.selectable.enabled,over:o,prevOver:null,element:Ho(r,o),originTarget:t.target,showGhost:n.draggable.showGhost,scheduledAnimationFrame:!1},n.draggable.magnified&&n.draggable.centerPiece&&(n.draggable.current.dec[1]=a[1]-(c.top+c.height)),n.draggable.current.started&&Gs(e)}else c&&ts(n),l&&ns(n);e.redraw()}(this,e))),i.addEventListener("touchmove",(e=>zs(this,e))),i.addEventListener("touchend",(e=>Ws(this,e))),i.addEventListener("touchcancel",(()=>Hs(this)))),n||(Qc.subscribe(this.externalMove,this.redraw),r?Qc.features().getState&&Qc.onCentralGetState():Qc.onCentralStateCreated(this.state)),window.addEventListener("resize",this.onOrientationChange)}getMaterialDiff(){let e=0;const t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(const n of this.state.pieces.values())t[n.role]+="white"===n.color?1:-1,e+=Jc[n.role]*("white"===n.color?1:-1);const n={white:{pieces:{},score:e},black:{pieces:{},score:-e}};for(const e in t){const r=t[e];r>0?n.white.pieces[e]=r:r<0&&(n.black.pieces[e]=-r)}return n}set(e){As((t=>ks(t,e)),this),Qc.onCentralStateChanged()}reconfigure(e){As((t=>ys(t,e)),this),Qc.onCentralStateCreated(this.state)}setOtbMode(e){As((t=>{t.otbMode=e}),this)}setPieces(e){As((t=>Zo(t,e)),this)}setLastPromotion(e){this.state.lastPromotion=e||null}promote(e,t){const n=new Map,r=this.state.pieces.get(e);r&&"pawn"===r.role&&(n.set(e,{color:r.color,role:t}),this.setPieces(n))}dragNewPiece(e,t,n=!1){!function(e,t,n,r){const i="a0",a=e.state,o=e.dom;a.pieces.set(i,t),e.redrawSync();const s=zo(n),c="white"===a.orientation,l=o.bounds,u=Wo(a.orientation,l,i),d=[(c?0:7)*u.width+l.left,(c?8:-1)*u.height+l.top];a.draggable.current={orig:i,origPos:jo(i),piece:t,rel:d,epos:s,pos:[s[0]-d[0],s[1]-d[1]],dec:a.draggable.magnified?[-u.width,2*-u.height]:[-u.width/2,-u.height/2],over:null,prevOver:null,started:!0,element:Ho(o,i),originTarget:n.target,previouslySelected:null,newPiece:!0,force:r||!1,showGhost:!1},Gs(e)}(this,t,e,n)}selectSquare(e){e?As((t=>as(t,e)),this):this.state.selected&&(ss(this.state),this.redraw())}apiMove(e,t,n,r){As((i=>{!function(e,t,n){ps(e,t,n)}(i,e,t),n&&Zo(i,n),r&&(ks(i,r),Qc.onCentralStateChanged())}),this)}apiNewPiece(e,t,n){As((r=>{!function(e,t,n){ms(e,t,n)}(r,e,t),n&&ks(r,n)}),this)}}const Zc={oninit({attrs:e}){this.pieceTheme=lt.general.theme.piece(),this.boardTheme=lt.general.theme.board(),this.ground=new Chessground(function({fen:e,lastMove:t,orientation:n,fixed:r=!0}){return{batchRAF:Gt,viewOnly:!0,fixed:r,minimalDom:!0,coordinates:!1,fen:e,lastMove:t?mc(t):null,orientation:n||"white"}}(e))},oncreate({attrs:e,dom:t}){const n=e.fixed?{top:0,bottom:0,left:0,right:0,height:0,width:0}:t.getBoundingClientRect();void 0!==e.delay?setTimeout((()=>{this.ground.attach(t,n)}),e.delay):this.ground.attach(t,n)},onbeforeupdate:({attrs:e},{attrs:t})=>e.fen!==t.fen||e.lastMove!==t.lastMove||e.orientation!==t.orientation,onupdate({attrs:e}){this.ground.set(Object.assign(Object.assign({},e),{lastMove:e.lastMove?mc(e.lastMove):void 0}))},onremove(){this.ground.detach()},view({attrs:e}){const t=["display_board",e.customPieceTheme||this.pieceTheme,`board-${this.boardTheme}`,e.variant||"standard"].join(" ");return Fn("div",{className:t})}};let el,tl=null,nl=!1;var rl={lastJoined:()=>el,resetLastJoined(){el=void 0},open:function(e){Si.backbutton.stack.push(ll),Zr.refresh(),nl=!0,setTimeout((()=>{tl&&!Ji()&&tl.goTo(void 0!==e?e:0)}),500)},close:ll,view:()=>nl?Fn("div#games_menu.overlay_popup_wrapper",{onbeforeremove:al},Fn.fragment({key:Zi()?"portrait":"landscape"},[Fn("div.wrapper_overlay_close",{oncreate:il}),fl(),Fn("div#wrapper_games",vl())])):null};const il=Vi((()=>ll()));function al({dom:e}){return e.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)}))}let ol;function sl({dom:e}){Zi()&&(tl=new Siema({selector:e,duration:250,loop:!1,perPage:Ji()?2:1,startIndex:0,threshold:50,draggable:!0,onChange:()=>{clearTimeout(ol),ol=setTimeout((()=>{Gt(gl)}),300)}}),Gt(gl),Xt())}function cl(){tl&&(tl.destroy(),tl=null)}function ll(e){"backbutton"!==e&&nl&&Si.backbutton.stack.pop(),nl=!1}function ul(e,t,n,r){return Fn("div.boardWrapper",Fn(Zc,{fen:e,lastMove:n,orientation:t,variant:r}))}function dl(e){return e.isMyTurn?e.secondsLeft?Fn("time",{},_t(Ge(new Date,e.secondsLeft))):kt("yourTurn"):kt("waitingForOpponent")}function hl(e){const t=e.opponent.ai?"n":dn(e.perf),n=mo(e.opponent,!1),r=["card","standard",e.color].join(" "),i=["timeIndication",e.isMyTurn?"myTurn":"opponentTurn"].join(" ");return Fn("div",{className:r,key:"game."+e.gameId,oncreate:Yi((()=>function(e){el=e,ho.set(e.fullId,{fen:e.fen,orientation:e.color}),ll(),Si.set("/game/"+e.fullId)}(e)))},[ul(e.fen,e.color,e.lastMove,e.variant.key),Fn("div.infos",[Fn("div.icon-game",{"data-icon":t||""}),Fn("div.description",[Fn("h2.title",n),Fn("p",[Fn("span.variant",e.variant.name),Fn("span",{className:i},dl(e))])])])])}function pl(e){if(!e.challenger)return null;const t=e.rated?kt("rated"):kt("casual"),n=e.challenger.provisional?"?":"",r=`${e.challenger.id} (${e.challenger.rating}${n})`;return Fn("div.card.standard.challenge",{key:"incoming."+e.id},[ul(e.initialFen||go,"white",void 0,e.variant.key),Fn("div.infos",[Fn("div.icon-game",{"data-icon":dn(e.speed)}),Fn("div.description",[Fn("h2.title",kt("playerisInvitingYou",r)),Fn("p.variant",[Fn("span.time-indication[data-icon=p]",Ir.challengeTime(e))," • ",Fn("span.variantName",e.variant.name)," • ",Fn("span",t)])]),Fn("div.actions",[Fn("button",{oncreate:Gi((()=>{return yr(t=e.id).then((e=>{Si.set("/game"+e.url.round)})).then((()=>Ir.remove(t))).then((()=>ll()));var t}))},kt("accept")),Fn("button",{oncreate:Gi((t=>{return(n=e.id,wr(n).then((()=>{Ir.remove(n)}))).then((()=>{zi(t,(()=>ll()),".card",250)}));var n}))},kt("decline"))])])])}function ml(e){const t=e.rated?kt("rated"):kt("casual");return Fn("div.card.standard.challenge.sending",{key:"sending."+e.id},[ul(e.initialFen||go,"white",void 0,e.variant.key),Fn("div.infos",[Fn("div.icon-game",{"data-icon":dn(e.speed)}),Fn("div.description",[Fn("h2.title",e.destUser?function(e){const t=e.provisional?"?":"";return`${e.id} (${e.rating}${t})`}(e.destUser):"Open challenge"),Fn("p.variant",[Fn("span.time-indication[data-icon=p]",Ir.challengeTime(e))," • ",Fn("span.variantName",e.variant.name)," • ",Fn("span",t)])]),Fn("div.actions",[e.destUser?null:Fn("button",{oncreate:Gi((()=>{ll(),Si.set(`/game/${e.id}`)}))},kt("viewInFullSize")),Fn("button",{oncreate:Gi((t=>{return(n=e.id,br(n).then((()=>{Ir.remove(n)}))).then((()=>{zi(t,(()=>ll()),".card",250)}));var n}))},kt("cancel"))])])])}function fl(){return Zi()?Fn("div.#games_menu__dots"):null}function gl(){if(Zi()&&tl){const e=Ji()?Math.ceil(tl.innerElements.length/2):tl.innerElements.length,t=document.getElementById("games_menu__dots");if(t){const n=e-t.childElementCount;if(0!==n)for(let e=0,r=Math.abs(n);e<r;e++)if(n>0){const e=document.createElement("i");e.className="dot",t.appendChild(e)}else{const e=t.firstChild;e&&t.removeChild(e)}const r=t.childNodes;for(let e=0;e<r.length;e++){const t=r[e];e===tl.currentSlide?t.className="dot current":t.className="dot"}}}}function vl(){const e=Zr.nowPlaying(),t=Ir.incoming(),n=Ir.sending().filter(Ir.isPersistent),r=t.map((e=>pl(e))).filter(kn),i=n.map((e=>ml(e))),a=[...r,...e.map((e=>hl(e))),...i];return Fn("div.games_carousel",{oncreate:sl,onremove:cl},a)}var bl={booleanChoice:[{label:"no",value:!1},{label:"yes",value:!0}],renderRadio(e,t,n,r,i,a,o){const s=t+"_"+n;return[Fn("input.radio[type=radio]",{name:t,id:s,className:n,value:n,checked:r,onchange:i,disabled:a}),Fn("label",{for:s,className:o},"string"==typeof e?kt(e):e)]},renderSelect(e,t,n,r,i,a){const o=r();return[Fn("label",{for:"select_"+t},kt(e)),Fn("select",{id:"select_"+t,disabled:i,onchange(e){const t=e.target.value;r(t),a&&a(t),setTimeout(Xt,10)}},n.map((e=>wl(e[0],e[1],o,e[2],e[3]))))]},renderSelectOption(e,t,n,r,i,a){const o=r();return Fn("div.check_container",{className:i?"disabled":""},[Fn("label",{for:"select_"+t},kt(e)),Fn("select",{id:"select_"+t,disabled:i,onchange(e){const t=e.target.value;r(t),a&&a(t),setTimeout(Xt,10)}},n.map((e=>wl(e[0],e[1],o,e[2],e[3]))))])},renderTextEditOption(e,t,n,r,i){const a=n();return Fn("div.check_container",{className:i?"disabled":""},[Fn("label",{for:"textedit_"+t},e),Fn("button",{type:"button",disabled:i,onclick(){const t=prompt(e,a);null!==t&&t!==a&&(n(t),r(t),setTimeout(Xt,10))}},a)])},renderCheckbox(e,t,n,r,i){const a=n();return Fn("div.check_container",{className:i?"disabled":""},[Fn("label",{for:t},e),Fn("input[type=checkbox]",{id:t,name:t,disabled:i,checked:a,onchange:()=>{const e=!a;n(e),r&&r(e),Xt()}})])},renderMultipleChoiceButton(e,t,n,r=!1,i){const a=n();return Fn("div.form-multipleChoiceContainer",[Fn("label",e),Fn("div.form-multipleChoice",{className:r?"wrap":""},t.map((e=>{const t=void 0!==e.labelArg?kt(e.label,e.labelArg):kt(e.label);return Fn("div",{className:e.value===a?"selected":"",oncreate:Vi((()=>{n(e.value),i&&i(e.value)}))},t)})))])},renderSliderOption(e,t,n,r,i,a,o,s){const c=a();return Fn("div.forms-rangeSlider",{className:s?"disabled":""},[Fn("label",{for:t},e),Fn("input[type=range]",{id:t,value:c,disabled:s,min:n,max:r,step:i,oninput(e){const t=~~e.target.value;a(t),o&&o(t),setTimeout(Xt,10)}}),Fn("div.forms-sliderValue",c)])},renderSlider(e,t,n,r,i,a,o,s){const c=a();return Fn("div.forms-rangeSlider",{className:s?"disabled":""},[Fn("label",{for:t},e),Fn("input[type=range]",{id:t,value:c,disabled:s,min:n,max:r,step:i,oninput(e){const t=~~e.target.value;a(t),o&&o(t),setTimeout(Xt,10)}}),Fn("div.forms-sliderValue",c+" / "+r)])}};function wl(e,t,n,r,i){const a=r&&i?kt(e,r,i):r?kt(e,r):kt(e);return Fn("option",{key:t,value:t,selected:n===t},a)}function yl(e,t,n,r,i){if(!r)return null;const a={overlay_popup:!0,native_scroller:!0};let o;if("object"==typeof e)o=Qi(Object.assign(Object.assign({},a),e));else{if("string"!=typeof e)throw new Error("First popup argument must be either a string or an object");o=Qi(a)+" "+e}const s=Qi({popup_content:!0,noheader:!t});return Fn("div",{className:"overlay_popup_wrapper fade-in",onbeforeremove:e=>(e.dom.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)})))},Fn("div",{className:"popup_overlay_close",oncreate:i?Vi(i):ln}),Fn("div",{className:o},t?Fn("header",null,t()):null,Fn("div",{className:s},n())))}let kl=!1;const Sl=lt.gameSetup.human;let Cl=Sl.preset(),Tl=null;var Pl={open:El,close:Ol,openRealTime(e){Sl.timeMode("1"),e&&(Cl=e),El()},openCorrespondence(){Tl=Cl,Cl="custom",Sl.timeMode("2"),El()},view:()=>yl("game_form_popup",void 0,_l,kl,Ol)};function El(){Zr.hasCurrentBan()||(0===kr.length&&Sr(!1).then(Xt),Si.backbutton.stack.push(Ol),kl=!0)}function Ol(e){"backbutton"!==e&&kl&&Si.backbutton.stack.pop(),kl=!1,Tl&&(Cl=Tl,Tl=null)}function xl(e){Ol(),Na(e)||ja(e)&&1===e.timeMode?od.startSeeking(e):fr(e).then((()=>Si.set("/?tab=1"))).catch(sn)}function _l(){const e=Sl,t=t=>an((()=>{const n=t.target.value;Cl=n,e.preset(n)}));return[Fn("div.newGame-preset_switch",[Fn("div.nice-radio",bl.renderRadio(kt("quickPairing"),"preset","quick","quick"===Cl,t)),Fn("div.nice-radio",bl.renderRadio(kt("custom"),"preset","custom","custom"===Cl,t))]),"quick"===Cl?Ml((()=>{Cl="custom",Sl.preset("custom")})):Nl("human",e,e.availableVariants,e.availableTimeModes.filter((e=>"1"===e[1]||Zr.isConnected())))]}function Ml(e){return Fn("div.newGame-pools",{className:kr.length?"":"loading"},kr.length?kr.map((e=>function(e){return Fn("div.newGame-pool",{key:"pool-"+e.id,oncreate:Vi((()=>{Sl.pool(e.id),xl({id:e.id}),Ol()}))},[Fn("div.newGame-clock",e.id),Fn("div.newGame-perf",e.perf)])}(e))).concat(Fn("div.newGame-pool",{key:"pool-custom",oncreate:Vi(e)},Fn("div.newGame-custom",kt("custom")))):zn.getVdom("monochrome"))}function Nl(e,t,n,r){const i=t.timeMode(),a="1"===i,o="2"===i&&Zr.isConnected(),s=t.variant();"2"===i&&"1"!==s&&t.mode("0");const c=t.mode();Zr.isConnected()||Sl.timeMode("1"),"0"===i&&Sl.mode("0");const l=!Zr.isConnected()||"0"===i||"2"===i&&"1"!==s?[["casual","0"]]:[["casual","0"],["rated","1"]],u=_n(c,t.variant());1===u.length&&t.color(u[0][1]);const d=[Fn("div.select_input",bl.renderSelect("side",e+"color",u,t.color)),Fn("div.select_input",bl.renderSelect("variant",e+"variant",n,t.variant))];d.push(Fn("div.select_input",bl.renderSelect("mode",e+"mode",l,t.mode))),Zr.isConnected()&&d.push(Fn("div.rating_range",[Fn("div.title",kt("ratingRange")),Fn("div.select_input.inline",bl.renderSelect("Min",e+"rating_min",Sl.availableRatingRanges.min,t.ratingRangeMin,!1)),Fn("div.select_input.inline",bl.renderSelect("Max",e+"rating_max",Sl.availableRatingRanges.max,t.ratingRangeMax,!1))]));const h=[Fn("div.select_input",bl.renderSelect("clock",e+"timeMode",r,t.timeMode))];return a&&h.push(Fn("div.select_input.inline",bl.renderSelect("time",e+"time",lt.gameSetup.availableTimes,t.time,!1)),Fn("div.select_input.inline",bl.renderSelect("increment",e+"increment",lt.gameSetup.availableIncrements.map(tt),t.increment,!1))),o&&h.push(Fn("div.select_input.large_label",bl.renderSelect("daysPerTurn",e+"days",lt.gameSetup.availableDays.map(tt),t.days,!1))),Fn("form.game_form",{onsubmit(e){e.preventDefault(),lt.gameSetup.isTimeValid(t)&&(Ol(),xl(dr(t)))}},[Fn("fieldset",d),Fn("fieldset",h),Fn("div.popupActionWrapper",[Fn("button[type=submit].defaultButton",kt("createAGame"))])])}function jl(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Dl,Ll=function(){function e(){}var t=e.prototype;return t.unwrap=function(e,t){var n=this._chain((function(t){return Dl.ok(e?e(t):t)}),(function(e){return t?Dl.ok(t(e)):Dl.err(e)}));if(n.isErr)throw n.error;return n.value},t.map=function(e,t){return this._chain((function(t){return Dl.ok(e(t))}),(function(e){return Dl.err(t?t(e):e)}))},t.chain=function(e,t){return this._chain(e,t||function(e){return Dl.err(e)})},e}(),Il=function(e){function t(t){var n;return(n=e.call(this)||this).value=t,n.isOk=!0,n.isErr=!1,n}return jl(t,e),t.prototype._chain=function(e,t){return e(this.value)},t}(Ll),ql=function(e){function t(t){var n;return(n=e.call(this)||this).error=t,n.isOk=!1,n.isErr=!0,n}return jl(t,e),t.prototype._chain=function(e,t){return t(this.error)},t}(Ll);!function(e){e.ok=function(e){return new Il(e)},e.err=function(e){return new ql(e)},e.all=function(t){if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++){var i=t[r];if(i.isErr)return i;n.push(i.value)}return e.ok(n)}for(var a={},o=Object.keys(t),s=0;s<o.length;s++){var c=t[o[s]];if(c.isErr)return c;a[o[s]]=c.value}return e.ok(a)}}(Dl||(Dl={}));const Rl=["a","b","c","d","e","f","g","h"],Al=["1","2","3","4","5","6","7","8"],Bl=["white","black"],$l=["pawn","knight","bishop","rook","queen","king"],Fl=["a","h"];function Ul(e){return"role"in e}function zl(e){return e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24}function Wl(e){return(e=e>>>8&16711935|(16711935&e)<<8)>>>16&65535|(65535&e)<<16}function Hl(e){return Wl(e=(e=(e=e>>>1&1431655765|(1431655765&e)<<1)>>>2&858993459|(858993459&e)<<2)>>>4&252645135|(252645135&e)<<4)}class SquareSet{constructor(e,t){this.lo=e,this.hi=t,this.lo=0|e,this.hi=0|t}static fromSquare(e){return e>=32?new SquareSet(0,1<<e-32):new SquareSet(1<<e,0)}static fromRank(e){return new SquareSet(255,0).shl64(8*e)}static fromFile(e){return new SquareSet(16843009<<e,16843009<<e)}static empty(){return new SquareSet(0,0)}static full(){return new SquareSet(4294967295,4294967295)}static corners(){return new SquareSet(129,2164260864)}static center(){return new SquareSet(402653184,24)}static backranks(){return new SquareSet(255,4278190080)}static backrank(e){return"white"===e?new SquareSet(255,0):new SquareSet(0,4278190080)}static lightSquares(){return new SquareSet(1437226410,1437226410)}static darkSquares(){return new SquareSet(2857740885,2857740885)}complement(){return new SquareSet(~this.lo,~this.hi)}xor(e){return new SquareSet(this.lo^e.lo,this.hi^e.hi)}union(e){return new SquareSet(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new SquareSet(this.lo&e.lo,this.hi&e.hi)}diff(e){return new SquareSet(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?SquareSet.empty():e>=32?new SquareSet(this.hi>>>e-32,0):e>0?new SquareSet(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?SquareSet.empty():e>=32?new SquareSet(0,this.lo<<e-32):e>0?new SquareSet(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new SquareSet(Wl(this.hi),Wl(this.lo))}rbit64(){return new SquareSet(Hl(this.hi),Hl(this.lo))}minus64(e){const t=this.lo-e.lo,n=(t&e.lo&1)+(e.lo>>>1)+(t>>>1)>>>31;return new SquareSet(t,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return zl(this.lo)+zl(this.hi)}isEmpty(){return 0===this.lo&&0===this.hi}nonEmpty(){return 0!==this.lo||0!==this.hi}has(e){return 0!=(e>=32?this.hi&1<<e-32:this.lo&1<<e)}set(e,t){return t?this.with(e):this.without(e)}with(e){return e>=32?new SquareSet(this.lo,this.hi|1<<e-32):new SquareSet(this.lo|1<<e,this.hi)}without(e){return e>=32?new SquareSet(this.lo,this.hi&~(1<<e-32)):new SquareSet(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new SquareSet(this.lo,this.hi^1<<e-32):new SquareSet(this.lo^1<<e,this.hi)}last(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}first(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}withoutFirst(){return 0!==this.lo?new SquareSet(this.lo&this.lo-1,this.hi):new SquareSet(0,this.hi&this.hi-1)}moreThanOne(){return 0!==this.hi&&0!==this.lo||!!(this.lo&this.lo-1)||!!(this.hi&this.hi-1)}singleSquare(){return this.moreThanOne()?void 0:this.last()}isSingleSquare(){return this.nonEmpty()&&!this.moreThanOne()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;0!==e;){const t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;0!==t;){const e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;0!==t;){const e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;0!==e;){const t=31-Math.clz32(e);e^=1<<t,yield t}}}class Board{constructor(){}static default(){const e=new Board;return e.reset(),e}static racingKings(){const e=new Board;return e.occupied=new SquareSet(65535,0),e.promoted=SquareSet.empty(),e.white=new SquareSet(61680,0),e.black=new SquareSet(3855,0),e.pawn=SquareSet.empty(),e.knight=new SquareSet(6168,0),e.bishop=new SquareSet(9252,0),e.rook=new SquareSet(16962,0),e.queen=new SquareSet(129,0),e.king=new SquareSet(33024,0),e}static horde(){const e=new Board;return e.occupied=new SquareSet(4294967295,4294901862),e.promoted=SquareSet.empty(),e.white=new SquareSet(4294967295,102),e.black=new SquareSet(0,4294901760),e.pawn=new SquareSet(4294967295,16711782),e.knight=new SquareSet(0,1107296256),e.bishop=new SquareSet(0,603979776),e.rook=new SquareSet(0,2164260864),e.queen=new SquareSet(0,134217728),e.king=new SquareSet(0,268435456),e}reset(){this.occupied=new SquareSet(65535,4294901760),this.promoted=SquareSet.empty(),this.white=new SquareSet(65535,0),this.black=new SquareSet(0,4294901760),this.pawn=new SquareSet(65280,16711680),this.knight=new SquareSet(66,1107296256),this.bishop=new SquareSet(36,603979776),this.rook=new SquareSet(129,2164260864),this.queen=new SquareSet(8,134217728),this.king=new SquareSet(16,268435456)}static empty(){const e=new Board;return e.clear(),e}clear(){this.occupied=SquareSet.empty(),this.promoted=SquareSet.empty();for(const e of Bl)this[e]=SquareSet.empty();for(const e of $l)this[e]=SquareSet.empty()}clone(){const e=new Board;e.occupied=this.occupied,e.promoted=this.promoted;for(const t of Bl)e[t]=this[t];for(const t of $l)e[t]=this[t];return e}equalsIgnorePromoted(e){return!!this.white.equals(e.white)&&$l.every((t=>this[t].equals(e[t])))}equals(e){return this.equalsIgnorePromoted(e)&&this.promoted.equals(e.promoted)}getColor(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}getRole(e){for(const t of $l)if(this[t].has(e))return t}get(e){const t=this.getColor(e);if(!t)return;return{color:t,role:this.getRole(e),promoted:this.promoted.has(e)}}take(e){const t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}set(e,t){const n=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,t){return this[e].intersect(this[t])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.king.intersect(this[e]).diff(this.promoted).singleSquare()}}class MaterialSide{constructor(){}static empty(){const e=new MaterialSide;for(const t of $l)e[t]=0;return e}static fromBoard(e,t){const n=new MaterialSide;for(const r of $l)n[r]=e.pieces(t,r).size();return n}clone(){const e=new MaterialSide;for(const t of $l)e[t]=this[t];return e}equals(e){return $l.every((t=>this[t]===e[t]))}add(e){const t=new MaterialSide;for(const n of $l)t[n]=this[n]+e[n];return t}nonEmpty(){return $l.some((e=>this[e]>0))}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}count(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class Material{constructor(e,t){this.white=e,this.black=t}static empty(){return new Material(MaterialSide.empty(),MaterialSide.empty())}static fromBoard(e){return new Material(MaterialSide.fromBoard(e,"white"),MaterialSide.fromBoard(e,"black"))}clone(){return new Material(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new Material(this.white.add(e.white),this.black.add(e.black))}count(){return this.white.count()+this.black.count()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class RemainingChecks{constructor(e,t){this.white=e,this.black=t}static default(){return new RemainingChecks(3,3)}clone(){return new RemainingChecks(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}function Vl(e){return void 0!==e}function Gl(e){return"white"===e?"black":"white"}function Kl(e){return e>>3}function Yl(e){return 7&e}function Xl(e){switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}}function Ql(e){switch(e){case"P":case"p":return"pawn";case"N":case"n":return"knight";case"B":case"b":return"bishop";case"R":case"r":return"rook";case"Q":case"q":return"queen";case"K":case"k":return"king";default:return}}function Jl(e){if(2!==e.length)return;const t=e.charCodeAt(0)-"a".charCodeAt(0),n=e.charCodeAt(1)-"1".charCodeAt(0);return t<0||t>=8||n<0||n>=8?void 0:t+8*n}function Zl(e){return Rl[Yl(e)]+Al[Kl(e)]}function eu(e){if("@"===e[1]&&4===e.length){const t=Ql(e[0]),n=Jl(e.slice(2));if(t&&Vl(n))return{role:t,to:n}}else if(4===e.length||5===e.length){const t=Jl(e.slice(0,2)),n=Jl(e.slice(2,4));let r;if(5===e.length&&(r=Ql(e[4]),!r))return;if(Vl(t)&&Vl(n))return{from:t,to:n,promotion:r}}}function tu(e,t){return"white"===e?"a"===t?2:6:"a"===t?58:62}const nu="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",ru="8/8/8/8/8/8/8/8 w - - 0 1";var iu;!function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"}(iu||(iu={}));class FenError extends Error{}function au(e){return/^\d{1,4}$/.test(e)?parseInt(e,10):void 0}function ou(e){const t=Ql(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}}function su(e){const t=Board.empty();let n=7,r=0;for(let i=0;i<e.length;i++){const a=e[i];if("/"===a&&8===r)r=0,n--;else{const o=parseInt(a,10);if(o>0)r+=o;else{if(r>=8||n<0)return Dl.err(new FenError(iu.Board));const o=r+8*n,s=ou(a);if(!s)return Dl.err(new FenError(iu.Board));"~"===e[i+1]&&(s.promoted=!0,i++),t.set(o,s),r++}}}return 0!==n||8!==r?Dl.err(new FenError(iu.Board)):Dl.ok(t)}function cu(e){if(e.length>64)return Dl.err(new FenError(iu.Pockets));const t=Material.empty();for(const n of e){const e=ou(n);if(!e)return Dl.err(new FenError(iu.Pockets));t[e.color][e.role]++}return Dl.ok(t)}function lu(e,t){let n=SquareSet.empty();if("-"===t)return Dl.ok(n);if(!/^[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2}$/.test(t))return Dl.err(new FenError(iu.Castling));for(const r of t){const t=r.toLowerCase(),i=r===t?"black":"white",a=SquareSet.backrank(i).intersect(e[i]);let o;o="q"===t?a:"k"===t?a.reversed():SquareSet.fromSquare(t.charCodeAt(0)-"a".charCodeAt(0)).intersect(a);for(const t of o){if(e.king.has(t)&&!e.promoted.has(t))break;if(e.rook.has(t)){n=n.with(t);break}}}return Dl.ok(n)}function uu(e){const t=e.split("+");if(3===t.length&&""===t[0]){const e=au(t[1]),n=au(t[2]);return!Vl(e)||e>3||!Vl(n)||n>3?Dl.err(new FenError(iu.RemainingChecks)):Dl.ok(new RemainingChecks(3-e,3-n))}if(2===t.length){const e=au(t[0]),n=au(t[1]);return!Vl(e)||e>3||!Vl(n)||n>3?Dl.err(new FenError(iu.RemainingChecks)):Dl.ok(new RemainingChecks(e,n))}return Dl.err(new FenError(iu.RemainingChecks))}function du(e){const t=e.split(" "),n=t.shift();let r,i,a=Dl.ok(void 0);if(n.endsWith("]")){const e=n.indexOf("[");if(-1===e)return Dl.err(new FenError(iu.Fen));r=su(n.substr(0,e)),a=cu(n.substr(e+1,n.length-1-e-1))}else{const e=function(e,t,n){let r=e.indexOf(t);for(;n-- >0&&-1!==r;)r=e.indexOf(t,r+t.length);return r}(n,"/",7);-1===e?r=su(n):(r=su(n.substr(0,e)),a=cu(n.substr(e+1)))}const o=t.shift();if(Vl(o)&&"w"!==o){if("b"!==o)return Dl.err(new FenError(iu.Turn));i="black"}else i="white";return r.chain((e=>{const n=t.shift(),r=Vl(n)?lu(e,n):Dl.ok(SquareSet.empty()),o=t.shift();let s;if(Vl(o)&&"-"!==o&&(s=Jl(o),!Vl(s)))return Dl.err(new FenError(iu.EpSquare));let c,l=t.shift();Vl(l)&&l.includes("+")&&(c=uu(l),l=t.shift());const u=Vl(l)?au(l):0;if(!Vl(u))return Dl.err(new FenError(iu.Halfmoves));const d=t.shift(),h=Vl(d)?au(d):1;if(!Vl(h))return Dl.err(new FenError(iu.Fullmoves));const p=t.shift();let m=Dl.ok(void 0);if(Vl(p)){if(Vl(c))return Dl.err(new FenError(iu.RemainingChecks));m=uu(p)}else Vl(c)&&(m=c);return t.length>0?Dl.err(new FenError(iu.Fen)):a.chain((t=>r.chain((n=>m.map((r=>({board:e,pockets:t,turn:i,unmovedRooks:n,remainingChecks:r,epSquare:s,halfmoves:u,fullmoves:Math.max(1,h)})))))))}))}function hu(e,t){let n=Xl(e.role);return"white"===e.color&&(n=n.toUpperCase()),(null==t?void 0:t.promoted)&&e.promoted&&(n+="~"),n}function pu(e,t){let n="",r=0;for(let i=7;i>=0;i--)for(let a=0;a<8;a++){const o=a+8*i,s=e.get(o);s?(r>0&&(n+=r,r=0),n+=hu(s,t)):r++,7===a&&(r>0&&(n+=r,r=0),0!==i&&(n+="/"))}return n}function mu(e){return $l.map((t=>Xl(t).repeat(e[t]))).join("")}function fu(e,t,n){const r=null==n?void 0:n.shredder;let i="";for(const n of Bl){const a=SquareSet.backrank(n),o=e.kingOf(n);if(!Vl(o)||!a.has(o))continue;const s=e.pieces(n,"rook").intersect(a);for(const e of t.intersect(s).reversed())if(!r&&e===s.first()&&e<o)i+="white"===n?"Q":"q";else if(!r&&e===s.last()&&o<e)i+="white"===n?"K":"k";else{const t=Rl[Yl(e)];i+="white"===n?t.toUpperCase():t}}return i||"-"}function gu(e,t){return[pu(e.board,t)+(e.pockets?`[${r=e.pockets,mu(r.white).toUpperCase()+mu(r.black)}]`:""),e.turn[0],fu(e.board,e.unmovedRooks,t),Vl(e.epSquare)?Zl(e.epSquare):"-",...e.remainingChecks?[(n=e.remainingChecks,`${n.white}+${n.black}`)]:[],...(null==t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))]].join(" ");var n,r}let vu,bu,wu="";const yu=En(!1);function ku(e){e?(vu=e,wu=kt("challengeToPlay")):(vu=void 0,wu=kt("playWithAFriend")),Si.backbutton.stack.push(Su),yu(!0),bu=void 0}function Su(e){"backbutton"!==e&&yu()&&Si.backbutton.stack.pop(),yu(!1)}function Cu(){return function(e,t){const n=lt.gameSetup.challenge,r=e?`/setup/friend?user=${e}`:"/setup/friend",i={variant:n.variant(),timeMode:n.timeMode(),days:n.days(),time:n.time(),increment:n.increment(),color:n.color(),mode:Zr.isConnected()?n.mode():"0"};return t&&(i.fen=t),Xn(r,{method:"POST",body:JSON.stringify(i)},!0)}(vu,bu).then((e=>{e.challenge.destUser&&Ir.isPersistent(e.challenge)?rl.open(Zr.nowPlaying().length+Ir.all().length):Si.set(`/game/${e.challenge.id}`)})).catch(sn)}function Tu(){const e="invite",t=lt.gameSetup.challenge,n=lt.gameSetup.challenge.availableVariants,r=lt.gameSetup.challenge.availableTimeModes,i=t.timeMode(),a="1"===i,o="2"===i,s=_n(t.mode(),t.variant());1===s.length&&t.color(s[0][1]);const c=Zr.isConnected()?[["casual","0"],["rated","1"]]:[["casual","0"]],l=[Fn("div.select_input",bl.renderSelect("side",e+"color",s,t.color)),Fn("div.select_input",bl.renderSelect("variant",e+"variant",n,t.variant)),"3"===t.variant()?Fn("div.setupPosition",[Fn("div.setupPositionInput",[Fn("input[type=text][name=fen]",{placeholder:kt("pasteTheFenStringHere"),oninput:e=>{const t=e.target.value;bu=""===t?void 0:du(t).unwrap((e=>gu(e)),(()=>!1)),Xt()}}),Fn("button.withIcon",{oncreate:Vi((()=>{Su(),Si.set("/editor")}))},Fn("span.fa.fa-pencil"))]),!1===bu?Fn("div.setupFenError","Invalid FEN"):null,void 0!==bu&&!1!==bu?[Fn("div",{style:{width:"100px",height:"100px"},oncreate:Vi((()=>{Su(),bu&&Si.set(`/editor/${encodeURIComponent(bu)}`)}))},[Fn(Zc,{fen:bu,orientation:"white"})])]:null]):null,"3"!==t.variant()?Fn("div.select_input",bl.renderSelect("mode",e+"mode",c,t.mode)):null],u=[Fn("div.select_input",bl.renderSelect("clock",e+"timeMode",r,t.timeMode))];return a&&u.push(Fn("div.select_input.inline",bl.renderSelect("time",e+"time",lt.gameSetup.availableTimes,t.time,!1)),Fn("div.select_input.inline",bl.renderSelect("increment",e+"increment",lt.gameSetup.availableIncrements.map(tt),t.increment,!1))),o&&u.push(Fn("div.select_input.large_label",bl.renderSelect("daysPerTurn",e+"days",lt.gameSetup.availableDays.map(tt),t.days,!1))),Fn("form#invite_form.game_form",{onsubmit(e){e.preventDefault(),lt.gameSetup.isTimeValid(t)&&(Su(),Cu())}},[Fn("fieldset",l),Fn("fieldset#clock",u),Fn("div.popupActionWrapper",[Fn("button[type=submit].defaultButton",wu)])])}var Pu={view:()=>yl("invite_form_popup game_form_popup",void 0,Tu,yu(),Su),open:ku,openFromPosition(e){ku(),bu=e,lt.gameSetup.challenge.variant("3"),lt.gameSetup.challenge.mode("0")}};let Eu=!1;var Ou={open:function(){Si.backbutton.stack.push(xu),Eu=!0},close:xu,view:()=>yl({onlineFriends:!0,native_scroller:!1},(function(){return[Fn("span",Ct("nbFriendsOnline",er.count()))]}),_u,Eu,xu)};function xu(e){"backbutton"!==e&&Eu&&Si.backbutton.stack.pop(),Eu=!1}function _u(){const e=er.list();return e.length?Fn("ul",null,e.map(Mu)):Fn("div",{className:"native_scroller nofriend"})}function Mu(e){const t=e.name.toLowerCase(),n="BOT"===e.title;return Fn("li",{className:"list_item",key:t,oncreate:Ki((function(){xu(),Si.set("/@/"+t)}))},Fn("div",{className:"friend_name"},e.patron?Fn("span",{className:"patron is-green","data-icon":""}):null,Fn("span",null,e.title?Fn("span",{className:"userTitle"+(n?" bot":"")},e.title," "):null,e.name)),Fn("div",{className:"onlineFriends_actions"},e.playing?Fn("span",{className:"friend_tv","data-icon":"1",oncreate:Ki((function(e){e.stopPropagation(),xu(),Si.set("/@/"+t+"/tv")}))}," "):null,Fn("span",{"data-icon":"U",oncreate:Ki((e=>{e.stopPropagation(),xu(),Pu.open(t)}))}),Fn("span",{"data-icon":"c",oncreate:Ki((e=>{e.stopPropagation(),xu(),Si.set(`/inbox/new/${t}`)}))})))}const Nu=Fn("div",{className:"svg_icon"},Fn("div",{className:"svg_icon_inner"},Fn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Fn("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})))),ju=Fn("div",{className:"svg_icon"},Fn("div",{className:"svg_icon_inner"},Fn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Fn("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),Du=Fn("div",{className:"svg_icon"},Fn("div",{className:"svg_icon_inner"},Fn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Fn("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})))),Lu=Fn("div",{className:"svg_icon"},Fn("div",{className:"svg_icon_inner"},Fn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Fn("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))));function Iu(){return Fn("button.fa.fa-navicon.main_header_button.menu_button",{oncreate:Vi(no.toggle)})}function qu(e){return Fn("div.back_button",[Fn("button",{oncreate:Vi(Si.backHistory)},Nu),void 0!==e?"string"==typeof e?Fn("div.main_header_title",e):e:null])}function Ru(e,t){return Zr.isConnected()?Fn("button.main_header_button.bookmarkButton",{oncreate:Vi(e,(()=>z.show({text:kt("bookmarkThisGame"),duration:"short",position:"top"})))},Fn("span",{"data-icon":t?"t":"s"})):null}function Au(){if(!lt.general.bluetooth.useDevice())return null;const e=Qc.isConnected(),t=Qc.batteryLevel(),n=()=>{"/settings/bluetooth"!==Si.get()&&Si.set("/settings/bluetooth")},r=[Fn("button.main_header_button.fa."+(e?"fa-bluetooth":"fa-bluetooth-b"),{oncreate:Vi(n),disabled:!e})];if(e&&void 0!==t){let e="fa-battery-full";t<=5?e="fa-battery-empty":t<=35?e="fa-battery-quarter":t<=65?e="fa-battery-half":t<=95&&(e="fa-battery-three-quarters"),r.unshift(Fn(`button.main_header_button.fa.${e}`,{oncreate:Vi(n)}))}return r}let Bu;function $u(e){Bu=e}function Fu(){Bu=Bu||lt.general.theme.board();const e=Zr.myTurnGames().length,t=Ir.incoming().length,n=["main_header_button","game_menu_button",Bu,t?"new_challenge":""].join(" ");return Fn("button",{className:n,"data-button":"games"},!t&&e?Fn("span",{className:"chip nb_playing"},e):null,t?Fn("span",{className:"chip nb_challenges"},t):null)}function Uu(e){const t=la(e,".main_header_button"),n=null==t?void 0:t.dataset.button;if(t&&n)if("games"===n){const e=Ir.all().length;Zr.nowPlaying().length||e?rl.open():Pl.open()}else"friends"===n&&Ou.open()}function zu(){const e=Vi(Uu,void 0,void 0,ua(".main_header_button"));return Zr.isConnected()&&er.count()?Fn("div",{className:"buttons",oncreate:e},Au(),function(){const e=er.count();return Fn("button",{className:"main_header_button friends_button","data-icon":"f","data-button":"friends"},e>0?Fn("span",{className:"chip nb_friends"},e):null)}(),Fu()):Fn("div",{className:"buttons",oncreate:e},Au(),Fu())}function Wu(e,t){return Fn("nav",[t||Iu(),"string"==typeof e?Fn("div.main_header_title",e):e,zu()])}function Hu(e,t){return[Fn("nav",[t||Iu(),e?Fn("div",{className:"main_header_title"},e):null,zu()])]}const Vu=Fn("div",{className:"loader_circles"},[1,2,3].map((e=>Fn("div",{className:"circle_"+e}))));function Gu(e){return Fn("nav",null,Iu(),Fn("div",{className:"main_header_title reconnecting"+(e?"withTitle":"")},e?Fn("span",null,e):null,Vu),zu())}function Ku(e){return[Fn("nav",[Iu(),Fn("div.main_header_title.reconnecting",{className:e?"withTitle":""}),e?Fn("div.main_header_title",e):null,zu()])]}function Yu(e){return Fn("nav",[qu(Fn("div.main_header_title.reconnecting",{className:e?"withTitle":""},[e?Fn("span",e):null,Vu])),zu()])}function Xu(e){const t=e.online?"online":"offline";return Fn("div",{className:"user"},e.patron?Fn("span",{className:"patron userStatus "+t,"data-icon":""}):Fn("span",{className:"fa fa-circle userStatus "+t}),e.title?Fn("span",{className:"userTitle"},e.title," "):null,e.username)}const Qu="setup.custom.last";let Ju,Zu,ed=0,td=0,nd=!1,rd=null,id=null;const ad={redirect:e=>{ud(),null!==rd&&(Na(rd)?md(rd):jn.set(Qu,rd)),Ma.redirectToGame(e)},n:(e,t)=>{ed=t.d,td=t.r,Xt()}};var od={startSeeking(e){ld(e)},appCancelSeeking(){nd&&pd()},onNewOpponent(e){if("pool"===e.game.source){const t=e.clock;ld({id:t.initial/60+"+"+t.increment})}else{ld(rd&&ja(rd)?rd:jn.get(Qu)||dr(lt.gameSetup.human),e.game.id)}},view:()=>yl("",void 0,(function(){const e=Ct("nbPlayers",ed,ed?void 0:"?"),t=Ct("nbGames",td,td?void 0:"?");return Fn("div.lobby-waitingPopup",null===rd?"Something went wrong. Please try again":[Fn("div.lobby-waitingForOpponent",kt("waitingForOpponent")),Fn("br"),Na(rd)?cd(rd):sd(rd),Fn("br"),zn.getVdom(),Fn("div.lobby-nbPlayers",Ma.isConnected()?[Fn("div",Fn.trust(e.replace(/(\d+)/,"<strong>$1</strong>"))),Fn("div",Fn.trust(t.replace(/(\d+)/,"<strong>$1</strong>")))]:Fn("div",[kt("reconnecting"),Vu])),Fn("button[data-icon=L]",{oncreate:Vi((()=>dd()))},kt("cancel"))])}),nd)};function sd(e){const t=lt.gameSetup.human.availableVariants.find((t=>t[1]===String(e.variant))),n=t&&t[0]||"Standard",r=e.timeMode,i=0===e.mode?kt("casual"):kt("rated"),a=e.time;let o;o=1===r?function(e){return"0.75"===e?"¾":"0.5"===e?"½":"0.25"===e?"¼":e}(String(a))+"+"+e.increment:2===r?Ct("nbDays",e.days):"∞";const s=` • ${n} • ${i}`;return Fn("div.gameInfos",[Fn("span[data-icon=p]",o),s])}function cd(e){const t=` • Standard • ${Zr.isConnected()?kt("rated"):kt("casual")}`;return Fn("div.gameInfos",[Fn("span[data-icon=p]",e.id),t])}function ld(e,t){var n;Si.backbutton.stack.push(dd),nd=!0,ga(),Na(e)?(rd=n=e,Zu=Ma.createLobby(ya,(()=>{nd&&Zr.refresh().then((()=>{if(Zr.isConnected())gd("poolIn",n),clearInterval(Ju),Ju=setInterval((()=>{gd("poolIn",n)}),1e4);else{const e=kr.find((e=>e.id===n.id));e&&hd({mode:0,variant:1,timeMode:1,time:e.lim,increment:e.inc,days:1,color:"random"})}}))}),ad)):Zr.refresh().then((()=>hd(e,t)))}function ud(e){"backbutton"!==e&&nd&&Si.backbutton.stack.pop(),nd=!1}function dd(e){ud(e),pd(),Si.reload(),va()}function hd(e,t){rd=e,id&&fd(),Zu=Ma.createLobby(ya,(()=>{nd&&(id||(t?function(e,t){const n=Zr.get(),r=n?hr(n,t):null;Xn(`/setup/hook/${Zt()}/like/${e}?rr=${r||""}`,{method:"POST"},!0)}(t,e):fr(e).then((e=>{id=e.hook.id})).catch(sn)))}),ad)}function pd(){null!==rd&&(Na(rd)?md(rd):id&&fd())}function md(e){clearInterval(Ju),gd("poolOut",e.id)}function fd(){gd("cancel",id),id=null}function gd(e,t){Zu&&Zu.send(e,t)}const vd=r("Badge");let bd=!0;function wd(e,t,r,i,a,o){window.lichess.cpuArch=o,window.deviceInfo={platform:t.platform,osVersion:t.osVersion,uuid:r.identifier,appVersion:e.version,cpuCores:i,stockfishMaxMemory:16*Math.ceil(a/16)},"ios"===n.getPlatform()&&p.setAccessoryBarVisible({isVisible:!0}),Pn((()=>{qi(),or.load()})),s.addListener("appStateChange",(e=>{e.isActive?(or.resume(),rr=!0,Zr.refresh().then((()=>{"ios"===n.getPlatform()&&vd.setNumber({badge:Zr.myTurnGames().length})})),Ma.cancelDelayedDisconnect(),Ma.connect(),Xt()):(rr=!1,Ma.delayedDisconnect(18e4),od.appCancelSeeking())})),u.addListener("networkStatusChange",(e=>{e.connected?kd():ir()&&!on()&&(Ma.disconnect(),Xt())})),s.addListener("backButton",Si.backbutton),window.addEventListener("resize",U(yd),!1),on()?kd():Zr.restoreStoredSession()}function yd(){_i=null,xi=void 0,Xt()}function kd(){ir()&&(bd?(bd=!1,function(){const e=window.deviceInfo.appVersion||"web-dev";Xn("/api/status",{query:{v:e}}).then((t=>{if(t.mustUpgrade){const t="warn_bug_"+e,n=Number(jn.get(t))||0;0===n?ur.alert({title:"Alert",message:"A new version of lichess mobile is available. Please upgrade as soon as possible."}).then((()=>{jn.set(t,1)})):10===n?jn.remove(t):jn.set(t,n+1)}else if(t.api.current>$t.apiVersion){const e=t.api.olds.find((e=>e.version===$t.apiVersion));if(e){const t=new Date,n=new Date(e.unsupportedAt),r=new Date(e.deprecatedAt),i="warn_old_"+e.version,a=Number(jn.get(i))||0;t>n?ur.alert({title:"Alert",message:kt("apiUnsupported")}):t>r&&(0===a?ur.alert({title:"Alert",message:kt("apiDeprecated",Et(n))}).then((()=>{jn.set(i,1)})):15===a?jn.remove(i):jn.set(i,a+1))}}}))}(),Cd(),Zr.rememberLogin().then((()=>{Jn.register(),Ir.refresh(),"ios"===n.getPlatform()&&vd.setNumber({badge:Zr.myTurnGames().length}),Xt()})).catch((()=>{"ios"===n.getPlatform()&&vd.setNumber({badge:0})}))):(Ma.connect(),Zr.refresh()))}let Sd=1;function Cd(){return Sr().then(Xt).catch((()=>{Sd<=5&&(Sd++,setTimeout(Cd,1e3*Sd))}))}const Td=r("Stockfish"),Pd=r("StockfishVariants",{web:()=>import("./StockfishVariantsWeb-44af0c77.js").then((e=>new e.StockfishVariantsWeb))});class StockfishPlugin{constructor(e){this.variant=e,this.plugin=!this.isVariant()&&xd()&&lt.analyse.cevalUseNNUE()?Td:Pd}async start(){return new Promise((e=>{let t="Stockfish";const n=r=>{const i=r.output;i.startsWith("id name ")&&(t=i.substring(8)),i.startsWith("uciok")&&(window.removeEventListener("stockfish",n,!1),e({engineName:t}))};window.addEventListener("stockfish",n,{passive:!0}),this.plugin.start().then((()=>this.send("uci")))}))}isReady(){return new Promise((e=>{const t=n=>{n.output.startsWith("readyok")&&(window.removeEventListener("stockfish",t,!1),e())};window.addEventListener("stockfish",t,{passive:!0}),this.send("isready")}))}send(e){return this.plugin.cmd({cmd:e})}setOption(e,t){return this.send(`setoption name ${e} value ${t}`)}setVariant(){return this.isVariant()?"web"!==n.getPlatform()&&"threeCheck"===this.variant?this.setOption("UCI_Variant","3check"):"web"===n.getPlatform()&&"antichess"===this.variant?this.setOption("UCI_Variant","giveaway"):this.setOption("UCI_Variant",this.variant.toLowerCase()):this.setOption("UCI_Chess960","chess960"===this.variant)}exit(){return this.plugin.exit()}isVariant(){return!("standard"===this.variant||"fromPosition"===this.variant||"chess960"===this.variant)}}async function Ed(){return Promise.resolve(window.deviceInfo.stockfishMaxMemory)}function Od(){const e=window.deviceInfo.cpuCores;return e>2?e-1:1}function xd(){return"android"===n.getPlatform()?"arm64-v8a"===window.lichess.cpuArch:"ios"===n.getPlatform()}var _d,Md;!function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE",e.ExternalCache="EXTERNAL_CACHE",e.LibraryNoCloud="LIBRARY_NO_CLOUD",e.Temporary="TEMPORARY"}(_d||(_d={})),function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"}(Md||(Md={}));const Nd=r("Filesystem",{web:()=>import("./web-a2167838.js").then((e=>new e.FilesystemWeb))});var jd,Dd;!function(e=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||e?void 0!==window.cordova&&function(e){e.CapacitorUtils.Synapse=new Proxy({},{get:(t,n)=>e.cordova.plugins[n]})}(window):function(e){e.CapacitorUtils.Synapse=new Proxy({},{get:(t,n)=>new Proxy({},{get:(t,r)=>(t,i,a)=>{const o=e.Capacitor.Plugins[n];void 0!==o?"function"==typeof o[r]?(async()=>{try{const e=await o[r](t);i(e)}catch(e){a(e)}})():a(new Error(`Method ${r} not found in Capacitor plugin ${n}`)):a(new Error(`Capacitor plugin ${n} not found`))}})})}(window))}(),function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(jd||(jd={})),function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"}(Dd||(Dd={}));const Ld=r("StatusBar"),Id="https://veloce.github.io/lichobile-themes";let qd,Rd;function Ad(e){return"dark"!==e&&"light"!==e&&"system"!==e}function Bd(e,t){return Nd.readFile({path:e+"-"+t,directory:_d.Data})}function $d(e){return Nd.readdir({path:"",directory:_d.Data}).then((({files:t})=>t.map((e=>e.name)).filter((t=>t.startsWith(e)))))}function Fd(e){return e.key+"."+e.ext}function Ud(e,t,n){const r=Hd(e,t);return Bd(e,r).catch((()=>function(e,t,n){return new Promise(((r,i)=>{const a=new XMLHttpRequest,o="bg"===e?"/background":"/board";a.open("GET",`${Id}${o}/${t}`,!0),a.responseType="blob",n&&(a.onprogress=n),a.onload=()=>{if(200===a.status){const n=a.response;if(n){const i=new FileReader;i.readAsDataURL(n),i.onloadend=()=>{const n=i.result;Nd.writeFile({path:e+"-"+t,data:n,directory:_d.Data}).then((()=>r()))}}else i("could not get file")}else i(`Request returned ${a.status}`)},a.send()}))}(e,r,n).then((()=>Bd(e,r))))).then((n=>{Wd(e,t,r,n)}))}function zd(e){z.show({text:"Cannot load theme file",duration:"short"})}function Wd(e,t,n,{data:r}){qd||(qd=document.createElement("style"),qd.type="text/css",document.head.appendChild(qd));const i=r,a=("png"===n.split(".").pop()?"data:image/png;base64,":"data:image/jpeg;base64,")+i,o="bg"===e?`.view-container.transp.${t} > main { background-image: url(${a}); }`:`:root { --board-background: url(${a}); }\n.board-${t} > .cg-board { background-image: var(--board-background); }\n.game_menu_button.${t}::before { background-image: var(--board-background); background-size: 40px; }`;qd.appendChild(document.createTextNode(o))}function Hd(e,t){return Fd(("bg"===e?lt.general.theme.availableBackgroundThemes:lt.general.theme.availableBoardThemes).find((e=>e.key===t)))}function Vd(){if(void 0===Rd){const e=window.matchMedia("(prefers-color-scheme: light)");Rd=e.matches?"light":"dark",e.addEventListener("change",(e=>{Rd=e.matches?"light":"dark"}))}return Rd}function Gd(e){const t="system"===e?Vd():e;return Promise.all(["android"===n.getPlatform()?Ld.setBackgroundColor({color:"light"===t?"#edebe9":"dark"===t?"#161512":"#000000"}):Promise.resolve(),Ld.setStyle({style:"light"===t?jd.Light:jd.Dark})]).then((()=>{}))}var Kd={init(){!function(e){e(ci)}((e=>{e.add("",(({params:e})=>{import("./home-79ce11fc.js").then((t=>{pi(t.default,e)}))})),e.add("timeline",(({params:e})=>{import("./timeline-d73f4077.js").then((t=>{pi(t.default,e)}))})),e.add("otb",(({params:e})=>{import("./otb-3d138d67.js").then((t=>{pi(t.default,e)}))})),e.add("otb/variant/:variant/fen/:fen",(({params:e})=>{import("./otb-3d138d67.js").then((t=>{pi(t.default,e)}))})),e.add("ai",(({params:e})=>{import("./ai-7fbdfca0.js").then((t=>{pi(t.default,e)}))})),e.add("ai/variant/:variant/fen/:fen/color/:color",(({params:e})=>{import("./ai-7fbdfca0.js").then((t=>{pi(t.default,e)}))})),e.add("game/:id",(({params:e})=>{import("./game-b2dabd35.js").then((t=>{pi(t.default,e)}))})),e.add("tournament/:tournamentId/game/:id",(({params:e})=>{import("./game-b2dabd35.js").then((t=>{pi(t.default,e)}))})),e.add("analyse/:source/:id/:color",(({params:e})=>{import("./analyse-1450df1f.js").then((t=>{pi(t.default,e)}))})),e.add("analyse/:source/:id",(({params:e})=>{import("./analyse-1450df1f.js").then((t=>{pi(t.default,e)}))})),e.add("analyse/fen/:fen",(({params:e})=>{import("./analyse-1450df1f.js").then((t=>{pi(t.default,e)}))})),e.add("analyse/variant/:variant",(({params:e})=>{import("./analyse-1450df1f.js").then((t=>{pi(t.default,e)}))})),e.add("analyse/variant/:variant/fen/:fen",(({params:e})=>{import("./analyse-1450df1f.js").then((t=>{pi(t.default,e)}))})),e.add("analyse",(({params:e})=>{import("./analyse-1450df1f.js").then((t=>{pi(t.default,e)}))})),e.add("importer",(({params:e})=>{import("./importer-f4dfffa3.js").then((t=>{pi(t.default,e)}))})),e.add("tv",(({params:e})=>{import("./tv-48844d40.js").then((t=>{pi(t.default,e)}))})),e.add("tv/:channel",(({params:e})=>{import("./tv-48844d40.js").then((t=>{pi(t.default,e)}))})),e.add("@/:id",(({params:e})=>{import("./user-b283e757.js").then((t=>{pi(t.default,e)}))})),e.add("@/:id/related",(({params:e})=>{import("./related-c744dc6a.js").then((t=>{pi(t.default,e)}))})),e.add("@/:id/games",(({params:e})=>{import("./games-1465c0a2.js").then((t=>{pi(t.default,e)}))})),e.add("@/:id/games/:filter",(({params:e})=>{import("./games-1465c0a2.js").then((t=>{pi(t.default,e)}))})),e.add("@/:id/:perf/perf",(({params:e})=>{import("./perfStats-d2eebe35.js").then((t=>{pi(t.default,e)}))})),e.add("@/:id/tv",(({params:e})=>{import("./userTv-1aea6c53.js").then((t=>{pi(t.default,e)}))})),e.add("about",(({params:e})=>{import("./about-d688a291.js").then((t=>{pi(t.default,e)}))})),e.add("account/preferences",(({params:e})=>{import("./preferences-1bd99610.js").then((t=>{pi(t.default,e)}))})),e.add("account/preferences/game-display",(({params:e})=>{import("./gameDisplay-747ff119.js").then((t=>{pi(t.default,e)}))})),e.add("account/preferences/game-behavior",(({params:e})=>{import("./gameBehavior-b5321cca.js").then((t=>{pi(t.default,e)}))})),e.add("account/preferences/clock",(({params:e})=>{import("./clock-6b90baa1.js").then((t=>{pi(t.default,e)}))})),e.add("account/preferences/privacy",(({params:e})=>{import("./privacy-48c62658.js").then((t=>{pi(t.default,e)}))})),e.add("account/preferences/kidMode",(({params:e})=>{import("./kid-c6fedd51.js").then((t=>{pi(t.default,e)}))})),e.add("clock",(({params:e})=>{import("./clock-5e68d4e7.js").then((t=>{pi(t.default,e)}))})),e.add("editor",(({params:e})=>{import("./editor-d72fabbc.js").then((t=>{pi(t.default,e)}))})),e.add("editor/:fen",(({params:e})=>{import("./editor-d72fabbc.js").then((t=>{pi(t.default,e)}))})),e.add("inbox",(({params:e})=>{import("./msg-e42b200d.js").then((t=>{pi(t.default,e)}))})),e.add("inbox/:id",(({params:e})=>{import("./msg-e42b200d.js").then((t=>{pi(t.default,e)}))})),e.add("inbox/new",(({params:e})=>{import("./msg-e42b200d.js").then((t=>{pi(t.default,e)}))})),e.add("inbox/new/:id",(({params:e})=>{import("./msg-e42b200d.js").then((t=>{pi(t.default,e)}))})),e.add("players",(({params:e})=>{import("./players-30e5da99.js").then((t=>{pi(t.default,e)}))})),e.add("search",(({params:e})=>{import("./search-75be0383.js").then((t=>{pi(t.default,e)}))})),e.add("settings",(({params:e})=>{import("./settings-fa060c6b.js").then((t=>{pi(t.default,e)}))})),e.add("settings/gameDisplay",(({params:e})=>{import("./gameDisplay-34908851.js").then((t=>{pi(t.default,e)}))})),e.add("settings/clock",(({params:e})=>{import("./clock-4bdbf833.js").then((t=>{pi(t.default,e)}))})),e.add("settings/gameBehavior",(({params:e})=>{import("./gameBehavior-c2a1fb56.js").then((t=>{pi(t.default,e)}))})),e.add("settings/bluetooth",(({params:e})=>{import("./bluetooth-a4537955.js").then((t=>{pi(t.default,e)}))})),e.add("settings/soundNotifications",(({params:e})=>{import("./soundNotifications-0913c2be.js").then((t=>{pi(t.default,e)}))})),e.add("settings/background",(({params:e})=>{import("./background-13d596cf.js").then((t=>{pi(t.default,e)}))})),e.add("settings/themes/board",(({params:e})=>{import("./boardTheme-54fc5f44.js").then((t=>{pi(t.default,e)}))})),e.add("settings/themes/piece",(({params:e})=>{import("./pieceThemes-f1927e39.js").then((t=>{pi(t.default,e)}))})),e.add("settings/lang",(({params:e})=>{import("./lang-9eefca8e.js").then((t=>{pi(t.default,e)}))})),e.add("teams",(({params:e})=>{import("./teamsList-aeb68375.js").then((t=>{pi(t.default,e)}))})),e.add("teams/:id",(({params:e})=>{import("./teamDetail-32c640d3.js").then((t=>{pi(t.default,e)}))})),e.add("training",(({params:e})=>{import("./training-3791ed31.js").then((t=>{pi(t.default,e)}))})),e.add("training/:id",(({params:e})=>{import("./training-3791ed31.js").then((t=>{pi(t.default,e)}))})),e.add("tournament",(({params:e})=>{import("./tournamentList-1858e650.js").then((t=>{pi(t.default,e)}))})),e.add("tournament/:id",(({params:e})=>{import("./tournamentDetail-654ca06e.js").then((t=>{pi(t.default,e)}))})),e.add("study",(({params:e})=>{import("./studyIndex-57ef5d7a.js").then((t=>{pi(t.default,e)}))})),e.add("study/:id",(({params:e})=>{import("./study-f0c7eb35.js").then((t=>{pi(t.default,e)}))})),e.add("study/:id/:chapterId",(({params:e})=>{import("./study-f0c7eb35.js").then((t=>{pi(t.default,e)}))})),e.add("coord",(({params:e})=>{import("./coordinates-d3603a58.js").then((t=>{pi(t.default,e)}))}))})),window.addEventListener("popstate",mi)}};let Yd=!1,Xd=!1,Qd=null;var Jd={open:function(){Si.backbutton.stack.push($i(th,"loginModal")),Yd=!0,Xd=!1,Qd=null},close:th,view:()=>Yd?Fn("div.modal#loginModal",{oncreate:Bi},[Fn("header",[Fn("button.modal_close",{oncreate:Vi($i(th,"loginModal"))},ju),Fn("h2",kt("signIn"))]),Fn("div.modal_content",[Fn("form.defaultForm.login",{onsubmit:Zd},[Qd&&!eh(Qd)?Fn("div.form-error",Qd):null,"InvalidTotpToken"===Qd?Fn("div.form-error",kt("invalidAuthenticationCode")):null,Fn("div.field",[Fn("input#username",{type:eh(Qd)?"hidden":"text",className:Qd?"form-error":"",placeholder:kt("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),Fn("div.field",[Fn("input#password",{type:eh(Qd)?"hidden":"password",className:Qd?"form-error":"",placeholder:kt("password"),required:!0})]),eh(Qd)?[Fn("div.field",[Fn("input#token[type=number]",{className:"MissingTotpToken"!==Qd?"form-error":"",placeholder:kt("authenticationCode"),pattern:"\\d{6}",required:!0})]),Fn("p.twofactorhelp",[Fn("i.fa.fa-mobile-phone"),Fn.trust("&nbsp"),"Open the two-factor authentication app on your device to view your authentication code and verify your identity."])]:null,Fn("div.submit",[Fn("button.defaultButton",{disabled:Xd},kt("signIn"))])]),Fn("div.loginActions",[Fn("a",{oncreate:Vi(oh.open)},[kt("signUp")]),Fn("a",{href:"https://lichess.org/password/reset"},[kt("passwordReset")])])])]):null};function Zd(e){if(Xd)return!1;e.preventDefault();const t=e.target,n=t.username.value.trim(),r=t.password.value,i=t.token?t.token.value:null;n&&r&&(Xt(),p.hide(),Xd=!0,Zr.login(n,r,i).then((()=>{Xd=!1,th(),Wt.afterLogin.dispatch(),Xt(),Ma.reconnectCurrent(),Jn.register(),Ir.refresh(),Zr.refresh()})).catch((e=>{Xd=!1,e.body.ipban?th():400!==e.status&&401!==e.status?sn(e):e.body.global&&(Qd=e.body.global[0],Xt())})))}function eh(e){return"MissingTotpToken"===e||"InvalidTotpToken"===e}function th(e){p.hide(),"backbutton"!==e&&Yd&&Si.backbutton.stack.pop(),Yd=!1}let nh=!1,rh=!1,ih=!1,ah=null;var oh={open:function(){Si.backbutton.stack.push($i(dh,"signupModal")),ah=null,nh=!0,rh=!1},close:dh,view:()=>nh?Fn("div.modal#signupModal",{oncreate:Bi},[Fn("header",[Fn("button.modal_close",{oncreate:Vi($i(dh,"signupModal"))},ju),Fn("h2",kt("signUp"))]),Fn("div#signupModalContent.modal_content",{},ih?[Fn("h1.signup-emailCheck.withIcon[data-icon=E]",kt("checkYourEmail")),Fn("p",kt("weHaveSentYouAnEmailClickTheLink")),Fn("p",kt("ifYouDoNotSeeTheEmailCheckOtherPlaces")),Fn("p","Not receiving it? Visit https://lichess.org/contact to request a manual confirmation.")]:[Fn("p.signupWarning.withIcon[data-icon=!]",[kt("computersAreNotAllowedToPlay")]),Fn("p.tosWarning",["By registering, you agree to be bound by our ",Fn("a",{oncreate:Vi((()=>window.open("https://lichess.org/terms-of-service","_blank")))},"Terms of Service"),"."]),Fn("form.defaultForm.login",{onsubmit:uh},[Fn("div.field",[ah&&ah.username?Fn("div.form-error",ah.username[0]):null,Fn("input#pseudo[type=text]",{className:ah&&ah.username?"form-error":"",placeholder:kt("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0,onfocus:lh,oninput:U(sh,500)})]),Fn("div.field",[ah&&ah.email?Fn("div.form-error",ah.email[0]):null,Fn("input#email[type=email]",{onfocus:lh,className:ah&&ah.email?"form-error":"",placeholder:kt("email"),autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),Fn("div.field",[ah&&ah.password?Fn("div.form-error",ah.password[0]):null,Fn("input#password[type=password]",{onfocus:lh,className:ah&&ah.password?"form-error":"",placeholder:kt("password"),required:!0})]),Fn("div.submit",[Fn("button.defaultButton",{disabled:rh},kt("signUp"))])])])]):null};function sh(e){const t=e.target.value.trim();var n;t&&t.match(/^[a-z0-9][\w-]{2,29}$/i)?(n=t,Xn("/api/player/autocomplete?exists=1",{query:{term:n}})).then((e=>{ch(e)})):ch(!1)}function ch(e){ah=e?{username:["This username is already in use, please try another one."]}:null,Xt()}function lh(e){setTimeout((()=>{e.target.scrollIntoView(!0)}),300)}function uh(e){e.preventDefault();const t=e.target,n=t[0].value.trim(),r=t[1].value.trim(),i=t[2].value;!rh&&n&&r&&i&&(p.hide(),rh=!0,ah=null,Xt(),Zr.signup(n,r,i).then((e=>{rh=!1,e&&function(e){return void 0!==e.email_confirm}(e)?(ih=!0,Xt()):(Ma.reconnectCurrent(),Xt(),Jd.close(),dh())})).catch((e=>{rh=!1,void 0!==e.body.error?(ah=e.body.error,Xt()):sn(e)})))}function dh(e){!0===ih&&Jd.close(),p.hide(),"backbutton"!==e&&nh&&Si.backbutton.stack.pop(),nh=!1}const hh=":r1/:r2/:r3/:r4/:r5/:r6/:r7/:r8";function ph(e){return e.r1+"/"+e.r2+"/"+e.r3+"/"+e.r4+"/"+e.r5+"/"+e.r6+"/"+e.r7+"/"+e.r8.split("_").join(" ")}var mh={init(){s.addListener("appUrlOpen",(({url:e})=>{setTimeout((()=>{const t=new URL(e),n=t.pathname;if(!fh.run(n)){const e=gh.exec(n);if(e){const n=e[2],r=vh.exec(t.hash),i={};n&&(i.color=n.substring(1)),r&&(i.ply=r[1]);const a=Hn(i);Si.set(`/game/${e[1]}?${a}`)}}}),100)}))}};const fh=new ii,gh=/^\/(\w{8})(\/black|\/white)?$/,vh=/^#(\d+)$/;fh.add("analysis",(()=>Si.set("/analyse"))),fh.add(`analysis/${hh}`,(({params:e})=>{const t=encodeURIComponent(ph(e));Si.set(`/analyse/fen/${t}`)})),fh.add("editor",(()=>Si.set("/editor"))),fh.add(`editor/${hh}`,(({params:e})=>{const t=encodeURIComponent(ph(e));Si.set(`/editor/${t}`)})),fh.add("inbox",(()=>Si.set("/inbox"))),fh.add("inbox/new",(()=>Si.set("/inbox/new"))),fh.add("challenge/:id",(({params:e})=>Si.set(`/game/${e.id}`))),fh.add("study",(()=>Si.set("/study"))),fh.add("study/:id",(({params:e})=>Si.set(`/study/${e.id}`))),fh.add("study/:id/:chapterId",(({params:e})=>Si.set(`/study/${e.id}/${e.chapterId}`))),fh.add("player",(()=>Si.set("/players"))),fh.add("tournament",(()=>Si.set("/tournament"))),fh.add("tournament/:id",(({params:e})=>Si.set(`/tournament/${e.id}`))),fh.add("training",(()=>Si.set("/training"))),fh.add("training/:id",(({params:e})=>Si.set(`/training/${e.id}`))),fh.add("tv",(()=>Si.set("/tv"))),fh.add("tv/:channel",(({params:e})=>Si.set(`/tv/${e.channel}`))),fh.add("@/:id",(({params:e})=>Si.set(`/@/${e.id}`))),fh.add("@/:id/tv",(({params:e})=>Si.set(`/@/${e.id}/tv`))),fh.add("@/:id/all",(({params:e})=>Si.set(`/@/${e.id}/games`))),fh.add("@/:id/perf/:key",(({params:e})=>Si.set(`/@/${e.id}/${e.key}/perf`))),fh.add("signup/confirm/:token",(({params:e})=>{const t=e.token;t&&Zr.confirmEmail(t).then((e=>{oh.close(),Si.set(`/@/${e.id}`)})).catch(sn)}));const bh=r("CPUInfo");(async function(){await Ye.migrate();const e=await Ye.get(it);Object.assign(ct,e)})().then((()=>Promise.all([s.getInfo().catch((()=>({version:$t.packageVersion}))),c.getInfo(),c.getId(),"ios"===n.getPlatform()?bh.nbCores().then((e=>e.value)).catch((()=>1)):Promise.resolve(navigator.hardwareConcurrency||1),Pd.getMaxMemory().then((e=>e.value)).catch((()=>16)),Pd.getCPUArch().then((e=>e.value)).catch((()=>"x86"))]))).then((([e,t,n,r,i,a])=>wd(e,t,n,r,i,a))).then((()=>{Kd.init(),mh.init()})).then((function(){const e=lt.general.theme.background(),t=lt.general.theme.board();if(Gd(e),Ad(e)){const t=Hd("bg",e);Bd("bg",t).then((n=>{Wd("bg",e,t,n)})).catch((()=>{lt.general.theme.background("dark")}))}if(!lt.general.theme.bundledBoardThemes.includes(t)){const e=Hd("board",t);Bd("board",e).then((n=>{Wd("board",t,e,n)})).catch((()=>{lt.general.theme.board("brown")}))}})).then((async function(){const e=import("./i18n/"+dt+".js").then((({default:e})=>{Object.assign(ht,e)})),t=lt.general.locale();return t&&void 0!==qt[t]?e.then((()=>Lt(t))):e.then((()=>c.getLanguageCode())).then((({value:e})=>Lt(jt(e)||dt)))})).then(Kc.init).then((()=>mi())).then((()=>{setTimeout((()=>{l.hide()}),500)}));export{ao as $,s as A,dn as B,Pl as C,Pu as D,sa as E,Cn as F,Ai as G,Hu as H,n as I,Ka as J,qi as K,Ya as L,Xa as M,u as N,Ga as O,Ha as P,no as Q,Za as R,Yi as S,er as T,Ja as U,cn as V,WebPlugin as W,to as X,eo as Y,ni as Z,Jd as _,Wt as a,jo as a$,ro as a0,io as a1,rl as a2,Ou as a3,z as a4,yl as a5,bl as a6,du as a7,gu as a8,Zc as a9,yn as aA,wn as aB,mn as aC,vn as aD,or as aE,So as aF,bo as aG,pn as aH,fc as aI,Zi as aJ,ra as aK,ga as aL,va as aM,Wu as aN,Xu as aO,mo as aP,Qc as aQ,Gt as aR,Gi as aS,yc as aT,Ru as aU,Iu as aV,zu as aW,aa as aX,Vu as aY,fo as aZ,Gu as a_,tt as aa,mr as ab,sn as ac,Va as ad,ju as ae,En as af,$r as ag,Qi as ah,so as ai,oh as aj,od as ak,Vd as al,qu as am,St as an,Ye as ao,r as ap,$t as aq,Et as ar,Sn as as,xt as at,Xi as au,bn as av,oa as aw,Ii as ax,Li as ay,go as az,Zr as b,SideMenuCtrl as b$,No as b0,Da as b1,hn as b2,$i as b3,p as b4,Pn as b5,Bi as b6,LRUMap as b7,Qn as b8,Gn as b9,mc as bA,wc as bB,_r as bC,Pr as bD,vd as bE,wo as bF,yo as bG,rn as bH,nn as bI,xd as bJ,Ul as bK,Xl as bL,Zl as bM,Yl as bN,SquareSet as bO,Kl as bP,Rl as bQ,Al as bR,eu as bS,Or as bT,Qe as bU,Io as bV,oi as bW,m as bX,Ji as bY,pc as bZ,Zt as b_,zs as ba,Ws as bb,A as bc,wa as bd,Chessground as be,gn as bf,On as bg,StockfishPlugin as bh,Od as bi,Ed as bj,gc as bk,vc as bl,bc as bm,fn as bn,yr as bo,Ir as bp,wr as bq,br,vr as bs,Tr as bt,Di as bu,ji as bv,ho as bw,Yu as bx,jn as by,ur as bz,_t as c,tc as c$,kc as c0,hc as c1,Co as c2,ko as c3,Ot as c4,Sc as c5,Bl as c6,Vl as c7,Fl as c8,Board as c9,Kc as cA,Wc as cB,Ad as cC,Ud as cD,zd as cE,Gd as cF,$d as cG,Fd as cH,$u as cI,qt as cJ,jt as cK,Rt as cL,Dt as cM,xr as cN,Lt as cO,Tn as cP,Fi as cQ,Ui as cR,ca as cS,Ku as cT,kn as cU,Du as cV,Lu as cW,xn as cX,o as cY,Md as cZ,nc as c_,Dl as ca,Gl as cb,tu as cc,Material as cd,RemainingChecks as ce,Ri as cf,ws as cg,po as ch,Ld as ci,Hi as cj,nu as ck,ru as cl,tn as cm,lu as cn,La as co,Ia as cp,qa as cq,Ra as cr,$a as cs,Aa as ct,Ba as cu,MessageSocket as cv,la as cw,Nu as cx,ia as cy,ua as cz,U as d,Zs as d0,Cr as e,Xn as f,lt as g,Mn as h,ir as i,Er as j,on as k,Sr as l,Si as m,ln as n,Fn as o,kt as p,Ki as q,Xt as r,Ma as s,Mr as t,zn as u,Mt as v,Pt as w,Ml as x,Vi as y,Ct as z};
