import{f as t,a$ as e,J as o,ak as a,o as n,b0 as s,d as r,r as i,k as c,aW as h,aX as d,m as u,$ as l,a6 as p,aD as g,aZ as m,g as v,b1 as b,b2 as f,b3 as k}from"./main.js";function w(e){return t(e.data.url.round)}function x(t,o=!1){return e(`/game/export/${t}${o?"?evals=0&clocks=0":"?literate=1"}`,{headers:{Accept:"application/x-chess-pgn, text/*","X-Requested-With":"__delete",[s]:"__delete"},credentials:"omit"},!0)}function y(e,o){return t("/api/crosstable/"+e+"/"+o,{cache:"reload"})}class NotesCtrl{constructor(t){var s;this.syncNotes=r((t=>{const s=t.target.value;var r,c;this.data.note!==s&&(r=this.data.game.id,c=s,e(`/${r}/note`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"},body:o({text:c})},!1).catch((t=>{throw a.show({text:n("notesSynchronizationHasFailed"),duration:"short"}),t}))).then((()=>{this.data.note=s,i()}))}),1e3),this.open=()=>{c.backbutton.stack.push(h(this.close,"notes")),this.showing=!0},this.close=t=>{d.hide(),"backbutton"!==t&&this.showing&&c.backbutton.stack.pop(),this.showing=!1},this.syncing=!0,this.data=t,this.showing=!1,this.inputValue="",(s=t.game.id,e(`/${s}/note`)).then((t=>{this.data.note=t,this.syncing=!1,i()})).catch((()=>{this.syncing=!1,i(),a.show({text:"Could not read notes from server.",position:"bottom",duration:"short"})}))}}function N(t){return t.showing?u("div#notes.modal",{oncreate:m},[u("header",[u("button.modal_close",{oncreate:l(h(t.close,"notes"))},p),u("h2",n("notes"))]),u("div.modal_content",[t.syncing?u("div.notesTextarea.loading",g.getVdom()):u("textarea#notesTextarea.native_scroller",{placeholder:n("typePrivateNotesHere"),oninput:t.syncNotes,value:t.data.note})])]):null}const C=["pawn","knight","bishop","rook","queen"],_={oninit(t){const{ctrl:e}=t.attrs,o=t=>function(t,e){if(e.touches&&e.touches.length>1)return;if(!t.canDrop())return;const o=e.target.getAttribute("data-role"),a=e.target.getAttribute("data-color"),n=e.target.getAttribute("data-nb");if(!o||!a||"0"===n)return;if(!function(t,e){return t.movable.color===e&&(t.turnColor===e||t.predroppable.enabled)}(t.chessground.state,a))return;e.stopPropagation(),e.preventDefault();const s={role:o,color:a};t.chessground.dragNewPiece(e,s)}(e,t),a=t=>b(e.chessground,t),n=t=>f(e.chessground,t);this.pocketOnCreate=function(t){const e=t.dom;e.addEventListener("touchstart",o),e.addEventListener("touchmove",a),e.addEventListener("touchend",n)},this.pocketOnRemove=function(t){const e=t.dom;e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",a),e.removeEventListener("touchend",n)}},view(t){const{crazyData:e,position:o,color:a,customPieceTheme:n}=t.attrs,s=e.pockets["white"===a?0:1],r=[n||v.general.theme.piece(),"pocket",o||""].join(" ");return u("div",{className:r,oncreate:this.pocketOnCreate,onremove:this.pocketOnRemove},C.map((t=>u("piece",{"data-role":t,"data-color":a,"data-nb":s[t]||0,className:t+" "+a}))))}};var E=1/0,L=17976931348623157e292;function T(t){var e=function(t){return t?(t=k(t))===E||t===-E?(t<0?-1:1)*L:t==t?t:0:0===t?t:0}(t),o=e%1;return e==e?o?e-o:e:0}export{_ as C,NotesCtrl as N,y as a,x as g,N as n,w as r,T as t};
