import{al as e,am as n,b as a,f as l,r as s,k as t,J as o,ad as i,a7 as c,ag as r,u,m,o as p,an as f,ao as d,ap as g,c as N,p as b,aq as h,G as v,ar as k,ai as w}from"./main.js";import{l as _}from"./html-1975aa10.js";import{p as T,a as M}from"./perfs-d8ca398c.js";import{c as y}from"./countries-a19495bf.js";import{u as $,a as C,f as j,b as P,c as x}from"./userXhr-e893d0da.js";const S=e("Browser",{web:()=>import("./web-cc022a79.js").then((e=>new e.BrowserWeb))});function z(e,s=!1){const t=`${n.apiEndPoint}${e}`;var o;a.isKidMode()?(o=t,window.open(o,"_blank")):a.isConnected()&&!s?l("/auth/token",{method:"POST"},!0).then((n=>{S.open({url:`${n.url}?referrer=${encodeURIComponent(e)}`})})).catch((()=>{S.open({url:t})})):S.open({url:t})}function R(e){const n=c(null);function l(e){Object.assign(n(),e),s()}const r=a.get();return r&&r.id===e&&n(r),$(e).then((e=>{n(e),s()})).then(a.refresh).catch((e=>{})),{user:n,isMe:()=>a.getUserId()===e,toggleFollowing(){const e=n();e&&A(e)&&e.following?C(e.id).then(l):e&&j(e.id).then(l)},toggleBlocking(){const e=n();e&&A(e)&&e.blocking?P(e.id).then(l):e&&x(e.id).then(l)},goToGames(){const e=n();if(e){const n={username:e.username};e.patron&&(n.patron="1"),e.title&&(n.title=e.title),t.set(`/@/${e.id}/games?${o(n)}`)}},goToUserTV(){const e=n();e&&t.set(`/@/${e.id}/tv`)},challenge(){const e=n();e&&i.open(e.id)},composeMessage(){const e=n();e&&t.set(`/inbox/new/${e.id}`)},followers(){const e=n();if(e){const n={username:e.username};e.title&&(n.title=e.title),t.set(`/@/${e.id}/related?${o(n)}`)}}}}function A(e){return void 0!==e.count}function B(e,n){const a=O(e.online,e.patron,e.username,e.title),l=n.isMe()?null:r(a);return u(l?null:a,l)}function O(e,n,a,l){const s="offline",t=m("span",n?{className:"userStatus patron "+s,"data-icon":"î€™"}:{className:"fa fa-circle userStatus "+s});return m("div.title",[t,m("span",[...l?[m("span.userTitle"+("BOT"===l?".bot":""),l)," "]:[],a])])}function U(e,n){return m("div",{id:"userProfile",className:"native_scroller page"},function(e){return e.tosViolation?m("section",{className:"warnings"},e.tosViolation?m("div",{className:"warning","data-icon":"j"},p("thisAccountViolatedTos")):null):null}(e),function(e){if(e.profile){const n=[e.profile.firstName,e.profile.lastName].filter((e=>null!=e)).join(" "),a=null!=e.profile.country?y[e.profile.country]:null,l=e.profile.location,s=p("memberSince")+" "+f(new Date(e.createdAt));return m("section",{className:"profileSection"},n?m("h3",{className:"fullname"},n):null,null!=e.profile.bio?m("p",{className:"profileBio"},m.trust(_(e.profile.bio))):null,m("div",null,null!=e.profile.fideRating?m("p",null,"FIDE rating: ",m("strong",null,e.profile.fideRating)):null,m("p",{className:"location"},l,null!=a&&d()?m("span",{className:"country"},null!=l?",":""," ",m("img",{className:"flag",src:g(`images/flags/${e.profile.country}.png`)}),a):null),m("p",null,s),e.seenAt?m("p",null,m.trust(p("lastSeenActive",`<small>${N(new Date(e.seenAt))}</small>`))):null))}return null}(e),function(e){let n=null;const a=e.playTime?p("tpTimeSpentPlaying",h(e.playTime.total)):null;A(e)&&(n=e.playTime&&e.playTime.tv>0?p("tpTimeSpentOnTV",h(e.playTime.tv)):null);return m("section",{className:"profileSection"},A(e)&&e.completionRate?m("p",null,p("gameCompletionRate",e.completionRate+"%")):null,a?m("p",null,a):null,n?m("p",null,n):null)}(e),function(e,n){return m("section",{className:"profileSection websiteLinks"},e.isMe()?m("p",null,m("a",{className:"external_link",oncreate:b((()=>z("/account/profile")))},p("editProfile"))):m("p",null,m("a",{className:"external_link",oncreate:b((()=>z(`/@/${n.id}`)))},"More on lichess.org")),n.patron?m("p",null,m("a",{className:"external_link",oncreate:b((()=>z("/patron")))},"Lichess Patron")):null)}(n,e),function(e){function n(e){return-1!==["blitz","bullet","rapid","classical","correspondence"].indexOf(e.key)||e.perf.games>0}return m("section",{id:"userProfileRatings",className:"perfs"},function(e){const n=T.map((n=>{const a=e.perfs[n[0]];return{key:n[0],name:n[1],perf:a||"-"}}));e.perfs.puzzle&&n.push({key:"puzzle",name:"Training",perf:e.perfs.puzzle});return n}(e).filter(n).map((n=>function(e,n,a,l){const s=function(e,n){return"puzzle"!==e&&n.games>0}(e,a);return m("div",{className:"profilePerf"+(s?" nav":""),"data-icon":w(e),oncreate:b((()=>{s&&t.set(`/@/${l.id}/${e}/perf`)}))},[m("span.name",n),m("div.rating",[a.rating,a.rd>=M?"?":null,k(a.prog),m("span.nb","/ "+a.games)])])}(n.key,n.name,n.perf,e))))}(e),function(e,n){return m("section",{id:"userProfileActions",className:"items_list_block noPadding"},A(n)?m("div",{className:"list_item nav",oncreate:b(e.goToGames)},v("nbGames",n.count.all)):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item",oncreate:b((()=>t.set("/inbox")))},m("span",{className:"fa fa-envelope"}),p("inbox")):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item",oncreate:b((()=>t.set("/account/preferences")))},m("span",{className:"fa fa-cog"}),p("preferences")):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item nav",oncreate:b(e.followers)},m("span",{className:"fa fa-users"}),p("friends")):null,e.isMe()?null:m("div",{className:"list_item nav","data-icon":"1",oncreate:b(e.goToUserTV)},p("watchGames")),a.isConnected()&&!e.isMe()?m("div",{className:"list_item","data-icon":"U",oncreate:b(e.challenge)},p("challengeToPlay")):null,a.isConnected()&&!e.isMe()?m("div",{className:"list_item nav",oncreate:b(e.composeMessage)},m("span",{className:"fa fa-comment"}),p("composeMessage")):null,a.isConnected()&&A(n)&&n.followable&&!e.isMe()?m("div",{className:["list_item",n.blocking?"disabled":""].join(" ")},m("div",{className:"check_container"},m("label",{htmlFor:"user_following"},p("follow")),m("input",{id:"user_following",type:"checkbox",checked:n.following,disabled:n.blocking,onchange:e.toggleFollowing}))):null,a.isConnected()&&A(n)&&!e.isMe()?m("div",{className:["list_item",n.following?"disabled":""].join(" ")},m("div",{className:"check_container"},m("label",{htmlFor:"user_blocking"},p("block")),m("input",{id:"user_blocking",type:"checkbox",checked:n.blocking,disabled:n.following,onchange:e.toggleBlocking}))):null,a.isConnected()&&!e.isMe()?m("div",{className:"list_item","data-icon":"!",oncreate:b((()=>z(`/report?username=${n.username}`)))},p("reportXToModerators",n.username)):null,a.isConnected()&&e.isMe()?m("div",{className:"list_item",oncreate:b(a.logout)},m("span",{className:"fa fa-power-off"}),p("logOut")):null)}(n,e))}export{R as U,B as h,z as o,U as p,O as u};
