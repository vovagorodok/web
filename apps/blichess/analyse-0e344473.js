import{bx as t,by as a,aw as s,g as e,q as o,aA as r,r as i,a3 as n,k as c,au as l,bm as d,bn as m,aB as h,s as p,ay as f,ag as u,m as b,o as y,aL as v,aC as j}from"./main.js";import{g,c as k,b as w}from"./offlineGames-9509d7c8.js";import{G as T}from"./GameTitle-46b0cab9.js";import{l as B}from"./layout-b3635a82.js";import{p as x,a as A}from"./fen-f2d95e2d.js";import{g as C,A as G,r as F,a as I,o as $,l as _}from"./AnalyseCtrl-82dd2126.js";import"./game-51118656.js";import"./perfs-d8ca398c.js";import"./CountdownTimer-c0405f18.js";import"./variant-ab8f8798.js";import"./promotion-87163dc0.js";import"./toInteger-62ca6ec9.js";import"./TabView-f358fd2b.js";import"./chat-bb3d94b0.js";import"./html-1975aa10.js";import"./tree-3ccd4e65.js";import"./axis-de48d5f2.js";import"./Board-591a9bd0.js";import"./chess-1c1bcc98.js";import"./vibrate-5a029184.js";import"./index-38489b13.js";import"./studyXhr-f4550073.js";const q={queen:0,rook:0,knight:0,bishop:0,pawn:0};var z={oninit(d){const m=d.attrs.source||"offline",h=d.attrs.id,p=d.attrs.color||"white",f=d.attrs.fen,u=d.attrs.variant,b=o(d.attrs.ply),y=d.attrs.tabId,v=void 0!==h||void 0!==f||"1"===d.attrs.goBack;if(r(),"online"===m&&h){const t=performance.now();C(h,p).then((a=>{const s=performance.now()-t;setTimeout((()=>{this.ctrl=new G(a,void 0,m,p,v,b,y),i()}),Math.max(400-s,0))})).catch((t=>{n(t),d.attrs.fallback&&d.attrs.curFen&&d.attrs.color?c.set(`/analyse/variant/standard/fen/${encodeURIComponent(d.attrs.curFen)}?color=${d.attrs.color}&goBack=1`):c.set("/analyse",!0),i()}))}else if("offline"===m&&"otb"===h)g().then((t=>{setTimeout((()=>{const a=t&&k(t,p);a?(a.player.spectator=!0,this.ctrl=new G(a,void 0,m,p,v,b,y),i()):c.set("/analyse",!0)}),400)}));else if("offline"===m&&"ai"===h)w().then((t=>{setTimeout((()=>{const a=t&&k(t,p);a?(a.player.spectator=!0,this.ctrl=new G(a,void 0,m,p,v,b,y),i()):c.set("/analyse",!0)}),400)}));else if(void 0===u){let t=e.analyse.syntheticVariant();f&&(t=l.has(t)?"standard":t);let a=`/analyse/variant/${t}`;f&&(a+=`/fen/${encodeURIComponent(f)}`),c.set(a,!0),i()}else this.ctrl=new G(function(o,r){const i=x(r),n=A(r),c=t(o),l=r||a(o);return{game:{fen:l,id:"synthetic",initialFen:l,player:i,source:"offline",status:{id:10,name:"created"},turns:0,startedAtTurn:0,variant:c},takebackable:!1,orientation:"white",opponent:{color:s(i)},player:{color:i},pref:{destination:e.game.pieceDestinations(),highlight:e.game.highlights()},treeParts:[{fen:l,ply:n,crazyhouse:"crazyhouse"===c.key?{pockets:[q,q]}:void 0,pgnMoves:[]}],userAnalysis:!0}}(u,f),void 0,m,p,v,b,y),i()},oncreate(t){"1"===t.attrs.slide?d(t.dom):m(t.dom)},onremove(){h(),p.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(t){const a=f();if(this.ctrl){let t=null;this.ctrl.shouldGoBack&&(t="synthetic"===this.ctrl.data.game.id?u(b("div.main_header_title",y("analysis"))):u([b(T,{data:this.ctrl.data,subTitle:"date"}),v(this.ctrl.toggleBookmark,this.ctrl.data.bookmarked)]));const s=this.ctrl.shouldGoBack?null:b("div.main_header_title.withSub",[b("div",y("analysis")),F(this.ctrl)]);return B.board(j(s,t),I(this.ctrl,a),void 0,$(this.ctrl))}return _(a,t.attrs.color,t.attrs.curFen)}};export{z as default};
