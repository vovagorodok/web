import{ap as e,aq as n,b as s,f as a,r as l,k as t,ac as o,m as i,V as c,D as r,af as u,am as m,H as p,o as f,p as d,ar as g,as as N,c as b,q as h,at as v,z as k,au as w,B as _}from"./main.js";import{l as T}from"./html-1975aa10.js";import{p as M,a as y}from"./perfs-d8ca398c.js";import{c as $}from"./countries-a19495bf.js";import{u as C,a as j,f as P,b as x,c as z}from"./userXhr-d3b3ac60.js";const S=e("Browser",{web:()=>import("./web-993f1293.js").then((e=>new e.BrowserWeb))});function B(e,l=!1){const t=`${n.apiEndPoint}${e}`;s.isKidMode()?R(t):s.isConnected()&&!l?a("/auth/token",{method:"POST"},!0).then((n=>{S.open({url:`${n.url}?referrer=${encodeURIComponent(e)}`})})).catch((()=>{S.open({url:t})})):S.open({url:t})}function R(e){window.open(e,"_blank")}function V(e){const n=u(null);function a(e){Object.assign(n(),e),l()}const m=s.get();return m&&m.id===e&&n(m),C(e).then((e=>{n(e),l()})).then(s.refresh).catch((e=>{t()&&o(e)})),{user:n,isMe:()=>s.getUserId()===e,toggleFollowing(){const e=n();e&&A(e)&&e.following?j(e.id).then(a):e&&P(e.id).then(a)},toggleBlocking(){const e=n();e&&A(e)&&e.blocking?x(e.id).then(a):e&&z(e.id).then(a)},goToGames(){const e=n();if(e){const n={username:e.username};e.patron&&(n.patron="1"),e.title&&(n.title=e.title),i.set(`/@/${e.id}/games?${c(n)}`)}},goToUserTV(){const e=n();e&&i.set(`/@/${e.id}/tv`)},challenge(){const e=n();e&&r.open(e.id)},composeMessage(){const e=n();e&&i.set(`/inbox/new/${e.id}`)},followers(){const e=n();if(e){const n={username:e.username};e.title&&(n.title=e.title),i.set(`/@/${e.id}/related?${c(n)}`)}}}}function A(e){return void 0!==e.count}function O(e,n){const s=U(e.online,e.patron,e.username,e.title),a=n.isMe()?null:m(s);return p(a?null:s,a)}function U(e,n,s,a){const l=t()&&e?"online":"offline",o=f("span",n?{className:"userStatus patron "+l,"data-icon":"î€™"}:{className:"fa fa-circle userStatus "+l});return f("div.title",[o,f("span",[...a?[f("span.userTitle"+("BOT"===a?".bot":""),a)," "]:[],s])])}function F(e,n){return f("div",{id:"userProfile",className:"native_scroller page"},function(e){return e.tosViolation?f("section",{className:"warnings"},e.tosViolation?f("div",{className:"warning","data-icon":"j"},d("thisAccountViolatedTos")):null):null}(e),function(e){if(e.profile){const n=[e.profile.firstName,e.profile.lastName].filter((e=>null!=e)).join(" "),s=null!=e.profile.country?$[e.profile.country]:null,a=e.profile.location,l=d("memberSince")+" "+g(new Date(e.createdAt));return f("section",{className:"profileSection"},n?f("h3",{className:"fullname"},n):null,null!=e.profile.bio?f("p",{className:"profileBio"},f.trust(T(e.profile.bio))):null,f("div",null,null!=e.profile.fideRating?f("p",null,"FIDE rating: ",f("strong",null,e.profile.fideRating)):null,f("p",{className:"location"},a,null!=s&&t()?f("span",{className:"country"},null!=a?",":""," ",f("img",{className:"flag",src:N(`images/flags/${e.profile.country}.png`)}),s):null),f("p",null,l),e.seenAt?f("p",null,f.trust(d("lastSeenActive",`<small>${b(new Date(e.seenAt))}</small>`))):null))}return null}(e),function(e){let n=null;const s=e.playTime?d("tpTimeSpentPlaying",v(e.playTime.total)):null;A(e)&&(n=e.playTime&&e.playTime.tv>0?d("tpTimeSpentOnTV",v(e.playTime.tv)):null);return f("section",{className:"profileSection"},A(e)&&e.completionRate?f("p",null,d("gameCompletionRate",e.completionRate+"%")):null,s?f("p",null,s):null,n?f("p",null,n):null)}(e),function(e,n){return f("section",{className:"profileSection websiteLinks"},e.isMe()?f("p",null,f("a",{className:"external_link",oncreate:h((()=>B("/account/profile")))},d("editProfile"))):f("p",null,f("a",{className:"external_link",oncreate:h((()=>B(`/@/${n.id}`)))},"More on lichess.org")),n.patron?f("p",null,f("a",{className:"external_link",oncreate:h((()=>B("/patron")))},"Lichess Patron")):null)}(n,e),function(e){function n(e){return-1!==["blitz","bullet","rapid","classical","correspondence"].indexOf(e.key)||e.perf.games>0}return f("section",{id:"userProfileRatings",className:"perfs"},function(e){const n=M.map((n=>{const s=e.perfs[n[0]];return{key:n[0],name:n[1],perf:s||"-"}}));e.perfs.puzzle&&n.push({key:"puzzle",name:"Training",perf:e.perfs.puzzle});return n}(e).filter(n).map((n=>function(e,n,s,a){const l=function(e,n){return"puzzle"!==e&&n.games>0}(e,s);return f("div",{className:"profilePerf"+(l?" nav":""),"data-icon":_(e),oncreate:h((()=>{l&&i.set(`/@/${a.id}/${e}/perf`)}))},[f("span.name",n),f("div.rating",[s.rating,s.rd>=y?"?":null,w(s.prog),f("span.nb","/ "+s.games)])])}(n.key,n.name,n.perf,e))))}(e),function(e,n){return f("section",{id:"userProfileActions",className:"items_list_block noPadding"},A(n)?f("div",{className:"list_item nav",oncreate:h(e.goToGames)},k("nbGames",n.count.all)):null,s.isConnected()&&e.isMe()?f("div",{className:"list_item",oncreate:h((()=>i.set("/inbox")))},f("span",{className:"fa fa-envelope"}),d("inbox")):null,s.isConnected()&&e.isMe()?f("div",{className:"list_item",oncreate:h((()=>i.set("/account/preferences")))},f("span",{className:"fa fa-cog"}),d("preferences")):null,s.isConnected()&&e.isMe()?f("div",{className:"list_item nav",oncreate:h(e.followers)},f("span",{className:"fa fa-users"}),d("friends")):null,e.isMe()?null:f("div",{className:"list_item nav","data-icon":"1",oncreate:h(e.goToUserTV)},d("watchGames")),s.isConnected()&&!e.isMe()?f("div",{className:"list_item","data-icon":"U",oncreate:h(e.challenge)},d("challengeToPlay")):null,s.isConnected()&&!e.isMe()?f("div",{className:"list_item nav",oncreate:h(e.composeMessage)},f("span",{className:"fa fa-comment"}),d("composeMessage")):null,s.isConnected()&&A(n)&&n.followable&&!e.isMe()?f("div",{className:["list_item",n.blocking?"disabled":""].join(" ")},f("div",{className:"check_container"},f("label",{htmlFor:"user_following"},d("follow")),f("input",{id:"user_following",type:"checkbox",checked:n.following,disabled:n.blocking,onchange:e.toggleFollowing}))):null,s.isConnected()&&A(n)&&!e.isMe()?f("div",{className:["list_item",n.following?"disabled":""].join(" ")},f("div",{className:"check_container"},f("label",{htmlFor:"user_blocking"},d("block")),f("input",{id:"user_blocking",type:"checkbox",checked:n.blocking,disabled:n.following,onchange:e.toggleBlocking}))):null,s.isConnected()&&!e.isMe()?f("div",{className:"list_item","data-icon":"!",oncreate:h((()=>B(`/report?username=${n.username}`)))},d("reportXToModerators",n.username)):null,s.isConnected()&&e.isMe()?f("div",{className:"list_item",oncreate:h(s.logout)},f("span",{className:"fa fa-power-off"}),d("logOut")):null)}(n,e))}export{V as U,B as a,O as h,R as o,F as p,U as u};
