import{aj as n,f as e,ak as t,k as o,g as i}from"./main.js";var r={fetch:function(e){return n.get(`${s}.${e}`)},save:function(e,t){return n.set(`${s}.${e}`,t)},clean:function(e){return n.remove(`${s}.${e}`)}};const s="offlinePuzzlesV2";function a(n){return e(`/training/${n.id}/round2`,{method:"POST",body:JSON.stringify({win:n.win})})}function u(n,t){return e(`/training/${n}/vote`,{method:"POST",body:JSON.stringify({vote:t?1:0})})}function c(n){return e(`/training/${n}/load`,{cache:"reload"})}function l(){return e("/training/new")}function d(n,e){return f(n,e).catch((()=>m((()=>p(n,e)))))}function f(n,e){return m((()=>n.fetch(e.id)))}function h(n,e){return n.fetch(e.id).then((n=>n&&n.unsolved||[]))}function v(n,e){return n.fetch(e.id).then((n=>n&&n.unsolved.length||0))}function g(n,e,t){return n.fetch(e.id).then((o=>o?n.save(e.id,Object.assign(Object.assign({},o),{solved:o.solved.concat([{id:t.id,win:t.win}]),unsolved:o.unsolved.filter((n=>n.puzzle.id!==t.id))})).then((()=>p(n,e))):null))}function z(n){"string"==typeof n?t.show({text:n,position:"center",duration:"long"}):t.show({text:"Could not load puzzle",position:"center",duration:"short"}),o.set("/")}function p(n,t){return n.fetch(t.id).then((o=>{const r=o?o.unsolved:[],s=o?o.solved:[],a=Math.max(i.training.puzzleBufferLen-r.length,0),u=s.length>0?(c=s,e("/training/batch",{method:"POST",body:JSON.stringify({solutions:c})})):Promise.resolve();var c;const l=r.map((n=>n.puzzle.id)),d=l.length>0?Math.max(...l):void 0;return u.then((()=>!o||a>0?e("/training/batch",{method:"GET",query:{nb:a,after:d},cache:"reload"}):Promise.resolve({puzzles:[],user:o.user}))).then((e=>n.save(t.id,{user:e.user,unsolved:r.concat(e.puzzles),solved:[]}))).catch((()=>o))}))}function m(n){return new Promise(((e,t)=>{n().then((n=>{n&&n.unsolved.length>0?e(n.unsolved[0]):t(`No additional offline puzzle available. Go online to get another ${i.training.puzzleBufferLen}`)})).catch(t)}))}export{g as a,v as b,c,r as d,h as g,f as l,l as n,z as p,a as r,d as s,u as v};
