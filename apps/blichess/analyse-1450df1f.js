import{bF as t,bG as a,aH as s,g as e,F as o,aL as r,r as i,ac as n,m as c,aF as l,bu as d,bv as m,aM as h,s as p,aJ as f,am as u,o as y,p as b,aU as v,aN as j}from"./main.js";import{g,c as k,b as w}from"./offlineGames-90731ac9.js";import{G as T}from"./GameTitle-fb417b3c.js";import{l as F}from"./layout-ae040024.js";import{p as B,a as G}from"./fen-f2d95e2d.js";import{g as x,A,r as C,a as I,o as $,l as _}from"./AnalyseCtrl-79633987.js";import"./game-b6f212b0.js";import"./perfs-d8ca398c.js";import"./CountdownTimer-c8587446.js";import"./variant-c1af828f.js";import"./promotion-070b22ca.js";import"./toInteger-da417924.js";import"./TabView-408b9801.js";import"./chat-2370f74a.js";import"./html-1975aa10.js";import"./tree-3ccd4e65.js";import"./axis-de48d5f2.js";import"./Board-0ecb6fca.js";import"./chess-a4e99343.js";import"./vibrate-2d0ad158.js";import"./index-c70fdca8.js";import"./studyXhr-058f9d1a.js";const M={queen:0,rook:0,knight:0,bishop:0,pawn:0};var U={oninit(d){const m=d.attrs.source||"offline",h=d.attrs.id,p=d.attrs.color||"white",f=d.attrs.fen,u=d.attrs.variant,y=o(d.attrs.ply),b=d.attrs.tabId,v=void 0!==h||void 0!==f||"1"===d.attrs.goBack;if(r(),"online"===m&&h){const t=performance.now();x(h,p).then((a=>{const s=performance.now()-t;setTimeout((()=>{this.ctrl=new A(a,void 0,m,p,v,y,b),i()}),Math.max(400-s,0))})).catch((t=>{n(t),d.attrs.fallback&&d.attrs.curFen&&d.attrs.color?c.set(`/analyse/variant/standard/fen/${encodeURIComponent(d.attrs.curFen)}?color=${d.attrs.color}&goBack=1`):c.set("/analyse",!0),i()}))}else if("offline"===m&&"otb"===h)g().then((t=>{setTimeout((()=>{const a=t&&k(t,p);a?(a.player.spectator=!0,this.ctrl=new A(a,void 0,m,p,v,y,b),i()):c.set("/analyse",!0)}),400)}));else if("offline"===m&&"ai"===h)w().then((t=>{setTimeout((()=>{const a=t&&k(t,p);a?(a.player.spectator=!0,this.ctrl=new A(a,void 0,m,p,v,y,b),i()):c.set("/analyse",!0)}),400)}));else if(void 0===u){let t=e.analyse.syntheticVariant();f&&(t=l.has(t)?"standard":t);let a=`/analyse/variant/${t}`;f&&(a+=`/fen/${encodeURIComponent(f)}`),c.set(a,!0),i()}else this.ctrl=new A(function(o,r){const i=B(r),n=G(r),c=t(o),l=r||a(o);return{game:{fen:l,id:"synthetic",initialFen:l,player:i,source:"offline",status:{id:10,name:"created"},turns:0,startedAtTurn:0,variant:c},takebackable:!1,orientation:"white",opponent:{color:s(i)},player:{color:i},pref:{destination:e.game.pieceDestinations(),highlight:e.game.highlights()},treeParts:[{fen:l,ply:n,crazyhouse:"crazyhouse"===c.key?{pockets:[M,M]}:void 0,pgnMoves:[]}],userAnalysis:!0}}(u,f),void 0,m,p,v,y,b),i()},oncreate(t){"1"===t.attrs.slide?d(t.dom):m(t.dom)},onremove(){h(),p.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(t){const a=f();if(this.ctrl){let t=null;this.ctrl.shouldGoBack&&(t="synthetic"===this.ctrl.data.game.id?u(y("div.main_header_title",b("analysis"))):u([y(T,{data:this.ctrl.data,subTitle:"date"}),v(this.ctrl.toggleBookmark,this.ctrl.data.bookmarked)]));const s=this.ctrl.shouldGoBack?null:y("div.main_header_title.withSub",[y("div",b("analysis")),C(this.ctrl)]);return F.board(j(s,t),I(this.ctrl,a),void 0,$(this.ctrl))}return _(a,t.attrs.color,t.attrs.curFen)}};export{U as default};
