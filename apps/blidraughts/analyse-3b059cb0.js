import{aS as t,bJ as a,bn as s,aK as e,aL as r,e as i,H as o,aP as n,r as l,ad as c,m as d,aJ as m,bx as h,by as p,aQ as f,s as u,aN as v,an as y,o as b,C as j,p as g,a$ as k,aR as w,bK as T}from"./main.js";import{g as B,c as $,b as x}from"./offlineGames-b5d74ab7.js";import{G as C}from"./GameTitle-898aeee2.js";import{l as G}from"./layout-26cca27d.js";import{g as A,A as F,r as I,a as _,o as P,l as R}from"./AnalyseCtrl-23c25d16.js";import"./game-3e605d21.js";import"./CountdownTimer-ca9a10d1.js";import"./continuePopup-d2e303e3.js";import"./notes-2c1d8afe.js";import"./TabView-6f41acb9.js";import"./chat-1f5c68bb.js";import"./area-59c9c857.js";import"./axis-d343de69.js";import"./Board-25b97c43.js";import"./draughts-5f7918a7.js";import"./vibrate-985a16e3.js";import"./index-28ac80d9.js";import"./studyXhr-5c18575b.js";var J={oninit(h){const p=h.attrs.source||"offline",f=h.attrs.id,u=h.attrs.color||"white",v=h.attrs.fen,y=h.attrs.variant,b=o(h.attrs.ply),j=h.attrs.tabId,g=void 0!==f||void 0!==v||"1"===h.attrs.goBack;if(n(),"online"===p&&f){const t=performance.now();A(f,u).then((a=>{const s=performance.now()-t;setTimeout((()=>{this.ctrl=new F(a,void 0,p,u,g,b,j),l()}),Math.max(400-s,0))})).catch((t=>{c(t),h.attrs.fallback&&h.attrs.variant&&h.attrs.curFen&&h.attrs.color?d.set(`/analyse/variant/${h.attrs.variant}/fen/${encodeURIComponent(h.attrs.curFen)}?color=${h.attrs.color}&goBack=1`):d.set("/analyse",!0),l()}))}else if("offline"===p&&"otb"===f)B().then((t=>{setTimeout((()=>{const a=t&&$(t,u);a?(a.player.spectator=!0,this.ctrl=new F(a,void 0,p,u,g,b,j),l()):d.set("/analyse",!0)}),400)}));else if("offline"===p&&"ai"===f)x().then((t=>{setTimeout((()=>{const a=t&&$(t,u);a?(a.player.spectator=!0,this.ctrl=new F(a,void 0,p,u,g,b,j),l()):d.set("/analyse",!0)}),400)}));else if(void 0===y){let t=i.analyse.syntheticVariant();v&&(t=m.has(t)?"standard":t);let a=`/analyse/variant/${t}`;v&&(a+=`/fen/${encodeURIComponent(v)}`),d.set(a,!0),l()}else this.ctrl=new F(function(o,n){const l=t(n),c=a(n),d=s(o),m=n||e(o);return{game:{fen:m,id:"synthetic",initialFen:m,player:l,source:"offline",status:{id:10,name:"created"},turns:0,startedAtTurn:0,variant:d},takebackable:!1,orientation:"white",opponent:{color:r(l)},player:{color:l},pref:{destination:i.game.pieceDestinations(),highlight:i.game.highlights()},treeParts:[{id:"",fen:m,ply:c,pdnMoves:[],children:[]}],userAnalysis:!0}}(y,v),void 0,p,u,g,b,j),l()},oncreate(t){"1"===t.attrs.slide?h(t.dom):p(t.dom)},onremove(){f(),u.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(t){const a=v();if(this.ctrl){let t=null;if(this.ctrl.shouldGoBack){const a=this.ctrl.data.game;t="synthetic"===a.id?y(b("div.main_header_title",["standard"!==a.variant.key?b("span.withIcon",{"data-icon":j(a.variant.key)||""}):null,g("analysis")])):y([b(C,{data:this.ctrl.data,subTitle:"date"}),k(this.ctrl.toggleBookmark,this.ctrl.data.bookmarked)])}const s=this.ctrl.shouldGoBack?null:b("div.main_header_title.withSub",[b("div",g("analysis")),I(this.ctrl)]);return G.board(w(s,t),_(this.ctrl,a),void 0,P(this.ctrl))}return R(a,t.attrs.color,T(t.attrs.curFen,!1),t.attrs.variant)}};export{J as default};
