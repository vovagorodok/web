import{o as e,q as t,p as o,cv as s,r as a,h as n,cz as u,ag as c,cA as l,m as r,ad as i,s as p,I as m,aR as d,an as f}from"./main.js";import{l as b}from"./layout-26cca27d.js";function v(n){const u=n.errors();return e("div",{className:"composeWrapper"},e("form",{id:"composeForm",onsubmit:e=>(e.preventDefault(),n.send(e.target))},n.id()?function(t){return e("input",{id:"recipient",type:"text",className:"composeInput",placeholder:o("recipient"),autocapitalize:"off",autocomplete:"off",value:t.id(),oninput:t.onInput,onblur:()=>{t.autocompleteResults([]),a()}})}(n):function(t){return e("input",{id:"recipient",type:"text",className:"composeInput",placeholder:o("recipient"),autocapitalize:"off",autocomplete:"off",oncreate:s,oninput:t.onInput,onblur:()=>{t.autocompleteResults([]),a()}})}(n),n.autocompleteResults().length?e("ul",{className:"compose_autocompleteResults native_scroller"},n.autocompleteResults().map((o=>e("li",{className:"list_item nav",key:o,oncreate:t((()=>function(e,t){t.autocompleteResults([]);const o=document.getElementById("recipient"),s=document.getElementById("subject");null!==o&&(o.value=e);null!==s&&s.focus()}(o,n)))},o)))):null,u&&u.username?y(u.username[0]):null,e("input",{id:"subject",type:"text",className:"composeInput",placeholder:o("subject"),oncreate:n.id()?s:void 0}),u&&u.subject?y(u.subject[0]):null,e("textarea",{id:"body",className:"composeInput composeTextarea"}),u&&u.text?y(u.text[0]):null,e("button",{className:"fatButton composeSend",type:"submit"},e("span",{className:"fa fa-check"}),o("send"))))}function y(t){return e("div",{className:"errorMessage"},t)}var h={oninit({attrs:e}){p.createDefault(),this.ctrl=function(e){const t=c(e),o=c(null),s=c([]);function p(e){e.body&&(e.body.username||e.body.subject||e.body.text)?(o(e.body),a()):i(e)}return{id:t,errors:o,send:function(e){const t=e[0].value,o=e[1].value,s=e[2].value;l(t,o,s).then((e=>{e.ok?r.set("/inbox/"+e.id):a()})).catch(p)},onInput:n((e=>{const t=e.target.value.trim();t.length>=3?u(t).then((e=>{s(e),a()})):(s([]),a())}),250),autocompleteResults:s}}(e.userId)},oncreate:m,view(){const e=d(null,f(o("composeMessage"))),t=v(this.ctrl);return b.free(e,t)}};export{h as default};
