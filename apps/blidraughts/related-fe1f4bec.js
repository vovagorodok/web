import{r as t,ad as e,cb as a,cc as s,E as o,s as l,cd as n,ce as i,o as r,B as c,v as g,q as h,p as u,ay as f,C as d,m as w,I as m,H as b,J as p,an as N}from"./main.js";import{l as P}from"./layout-26cca27d.js";import{T as v,a as T}from"./TabView-6f41acb9.js";class RelatedCtrl{constructor(n,i){this.userId=n,this.defaultTab=i,this.isLoadingNextPage=!1,this.loadNextPage=a=>{this.isLoadingNextPage=!0,this.getData(this.userId,a).then((()=>{this.isLoadingNextPage=!1,t()})).catch(e),t()},this.toggleFollowing=t=>{t.relation?a(t.user).then((e=>this.setNewUserState(t,e))):s(t.user).then((e=>this.setNewUserState(t,e)))},this.challenge=t=>{o.open(t)},this.onTabChange=e=>{const a=window.location.search.replace(/\?tab=\w+$/,"");try{window.history.replaceState(window.history.state,"",a+"?tab="+e)}catch(t){}this.currentTab=e,(0===this.currentTab&&!this.followers||1===this.currentTab&&!this.following)&&this.getData(this.userId,1).then(t),t()},this.currentTab=i||0,l.createDefault(),this.getData(this.userId,1).then(t).catch(e)}getData(t,e){return 0===this.currentTab?n(t,e).then((t=>{this.followers=(this.followers||[]).concat(t.paginator.currentPageResults),this.followersPaginator=t.paginator})):i(t,e).then((t=>{this.following=(this.following||[]).concat(t.paginator.currentPageResults),this.followingPaginator=t.paginator}))}setNewUserState(e,a){e.relation=a.following,t()}}function x(t,e,a){if(e){if(e.length){const s=a&&a.nextPage;return r("ul",{className:"native_scroller page"},e.map(((e,a)=>function(t,e,a){const s=e.online?"online":"offline",o=e.perfs&&Object.keys(e.perfs)[0],l=e.perfs&&e.perfs[o],n=h((()=>w.set(`/@/${e.user}`))),i=a%2==0?"even":"odd";return r("li",{className:`list_item followingList ${i}`},r("div",{className:"followingPlayerTitle",oncreate:n},r("div",{className:"user"},e.patron?r("span",{className:"patron userStatus "+s,"data-icon":"î€™"}):r("span",{className:"fa fa-circle userStatus "+s}),f(e.title),e.user),o?r("span",{className:"rating","data-icon":d(o)},l.rating):null),e.followable?r("div",{className:"followingPlayerItem"},r("div",{className:"check_container"},r("label",null,u("follow")),r("input",{type:"checkbox",checked:e.relation,onchange:()=>t.toggleFollowing(e)}))):null)}(t,e,a))),s?r("li",{className:"list_item followingList moreFollow",oncreate:h((()=>t.loadNextPage(s)))},t.isLoadingNextPage?g.getVdom("monochrome"):"..."):null)}return r("div",{className:"followingListEmpty"},"Oops! Nothing here.")}return r("div",{className:"followingListEmpty"},g.getVdom("monochrome"))}var y={oncreate:m,oninit(t){this.ctrl=new RelatedCtrl(t.attrs.id,b(t.attrs.tab))},view({attrs:t}){const e=t.username?r("div.title",[r("span",[...f(t.title),t.username])]):t.id;return P.free(p(null,N(e)),function(t){const e=[{id:"followers",f:()=>x(t,t.followers,t.followersPaginator)},{id:"following",f:()=>x(t,t.following,t.followingPaginator)}],a=t.followersPaginator&&t.followersPaginator.nbResults,s=t.followingPaginator&&t.followingPaginator.nbResults;return[r("div.tabs-nav-header.subHeader",r(v,{buttons:[{label:c("nbFollowers",a||0,a?void 0:"")},{label:c("nbFollowing",s||0,s?void 0:"")}],selectedIndex:t.currentTab,onTabChange:t.onTabChange})),r(T,{selectedIndex:t.currentTab,tabs:e,onTabChange:t.onTabChange})]}(this.ctrl))}};export{y as default};
