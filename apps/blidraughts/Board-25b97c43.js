import{o as e,b9 as t,r as i,e as o,ba as r}from"./main.js";const a=t;function n(e,t,i,o){const r=512*o[0]/10;return(e.lineWidth||10)*(t?.7:1)/r*i.width}function l(e,t){return(e.opacity||1)*(t?.6:1)}function s(e,t,i){return[(2*e[0]-(e[1]%2!=0?.5:1.5))*t.width/i[0],(e[1]-.5)*t.height/i[1]]}function c(e,t,i){return"white"===t?e:[i[0]/2+1-e[0],i[1]+1-e[1]]}function h(t,i,o,r,h,p,d){return function(u){if(u.piece)return function(t,i,o,r,a){const n=s(i,r,a),l=r.width/10,c=`images/pieces/${t}/${o.color[0]+o.role[0].toUpperCase()}.svg`;return e("image",{x:n[0]-l/2,y:n[1]-l/2,width:l,height:l,"xlink:href":c})}(p,c(a(u.orig,d),t,d),u.piece,h,d);const y=o[u.brush];return y&&u.orig&&u.dest?function(t,i,o,r,a,c,h){const p=function(e,t,i){return i[0]*(t?2:1)/512*e.width}(c,a&&!r,h),d=s(i,c,h),u=s(o,c,h),y=u[0]-d[0],b=u[1]-d[1],k=Math.atan2(b,y),g=Math.cos(k)*p,m=Math.sin(k)*p;return e("line",{stroke:t.color,"stroke-width":n(t,r,c,h),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+t.key+")",opacity:l(t,r),x1:d[0],y1:d[1],x2:u[0]-g,y2:u[1]-m})}(y,c(a(u.orig,d),t,d),c(a(u.dest,d),t,d),i,r[u.dest]>1,h,d):y&&u.orig?function(t,i,o,r,a){const n=s(i,r,a),c=function(e,t,i){return(e?3:4)/(512*i[0]/10)*t.width}(o,r,a),h=(r.width+r.height)/(2*(a[0]+a[1]));return e("circle",{stroke:t.color,"stroke-width":c,fill:"none",opacity:l(t,o),cx:n[0],cy:n[1],r:h-c/2})}(y,c(a(u.orig,d),t,d),i,h,d):null}}const p={green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleBlue12:{key:"pb12",color:"#003088",opacity:.3,lineWidth:12},paleBlue11:{key:"pb11",color:"#003088",opacity:.3,lineWidth:11},paleBlue10:{key:"pb10",color:"#003088",opacity:.3,lineWidth:10},paleBlue9:{key:"pb9",color:"#003088",opacity:.3,lineWidth:9},paleBlue8:{key:"pb8",color:"#003088",opacity:.3,lineWidth:8},paleBlue7:{key:"pb7",color:"#003088",opacity:.3,lineWidth:7},paleBlue6:{key:"pb6",color:"#003088",opacity:.3,lineWidth:6},paleBlue5:{key:"pb5",color:"#003088",opacity:.3,lineWidth:5},paleBlue4:{key:"pb4",color:"#003088",opacity:.3,lineWidth:4},paleBlue3:{key:"pb3",color:"#003088",opacity:.3,lineWidth:3},paleBlue2:{key:"pb2",color:"#003088",opacity:.3,lineWidth:2},paleBlue_2:{key:"pb_2",color:"#003088",opacity:.6,lineWidth:15},paleBlue_3:{key:"pb_3",color:"#003088",opacity:.3,lineWidth:15},paleBlue_4:{key:"pb_4",color:"#003088",opacity:.8,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},palePurple:{key:"pp",color:"#4b0082",opacity:.35,lineWidth:10},paleRed:{key:"pr",color:"rgb(136, 32, 32)",opacity:.65,lineWidth:15},paleRed2:{key:"pr2",color:"rgb(136, 32, 32)",opacity:.4,lineWidth:8},paleRed3:{key:"pr3",color:"rgb(136, 32, 32)",opacity:.8,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},d=function(t){return e("defs",null,t.map((t=>e("marker",{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},e("path",{d:"M0,0 V4 L3,2 Z",fill:t.color})))))}(Object.keys(p).map((e=>p[e])));function u(t,i,o,r,a){if(!o)return null;if(!t)return null;if(t.width!==t.height)return null;const n={};return o.forEach((e=>{e.dest&&(n[e.dest]=(n[e.dest]||0)+1)})),e("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},[d,o.map(h(i,!1,p,n,t,r,a))])}var y={oninit(e){const{draughtsground:t,canClearShapes:r}=e.attrs;this.wrapperOnCreate=({dom:e})=>{r&&e.addEventListener("touchstart",(()=>{this.shapesCleared||(this.shapesCleared=!0,i())})),this.bounds=e.getBoundingClientRect(),this.onResize=()=>{this.bounds=e.getBoundingClientRect()},window.addEventListener("resize",this.onResize)},this.boardOnCreate=({dom:e})=>{t.attach(e,this.bounds)},this.boardOnRemove=()=>{t.detach()},this.shapesCleared=!1,this.pieceTheme=o.general.theme.piece(),this.boardTheme=o.general.theme.board(),this.blindfoldDraughts=o.game.blindfoldDraughts()},onbeforeupdate({attrs:e},{attrs:t}){return e.clearableShapes!==t.clearableShapes&&(this.shapesCleared=!1),!0},view(t){const{variant:i,draughtsground:o,wrapperClasses:a,customPieceTheme:n,shapes:l,clearableShapes:s}=t.attrs,c=["display_board","orientation-"+o.state.orientation,`board-${this.boardTheme}`,n||this.pieceTheme,`blindfold-${this.blindfoldDraughts}`,i,"is"+r(i).key].join(" ");let h="playable_board_wrapper";a&&(h+=" ",h+=a);const p=[...void 0!==l?l:[],...void 0===s||this.shapesCleared?[]:s];return e("section",{className:h,oncreate:this.wrapperOnCreate,onremove:()=>{window.removeEventListener("resize",this.onResize)}},[t.children,e("div",{className:c,oncreate:this.boardOnCreate,onremove:this.boardOnRemove}),p.length>0&&this.bounds?u(this.bounds,o.state.orientation,p,this.pieceTheme,o.state.boardSize):null])}};export{y as B};
