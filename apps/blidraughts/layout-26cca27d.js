import{L as e,M as a,O as t,P as s,Q as n,R as i,S as o,o as l,T as c,b as r,k as u,U as h,p as d,B as p,V as m,X as v,Y as f,_ as g,$ as w,s as N,a0 as k,a1 as b,G as _,a2 as M,a3 as S,r as y,a4 as E,D as T,a5 as X,a6 as Y,e as D,a7 as O,m as C,a8 as x,z as G,a9 as L,aa as P,ab as V,ac as I,ad as B,K as A,ae as $,w as R,af as F,ag as W,ah as j,ai as K,aj as z,ak as H,E as U,al as q,am as Q}from"./main.js";class Gesture{constructor(e,a,t){this.element=e,this.vd=a,this.options=t,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[]},this.swipingDirection=null,this.startInputTimestamp=0,this.onTouchStart=e=>{e.changedTouches.length>1||(this.touchStartX=e.changedTouches[0].pageX,this.touchStartY=e.changedTouches[0].pageY,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.touchEndX=null,this.touchEndY=null,this.startInputTimestamp=performance.now(),this.fire("panstart",e))},this.onTouchMove=e=>{if(e.changedTouches.length>1)return;this.touchMoveX=e.changedTouches[0].pageX-this.touchStartX;const a=performance.now()-this.startInputTimestamp;this.velocityX=this.touchMoveX/a,this.touchMoveY=e.changedTouches[0].pageY-this.touchStartY,this.velocityY=this.touchMoveY/a;const t=Math.abs(this.touchMoveX),s=Math.abs(this.touchMoveY),n=t>this.swipeThresholdX,i=s>this.swipeThresholdY;this.swipingDirection=t>s?n?"horizontal":"pre-horizontal":i?"vertical":"pre-vertical",this.fire("panmove",e)},this.onTouchEnd=e=>{if(e.changedTouches.length>1)return;this.touchEndX=e.changedTouches[0].pageX,this.touchEndY=e.changedTouches[0].pageY,this.fire("panend",e);const a=this.touchEndX-this.touchStartX,t=Math.abs(a),s=this.touchEndY-this.touchStartY,n=Math.abs(s);if(t>this.swipeThresholdX||n>this.swipeThresholdY){const i=t>=n&&t>this.swipeThresholdX,o=n>t&&n>this.swipeThresholdY;i&&(a<0?this.velocityX<-this.opts.swipeVelocityThreshold&&this.fire("swipeleft",e):this.velocityX>this.opts.swipeVelocityThreshold&&this.fire("swiperight",e)),o&&(s<0?this.velocityY<-this.opts.swipeVelocityThreshold&&this.fire("swipeup",e):this.velocityY>this.opts.swipeVelocityThreshold&&this.fire("swipedown",e))}},this.swipeThresholdX=J("x",a),this.swipeThresholdY=J("y",a),this.element=e,this.opts=Object.assign({},Z,t),this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.velocityX=0,this.velocityY=0,this.touchMoveX=0,this.touchMoveY=0,this.element.addEventListener("touchstart",this.onTouchStart,ee),this.element.addEventListener("touchmove",this.onTouchMove,!!this.opts.passiveMove&&ee),this.element.addEventListener("touchend",this.onTouchEnd,ee)}destroy(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}on(e,a){if(this.handlers[e])return this.handlers[e].push(a),{type:e,fn:a,cancel:()=>this.off(e,a)}}off(e,a){if(this.handlers[e]){const t=this.handlers[e].indexOf(a);-1!==t&&this.handlers[e].splice(t,1)}}fire(e,a){for(let t=0;t<this.handlers[e].length;t++)this.handlers[e][t](a)}}function J(e,a){return Math.max(25,Math.floor(.15*("x"===e?a.vw:a.vh)))}const Z={swipeVelocityThreshold:.4,passiveMove:!0},ee={passive:!0};function ae(o,l){const c=l.side,r=e(),u={backDropElement:null,isScrolling:!1,isClosing:!1},h=new Gesture(o,a(),{passiveMove:!1});h.on("panstart",(()=>{u.backDropElement=l.getBackdropEl(),u.isScrolling=!1,u.isClosing=!1})),h.on("panmove",(e=>{if(!u.isScrolling){if(u.isClosing)e.preventDefault();else if("left"===c&&h.touchMoveX<-5||"right"===c&&h.touchMoveX>5)e.preventDefault(),u.isClosing=!0;else if(u.isScrolling=Math.abs(h.touchMoveY)>5,u.isScrolling)return;"left"===c?h.touchMoveX<0&&h.touchMoveX>=-r&&(t(o,h.touchMoveX),s(u.backDropElement,(r+h.touchMoveX)/r*100/100*n)):h.touchMoveX>0&&h.touchMoveX<=r&&(t(o,h.touchMoveX),s(u.backDropElement,(r-h.touchMoveX)/r*100/100*n))}})),h.on("panend",(()=>{if(u.isScrolling)return;u.isScrolling=!1,u.isClosing=!1;const e=h.velocityX;0!==e&&("left"===c?e<0&&(h.touchMoveX<-(r-r*i)||e<-.4)?l.close():l.open():e>0&&(h.touchMoveX>r-r*i||e>.4)?l.close():l.open())}))}var te={onbeforeupdate:()=>o.isOpen,view(){const e=r.get();return l("aside",{id:"side_menu",oncreate:({dom:e})=>{ae(e,o)}},function(e){const a=c()?"up":"down";return l("header",{className:"side_menu_header",oncreate:h(b)},r.isKidMode()?l("div",{className:"kiddo"},"ðŸ˜Š"):null,function(e){const a=g(),t=w(),s=`PING: ${d("networkLagBetweenYouAndLidraughts")}; SERVER: ${d("timeToProcessAMoveOnLidraughtsServer")}`,n=e=>{e.stopPropagation(),Y.show({text:s,duration:"long",position:"top"})};return l("div",{className:"pingServer"},function(e){const a=void 0===e?0:e<150?4:e<300?3:e<500?2:1,t=[];for(let e=1;e<=4;e++)t.push(l(e<=a?"i":"i.off"));return l("signal.q"+a,t)}(u()?a:void 0),u()?l("div",null,l("div",null,l("span",{className:"pingKey"},"PingÂ Â Â "),l("strong",{className:"pingValue"},N.isConnected()&&a?a:"?")," ms"),e?l("div",null,l("span",{className:"pingKey"},"ServerÂ "),l("strong",{className:"pingValue"},N.isConnected()&&t?t:"?")," ms"):null):l("div",null,"Offline"),u()?l("i",{className:"fa fa-question-circle-o",oncreate:h(n)}):null)}(e),u()&&!e?l("button",{className:"signInButton",oncreate:h(k.open)},d("signIn")):null,e?l("h2",{className:"username"},e.username,l("i",{className:"fa fa-caret-"+a})):null)}(e),l("div",{className:"native_scroller side_menu_scroller"},e&&c()?function(e){const a={username:e.username};e.title&&(a.title=e.title);e.patron&&(a.patron="1");return l("ul",{className:"side_links profileActions",oncreate:h(ne,void 0,_)},l("li",{className:"side_link","data-route":`/@/${e.id}`},e.patron?l("span",{className:"patron","data-icon":"î€™"}):l("span",{className:"fa fa-circle userStatus online"}),d("profile")),l("li",{className:"side_link","data-route":`/@/${e.id}/games?${f(a)}`},l("span",{className:"menu_icon_game"}),d("games")),l("li",{className:"side_link","data-route":"/inbox"},l("span",{className:"fa fa-envelope"}),d("inbox")+(null!==v()&&v()>0?" ("+v()+")":"")),l("li",{className:"side_link","data-route":"/account/preferences"},l("span",{"data-icon":"%"}),d("preferences")),l("li",{className:"side_link","data-action":"friends"},l("span",{"data-icon":"f"}),p("nbFriendsOnline",m.count())),l("li",{className:"side_link","data-route":`/@/${e.id}/related`},l("span",{className:"fa fa-arrow-circle-left"}),p("nbFollowers",e.nbFollowers||0)),l("li",{className:"side_link","data-nocloseaction":"logout"},l("span",{"data-icon":"w"}),d("logOut")))}(e):function(e){const a=u();return l("ul",{className:"side_links",oncreate:h(ne,void 0,_)},l("li",{className:"side_link","data-route":"/"},l("span",{className:"fa fa-home"}),d("home")),a?l("li",{className:"sep_link"},d("playOnline")):null,a&&!r.hasCurrentBan()?l("li",{className:"side_link","data-action":"createGame"},l("span",{className:"fa fa-plus-circle"}),d("createAGame")):null,a?l("li",{className:"side_link","data-route":"/tournament"},l("span",{className:"fa fa-trophy"}),d("tournaments")):null,l("li",{className:"sep_link"},d("learnMenu")),a?l("li",{className:"side_link","data-route":"/training"},l("span",{"data-icon":"-"}),d("training")):null,!a&&e?l("li",{className:"side_link","data-route":"/training"},l("span",{"data-icon":"-"}),d("training")):null,a?l("li",{className:"side_link","data-route":"/study"},l("span",{"data-icon":"4"}),d("studyMenu")):null,a?l("li",{className:"sep_link"},d("watch")):null,a?l("li",{className:"side_link","data-route":"/tv"},l("span",{"data-icon":"1"}),d("watchLidraughtsTV")):null,a?l("li",{className:"sep_link"},d("community")):null,a?l("li",{className:"side_link","data-route":"/players"},l("span",{className:"fa fa-at"}),d("players")):null,l("li",{className:"sep_link"},d("tools")),l("li",{className:"side_link","data-route":"/analyse"},l("span",{"data-icon":"A"}),d("analysis")),l("li",{className:"side_link","data-route":"/editor"},l("span",{className:"fa fa-pencil"}),d("boardEditor")),l("li",{className:"side_link","data-route":"/clock"},l("span",{className:"fa fa-clock-o"}),d("clock")),a?l("li",{className:"side_link","data-route":"/importer"},l("span",{className:"fa fa-cloud-upload"}),d("importGame")):null,a?l("li",{className:"side_link","data-route":"/search"},l("span",{className:"fa fa-search"}),d("advancedSearch")):null,l("li",{className:"sep_link"},d("playOffline")),l("li",{className:"side_link","data-route":"/ai"},l("span",{className:"fa fa-cogs"}),d("playOfflineComputer")),l("li",{className:"side_link","data-route":"/otb"},l("span",{className:"fa fa-beer"}),d("playOfflineOverTheBoard")),l("li",{className:"hr"}),l("li",{className:"side_link","data-route":"/settings"},l("span",{className:"fa fa-cog"}),d("settings")),l("li",{className:"side_link","data-route":"/about"},l("span",{className:"fa fa-info-circle"}),d("about")))}(e)))}};const se={gamesMenu:()=>E.open(),createGame:()=>T.openRealTime(),friends:()=>X.open(),logout:()=>{r.logout(),c(!1)}};function ne(e){e.stopPropagation();const a=_(e);if(a){const e=a.dataset;e.route?M(e.route)():a&&e.action?S(se[e.action])():a&&e.nocloseaction&&(se[e.nocloseaction](),y())}}let ie,oe=!1;var le={open:ce,close:re,openAIFromPosition(e){D.gameSetup.ai.variant("3"),ce(),ie=e},view:()=>O("game_form_popup",void 0,(function(){return function(e,a,t,s){const n="1"===a.timeMode(),i=[l("div.select_input",[x.renderSelect("variant",e+"variant",t,a.variant)])],o=[["randomColor","random"],["white","white"],["black","black"]];i.unshift(l("div.select_input",[x.renderSelect("side",e+"color",o,a.color)])),"3"===a.variant()&&i.push(l("div.setupPosition",ie?[l("div.setupMiniBoardWrapper",{style:{width:"100px",height:"100px"},oncreate:G((()=>{re(),ie&&C.set(`/editor/${encodeURIComponent(ie)}`)}))},[l(L,{fen:ie,variant:P(a.variant())||"standard",orientation:"white"})])]:l("div",l("button.withIcon.fa.fa-pencil",{oncreate:G((()=>{re(),C.set("/editor")}))},d("boardEditor")))));i.push(l("div.select_input",[x.renderSelect("level","ailevel",["1","2","3","4","5","6","7","8"].map(V),a.level)]));const c=[l("div.select_input",[x.renderSelect("clock",e+"timeMode",s,a.timeMode)])];n&&c.push(l("div.select_input.inline",[x.renderSelect("time",e+"time",D.gameSetup.availableTimes,a.time,!1)]),l("div.select_input.inline",[x.renderSelect("increment",e+"increment",D.gameSetup.availableIncrements.map(V),a.increment,!1)]));return l("form.game_form",{onsubmit:function(e){e.preventDefault(),D.gameSetup.isTimeValid(a)&&(re(),I(ie).then((e=>{C.set("/game"+e.url.round)})).catch(B))}},[l("fieldset",i),l("fieldset",c),l("div.popupActionWrapper",[l("button.defaultButton[type=submit]",d("playWithTheMachine"))])])}("ai",D.gameSetup.ai,D.gameSetup.ai.availableVariants,D.gameSetup.ai.availableTimeModes)}),oe,re)};function ce(){C.backbutton.stack.push(re),ie=void 0,oe=!0}function re(e){"backbutton"!==e&&oe&&C.backbutton.stack.pop(),oe=!1}function ue(o){const l=o.side,c=e(),r={menuElement:null,backDropElement:null,canSlide:!1};return{panstart:e=>t=>{const s=t.target;"PIECE"===s.nodeName||"SQUARE"===s.nodeName||s.className.startsWith&&s.className.startsWith("cg-board manipulable")||!function(e,a,t){return"left"===a?e<$:e>t-$}(e.touchStartX,l,a().vw)?r.canSlide=!1:(r.menuElement=o.getMenuEl(),r.backDropElement=o.getBackdropEl(),r.menuElement&&r.backDropElement&&(r.menuElement.style.visibility="visible",r.backDropElement.style.visibility="visible",r.canSlide=!0,y()))},panmove:e=>a=>{if(r.canSlide){"ios"===A.getPlatform()&&(a.defaultPrevented||a.preventDefault());const i=e.touchMoveX;"left"===l?i<=c&&(t(r.menuElement,-c+i),s(r.backDropElement,i/c*100/100*n)):i>=-c&&(t(r.menuElement,c+i),s(r.backDropElement,-i/c*100/100*n))}},panend:e=>()=>{const a=e.velocityX;if(r.canSlide&&0!==a){r.canSlide=!1;const t=e.touchMoveX;"left"===l?a>0&&(t>=c*i||a>.2)?o.open():o.close():a<0&&(t<=-c*i||a<-.2)?o.open():o.close()}}}}const he=W(!1);function de(e){return e?l("div.announce",{className:he()?"expanded":""},[l("span.text",{oncreate:G((()=>{he(!he()),y()}))},e.msg),l("small",R(new Date(e.date),!0)),l("button.dismiss",{oncreate:G(j.dismiss)},F)]):null}var pe={oninit(){this.boundHandlers=!1},oncreate({dom:e}){this.gesture=new Gesture(e,a());const t=ue(o);for(const e in t)this.gesture.on(e,t[e](this.gesture))},onupdate({attrs:e}){if(!this.boundHandlers&&e.handlers){this.boundHandlers=!0;for(const a in e.handlers)this.gesture.on(a,e.handlers[a](this.gesture))}},view({attrs:e,children:a}){const{header:t,color:s}=e,n={righty:"right"===D.game.landscapeBoardSide()};return e.klass&&(n[e.klass]=!0),l("main#page",{className:s},[l("header.main_header.board",t),de(j.get()),l("div.content_round",{className:K(n)},a),l("div#menu-close-overlay.menu-backdrop",{oncreate:z})])}},me={board(e,a,t,s,n,i,o){const c=D.general.theme.background(),r=t?Object.assign({key:t},fe(c)):fe(c);return l("div.view-container",r,[l(pe,{header:e,color:i,handlers:n,klass:o},a),l(te),E.view(),k.view(),H.view(),T.view(),le.view(),U.view(),X.view(),q.view(),s])},free(e,a,t,s,n){const i=D.general.theme.background();return l("div.view-container",fe(i),[l("main#page",{oncreate:ve},[l("header.main_header",e),de(j.get()),l("div#free_content.content.native_scroller",{className:t?"withFooter":"",oncreate:({dom:e})=>{n&&e.addEventListener("scroll",n)}},a),t?l("footer.main_footer",t):null,l("div#menu-close-overlay.menu-backdrop",{oncreate:z})]),l(te),E.view(),k.view(),H.view(),T.view(),le.view(),U.view(),X.view(),q.view(),s])},clock(e,a){const t=D.general.theme.background();return l("div.view-container",fe(t),[l("main#page",[l("div.content.fullScreen",e())]),a?a():null])}};function ve({dom:e}){const t=new Gesture(e,a(),{passiveMove:"ios"!==A.getPlatform()}),s=ue(o);for(const e in s)t.on(e,s[e](t))}function fe(e){return{className:(a=e,"dark"===a||"light"===a?a:"system"===a?Q():"transp "+a)};var a}export{ae as C,ue as E,Gesture as G,me as l,le as p};
