/*! Capacitor: https://capacitorjs.com/ - MIT License */
var e;!function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(e||(e={}));class CapacitorException extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const t=t=>{const n=t.CapacitorCustomPlatform||null,a=t.Capacitor||{},i=a.Plugins=a.Plugins||{},r=()=>null!==n?n.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(t),o=e=>{var t;return null===(t=a.PluginHeaders)||void 0===t?void 0:t.find((t=>t.name===e))},s=new Map;return a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=r,a.handleError=e=>t.console.error(e),a.isNativePlatform=()=>"web"!==r(),a.isPluginAvailable=e=>{const t=s.get(e);return!!(null==t?void 0:t.platforms.has(r()))||!!o(e)},a.registerPlugin=(t,l={})=>{const c=s.get(t);if(c)return c.proxy;const u=r(),d=o(t);let h;const m=i=>{let r;const o=(...o)=>{const s=(async()=>(!h&&u in l?h=h="function"==typeof l[u]?await l[u]():l[u]:null!==n&&!h&&"web"in l&&(h=h="function"==typeof l.web?await l.web():l.web),h))().then((n=>{const s=((n,i)=>{var r,o;if(!d){if(n)return null===(o=n[i])||void 0===o?void 0:o.bind(n);throw new CapacitorException(`"${t}" plugin is not implemented on ${u}`,e.Unimplemented)}{const e=null==d?void 0:d.methods.find((e=>i===e.name));if(e)return"promise"===e.rtype?e=>a.nativePromise(t,i.toString(),e):(e,n)=>a.nativeCallback(t,i.toString(),e,n);if(n)return null===(r=n[i])||void 0===r?void 0:r.bind(n)}})(n,i);if(s){const e=s(...o);return r=null==e?void 0:e.remove,e}throw new CapacitorException(`"${t}.${i}()" is not implemented on ${u}`,e.Unimplemented)}));return"addListener"===i&&(s.remove=async()=>r()),s};return o.toString=()=>`${i.toString()}() { [capacitor code] }`,Object.defineProperty(o,"name",{value:i,writable:!1,configurable:!1}),o},p=m("addListener"),f=m("removeListener"),g=(e,t)=>{const n=p({eventName:e},t),a=async()=>{const a=await n;f({eventName:e,callbackId:a},t)},i=new Promise((e=>n.then((()=>e({remove:a})))));return i.remove=async()=>{await a()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?g:p;case"removeListener":return f;default:return m(t)}}});return i[t]=v,s.set(t,{name:t,proxy:v,platforms:new Set([...Object.keys(l),...d?[u]:[]])}),v},a.Exception=CapacitorException,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a},n=(e=>e.Capacitor=t(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),a=n.registerPlugin;class WebPlugin{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),n&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,n){const a=this.listeners[e];if(a)a.forEach((e=>e(t)));else if(n){let n=this.retainedEventArguments[e];n||(n=[]),n.push(t),this.retainedEventArguments[e]=n}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(t="not implemented"){return new n.Exception(t,e.Unimplemented)}unavailable(t="not available"){return new n.Exception(t,e.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const a=n.indexOf(t);this.listeners[e].splice(a,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach((t=>{this.notifyListeners(e,t)})))}}const i=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),r=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class CapacitorCookiesPluginWeb extends WebPlugin{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach((e=>{if(e.length<=0)return;let[n,a]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=r(n).trim(),a=r(a).trim(),t[n]=a})),t}async setCookie(e){try{const t=i(e.key),n=i(e.value),a=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),o=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${a}; path=${r}; ${o};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}a("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});const o=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),a=((e={})=>{const t=Object.keys(e);return Object.keys(e).map((e=>e.toLocaleLowerCase())).reduce(((n,a,i)=>(n[a]=e[t[i]],n)),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,a]of Object.entries(e.data||{}))t.set(n,a);n.body=t.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach(((e,n)=>{t.append(n,e)}));else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(a.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n};class CapacitorHttpPluginWeb extends WebPlugin{async request(e){const t=o(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce(((e,n)=>{const[a,i]=n;let r,o;return Array.isArray(i)?(o="",i.forEach((e=>{r=t?encodeURIComponent(e):e,o+=`${a}=${r}&`})),o.slice(0,-1)):(r=t?encodeURIComponent(i):i,o=`${a}=${r}`),`${e}&${o}`}),"").substr(1):null)(e.params,e.shouldEncodeUrlParams),a=n?`${e.url}?${n}`:e.url,i=await fetch(a,t),r=i.headers.get("content-type")||"";let s,l,{responseType:c="text"}=i.ok?e:{};switch(r.includes("application/json")&&(c="json"),c){case"arraybuffer":case"blob":l=await i.blob(),s=await(async e=>new Promise(((t,n)=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},a.onerror=e=>n(e),a.readAsDataURL(e)})))(l);break;case"json":s=await i.json();break;default:s=await i.text()}const u={};return i.headers.forEach(((e,t)=>{u[t]=e})),{data:s,headers:u,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}a("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb});const s=a("App",{web:()=>import("./web-5398aa8b.js").then((e=>new e.AppWeb))}),l=a("Device",{web:()=>import("./web-368f526b.js").then((e=>new e.DeviceWeb))}),c=a("SplashScreen",{web:()=>import("./web-4a6fae5e.js").then((e=>new e.SplashScreenWeb))}),u=a("Network",{web:()=>import("./web-93e64e72.js").then((e=>new e.NetworkWeb))});var d,h;!function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(d||(d={})),function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"}(h||(h={}));const m=a("Keyboard");function p(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var f="object"==typeof global&&global&&global.Object===Object&&global,g="object"==typeof self&&self&&self.Object===Object&&self,v=f||g||Function("return this")(),b=function(){return v.Date.now()},y=/\s/;var w=/^\s+/;function k(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&y.test(e.charAt(t)););return t}(e)+1).replace(w,""):e}var S=v.Symbol,C=Object.prototype,T=C.hasOwnProperty,M=C.toString,x=S?S.toStringTag:void 0;var P=Object.prototype.toString;var E="[object Null]",O="[object Undefined]",N=S?S.toStringTag:void 0;function _(e){return null==e?void 0===e?O:E:N&&N in Object(e)?function(e){var t=T.call(e,x),n=e[x];try{e[x]=void 0;var a=!0}catch(e){}var i=M.call(e);return a&&(t?e[x]=n:delete e[x]),i}(e):function(e){return P.call(e)}(e)}var L="[object Symbol]";var I=NaN,D=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,A=/^0o[0-7]+$/i,B=parseInt;function R(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&_(e)==L}(e))return I;if(p(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=p(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=k(e);var n=j.test(e);return n||A.test(e)?B(e.slice(2),n?2:8):D.test(e)?I:+e}var $="Expected a function",z=Math.max,F=Math.min;function U(e,t,n){var a,i,r,o,s,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError($);function m(t){var n=a,r=i;return a=i=void 0,c=t,o=e.apply(r,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=r}function g(){var e=b();if(f(e))return v(e);s=setTimeout(g,function(e){var n=t-(e-l);return d?F(n,r-(e-c)):n}(e))}function v(e){return s=void 0,h&&a?m(e):(a=i=void 0,o)}function y(){var e=b(),n=f(e);if(a=arguments,i=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(g,t),u?m(e):o}(l);if(d)return clearTimeout(s),s=setTimeout(g,t),m(l)}return void 0===s&&(s=setTimeout(g,t)),o}return t=R(t)||0,p(n)&&(u=!!n.leading,r=(d="maxWait"in n)?z(R(n.maxWait)||0,t):r,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=i=s=void 0},y.flush=function(){return void 0===s?o:v(b())},y}const W=a("Toast",{web:()=>import("./web-a25bad9d.js").then((e=>new e.ToastWeb))});var G=6e4;function q(e){return e.getTime()%G}function V(e){var t=new Date(e.getTime()),n=Math.ceil(t.getTimezoneOffset());t.setSeconds(0,0);var a=n>0?(G+q(t))%G:q(t);return n*G+a}function H(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Y(e){H(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}function K(e,t){H(2,arguments);var n=function(e,t){H(2,arguments);var n=Y(e),a=Y(t);return n.getTime()-a.getTime()}(e,t)/1e3;return n>0?Math.floor(n):Math.ceil(n)}function X(e){return function(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e)}var J={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Q(e){return function(t){var n=t||{},a=n.width?String(n.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}var Z={date:Q({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Q({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Q({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ee={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function te(e){return function(t,n){var a,i=n||{};if("formatting"===(i.context?String(i.context):"standalone")&&e.formattingValues){var r=e.defaultFormattingWidth||e.defaultWidth,o=i.width?String(i.width):r;a=e.formattingValues[o]||e.formattingValues[r]}else{var s=e.defaultWidth,l=i.width?String(i.width):e.defaultWidth;a=e.values[l]||e.values[s]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function ne(e){return function(t,n){var a=String(t),i=n||{},r=i.width,o=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],s=a.match(o);if(!s)return null;var l,c=s[0],u=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth];return l="[object Array]"===Object.prototype.toString.call(u)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(u,(function(e){return e.test(c)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(u,(function(e){return e.test(c)})),l=e.valueCallback?e.valueCallback(l):l,{value:l=i.valueCallback?i.valueCallback(l):l,rest:a.slice(c.length)}}}var ae,ie={code:"en-US",formatDistance:function(e,t,n){var a;return n=n||{},a="string"==typeof J[e]?J[e]:1===t?J[e].one:J[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+a:a+" ago":a},formatLong:Z,formatRelative:function(e,t,n,a){return ee[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:te({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:te({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:te({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:te({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:te({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(ae={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),a=t||{},i=n.match(ae.matchPattern);if(!i)return null;var r=i[0],o=n.match(ae.parsePattern);if(!o)return null;var s=ae.valueCallback?ae.valueCallback(o[0]):o[0];return{value:s=a.valueCallback?a.valueCallback(s):s,rest:n.slice(r.length)}}),era:ne({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ne({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ne({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ne({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ne({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},re=1440,oe=43200,se=525600;function le(e,t,n){H(2,arguments);var a=n||{},i=a.locale||ie;if(!i.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var r=function(e,t){H(2,arguments);var n=Y(e),a=Y(t),i=n.getTime()-a.getTime();return i<0?-1:i>0?1:i}(e,t);if(isNaN(r))throw new RangeError("Invalid time value");var o,s,l=X(a);l.addSuffix=Boolean(a.addSuffix),l.comparison=r,r>0?(o=Y(t),s=Y(e)):(o=Y(e),s=Y(t));var c,u=null==a.roundingMethod?"round":String(a.roundingMethod);if("floor"===u)c=Math.floor;else if("ceil"===u)c=Math.ceil;else{if("round"!==u)throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");c=Math.round}var d,h=K(s,o),m=c((h-(V(s)-V(o))/1e3)/60);if("second"===(d=null==a.unit?m<1?"second":m<60?"minute":m<re?"hour":m<oe?"day":m<se?"month":"year":String(a.unit)))return i.formatDistance("xSeconds",h,l);if("minute"===d)return i.formatDistance("xMinutes",m,l);if("hour"===d){var p=c(m/60);return i.formatDistance("xHours",p,l)}if("day"===d){var f=c(m/re);return i.formatDistance("xDays",f,l)}if("month"===d){var g=c(m/oe);return i.formatDistance("xMonths",g,l)}if("year"===d){var v=c(m/se);return i.formatDistance("xYears",v,l)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function ce(e){H(1,arguments);var t=Y(e);return t.setHours(0,0,0,0),t}var ue=864e5;function de(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function he(e,t){H(2,arguments);var n=Y(e).getTime(),a=de(t);return new Date(n+a)}function me(e,t){return H(2,arguments),he(e,-de(t))}function pe(e,t){for(var n=e<0?"-":"",a=Math.abs(e).toString();a.length<t;)a="0"+a;return n+a}var fe={y:function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return pe("yy"===t?a%100:a,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):pe(n+1,2)},d:function(e,t){return pe(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.toUpperCase();case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return pe(e.getUTCHours()%12||12,t.length)},H:function(e,t){return pe(e.getUTCHours(),t.length)},m:function(e,t){return pe(e.getUTCMinutes(),t.length)},s:function(e,t){return pe(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,a=e.getUTCMilliseconds();return pe(Math.floor(a*Math.pow(10,n-3)),t.length)}};function ge(e){H(1,arguments);var t=Y(e),n=t.getUTCDay(),a=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function ve(e){H(1,arguments);var t=Y(e),n=t.getUTCFullYear(),a=new Date(0);a.setUTCFullYear(n+1,0,4),a.setUTCHours(0,0,0,0);var i=ge(a),r=new Date(0);r.setUTCFullYear(n,0,4),r.setUTCHours(0,0,0,0);var o=ge(r);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function be(e){H(1,arguments);var t=Y(e),n=ge(t).getTime()-function(e){H(1,arguments);var t=ve(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),ge(n)}(t).getTime();return Math.round(n/6048e5)+1}function ye(e,t){H(1,arguments);var n=t||{},a=n.locale,i=a&&a.options&&a.options.weekStartsOn,r=null==i?0:de(i),o=null==n.weekStartsOn?r:de(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=Y(e),l=s.getUTCDay(),c=(l<o?7:0)+l-o;return s.setUTCDate(s.getUTCDate()-c),s.setUTCHours(0,0,0,0),s}function we(e,t){H(1,arguments);var n=Y(e,t),a=n.getUTCFullYear(),i=t||{},r=i.locale,o=r&&r.options&&r.options.firstWeekContainsDate,s=null==o?1:de(o),l=null==i.firstWeekContainsDate?s:de(i.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var c=new Date(0);c.setUTCFullYear(a+1,0,l),c.setUTCHours(0,0,0,0);var u=ye(c,t),d=new Date(0);d.setUTCFullYear(a,0,l),d.setUTCHours(0,0,0,0);var h=ye(d,t);return n.getTime()>=u.getTime()?a+1:n.getTime()>=h.getTime()?a:a-1}function ke(e,t){H(1,arguments);var n=Y(e),a=ye(n,t).getTime()-function(e,t){H(1,arguments);var n=t||{},a=n.locale,i=a&&a.options&&a.options.firstWeekContainsDate,r=null==i?1:de(i),o=null==n.firstWeekContainsDate?r:de(n.firstWeekContainsDate),s=we(e,t),l=new Date(0);return l.setUTCFullYear(s,0,o),l.setUTCHours(0,0,0,0),ye(l,t)}(n,t).getTime();return Math.round(a/6048e5)+1}var Se="midnight",Ce="noon",Te="morning",Me="afternoon",xe="evening",Pe="night",Ee={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var a=e.getUTCFullYear(),i=a>0?a:1-a;return n.ordinalNumber(i,{unit:"year"})}return fe.y(e,t)},Y:function(e,t,n,a){var i=we(e,a),r=i>0?i:1-i;return"YY"===t?pe(r%100,2):"Yo"===t?n.ordinalNumber(r,{unit:"year"}):pe(r,t.length)},R:function(e,t){return pe(ve(e),t.length)},u:function(e,t){return pe(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return pe(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return pe(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return fe.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return pe(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var i=ke(e,a);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):pe(i,t.length)},I:function(e,t,n){var a=be(e);return"Io"===t?n.ordinalNumber(a,{unit:"week"}):pe(a,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):fe.d(e,t)},D:function(e,t,n){var a=function(e){H(1,arguments);var t=Y(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var a=n-t.getTime();return Math.floor(a/864e5)+1}(e);return"Do"===t?n.ordinalNumber(a,{unit:"dayOfYear"}):pe(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var i=e.getUTCDay(),r=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(r);case"ee":return pe(r,2);case"eo":return n.ordinalNumber(r,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var i=e.getUTCDay(),r=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(r);case"cc":return pe(r,t.length);case"co":return n.ordinalNumber(r,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),i=0===a?7:a;switch(t){case"i":return String(i);case"ii":return pe(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a,i=e.getUTCHours();switch(a=12===i?Ce:0===i?Se:i/12>=1?"pm":"am",t){case"b":case"bb":case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a,i=e.getUTCHours();switch(a=i>=17?xe:i>=12?Me:i>=4?Te:Pe,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var a=e.getUTCHours()%12;return 0===a&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return fe.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):fe.H(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(a,{unit:"hour"}):pe(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return 0===a&&(a=24),"ko"===t?n.ordinalNumber(a,{unit:"hour"}):pe(a,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):fe.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):fe.s(e,t)},S:function(e,t){return fe.S(e,t)},X:function(e,t,n,a){var i=(a._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return Ne(i);case"XXXX":case"XX":return _e(i);default:return _e(i,":")}},x:function(e,t,n,a){var i=(a._originalDate||e).getTimezoneOffset();switch(t){case"x":return Ne(i);case"xxxx":case"xx":return _e(i);default:return _e(i,":")}},O:function(e,t,n,a){var i=(a._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Oe(i,":");default:return"GMT"+_e(i,":")}},z:function(e,t,n,a){var i=(a._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Oe(i,":");default:return"GMT"+_e(i,":")}},t:function(e,t,n,a){var i=a._originalDate||e;return pe(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,a){return pe((a._originalDate||e).getTime(),t.length)}};function Oe(e,t){var n=e>0?"-":"+",a=Math.abs(e),i=Math.floor(a/60),r=a%60;if(0===r)return n+String(i);var o=t||"";return n+String(i)+o+pe(r,2)}function Ne(e,t){return e%60==0?(e>0?"-":"+")+pe(Math.abs(e)/60,2):_e(e,t)}function _e(e,t){var n=t||"",a=e>0?"-":"+",i=Math.abs(e);return a+pe(Math.floor(i/60),2)+n+pe(i%60,2)}var Le=Ee;function Ie(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}}function De(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}}var je={p:De,P:function(e,t){var n,a=e.match(/(P+)(p+)?/),i=a[1],r=a[2];if(!r)return Ie(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",Ie(i,t)).replace("{{time}}",De(r,t))}},Ae=je,Be=["D","DD"],Re=["YY","YYYY"];function $e(e){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===e)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===e)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===e)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}var ze=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ue=/^'([^]*?)'?$/,We=/''/g,Ge=/[a-zA-Z]/;function qe(e,t,n){H(2,arguments);var a=String(t),i=n||{},r=i.locale||ie,o=r.options&&r.options.firstWeekContainsDate,s=null==o?1:de(o),l=null==i.firstWeekContainsDate?s:de(i.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var c=r.options&&r.options.weekStartsOn,u=null==c?0:de(c),d=null==i.weekStartsOn?u:de(i.weekStartsOn);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!r.localize)throw new RangeError("locale must contain localize property");if(!r.formatLong)throw new RangeError("locale must contain formatLong property");var h=Y(e);if(!function(e){H(1,arguments);var t=Y(e);return!isNaN(t)}(h))throw new RangeError("Invalid time value");var m=me(h,V(h)),p={firstWeekContainsDate:l,weekStartsOn:d,locale:r,_originalDate:h};return a.match(Fe).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,Ae[t])(e,r.formatLong,p):e})).join("").match(ze).map((function(e){if("''"===e)return"'";var t=e[0];if("'"===t)return e.match(Ue)[1].replace(We,"'");var n,a=Le[t];if(a)return i.useAdditionalWeekYearTokens||(n=e,-1===Re.indexOf(n))||$e(e),!i.useAdditionalDayOfYearTokens&&function(e){return-1!==Be.indexOf(e)}(e)&&$e(e),a(m,e,r.localize,p);if(t.match(Ge))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return e})).join("")}function Ve(e,t,n){H(2,arguments);var a=Y(e),i=Y(t),r=n||{},o=r.locale||ie;if(!o.localize)throw new RangeError("locale must contain localize property");if(!o.formatLong)throw new RangeError("locale must contain formatLong property");if(!o.formatRelative)throw new RangeError("locale must contain formatRelative property");var s,l=function(e,t){H(2,arguments);var n=ce(e),a=ce(t),i=n.getTime()-V(n),r=a.getTime()-V(a);return Math.round((i-r)/ue)}(a,i);if(isNaN(l))throw new RangeError("Invalid time value");s=l<-6?"other":l<-1?"lastWeek":l<0?"yesterday":l<1?"today":l<2?"tomorrow":l<7?"nextWeek":"other";var c=me(a,V(a)),u=me(i,V(i));return qe(a,o.formatRelative(s,c,u,r),r)}function He(e,t){return H(2,arguments),he(e,1e3*de(t))}const Ye=a("Preferences",{web:()=>import("./web-aee0029d.js").then((e=>new e.PreferencesWeb))});var Ke={get:function(e){return Ye.get({key:e}).then((({value:e})=>null!==e?JSON.parse(e):e))},set:function(e,t){return Ye.set({key:e,value:JSON.stringify(t)}).then((()=>t))},remove:e=>Ye.remove({key:e}),async migrate(){await Ye.migrate()}};const Xe=Object.prototype.hasOwnProperty;function Je(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(let a=0;a<n.length;a++)if(!Xe.call(t,n[a])||!Object.is(e[n[a]],t[n[a]]))return!1;return!0}function Qe(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function Ze(e,t,n){if("string"==typeof t&&(t=t.split(".")),t.length>1){const a=t.shift();null!==e[a]&&"object"==typeof e[a]||(e[a]={}),Ze(e[a],t,n)}else e[t[0]]=n}function et(e,t){return Object.assign({},t.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:e[n]})),{}))}function tt(e){return[e.toString(),e.toString()]}function nt(e,t,n=1){const a=[];for(let i=e;i<=t;i+=n)a.push(i.toString());return a}function at(e,t,n=1){return nt(e,t,n).map(tt)}const it="settings",rt=[["Standard","standard"],["Frisian","frisian"],["Frysk!","frysk"],["Antidraughts","antidraughts"],["Breakthrough","breakthrough"],["Russian","russian"],["Brazilian","brazilian"]],ot=[["Sudden Death","simple"],["Increment","increment"],["Increment with Handicap","handicapInc"],["Simple Delay","delay"],["Bronstein Delay","bronstein"],["Hourglass","hourglass"],["Stage","stage"]],st=[...Array(11).keys()].map((e=>50*e)),lt={};var ct={general:{locale:ut("lang",null),sound:ut("sound",!0),theme:{availableBackgroundThemes:[{key:"dark",name:"dark",ext:""},{key:"light",name:"light",ext:""},{key:"system",name:"bgThemeSyncWithSystem",ext:""},{key:"bgshapes",name:"Shapes",ext:"jpg"},{key:"anthracite",name:"Anthracite",ext:"jpg"},{key:"blue-maze",name:"Blue Maze",ext:"jpg"},{key:"red-maze",name:"Red Maze",ext:"jpg"},{key:"checkerboard",name:"Checkerboard",ext:"png"},{key:"wood",name:"Wood",ext:"jpg"},{key:"space",name:"Space",ext:"jpg"}],availableBoardThemes:[{key:"blue",name:"Blue",ext:"svg"},{key:"blue2",name:"Blue 2",ext:"jpg"},{key:"blue3",name:"Blue 3",ext:"jpg"},{key:"canvas",name:"Canvas",ext:"jpg"},{key:"wood",name:"Wood",ext:"jpg"},{key:"wood2",name:"Wood 2",ext:"jpg"},{key:"wood3",name:"Wood 3",ext:"jpg"},{key:"maple",name:"Maple",ext:"jpg"},{key:"brown",name:"Brown",ext:"svg"},{key:"brown2",name:"Brown 2",ext:"svg"},{key:"leather",name:"Leather",ext:"jpg"},{key:"match",name:"Match",ext:"svg"},{key:"ic",name:"IC",ext:"svg"},{key:"green",name:"Green",ext:"svg"},{key:"marble",name:"Marble",ext:"jpg"},{key:"grey",name:"Grey",ext:"jpg"},{key:"metal",name:"Metal",ext:"jpg"},{key:"olive",name:"Olive",ext:"jpg"},{key:"purple",name:"Purple",ext:"svg"}],bundledBoardThemes:["brown","brown2","blue","green","purple","match","ic"],availablePieceThemes:[["wide_crown"],["wide"],["narrow_edge"],["narrow"],["fabirovsky"],["flat"],["phin"],["ringed"],["basic"],["frisianovsky"],["eightbit","8-bit"]],background:ut("bgTheme","system"),board:ut("theme.board","brown"),piece:ut("theme.piece","fabirovsky")},vibrateOnGameEvents:ut("vibrateOnGameEvents",!1),bluetooth:{useDevice:ut("bluetooth.useDevice",!1),deviceId:ut("bluetooth.deviceId",void 0)},notifications:{enable:ut("notifications",!0),vibrate:ut("notifications.vibrate",!0),sound:ut("notifications.sound",!0)}},game:{supportedVariants:["standard","antidraughts","breakthrough","fromPosition","frisian","frysk","russian","brazilian"],supportedPerfs:["ultraBullet","bullet","blitz","rapid","classical","correspondence","antidraughts","breakthrough","frisian","frysk","russian","brazilian","puzzle","puzzleFrisian"],animations:ut("gameAnimations",!0),highlights:ut("boardHighlights",!0),pieceDestinations:ut("pieceDestinations",!0),coords:ut("coords",2),coordSystem:ut("coordSystem",1),magnified:ut("pieceMagnified",!0),zenMode:ut("zenMode",!1),blindfoldDraughts:ut("blindfoldDraughts",!1),kingMoves:ut("kingMoves",!0),draughtsResult:ut("draughtsResult",!0),clockPosition:ut("game.inversedClockPos","right"),pieceMove:ut("game.pieceMove","both"),moveList:ut("game.moveList",!0),landscapeBoardSide:ut("game.landscapeBoardSide","left")},analyse:{supportedVariants:["standard","antidraughts","breakthrough","fromPosition","frisian","frysk","russian","brazilian"],availableVariants:rt,syntheticVariant:ut("analyse.syntheticVariant","standard"),enableCeval:ut("analyse.enableCeval",!1),cevalMultiPvs:ut("ceval.multipv",1),cevalCores:ut("ceval.cores",1),cevalHashSize:ut("ceval.hashSize",16),cevalInfinite:ut("ceval.infinite",!1),cevalMaxDepthNormal:ut("ceval.maxDepth",18),cevalMaxDepthAnti:ut("ceval.maxDepthAnti",6),showBestMove:ut("analyse.showBestMove",!0),showComments:ut("analyse.showComments",!0),smallBoard:ut("analyse.smallBoard",!0),fullCapture:ut("fullCapture",!1),explorer:{db:ut("analyse.explorer.db","lidraughts"),availableRatings:[1600,1800,2e3,2200,2500],rating:ut("analyse.explorer.rating",[1600,1800,2e3,2200,2500]),availableSpeeds:["bullet","blitz","rapid","classical"],speed:ut("analyse.explorer.speed",["bullet","blitz","rapid","classical"])}},ai:{availableOpponents:[["Scan","1"],["Scan","2"],["Scan","3"],["Scan","4"],["Scan","5"],["Scan","6"],["Scan","7"],["Scan","8"]],color:ut("ai.color","white"),opponent:ut("ai.opponent","1"),variant:ut("ai.variant","standard"),availableVariants:[["Standard","standard"],["Frisian","frisian"],["Frysk!","frysk"],["Antidraughts","antidraughts"],["Breakthrough","breakthrough"]]},otb:{flipPieces:ut("otb.flipPieces",!1),mirrorPieces:ut("otb.mirrorPieces",!1),variant:ut("otb.variant","standard"),availableVariants:rt,whitePlayer:ut("otb.whitePlayer","White"),blackPlayer:ut("otb.blackPlayer","Black"),clockType:ut("otb.clockType","none"),availableClocks:[["None","none"]].concat(ot)},clock:{availableClocks:ot,clockType:ut("clock.clockType","simple"),simple:{time:ut("clock.simple.time","5")},increment:{time:ut("clock.increment.time","3"),increment:ut("clock.increment.increment","2")},handicapInc:{topTime:ut("clock.handicapInc.topTime","3"),topIncrement:ut("clock.handicapInc.topIncrement","2"),bottomTime:ut("clock.handicapInc.bottomTime","3"),bottomIncrement:ut("clock.handicapInc.bottomIncrement","2")},delay:{time:ut("clock.delay.time","3"),increment:ut("clock.delay.increment","2")},bronstein:{time:ut("clock.bronstein.time","3"),increment:ut("clock.bronstein.increment","2")},hourglass:{time:ut("clock.hourglass.time","5")},stage:{stages:ut("clock.stage.stages",[{time:"120",moves:"40"},{time:"60",moves:null}]),increment:ut("clock.stage.increment","30")},availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableMoves:["5","10","15","20","25","30","35","40","45","50","55","60"]},gameSetup:{availableTimes:[["0","0"],["¼","0.25"],["½","0.5"],["¾","0.75"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["45","45"],["60","60"],["90","90"],["120","120"],["150","150"],["180","180"]],availableIncrements:["0","1","2","3","4","5","6","7","8","9","10","15","20","25","30","45","60","90","120","150","180"],availableDays:["1","2","3","5","7","10","14"],isTimeValid:function(e){return"1"!==e.timeMode()||"0"!==e.time()||"0"!==e.increment()},ai:{color:ut("game.ai.color","random"),availableVariants:[["Standard","1"],["Frisian","10"],["Frysk!","8"],["Antidraughts","6"],["Breakthrough","9"],["From Position","3"]],variant:ut("game.ai.variant","1"),availableTimeModes:[["unlimited","0"],["realTime","1"]],timeMode:ut("game.ai.clock","1"),time:ut("game.ai.time","10"),increment:ut("game.ai.increment","0"),days:ut("game.ai.days","2"),level:ut("game.ai.aiLevel","3")},human:{availableVariants:[["Standard","1"],["Frisian","10"],["Frysk!","8"],["Antidraughts","6"],["Breakthrough","9"],["Russian","11"],["Brazilian","12"]],availableRatingRanges:{min:[...st].reverse().map((e=>["-"+e,"-"+e])),max:st.map((e=>["+"+e,"+"+e]))},ratingRangeMin:ut("game.human.rating.range_min","-500"),ratingRangeMax:ut("game.human.rating.range_max","+500"),color:ut("game.human.color","random"),variant:ut("game.human.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:ut("game.human.clock","1"),time:ut("game.human.time","5"),increment:ut("game.human.increment","0"),days:ut("game.human.days","2"),mode:ut("game.human.mode","0"),preset:ut("game.human.preset","quick"),pool:ut("game.human.pool","")},challenge:{availableVariants:[["Standard","1"],["Frisian","10"],["Frysk!","8"],["Antidraughts","6"],["Breakthrough","9"],["Russian","11"],["Brazilian","12"],["From Position","3"]],color:ut("game.invite.color","random"),variant:ut("game.invite.variant","1"),availableTimeModes:[["realTime","1"],["correspondence","2"],["unlimited","0"]],timeMode:ut("game.invite.clock","1"),time:ut("game.invite.time","5"),increment:ut("game.invite.increment","0"),days:ut("game.invite.days","2"),mode:ut("game.invite.mode","0")}},tournament:{availableVariants:[["Standard","1"],["Frisian","10"],["Frysk!","8"],["Antidraughts","6"],["Breakthrough","9"],["Russian","11"],["Brazilian","12"]],availableModes:[["casual","0"],["rated","1"]],availableTimes:[["0","0"],["½","0.5"],["¾","0.75"],["1","1"],["1.5","1.5"]].concat(at(2,8,1)).concat(at(10,25,5)).concat(at(30,60,10)),availableIncrements:nt(0,7,1).concat(nt(10,25,5)).concat(nt(30,60,10)),availableDurations:nt(20,55,5).concat(nt(60,110,10)).concat(nt(120,360,30)),availableTimesToStart:["1","2","3","5","10","15","20","30","45","60"],variant:ut("tournament.variant","1"),mode:ut("tournament.mode","0"),time:ut("tournament.time","5"),increment:ut("tournament.increment","0"),duration:ut("tournament.duration","45"),timeToStart:ut("tournament.timeToStart","15"),position:ut("tournament.timeToStart","15"),private:ut("tournament.private",!1),join:{lastTeam:ut("tournament.join.lastTeam","")}},tv:{availableChannels:[["Top rated","best"],["Bullet","bullet"],["Blitz","blitz"],["Rapid","rapid"],["Classical","classical"],["Frisian","frisian"],["Frysk!","frysk"],["Antidraughts","antidraughts"],["Breakthrough","breakthrough"],["Russian","russian"],["Brazilian","brazilian"],["UltraBullet","ultraBullet"],["Bot","bot"],["Computer","computer"]],channel:ut("tv.channel","best")},importer:{analyse:ut("importer.analyse",!1)},training:{supportedVariants:["standard","frisian","russian"],puzzleBufferLen:50,ratingDiffThreshold:100,variant:ut("training.variant","standard")},study:{tour:ut("study.tour",null)}};function ut(e,t){return function(n){if(void 0!==n)return Ze(lt,e,n),Ke.set(it,lt).then((()=>{})),n;const a=Qe(lt,e);return void 0!==a?a:t}}const dt="en-GB",ht={},mt={day:"2-digit",month:"long",year:"numeric"},pt=Object.assign(Object.assign({},mt),{hour:"2-digit",minute:"2-digit"});let ft,gt=dt,vt={},bt=new Intl.NumberFormat,yt=new Intl.DateTimeFormat(void 0,mt),wt=new Intl.DateTimeFormat(void 0,pt);function kt(e,...t){const n=vt[e]||$t[e];return n?Tt(n,...t):e}function St(e,...t){const n=vt[e]||$t[e];return n?function(e,...t){const n=e.split(/(%(?:\d\$)?s)/g);for(let e=1;e<=t.length;e++){const a=n.indexOf("%"+e+"$s");-1!==a&&(n[a]=t[e-1])}for(let e=0;e<t.length;e++){const a=n.indexOf("%s");if(-1===a)break;n[a]=t[e]}return n}(n,...t):e}function Ct(e,t,n){const a=e+":"+function(e,t){const n=t%100,a=t%10;switch(_t(e)){case"fr":case"ff":case"kab":case"co":return t<2?"one":"other";case"cs":case"sk":return 1===t?"one":t>=2&&t<=4?"few":"other";case"hr":case"ru":case"sr":case"uk":case"be":case"bs":case"sh":case"ry":return 1===a&&11!==n?"one":a>=2&&a<=4&&!(n>=12&&n<=14)?"few":0===a||a>=5&&a<=9||n>=11&&n<=14?"many":"other";case"lv":return 0===t?"zero":t%10==1&&t%100!=11?"one":"other";case"lt":return 1!==a||n>=11&&n<=19?a>=2&&a<=9&&!(n>=11&&n<=19)?"few":"other":"one";case"pl":return 1===t?"one":a>=2&&a<=4&&!(n>=12&&n<=14)?"few":"other";case"ro":case"mo":return 1===t?"one":0===t||n>=1&&n<=19?"few":"other";case"sl":return 1===n?"one":2===n?"two":n>=3&&n<=4?"few":"other";case"ar":return 0===t?"zero":1===t?"one":2===t?"two":n>=3&&n<=10?"few":n>=11&&n<=99?"many":"other";case"mk":return t%10==1&&11!==t?"one":"other";case"cy":case"br":return 0===t?"zero":1===t?"one":2===t?"two":3===t?"few":6===t?"many":"other";case"mt":return 1===t?"one":0===t||n>=2&&n<=10?"few":n>=11&&n<=19?"many":"other";case"ga":case"se":case"sma":case"smi":case"smj":case"smn":case"sms":return 1===t?"one":2===t?"two":"other";case"ak":case"am":case"bh":case"fil":case"tl":case"guw":case"hi":case"ln":case"mg":case"nso":case"ti":case"wa":return 0===t||1===t?"one":"other";case"az":case"bm":case"fa":case"ig":case"hu":case"ja":case"kde":case"kea":case"ko":case"my":case"ses":case"sg":case"to":case"tr":case"vi":case"wo":case"yo":case"zh":case"bo":case"dz":case"id":case"jv":case"ka":case"km":case"kn":case"ms":case"th":case"tp":case"io":case"ia":return"other";default:return 1===t?"one":"other"}}(gt,t),i=vt[a]||vt[e+":other"]||vt[e];return i?Tt(i,void 0!==n?n:t):e}function Tt(e,...t){let n=e;if(t.length){if(n.includes("$s"))for(let e=1;e<4;e++)n=n.replace("%"+e+"$s",String(t[e-1]));for(const e of t)n=n.replace("%s",String(e))}return n}function Mt(e){return bt.format(e)}function xt(e){return yt.format(e)}function Pt(e){return wt.format(e)}function Et(e){const t=new Date(0);return le(t,He(t,e),{locale:ft})}function Ot(e){return Ve(e,new Date,{locale:ft})}function Nt(e,t=!1){return function(e,t){return H(1,arguments),le(e,Date.now(),t)}(e,{locale:ft,addSuffix:t})}function _t(e){return e.split("-")[0]}function Lt(e){return Rt[e]||Bt.find((t=>_t(t)===e))}function It(){return gt}function Dt(e){return function(e){const t=At[e]?e:dt;return import("./i18n/"+t+".js").then((({default:e})=>(gt=t,vt=Object.assign(Object.assign({},ht),e),bt=new Intl.NumberFormat(t),yt=new Intl.DateTimeFormat(t,mt),wt=new Intl.DateTimeFormat(t,pt),t)))}(e).then(ct.general.locale).then((()=>function(e){if(e===dt)return Promise.resolve(e);const t=jt.includes(e)?e:_t(e);return import(`./i18n/date/${t}.js`).then((t=>(ft=t.default||void 0,e))).catch((()=>(ft=void 0,e)))}(e)))}const jt=["ar-DZ","ar-EG","ar-MA","ar-SA","ar-TN","de-AT","en-AU","en-CA","en-GB","en-IE","en-IN","en-NZ","en-US","en-ZA","fa-IR","fr-CA","fr-CH","it-CH","nl-BE","pt-BR","zh-CN","zh-HK","zh-TW"];const At={"be-BY":"Беларуская","cs-CZ":"čeština","cy-GB":"Cymraeg","de-DE":"Deutsch","el-GR":"Ελληνικά","en-GB":"English","en-US":"English (US)","es-ES":"español","fr-FR":"français","fy-NL":"Frysk","he-IL":"עִבְרִית","hu-HU":"Magyar","it-IT":"Italiano","ja-JP":"日本語","lt-LT":"lietuvių kalba","lv-LV":"latviešu valoda","mn-MN":"монгол","nl-NL":"Nederlands","pl-PL":"polski","pt-PT":"Português","pt-BR":"Português (BR)","ro-RO":"Română","ru-RU":"русский язык","tr-TR":"Türkçe","uk-UA":"українська","vi-VN":"Tiếng Việt","zh-CN":"中文","zh-TW":"繁體中文"},Bt=Object.keys(At),Rt={de:"de-DE",en:"en-GB",fr:"fr-FR",nl:"nl-NL",pt:"pt-PT",zh:"zh-CN"},$t={apiUnsupported:"Your version of lichess app is too old! Please upgrade for free to the latest version.",apiDeprecated:"Upgrade for free to the latest lichess app! Support for this version will be dropped on %s.",playerisInvitingYou:"%s is inviting you",unsupportedVariant:"Variant %s is not supported in this version",notesSynchronizationHasFailed:"Notes synchronization with lichess has failed, please try later.",localEvalCaution:"Caution: intensive usage will drain battery.",incorrectThreefoldClaim:"Incorrect threefold repetition claim.",useBluetoothDevice:"Use bluetooth device",resetToDefault:"Reset to default",deviceOptions:"Device options",vibrateOnGameEvents:"Vibrate on game events",offline:"Offline"},zt=Object.assign({},{apiVersion:3,fetchTimeoutMs:15e3},window.lidraughts);var Ft="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ut(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var Wt=Ut((function(e){
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
!function(t){function n(e,t,n,a,i){this._listener=t,this._isOnce=n,this.context=a,this._signal=e,this._priority=i||0}function a(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}n.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,a,i){var r,o=this._indexOfListener(e,a);if(-1!==o){if((r=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else r=new n(this,e,t,a,i),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,a=this._bindings.length;a--;)if((n=this._bindings[a])._listener===e&&n.context===t)return a;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return a(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return a(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){a(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),a=this._bindings.length;if(this.memorize&&(this._prevParams=n),a){t=this._bindings.slice(),this._shouldPropagate=!0;do{a--}while(t[a]&&this._shouldPropagate&&!1!==t[a].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var r=i;r.Signal=i,e.exports?e.exports=r:t.signals=r}(Ft)})),Gt={redraw:new Wt.Signal,afterLogin:new Wt.Signal,afterLogout:new Wt.Signal,sessionRestored:new Wt.Signal,homePong:new Wt.Signal,gameBackButton:new Wt.Signal};let qt=new Set,Vt=!1;function Ht(e){qt.add(e),Vt||(Vt=!0,requestAnimationFrame((e=>{const t=qt;Vt=!1,qt=new Set,t.forEach((t=>t(e)))})))}function Yt(e){qt.delete(e)}const Kt=Gt.redraw.dispatch;function Xt(){Ht(Kt)}let Jt,Qt;function Zt(){return Jt||en()}function en(){const e=window.crypto.getRandomValues(new Uint8Array(9));return Jt=btoa(String.fromCharCode(...e)).replace(/[/+]/g,"_"),Jt}function tn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("script");for(let n=0,a=t.length;n<a;n++)if(t[n].getAttribute("src")===e)return!0;return!1}(e))setTimeout(t,0);else{const a=document.createElement("script");a.src=e,a.onload=()=>t(),a.onerror=()=>n(),document.head.appendChild(a)}}))}function nn(e){return new Promise(((t,n)=>{if(function(e){const t=document.head.getElementsByTagName("link");for(let n=0,a=t.length;n<a;n++)if(t[n].getAttribute("href")===e)return!0;return!1}(e))setTimeout(t,0);else{const a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.href=e,a.onload=()=>t(),a.onerror=()=>n(),document.head.appendChild(a)}}))}function an(e){const t=e();return Xt(),t}function rn(){return Qt.connected}function on(e){const t=e.status,n=e.body;let a;a=t&&0!==t?401===t?"unauthorizedError":404===t?"Resource not found.":503===t?"lidraughtsIsUnavailableError":t>=500?"Server error.":"Error.":"lidraughtsIsUnreachable",a=kt(a),n&&("string"==typeof n?a+=` ${n}`:"string"==typeof n.error?a+=` ${n.error}`:n.global&&n.global.constructor===Array&&(a+=` ${kt(n.global[0])}`)),W.show({text:a,duration:"short"})}function sn(e){let t="";return Object.keys(e).forEach((n=>{const a=e[n];null!=a&&(""!==t&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(a))})),t}function ln(){}u.addListener("networkStatusChange",(e=>{Qt=e})),u.getStatus().then((e=>{Qt=e}));const cn={bullet:"T",blitz:")",rapid:"#",classical:"+",correspondence:";",frisian:"'",antidraughts:"@",puzzle:"-",puzzlefrisian:"",frysk:"_",fromPosition:"*",breakthrough:"",russian:"",brazilian:"(",ultraBullet:"{",computer:"n",bot:"n"};function un(e){return e&&cn[e]||"8"}function dn(e){return 0===e?e:e/60}function hn(e){return"white"===e?"black":"white"}function mn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function pn(e,t){return Math.random()*(t-e)+e}function fn(e,t){return t?e.opponent.color:e.player.color}function gn(e,t){let n=e+"";for(;n.length<t;)n="0"+n;return n}function vn(e,t="hour_min_secs"){let n="";const a=Math.floor(e/60/60),i=Math.floor(e/60)-60*a,r=e%60;return n="hour_min_secs"===t?a>0?a+":"+gn(i,2)+":"+gn(r,2):i+":"+gn(r,2):gn(r,2),n}function bn(e){const t=Math.floor(e/60),n=Math.floor(e-60*t);return(t?t+"H ":"")+(n?n+"M":"")}function yn(e){if(e){const t=dn(e.limit);return(.25===t?"¼":.5===t?"½":.75===t?"¾":t.toString())+"+"+e.increment}return"∞"}function wn(e){return null!=e}function kn(e){return`${zt.apiEndPoint}/assets/${e}`}function Sn(e){const t=Number(e);return isNaN(t)?void 0:t}function Cn(e){if(!(void 0===e||e.length>7||0===e.length||/[^a-zA-Z0-9]/.exec(e)))return e.split("").reduce(((e,t,n)=>e+function(e){const t=e.charCodeAt(0);return t>96?t-71:t>64?t-65:t+4}(t)*Math.pow(62,n)),0)}const Tn=window.requestIdleCallback||window.setTimeout;function Mn(e){let t=e;return e=>(void 0!==e&&(t=e),t)}function xn(e){return e?250:0}function Pn(e,t,n){var a=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return p(n)&&(a="leading"in n?!!n.leading:a,i="trailing"in n?!!n.trailing:i),U(e,t,{leading:a,maxWait:t,trailing:i})}function En(e){try{return window.localStorage?e(window.localStorage):null}catch(e){}}var On={get:function(e){return En((t=>{const n=t.getItem(e);return n?JSON.parse(n):null}))},set:function(e,t){En((n=>{try{n.setItem(e,JSON.stringify(t))}catch(a){n.removeItem(e),n.setItem(e,JSON.stringify(t))}}))},remove:function(e){En((t=>{t.removeItem(e)}))}};function Nn(e,t,n,a,i,r){return{tag:e,key:t,attrs:n,children:a,text:i,dom:r,domSize:void 0,state:void 0,events:void 0,instance:void 0}}Nn.normalize=function(e){return Array.isArray(e)?Nn("[",void 0,void 0,Nn.normalizeChildren(e),void 0,void 0):null==e||"boolean"==typeof e?null:"object"==typeof e?e:Nn("#",void 0,void 0,String(e),void 0,void 0)},Nn.normalizeChildren=function(e){var t=[];if(window.lichess&&"dev"===window.lichess.mode&&e.length)for(var n=null!=e[0]&&null!=e[0].key,a=1;a<e.length;a++)if((null!=e[a]&&null!=e[a].key)!==n)throw new TypeError(!n||null==e[a]&&"boolean"!=typeof e[a]?"In fragments, vnodes must either all have keys or none have keys.":"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.");for(a=0;a<e.length;a++)t[a]=Nn.normalize(e[a]);return t};var _n=Nn,Ln=function(){var e,t=arguments[this],n=this+1;if(null==t?t={}:("object"!=typeof t||null!=t.tag||Array.isArray(t))&&(t={},n=this),arguments.length===n+1)e=arguments[n],Array.isArray(e)||(e=[e]);else for(e=[];n<arguments.length;)e.push(arguments[n++]);return _n("",t.key,t,e)},In={}.hasOwnProperty,Dn=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,jn={};function An(e){for(var t in e)if(In.call(e,t))return!1;return!0}var Bn=function(e){if(null==e||"string"!=typeof e&&"function"!=typeof e&&"function"!=typeof e.view)throw Error("The selector must be either a string or a component.");var t=Ln.apply(1,arguments);return"string"==typeof e&&(t.children=_n.normalizeChildren(t.children),"["!==e)?function(e,t){var n=t.attrs,a=_n.normalizeChildren(t.children),i=In.call(n,"class"),r=i?n.class:n.className;if(t.tag=e.tag,t.attrs=null,t.children=void 0,!An(e.attrs)&&!An(n)){var o={};for(var s in n)In.call(n,s)&&(o[s]=n[s]);n=o}for(var s in e.attrs)In.call(e.attrs,s)&&"className"!==s&&!In.call(n,s)&&(n[s]=e.attrs[s]);for(var s in null==r&&null==e.attrs.className||(n.className=null!=r?null!=e.attrs.className?String(e.attrs.className)+" "+String(r):r:null!=e.attrs.className?e.attrs.className:null),i&&(n.class=null),n)if(In.call(n,s)&&"key"!==s){t.attrs=n;break}return Array.isArray(a)&&1===a.length&&null!=a[0]&&"#"===a[0].tag?t.text=a[0].children:t.children=a,t}(jn[e]||function(e){for(var t,n="div",a=[],i={};t=Dn.exec(e);){var r=t[1],o=t[2];if(""===r&&""!==o)n=o;else if("#"===r)i.id=o;else if("."===r)a.push(o);else if("["===t[3][0]){var s=t[6];s&&(s=s.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===t[4]?a.push(s):i[t[4]]=""===s?s:s||!0}}return a.length>0&&(i.className=a.join(" ")),jn[e]={tag:n,attrs:i}}(e),t):(t.tag=e,t)};Bn.trust=function(e){return null==e&&(e=""),_n("<",void 0,void 0,e,void 0,void 0)},Bn.fragment=function(){var e=Ln.apply(0,arguments);return e.tag="[",e.children=_n.normalizeChildren(e.children),e};var Rn=Bn;let $n;var zn={spin(){if(void 0!==$n||document.getElementById("globalSpinner"))return;const e=document.createElement("div");e.id="globalSpinner",e.className="spinner globalSpinner";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 40 40");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","20"),n.setAttribute("cy","20"),n.setAttribute("r","18"),n.setAttribute("fill","none"),t.appendChild(n),e.appendChild(t),$n=setTimeout((()=>{document.body.appendChild(e)}),200)},stop(){clearTimeout($n),$n=void 0;const e=document.getElementsByClassName("globalSpinner");e.length&&setTimeout((function(){for(;e[0];)document.body.removeChild(e[0])}),500)},getVdom:e=>Rn("div.spinner",{className:e||""},[Rn("svg",{viewBox:"0 0 40 40"},[Rn("circle",{cx:"20",cy:"20",r:"18",fill:"none"})])]),getHtml:()=>'<div class="spinner monochrome"><svg viewBox="0 0 40 40"><circle cx=20 cy=20 r=18 fill="none"></circle></svg></div>'};function Fn(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e.toString():"";default:return""}}function Un(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((a=>{const i=encodeURIComponent(Fn(a))+n;return Array.isArray(e[a])?e[a].map((e=>i+encodeURIComponent(Fn(e)))).join(t):i+encodeURIComponent(Fn(e[a]))})).join(t):a?encodeURIComponent(Fn(a))+n+encodeURIComponent(Fn(e)):""}var Wn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n};const Gn="sessionId",qn=zt.apiEndPoint;function Vn(e,t,n,a=!1){let i;function r(){clearTimeout(i),a&&zn.stop()}const o=new Headers({"X-Requested-With":"XMLHttpRequest",Accept:"application/vnd.lidraughts.v"+zt.apiVersion+"+json"}),s=On.get(Gn);null!=s&&o.append(Gn,s);const l={method:"GET",credentials:"include"};let c;if(void 0!==n){const{headers:t,query:a,timeout:i}=n,r=Wn(n,["headers","query","timeout"]);if(c=i,a){const t=Un(a);""!==t&&(e=function(e,t){const n=e.indexOf("?")<0?"?":"&";return e+n+t}(e,t))}Object.assign(l,r),t&&Object.keys(t).forEach((e=>{const n=t[e];"__delete"!==n?o.set(e,n):o.delete(e)}))}"POST"!==l.method&&"PUT"!==l.method||o.has("Content-Type")||(o.set("Content-Type","application/json; charset=UTF-8"),l.body||(l.body="{}"));const u=e.indexOf("http")>-1?e:qn+e,d=new Promise(((e,t)=>{i=setTimeout((()=>t(new Error("Request timeout."))),c||zt.fetchTimeoutMs)})),h=Promise.race([fetch(u,Object.assign(Object.assign({},l),{headers:o})),d]);return a&&zn.spin(),new Promise(((e,n)=>{h.then((a=>{r(),a.ok?e(a[t]()):a.text().then((e=>{try{n({status:a.status,body:JSON.parse(e)})}catch(e){n({status:a.status,body:a.statusText})}}))})).catch((e=>{r(),n({status:0,body:e.message})}))}))}const Hn=new Map;function Yn(e){const t=Hn.get(e);if(t)return t}function Kn(e,t,n,a=!1){return async function(e,t,n){const a=Hn.get(e);if(a&&a.expires>=Date.now())return a.data;Hn.delete(e);const i=Date.now()+1e3*t;return n().then((t=>(Hn.set(e,{expires:i,data:t}),t)))}(t,e,(()=>Vn(t,"json",n,a)))}function Xn(e,t,n=!1){return Vn(e,"json",t,n)}function Jn(e,t,n=!1){return Vn(e,"text",t,n)}var Qn={isStub:!0,init(){},register:async e=>Promise.resolve(),unregister:()=>Promise.resolve("")};const Zn=new Map;var ea={list:()=>[...Zn.values()].sort(((e,t)=>{return a=t,(n=e).name.toLowerCase()<a.name.toLowerCase()?-1:n.name.toLowerCase()>a.name.toLowerCase()?1:0;var n,a})),count:()=>Zn.size,reset(e,t,n){Zn.clear(),e.forEach((e=>{const[a,i]=ta(e),r=a.toLowerCase(),o=t.includes(r),s=n.includes(r);Zn.set(e,{name:a,title:i,playing:o,patron:s})}))},set(e,t,n){const[a,i]=ta(e);Zn.set(e,{name:a,title:i,playing:t,patron:n})},playing(e){const t=Zn.get(e);t&&Zn.set(e,Object.assign(Object.assign({},t),{playing:!0}))},stoppedPlaying(e){const t=Zn.get(e);t&&Zn.set(e,Object.assign(Object.assign({},t),{playing:!1}))},remove(e){Zn.delete(e)},clear(){Zn.clear()}};function ta(e){const t=e.split(" ");return[t.length>1?t[1]:t[0],t.length>1?t[0]:void 0]}const na=a("SoundEffect",{web:()=>import("./web-f4e852b0.js").then((e=>new e.SoundEffectWeb))});let aa=!0;function ia(){return aa}let ra=void 0!==window.AudioContext?new AudioContext:null;var oa={load:()=>Promise.all([la("move"),la("capture"),la("explosion"),la("lowtime"),la("dong"),la("berserk"),la("clock"),la("confirmation")]).then((()=>{})),resume(){null!=ra&&(ra.close(),ra=new AudioContext)},move(){ca("move")},throttledMove:Pn((()=>{ca("move")}),50),capture(){ca("capture")},throttledCapture:Pn((()=>{ca("capture")}),50),explosion(){ca("explosion")},throttledExplosion:Pn((()=>{ca("explosion")}),50),lowtime(){ca("lowtime")},dong(){ca("dong")},berserk(){ca("berserk")},clock(){ca("clock")},confirmation(){ca("confirmation")}};const sa={};async function la(e){const t=`sounds/${e}.mp3`;"ios"===n.getPlatform()&&null!=ra?window.fetch(t).then((e=>e.arrayBuffer())).then((e=>ra.decodeAudioData(e))).then((t=>sa[e]=t)):na.loadSound({id:e,path:t})}function ca(e){if(ct.general.sound()&&ia())if("ios"===n.getPlatform()&&null!=ra){const t=ra.createBufferSource();t.buffer=sa[e],t.connect(ra.destination),t.start()}else na.play({id:e})}const ua=a("Dialog",{web:()=>import("./web-1899cf95.js").then((e=>new e.DialogWeb))});function da(e){return{mode:Number(e.mode()),variant:Number(e.variant()),timeMode:Number(e.timeMode()),time:Number(e.time()),increment:Number(e.increment()),days:Number(e.days()),color:e.color(),ratingRangeMin:Number(e.ratingRangeMin()),ratingRangeMax:Number(e.ratingRangeMax())}}function ha(e,t){const{ratingRangeMin:n,ratingRangeMax:a}=t;let i="correspondence";switch(t.variant){case 1:case 3:if(1===t.timeMode){const e=60*t.time+40*t.increment;i=e<30?"ultraBullet":e<180?"bullet":e<480?"blitz":e<1500?"rapid":"classical"}break;case 6:i="antidraughts";break;case 8:i="frysk";break;case 9:i="breakthrough";break;case 10:i="frisian";break;case 11:i="russian";break;case 12:i="brazilian"}const r=e.perfs[i];return r&&void 0!==n&&void 0!==a?`${r.rating+n}-${r.rating+a}`:null}var ma=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n};function pa(e){const t=ct.gameSetup.ai,n={variant:t.variant(),timeMode:t.timeMode(),days:t.days(),time:t.time(),increment:t.increment(),level:t.level(),color:t.color()};return e&&(n.fen=e),Xn("/setup/ai",{method:"POST",body:JSON.stringify(n)},!0)}function fa(e){const t=ma(e,["ratingRangeMin","ratingRangeMax"]),n=Za.get(),a=n?ha(n,e):null,i=a?Object.assign(Object.assign({},t),{ratingRange:a}):Object.assign({},t);return i.fromPool=void 0,Xn("/setup/hook/"+Zt()+(e.fromPool?"?pool=1":""),{method:"POST",body:JSON.stringify(i)},!0)}function ga(){return Xn("/challenge")}function va(e){return Xn(`/challenge/${e}`,{},!0)}function ba(e){return Jn(`/challenge/${e}/cancel`,{method:"POST"},!0)}function ya(e){return Jn(`/challenge/${e}/decline`,{method:"POST"},!0)}function wa(e){return Xn(`/challenge/${e}/accept`,{method:"POST"},!0)}let ka=[];function Sa(e){return Xn("/",e?{cache:"reload"}:void 0).then((e=>(void 0!==e.lobby.pools&&(ka=e.lobby.pools),e)))}function Ca(e){return Xn("/lobby/seeks",{query:{_:Date.now()}},e)}function Ta(e,t){let n="/"+e;return t&&(n+="/"+t),Xn(n)}function Ma(e){return Jn("/bookmark/"+e,{method:"POST"})}function xa(e,t){return Xn("/tv/"+e,t?{query:{flip:1}}:{})}function Pa(e,t){return Xn(`/import/master/${e}/${t}`)}function Ea(e){return Za.isConnected()?Xn("/translation/select",{method:"POST",body:JSON.stringify({lang:e})}).then((()=>{})):Promise.resolve()}function Oa(e){return Xn(`/@/${e}/mini`)}function Na(e,t){const n={query:{nb:e||10}};return t?Kn(15,"/timeline",n,!1):Xn("/timeline",n,!1)}let _a=[],La=[];function Ia(e){return-1!==ct.game.supportedVariants.indexOf(e.variant.key)&&"created"===e.status}function Da(e){e.in.length>_a.length&&oa.dong(),_a=e.in,La=e.out}var ja={all:()=>_a.filter(Ia).concat(La.filter(Ia)),incoming:()=>_a.filter(Ia),sending:()=>La.filter(Ia),set:Da,refresh(){var e;return null===(e=Pn(ga,1e3)())||void 0===e?void 0:e.then(Da)},remove(e){_a=_a.filter((t=>t.id!==e)),La=La.filter((t=>t.id!==e))},isPersistent:e=>"correspondence"===e.timeControl.type||"unlimited"===e.timeControl.type,challengeTime:e=>"clock"===e.timeControl.type?e.timeControl.show:function(e){return"correspondence"===e.type}(e.timeControl)?Ct("nbDays",e.timeControl.daysPerTurn):"∞"};const Aa="announce";let Ba;function Ra(e){return e.date}function $a(e){return new Date(e)<new Date}var za={get:function(){return Ba&&$a(Ba.date)&&(Ba=void 0),Ba},set:async function(e){if(e){const t=Ra(e),n=await Ke.get(Aa);if(null==n?void 0:n.includes(t))return}Ba!==e&&(Ba=e,Xt())},dismiss:async function(){if(void 0===Ba)return;const e=Ra(Ba);Ba=void 0,Xt();const t=(await Ke.get(Aa)||[]).filter((e=>!$a(e)));t.push(e),await Ke.set(Aa,t)}};let Fa;function Ua(){return void 0!==Fa}function Wa(e){Ke.set("session",e)}function Ga(){Hn.clear(),Ke.remove("session"),On.remove(Gn),Gt.afterLogout.dispatch()}function qa(){return(Fa&&Fa.nowPlaying||[]).filter((e=>-1!==ct.game.supportedVariants.indexOf(e.variant.key)))}function Va(e){return W.show({text:"✓ lidraughts.org: "+kt("yourPreferencesHaveBeenSaved"),position:"center",duration:"short"}),e}function Ha(e){return!0===e?"1":!1===e?"0":String(e)}function Ya(e){return function(t,[n,a]){return Object.assign(Object.assign({},t),{[e+n]:Ha(a)})}}const Ka=Pn((()=>{const e=Fa&&Fa.prefs||{},t=Object.entries(et(e,["animation","captured","kingMoves","highlight","destination","coords","replay","gameResult","coordSystem","blindfold"])).reduce(Ya("display."),{}),n=Object.entries(et(e,["premove","takeback","autoThreefold","submitMove","confirmResign","fullCapture"])).reduce(Ya("behavior."),{}),a=Object.entries(et(e,["moretime"])).reduce(Ya("clock."),{});a["clock.tenths"]=Ha(e.clockTenths),a["clock.bar"]=Ha(e.clockBar),a["clock.sound"]=Ha(e.clockSound);const i=Object.entries(et(e,["follow","challenge","message","insightShare"])).reduce(Ya(""),{});return Jn("/account/preferences",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"},body:sn(Object.assign(Object.assign(Object.assign(Object.assign({},i),t),n),a))},!0).then(Va)}),1e3);function Xa(e){return void 0!==e.id}async function Ja(){var e;try{const t=await Xn("/account/info",{cache:"reload"});Fa=t,Wa(t),za.set(t.announce),Fa.nbChallenges!==ja.incoming().length&&(null===(e=ja.refresh())||void 0===e||e.then(Xt)),Xt()}catch(e){void 0!==Fa&&401===(null==e?void 0:e.status)&&(Fa=void 0,Ga(),Xt(),W.show({text:kt("signedOut"),position:"center",duration:"short"}))}}function Qa(){l.getId().then((({identifier:e})=>{"web"!==e&&Jn(`/auth/set-fp/${e}/0`,{method:"POST"})}))}var Za={isConnected:Ua,isKidMode:function(){return!(!Fa||!Fa.kid)},isShadowban:function(){return!(!Fa||!Fa.troll)},logout:function(){return Qn.unregister().then((()=>Xn("/logout",{method:"POST"},!0).then((()=>{Fa=void 0,Ga(),ea.clear(),Xt()})))).catch(on)},signup:function(e,t,n){return Xn("/signup",{method:"POST",body:JSON.stringify({username:e,email:t,password:n,"can-confirm":!0})},!0).then((e=>(Xa(e)&&(Fa=e,Fa.sessionId&&On.set(Gn,Fa.sessionId),Qa()),e)))},login:Pn((function(e,t,n){return Xn("/login",{method:"POST",body:JSON.stringify({username:e,password:t,token:n})},!0).then((e=>{if(Xa(e))return Hn.clear(),Fa=e,Fa.sessionId&&On.set(Gn,Fa.sessionId),Wa(e),Qa(),Fa;throw{ipban:!0}}))}),1e3),rememberLogin:Pn((function(){return Xn("/account/info").then((e=>(Fa=e,Wa(e),e)))}),1e3),restoreStoredSession:function(){Ke.get("session").then((e=>{Fa=e||void 0,null!==e&&(Gt.sessionRestored.dispatch(),Xt())}))},refresh:Pn(Ja,1e3),backgroundRefresh:Pn((async function(){var e;if(rn()&&Ua()){const t=await Xn("/account/info");Fa=t,Wa(t),za.set(t.announce),Fa.nbChallenges!==ja.incoming().length&&(null===(e=ja.refresh())||void 0===e||e.then(Xt))}}),1e3),get:function(){return Fa},getUserId:function(){return Fa&&Fa.id},appUser:e=>Fa?Fa&&Fa.username:e,nowPlaying:qa,myTurnGames:function(){return qa().filter((e=>e.isMyTurn))},lidraughtsBackedProp:function(e,t){return function(...n){var a;if(n.length){let t;Fa&&(t=Qe(Fa,e),Ze(Fa,e,n[0])),null===(a=Ka())||void 0===a||a.catch((n=>{Fa&&Ze(Fa,e,t),rn()&&on(n)}))}return Fa?Qe(Fa,e):t}},setKidMode:function(e,t){return Jn(`/account/kid?v=${e}`,{method:"POST",body:new URLSearchParams(t),headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/*"}},!0).then(Ja)},confirmEmail:function(e){return Xn(`/signup/confirm/${e}`,void 0,!0).then((e=>(Fa=e,Wa(e),Fa)))},hasCurrentBan:()=>void 0!==(null==Fa?void 0:Fa.playban)};const ei="transition",ti="transitionend";function ni(e,t,n,a,i){var r=arguments,o=arguments.length;return 0===o||2===o||o>5?Promise.reject(new Error("Zanimo invalid arguments")):e instanceof Promise?e.then((function(e){return ni.apply(this,[e].concat(Array.prototype.slice.call(r,1)))})):function(e){try{return e&&e.nodeType}catch(e){return!1}}(e)?1===o?Promise(e):3===o?function(e,t,n){e._zanimo&&Object.prototype.hasOwnProperty.call(e._zanimo,t);return function(e,t,n){return requestAnimationFrame((function(){e.style[t]=n})),Promise(e)}(e,t,n)}(e,t,n):window.isNaN(parseInt(a,10))?Promise.reject(new Error("Zanimo transition: duration must be an integer!")):function(e,t,n,a,i){var r,o=t,s=new Promise((function(s,l){function c(t){t.propertyName===o&&(u(!0),s(e))}function u(n){r&&(clearTimeout(r),r=null),function(e,t){e.style[ei]=e.style[ei].split(",").filter((function(e){return!e.match(t)})).join(",")}(e,t),e.removeEventListener(ti,c),n&&delete e._zanimo[t]}e.addEventListener(ti,c),requestAnimationFrame((function(){!function(e,t,n,a,i){var r=e.style[ei];e.style[ei]=r?r+", "+ai(t,a,i):ai(t,a,i);e.style[t]=n}(e,t,n,a,i),r=setTimeout((function(){u(!0),s(e)}),a+20),e._zanimo=e._zanimo||{},e._zanimo[t],e._zanimo[t]={value:n}}))}));return s}(e,t,n,a,i):Promise.reject(new Error("Zanimo require an HTMLElement, or a promise of an HTMLElement"))}function ai(e,t,n){return e+" "+t+"ms "+(n||"linear")}var ii=Ut((function(e){!function(t,n){var a=t.define;a&&a.amd?a("rlite",[],n):e.exports?e.exports=n():t.Rlite=n()}(Ft,(function(){return function(){var e={},t=decodeURIComponent;function n(e){return e}function a(a){var i=function(e){return~e.indexOf("/?")&&(e=e.replace("/?","?")),"/"==e[0]&&(e=e.slice(1)),"/"==e[e.length-1]&&(e=e.slice(0,-1)),e}(a).split("?"),r=~a.indexOf("%")?t:n;return function(e,t,n){if(e&&t.cb)for(var a=e.indexOf("#"),i=(a<0?e:e.slice(0,a)).split("&"),r=0;r<i.length;++r){var o=i[r].split("=");t.params[o[0]]=n(o[1])}return t}(i[1],function(t,n){for(var a=t.split("/"),i=e,r={},o=0;o<a.length&&i;++o){var s=n(a[o]);(i=i[s.toLowerCase()]||i[":"])&&i["~"]&&(r[i["~"]]=s)}return i&&{cb:i["@"],params:r}}(i[0],r)||{},r)}return{add:function(t,n){for(var a=t.split("/"),i=e,r=0;r<a.length;++r){var o=a[r],s=":"==o[0]?":":o.toLowerCase();i=i[s]||(i[s]={}),":"==s&&(i["~"]=o.slice(1))}i["@"]=n},exists:function(e){return!!a(e).cb},lookup:a,run:function(e){var t=a(e);return t.cb&&t.cb({url:e,params:t.params}),!!t.cb}}}}))})),ri=function(e){var t,n=e&&e.document,a={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(e){return e.attrs&&e.attrs.xmlns||a[e.tag]}function r(e,t){if(e.state!==t)throw new Error("'vnode.state' must not be modified.")}function o(e){var t=e.state;try{return this.apply(t,arguments)}finally{r(e,t)}}function s(){try{return n.activeElement}catch(e){return null}}function l(e,t,n,a,i,r,o){for(var s=n;s<a;s++){var l=t[s];null!=l&&c(e,l,i,o,r)}}function c(e,t,a,i,r){var o=t.tag;if("string"==typeof o)switch(t.state={},null!=t.attrs&&F(t.attrs,t,a),o){case"#":!function(e,t,a){t.dom=n.createTextNode(t.children),C(e,t.dom,a)}(e,t,r);break;case"<":d(e,t,i,r);break;case"[":!function(e,t,a,i,r){var o=n.createDocumentFragment();if(null!=t.children){var s=t.children;l(o,s,0,s.length,a,null,i)}t.dom=o.firstChild,t.domSize=o.childNodes.length,C(e,o,r)}(e,t,a,i,r);break;default:h(e,t,a,i,r)}else!function(e,t,n,a,i){m(t,n),null!=t.instance?(c(e,t.instance,n,a,i),t.dom=t.instance.dom,t.domSize=null!=t.dom?t.instance.domSize:0):t.domSize=0}(e,t,a,i,r)}var u={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function d(e,t,a,i){var r=t.children.match(/^\s*?<(\w+)/im)||[],o=n.createElement(u[r[1]]||"div");"http://www.w3.org/2000/svg"===a?(o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",o=o.firstChild):o.innerHTML=t.children,t.dom=o.firstChild,t.domSize=o.childNodes.length,t.instance=[];for(var s,l=n.createDocumentFragment();s=o.firstChild;)t.instance.push(s),l.appendChild(s);C(e,l,i)}function h(e,t,a,r,o){var s=t.tag,c=t.attrs,u=c&&c.is,d=(r=i(t)||r)?u?n.createElementNS(r,s,{is:u}):n.createElementNS(r,s):u?n.createElement(s,{is:u}):n.createElement(s);if(t.dom=d,null!=c&&function(e,t,n){for(var a in t)N(e,a,null,t[a],n)}(t,c,r),C(e,d,o),!T(t)&&(null!=t.text&&(""!==t.text?d.textContent=t.text:t.children=[_n("#",void 0,void 0,t.text,void 0,void 0)]),null!=t.children)){var h=t.children;l(d,h,0,h.length,a,null,r),"select"===t.tag&&null!=c&&function(e,t){if("value"in t)if(null===t.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var n=""+t.value;e.dom.value===n&&-1!==e.dom.selectedIndex||(e.dom.value=n)}"selectedIndex"in t&&N(e,"selectedIndex",null,t.selectedIndex,void 0)}(t,c)}}function m(e,t){var n;if("function"==typeof e.tag.view){if(e.state=Object.create(e.tag),null!=(n=e.state.view).$$reentrantLock$$)return;n.$$reentrantLock$$=!0}else{if(e.state=void 0,null!=(n=e.tag).$$reentrantLock$$)return;n.$$reentrantLock$$=!0,e.state=null!=e.tag.prototype&&"function"==typeof e.tag.prototype.view?new e.tag(e):e.tag(e)}if(F(e.state,e,t),null!=e.attrs&&F(e.attrs,e,t),e.instance=_n.normalize(o.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");n.$$reentrantLock$$=null}function p(e,t,n,a,i,r){if(t!==n&&(null!=t||null!=n))if(null==t||0===t.length)l(e,n,0,n.length,a,i,r);else if(null==n||0===n.length)M(e,t,0,t.length);else{var o=null!=t[0]&&null!=t[0].key,s=null!=n[0]&&null!=n[0].key,u=0,d=0;if(!o)for(;d<t.length&&null==t[d];)d++;if(!s)for(;u<n.length&&null==n[u];)u++;if(null===s&&null==o)return;if(o!==s)M(e,t,d,t.length),l(e,n,u,n.length,a,i,r);else if(s){for(var h,m,p,g,v,S=t.length-1,C=n.length-1;S>=d&&C>=u&&(p=t[S],g=n[C],p.key===g.key);)p!==g&&f(e,p,g,a,i,r),null!=g.dom&&(i=g.dom),S--,C--;for(;S>=d&&C>=u&&(h=t[d],m=n[u],h.key===m.key);)d++,u++,h!==m&&f(e,h,m,a,w(t,d,i),r);for(;S>=d&&C>=u&&u!==C&&h.key===g.key&&p.key===m.key;)k(e,p,v=w(t,d,i)),p!==m&&f(e,p,m,a,v,r),++u<=--C&&k(e,h,i),h!==g&&f(e,h,g,a,i,r),null!=g.dom&&(i=g.dom),d++,p=t[--S],g=n[C],h=t[d],m=n[u];for(;S>=d&&C>=u&&p.key===g.key;)p!==g&&f(e,p,g,a,i,r),null!=g.dom&&(i=g.dom),C--,p=t[--S],g=n[C];if(u>C)M(e,t,d,S+1);else if(d>S)l(e,n,u,C+1,a,i,r);else{var T,P,E=i,O=C-u+1,N=new Array(O),_=0,L=0,I=2147483647,D=0;for(L=0;L<O;L++)N[L]=-1;for(L=C;L>=u;L--){null==T&&(T=b(t,d,S+1));var j=T[(g=n[L]).key];null!=j&&(I=j<I?j:-1,N[L-u]=j,p=t[j],t[j]=null,p!==g&&f(e,p,g,a,i,r),null!=g.dom&&(i=g.dom),D++)}if(i=E,D!==S-d+1&&M(e,t,d,S+1),0===D)l(e,n,u,C+1,a,i,r);else if(-1===I)for(P=function(e){var t=[0],n=0,a=0,i=0,r=y.length=e.length;for(i=0;i<r;i++)y[i]=e[i];for(i=0;i<r;++i)if(-1!==e[i]){var o=t[t.length-1];if(e[o]<e[i])y[i]=o,t.push(i);else{for(n=0,a=t.length-1;n<a;){var s=(n>>>1)+(a>>>1)+(n&a&1);e[t[s]]<e[i]?n=s+1:a=s}e[i]<e[t[n]]&&(n>0&&(y[i]=t[n-1]),t[n]=i)}}n=t.length,a=t[n-1];for(;n-- >0;)t[n]=a,a=y[a];return y.length=0,t}(N),_=P.length-1,L=C;L>=u;L--)m=n[L],-1===N[L-u]?c(e,m,a,r,i):P[_]===L-u?_--:k(e,m,i),null!=m.dom&&(i=n[L].dom);else for(L=C;L>=u;L--)m=n[L],-1===N[L-u]&&c(e,m,a,r,i),null!=m.dom&&(i=n[L].dom)}}else{var A=t.length<n.length?t.length:n.length;for(u=u<d?u:d;u<A;u++)(h=t[u])===(m=n[u])||null==h&&null==m||(null==h?c(e,m,a,r,w(t,u+1,i)):null==m?x(e,h):f(e,h,m,a,w(t,u+1,i),r));t.length>A&&M(e,t,u,t.length),n.length>A&&l(e,n,u,n.length,a,i,r)}}}function f(e,t,n,a,i,r){var s=t.tag;if(s===n.tag){if(n.state=t.state,n.events=t.events,function(e,t){do{var n;if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate)if(void 0!==(n=o.call(e.attrs.onbeforeupdate,e,t))&&!n)break;if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate)if(void 0!==(n=o.call(e.state.onbeforeupdate,e,t))&&!n)break;return!1}while(0);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}(n,t))return;if("string"==typeof s)switch(null!=n.attrs&&U(n.attrs,n,a),s){case"#":!function(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children);t.dom=e.dom}(t,n);break;case"<":!function(e,t,n,a,i){t.children!==n.children?(P(e,t),d(e,n,a,i)):(n.dom=t.dom,n.domSize=t.domSize,n.instance=t.instance)}(e,t,n,r,i);break;case"[":!function(e,t,n,a,i,r){p(e,t.children,n.children,a,i,r);var o=0,s=n.children;if(n.dom=null,null!=s){for(var l=0;l<s.length;l++){var c=s[l];null!=c&&null!=c.dom&&(null==n.dom&&(n.dom=c.dom),o+=c.domSize||1)}1!==o&&(n.domSize=o)}}(e,t,n,a,i,r);break;default:g(t,n,a,r)}else v(e,t,n,a,i,r)}else x(e,t),c(e,n,a,r,i)}function g(e,t,n,a){var r=t.dom=e.dom;a=i(t)||a,"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),function(e,t,n,a){if(null!=n)for(var i in n)N(e,i,t&&t[i],n[i],a);var r;if(null!=t)for(var i in t)null==(r=t[i])||null!=n&&null!=n[i]||_(e,i,r,a)}(t,e.attrs,t.attrs,a),T(t)||(null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[_n("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[_n("#",void 0,void 0,t.text,void 0,void 0)]),p(r,e.children,t.children,n,null,a)))}function v(e,t,n,a,i,r){if(n.instance=_n.normalize(o.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");U(n.state,n,a),null!=n.attrs&&U(n.attrs,n,a),null!=n.instance?(null==t.instance?c(e,n.instance,a,r,i):f(e,t.instance,n.instance,a,i,r),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?(x(e,t.instance),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function b(e,t,n){for(var a=Object.create(null);t<n;t++){var i=e[t];if(null!=i){var r=i.key;null!=r&&(a[r]=t)}}return a}var y=[];function w(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function k(e,t,a){var i=n.createDocumentFragment();S(e,i,t),C(e,i,a)}function S(e,t,n){for(;null!=n.dom&&n.dom.parentNode===e;){if("string"!=typeof n.tag){if(null!=(n=n.instance))continue}else if("<"===n.tag)for(var a=0;a<n.instance.length;a++)t.appendChild(n.instance[a]);else if("["!==n.tag)t.appendChild(n.dom);else if(1===n.children.length){if(null!=(n=n.children[0]))continue}else for(a=0;a<n.children.length;a++){var i=n.children[a];null!=i&&S(e,t,i)}break}}function C(e,t,n){null!=n?e.insertBefore(t,n):e.appendChild(t)}function T(e){if(null==e.attrs||null==e.attrs.contenteditable&&null==e.attrs.contentEditable)return!1;var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var n=t[0].children;e.dom.innerHTML!==n&&(e.dom.innerHTML=n)}else if(null!=e.text||null!=t&&0!==t.length)throw new Error("Child node of a contenteditable must be trusted.");return!0}function M(e,t,n,a){for(var i=n;i<a;i++){var r=t[i];null!=r&&x(e,r)}}function x(e,t){var n,a,i,s=0,l=t.state;"string"!=typeof t.tag&&"function"==typeof t.state.onbeforeremove&&(null!=(i=o.call(t.state.onbeforeremove,t))&&"function"==typeof i.then&&(s=1,n=i));t.attrs&&"function"==typeof t.attrs.onbeforeremove&&(null!=(i=o.call(t.attrs.onbeforeremove,t))&&"function"==typeof i.then&&(s|=2,a=i));if(r(t,l),s){if(null!=n){var c=function(){1&s&&((s&=2)||u())};n.then(c,c)}if(null!=a){c=function(){2&s&&((s&=1)||u())};a.then(c,c)}}else O(t),E(e,t);function u(){r(t,l),O(t),E(e,t)}}function P(e,t){for(var n=0;n<t.instance.length;n++)e.removeChild(t.instance[n])}function E(e,t){for(;null!=t.dom&&t.dom.parentNode===e;){if("string"!=typeof t.tag){if(null!=(t=t.instance))continue}else if("<"===t.tag)P(e,t);else{if("["!==t.tag&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(1===t.children.length){if(null!=(t=t.children[0]))continue}else for(var n=0;n<t.children.length;n++){var a=t.children[n];null!=a&&E(e,a)}}break}}function O(e){if("string"!=typeof e.tag&&"function"==typeof e.state.onremove&&o.call(e.state.onremove,e),e.attrs&&"function"==typeof e.attrs.onremove&&o.call(e.attrs.onremove,e),"string"!=typeof e.tag)null!=e.instance&&O(e.instance);else{var t=e.children;if(Array.isArray(t))for(var n=0;n<t.length;n++){var a=t[n];null!=a&&O(a)}}}function N(e,t,a,i,r){if("key"!==t&&"is"!==t&&null!=i&&!L(t)&&(a!==i||function(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===s()||"option"===e.tag&&e.dom.parentNode===n.activeElement}(e,t)||"object"==typeof i)){if("o"===t[0]&&"n"===t[1])return z(e,t,i);if("xlink:"===t.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),i);else if("style"===t)R(e.dom,a,i);else if(I(e,t,r)){if("value"===t){if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+i&&e.dom===s())return;if("select"===e.tag&&null!==a&&e.dom.value===""+i)return;if("option"===e.tag&&null!==a&&e.dom.value===""+i)return}"input"===e.tag&&"type"===t?e.dom.setAttribute(t,i):e.dom[t]=i}else"boolean"==typeof i?i?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute("className"===t?"class":t,i)}}function _(e,t,n,a){if("key"!==t&&"is"!==t&&null!=n&&!L(t))if("o"!==t[0]||"n"!==t[1]||L(t))if("style"===t)R(e.dom,n,null);else if(!I(e,t,a)||"className"===t||"value"===t&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===s())||"input"===e.tag&&"type"===t){var i=t.indexOf(":");-1!==i&&(t=t.slice(i+1)),!1!==n&&e.dom.removeAttribute("className"===t?"class":t)}else e.dom[t]=null;else z(e,t,void 0)}function L(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function I(e,t,n){return void 0===n&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==t&&"list"!==t&&"form"!==t&&"width"!==t&&"height"!==t)&&t in e.dom}var D,j=/[A-Z]/g;function A(e){return"-"+e.toLowerCase()}function B(e){return"-"===e[0]&&"-"===e[1]?e:"cssFloat"===e?"float":e.replace(j,A)}function R(e,t,n){if(t===n);else if(null==n)e.style.cssText="";else if("object"!=typeof n)e.style.cssText=n;else if(null==t||"object"!=typeof t)for(var a in e.style.cssText="",n){null!=(i=n[a])&&e.style.setProperty(B(a),String(i))}else{for(var a in n){var i;null!=(i=n[a])&&(i=String(i))!==String(t[a])&&e.style.setProperty(B(a),i)}for(var a in t)null!=t[a]&&null==n[a]&&e.style.removeProperty(B(a))}}function $(){this._=t}function z(e,t,n){if(null!=e.events){if(e.events[t]===n)return;null==n||"function"!=typeof n&&"object"!=typeof n?(null!=e.events[t]&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0):(null==e.events[t]&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}else null==n||"function"!=typeof n&&"object"!=typeof n||(e.events=new $,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=n)}function F(e,t,n){"function"==typeof e.oninit&&o.call(e.oninit,t),"function"==typeof e.oncreate&&n.push(o.bind(e.oncreate,t))}function U(e,t,n){"function"==typeof e.onupdate&&n.push(o.bind(e.onupdate,t))}return $.prototype=Object.create(null),$.prototype.handleEvent=function(e){var t,n=this["on"+e.type];"function"==typeof n?t=n.call(e.currentTarget,e):"function"==typeof n.handleEvent&&n.handleEvent(e),this._&&!1!==e.redraw&&(0,this._)(),!1===t&&(e.preventDefault(),e.stopPropagation())},function(e,n,a){if(!e)throw new TypeError("DOM element being rendered to does not exist.");if(null!=D&&e.contains(D))throw new TypeError("Node is currently being rendered to and thus is locked.");var i=t,r=D,o=[],l=s(),c=e.namespaceURI;D=e,t="function"==typeof a?a:void 0;try{null==e.vnodes&&(e.textContent=""),n=_n.normalizeChildren(Array.isArray(n)?n:[n]),p(e,e.vnodes,n,o,null,"http://www.w3.org/1999/xhtml"===c?void 0:c),e.vnodes=n,null!=l&&s()!==l&&"function"==typeof l.focus&&l.focus();for(var u=0;u<o.length;u++)o[u]()}finally{t=i,D=r}}}(window);const oi=function(){let e=0;return()=>e++}(),si=new ii;let li=0,ci="fwd",ui="/";const di=document.body;function hi(e,t){const n={view:()=>_n(e,void 0,t)};function a(){ri(di,_n(n))}Gt.redraw.removeAll(),Gt.redraw.add(a);try{a()}catch(e){throw Gt.redraw.removeAll(),e}}function mi(e){e&&e.state&&(ci=e.state.id<li?"bwd":"fwd",li=e.state.id),ui=yi();const t=window.location.search||"?=";si.run(t.slice(2))||si.run("/")}const pi={replaceState(e,t){try{const n=e?Object.assign({},window.history.state,e):window.history.state;void 0!==t?window.history.replaceState(n,"","?="+t):window.history.replaceState(n,"")}catch(e){}},pushState(e){const t=oi();li=t,ci="fwd";try{window.history.pushState({id:t},"","?="+e)}catch(e){}}};function fi(e,t=!1){const n=(window.location.search||"?=/").substring(2).replace(/\?.+$/,"")+`?${sn(e)}`;t?bi(n,!0):pi.replaceState(void 0,n)}function gi(){const e=yi(),t=/\?.+$/.exec(e),n={};if(t&&t[0])for(const[e,a]of new URLSearchParams(t[0]))n[e]=a;return n}const vi=(()=>{const e=()=>{const t=e.stack.pop();!function(e){if(!p(e))return!1;var t=_(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}(t)?/^\/$/.test(yi())?s.exitApp():/^\/game\/[a-zA-Z0-9]{12}/.test(yi())?Gt.gameBackButton.dispatch(event):wi():(t("backbutton"),Xt())};return e.stack=[],e})();function bi(e,t=!1){setTimeout((()=>function(e,t=!1){vi.stack=[],ui=yi(),t?pi.replaceState(void 0,e):pi.pushState(e),si.run(e)||si.run("/")}(e,t)),0)}function yi(){const e=window.location.search||"?=/";return decodeURIComponent(e.substring(2))}function wi(){window.history.go(-1)}window.backButton=vi;var ki={get:yi,set:bi,reload(){bi(yi(),!0)},setQueryParams:fi,getQueryParams:gi,deleteQueryParam:function(e,t=!1){const n=gi();n&&(delete n[e],fi(n,t))},History:pi,backHistory:wi,getViewSlideDirection:()=>ci,backbutton:vi,getPreviousPath:()=>ui};const Si=600,Ci=4,Ti=4,Mi="active";function xi(e,t,n,a,i,r,o,s=!0){let l,c,u,d,h,m,p,f=e;if("function"!=typeof t)throw new Error("ButtonHandler 2nd argument must be a function!");if(n&&"function"!=typeof n)throw new Error("ButtonHandler 3rd argument must be a function!");if(a&&"function"!=typeof a)throw new Error("ButtonHandler 4rd argument must be a function!");function g(){a()&&Ht(g),Kt()}const v={passive:!0};e.addEventListener("touchstart",(function(t){const i=t.changedTouches[0];if(f=o?o(t):e,!f)return;if(!0===f.disabled)return;const r=f.getBoundingClientRect();l=i.clientX,c=i.clientY,u={minX:r.left,maxX:r.right,minY:r.top,maxY:r.bottom},d=!0,clearTimeout(p),f.classList.add(Mi),h=setTimeout((()=>function(e){n&&(n(e),d=!1,f&&f.classList.remove(Mi))}(t)),Si),a&&(m=setTimeout((()=>{Ht(g)}),500))}),v),e.addEventListener("touchmove",(function(e){if(d&&f){const t=e.changedTouches[0];d=function(e){const t=e.clientX,n=e.clientY,a=u;let o=0,s=0;i&&(o=Math.abs(t-l));r&&(s=Math.abs(n-c));return t<a.maxX&&t>a.minX&&n<a.maxY&&n>a.minY&&o<Ci&&s<Ti}(t),d||(clearTimeout(h),clearTimeout(m),Yt(g),f.classList.remove(Mi))}}),v),e.addEventListener("touchend",(function(e){e.cancelable&&s&&e.preventDefault(),clearTimeout(m),Yt(g),d&&f&&(clearTimeout(h),p=setTimeout((()=>f&&f.classList.remove(Mi)),80),t(e),d=!1)}),!1),e.addEventListener("touchcancel",(function(){clearTimeout(h),clearTimeout(m),Yt(g),d=!1,f&&f.classList.remove(Mi)}),!1),e.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation()}),!1)}let Pi,Ei=null;const Oi=56;function Ni(e){return({dom:t})=>e(t)}function _i(e,t=250,n="0.5",a="1"){let i;function r(){clearTimeout(i),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",r,!1))}e.style.opacity=n,e.style.transition=`opacity ${t}ms ease-out`,setTimeout((()=>{e.style.opacity=a})),e.addEventListener("transitionend",r,!1),i=setTimeout(r,t+10)}function Li(e){let t;function n(){clearTimeout(t),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",n,!1))}const a="fwd"===ki.getViewSlideDirection()?"100%":"-100%";e.style.transform=`translate3d(${a},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",n,!1),t=setTimeout(n,270)}function Ii(e,t){let n;function a(){clearTimeout(n),e&&(e.removeAttribute("style"),e.removeEventListener("transitionend",a,!1))}const i="left"===t?"100%":"-100%";e.style.transform=`translate3d(${i},0,0)`,setTimeout((()=>{e.style.transition="transform 250ms ease-out",e.style.transform="translate3d(0%,0,0)"}),10),e.addEventListener("transitionend",a,!1),n=setTimeout(a,270)}function Di(e,t){return e.closest(t)||e}function ji(){if(Ei)return Ei;const e=document.documentElement;return Ei={vw:e.clientWidth,vh:e.clientHeight}}const Ai=Ni(Li),Bi=Ni(_i);function Ri(e){const t=e.dom;return t.style.transform="translateY(100%)",e.state.lol=t.offsetHeight,ni(t,"transform","translateY(0)",250,"ease-out").catch(console.log.bind(console))}function $i(e,t){return function(n){const a=document.getElementById(t);a&&ni(a,"transform","translateY(100%)",250,"ease-out").then((()=>an((()=>e(n))))).catch(console.log.bind(console))}}function zi(e,t){return function(n){const a=document.getElementById(t);a&&ni(a,"transform","translateX(100%)",250,"ease-out").then((()=>an((()=>e(n))))).catch(console.log.bind(console))}}function Fi(e){const t=e.dom;return t.style.transform="translateX(100%)",e.state.lol=t.offsetHeight,ni(t,"transform","translateX(0)",250,"ease-out").catch(console.log.bind(console))}function Ui(e,t,n,a=150){e.stopPropagation();const i=n?Di(e.target,n):e.target;i?ni(i,"opacity",0,a).then((()=>an(t))).catch(console.log.bind(console)):(t(),Xt())}function Wi(e,t,n,a,i,r,o){return function(s){xi(s.dom,(t=>{e(t),Xt()}),t?e=>an((()=>t(e))):void 0,n,a,i,r,o)}}function Gi(e){return t=>{t.dom.addEventListener("touchstart",e)}}function qi(e,t,n,a){return Wi(e,t,n,!1,!1,a)}function Vi(e,t,n){return Wi(e,t,void 0,!0,!1,n)}function Hi(e,t,n,a=!0){return Wi(e,t,void 0,!1,!0,n,a)}function Yi(e,t,n,a=!0){return Wi(e,t,void 0,!0,!0,n,a)}function Ki(e){return 0===e?null:Rn("span",{className:"progress "+(e>0?"positive":"negative"),"data-icon":e>0?"N":"M"},String(Math.abs(e)))}function Xi(e){const t=[];for(const n in e)e[n]&&t.push(n);return t.join(" ")}function Ji(){const{vw:e,vh:t}=ji();return e>=768&&t>=768}function Qi(){return void 0!==Pi||(Pi=window.matchMedia("(orientation: portrait)").matches),Pi}let Zi=null;function er(e){const t=/\d{1,3}/.exec(e),n=t&&t[0],a=Number(n);return isNaN(a)?0:a}function tr(e,t){const{vh:n,vw:a}=e,i=function(){if(!Zi){const e=getComputedStyle(document.documentElement);return Zi={top:er(e.getPropertyValue("--sat")),right:er(e.getPropertyValue("--sar")),bottom:er(e.getPropertyValue("--sab")),left:er(e.getPropertyValue("--sal"))},Zi}return Zi}(),r=Ji();if(t){if(r){const e=.94*a;return{width:e,height:e}}return{width:a,height:a}}if(r){const e=n-Oi-.06*n-i.top;return{width:e,height:e}}{const e=n-Oi-i.top;return{width:e,height:e}}}function nr(e,t){const n=tr(e,t);return e.vh-n.height-56-45-110>=25}function ar(e){e.dom.focus()}function ir(e){return void 0===e.ratingDiff?null:0===e.ratingDiff?Rn("span.rp.null"," +0"):e.ratingDiff>0?Rn("span.rp.up"," +"+e.ratingDiff):e.ratingDiff<0?Rn("span.rp.down"," "+e.ratingDiff):null}function rr(e){const t=e.target;return"BUTTON"===t.tagName?t:t.closest("button")}function or(e){const t=e.target;return"LI"===t.tagName?t:t.closest("li")}function sr(e){const t=e.target;return"TR"===t.tagName?t:t.closest("tr")}function lr(e,t){var n;return null===(n=e.target)||void 0===n?void 0:n.closest(t)}function cr(e){return t=>{var n;return null===(n=t.target)||void 0===n?void 0:n.closest(e)}}const ur=a("KeepAwake",{web:()=>import("./web-8d98dc01.js").then((e=>new e.KeepAwakeWeb))}),dr=9e5,hr=27e5;let mr,pr;function fr(){ur.keepAwake(),void 0!==pr&&pr(),pr=function(e,t,n){const a=["touchstart"];let i,r=!1,o=!0,s=performance.now();const l=()=>{o||n(),o=!0,s=performance.now(),u()},c=()=>{r||(a.forEach((e=>{document.addEventListener(e,l)})),r=!0)},u=()=>{r&&(a.forEach((e=>{document.removeEventListener(e,l)})),r=!1)},d=()=>{clearInterval(i),u()};return i=setInterval((()=>{o&&performance.now()-s>e&&(t(),o=!1),c()}),3e4),d}(dr,(()=>{mr=setTimeout((()=>{ur.allowSleep()}),hr)}),(()=>{clearTimeout(mr)}))}function gr(){void 0!==pr&&(pr(),pr=void 0),ur.allowSleep()}function vr(e,t,n){void 0!==n?e.postMessage({topic:t,payload:n}):e.postMessage({topic:t})}function br(e,t){return new Promise(((n,a)=>{e.addEventListener("message",(function i(r){r.data.topic!==t.topic||void 0!==t.reqid&&r.data.reqid!==t.reqid?"error"!==r.data.topic||r.data.payload.callerTopic!==t.topic||void 0!==t.reqid&&r.data.reqid!==t.reqid||(e.removeEventListener("message",i),a(r.data.payload.error)):(e.removeEventListener("message",i),n(r.data.payload))})),e.postMessage(t)}))}const yr="seekLobby",wr=new Worker("socketWorker.js");let kr,Sr=!1,Cr=0,Tr=2e3;const Mr={following_onlines:function(e,t){const n=t.playing,a=t.patrons;ea.reset(e,n,a),Xt()},following_enters:(e,t)=>an((()=>ea.set(e,t.playing||!1,t.patron||!1))),following_leaves:e=>an((()=>ea.remove(e))),following_playing:e=>an((()=>ea.playing(e))),following_stopped_playing:e=>an((()=>ea.stoppedPlaying(e))),challenges:e=>{ja.set(e),Xt()},mlat:e=>{Cr=e},deployPost(){vr(wr,"deploy")},resync(){ki.reload()},announce:e=>{const t=e;t.date?za.set(t):za.set(void 0)}};function xr(e,t){const n=On.get(Gn);null!==n?e.opts.params?e.opts.params[Gn]=n:e.opts.params={[Gn]:n}:e.opts.params&&delete e.opts.params.sessionId,e.opts.options.isAuth=!!n,wr.onmessage=e=>{switch(e.data.topic){case"onOpen":t.onOpen&&t.onOpen();break;case"disconnected":Sr&&(Sr=!1,Xt());break;case"connected":Sr||(Sr=!0,Xt());break;case"onError":t.onError&&t.onError();break;case"resync":ki.reload();break;case"handle":{const n=t.events[e.data.payload.t];n&&n(e.data.payload.d,e.data.payload);break}case"pingInterval":Tr=e.data.payload}},kr={setup:e,handlers:t},vr(wr,"create",e)}function Pr(e){return{send:(t,n,a)=>function(e,t,n,a){vr(wr,"send",[e,t,n,a])}(e,t,n,a),ask:(t,n,a,i)=>function(e,t,n,a,i){return new Promise(((r,o)=>{let s;function l(e){"handle"===e.data.topic&&e.data.payload.t===n&&(clearTimeout(s),wr.removeEventListener("message",l),r(e.data.payload.d))}wr.addEventListener("message",l),vr(wr,"ask",{msg:[e,t,a,i],listenTo:n}),s=setTimeout((()=>{wr.removeEventListener("message",l),o()}),3e3)}))}(e,t,n,a,i)}}function Er(){kr?xr(kr.setup,kr.handlers):vr(wr,"connect")}Gt.afterLogout.add(Er);var Or={createGame:function(e,t,n,a,i){let r=!1;const o={onError:function(){r||(r=!0,Ta(a.substring(1)).catch((e=>{401===e.status&&(W.show({text:kt("unauthorizedError"),position:"center",duration:"short"}),ki.set("/"))})))},onOpen:Za.backgroundRefresh,events:Object.assign({},Mr,n)},s={options:{name:"game",debug:"dev"===zt.mode,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(o.events)}};return i&&(s.params={userTv:i}),xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:e,version:t,opts:s},o),Pr(e)},createChallenge:function(e,t,n,a){const i={onOpen:()=>{Za.backgroundRefresh(),n()},events:Object.assign({},Mr,a)},r=`/challenge/${e}/socket/v${zt.apiVersion}`,o={options:{name:"challenge",debug:"dev"===zt.mode,ignoreUnknownMessages:!0,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(i.events)}};return xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:r,version:t,opts:o},i),Pr(r)},createLobby:function(e,t,n){const a={onOpen:()=>{Za.refresh(),t()},events:Object.assign({},Mr,n)},i={options:{name:e,debug:"dev"===zt.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(a.events)}},r=`/lobby/socket/v${zt.apiVersion}`;return xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:r,opts:i},a),Pr(r)},createTournament:function(e,t,n,a){const i="/tournament/"+e+`/socket/v${zt.apiVersion}`,r={events:Object.assign({},Mr,n),onOpen:Za.backgroundRefresh},o={options:{name:"tournament",debug:"dev"===zt.mode,pingDelay:2e3,sendOnOpen:[{t:"following_onlines"},{t:"startWatching",d:a}],registeredEvents:Object.keys(r.events)}};return xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:i,version:t,opts:o},r),Pr(i)},createDefault:function(){if(rn()){const e={events:Mr,onOpen:Za.backgroundRefresh},t={options:{name:"default",debug:"dev"===zt.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(e.events)}};xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:`/socket/v${zt.apiVersion}`,opts:t},e)}},createAnalysis:function(e){const t={events:Object.assign(Object.assign({},Mr),e),onOpen:Za.backgroundRefresh},n={options:{name:"analysis",debug:"dev"===zt.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(t.events)}},a=`/analysis/socket/v${zt.apiVersion}`;return xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:a,opts:n},t),Pr(a)},createStudy:function(e,t){const n={events:Object.assign(Object.assign({},Mr),t),onOpen:Za.backgroundRefresh},a={options:{name:"study",debug:"dev"===zt.mode,pingDelay:3e3,sendOnOpen:[{t:"following_onlines"}],registeredEvents:Object.keys(n.events)}},i=`/study/${e}/socket/v${zt.apiVersion}`;return xr({clientId:en(),socketEndPoint:zt.socketEndPoint,url:i,opts:a},n),Pr(i)},redirectToGame:function(e){let t;if("string"==typeof e)t=e;else if(t=e.url,e.cookie){const t=document.domain.replace(/^.+(\.[^.]+\.[^.]+)$/,"$1"),n=[encodeURIComponent(e.cookie.name)+"="+e.cookie.value,"; max-age="+e.cookie.maxAge,"; path=/","; domain="+t].join("");document.cookie=n}ki.set("/game"+t)},sendWithNoCheck(e,t,n){["moveLat"].includes(e)&&vr(wr,"send",["noCheck",e,t,n])},setVersion(e){vr(wr,"setVersion",e)},connect(){vr(wr,"connect")},reconnectCurrent:Er,disconnect(){vr(wr,"disconnect")},delayedDisconnect(e){vr(wr,"delayedDisconnect",e)},cancelDelayedDisconnect(){vr(wr,"cancelDelayedDisconnect")},isConnected:()=>Sr,destroy(){vr(wr,"destroy")},getVersion:()=>br(wr,{topic:"getVersion"}),getCurrentPing:()=>br(wr,{topic:"averageLag"}),getCurrentMoveLatency:()=>Cr,getCurrentPingInterval:()=>Tr,terminate(){wr&&wr.terminate()}};function Nr(e){return void 0!==e.timeMode}function _r(e){return void 0!==e.steps}function Lr(e=!0){return Xn("/inbox",{},e)}function Ir(e){return Xn("/inbox",{method:"GET",query:e?{page:e}:{}})}function Dr(e){return Xn("/inbox/"+e,{},!0)}function jr(e,t){return Xn("/inbox/"+e,{method:"POST",body:JSON.stringify({text:t})},!0)}function Ar(e,t,n){return Xn("/inbox/new",{method:"POST",body:JSON.stringify({username:e,subject:t,text:n})},!0)}function Br(e){return Xn("/inbox/"+e+"/delete",{method:"POST"},!0)}function Rr(e){return Xn("/player/autocomplete?friend=1",{query:{term:e}})}const $r=.6,zr=25,Fr=.7;function Ur(){const e=ji().vw;return e*(e>=960?.35:e>=500?.5:.85)}function Wr(e,t){e.style.transform=`translate3d(${t}px, 0, 0)`}function Gr(e,t){e.style.opacity=`${t}`}class SideMenuCtrl{constructor(e,t,n,a,i){this.isOpen=!1,this.open=()=>{this.isOpen=!0,ki.backbutton.stack.push(this.close);const e=document.getElementById(this.menuID),t=document.getElementById(this.backdropID);return this.onOpen&&this.onOpen(),Promise.all([ni(t,"visibility","visible",0),ni(t,"opacity",.7,250,"linear"),ni(e,"visibility","visible",0),ni(e,"transform","translate3d(0,0,0)",250,"ease-out")]).then(Xt).catch(console.error.bind(console))},this.close=e=>{"backbutton"!==e&&this.isOpen&&ki.backbutton.stack.pop(),this.isOpen=!1;const t=document.getElementById(this.menuID),n=document.getElementById(this.backdropID);return this.onClose&&this.onClose(),Promise.all([ni(n,"opacity",0,250,"linear"),ni(t,"transform",this.closeTranslate(),250,"ease-out")]).then((()=>Promise.all([ni(t,"visibility","hidden",0),ni(n,"visibility","hidden",0)]))).catch(console.error.bind(console))},this.toggle=e=>{e.stopPropagation(),this.isOpen?this.close():this.open()},this.closeTranslate=()=>"left"===this.side?"translate3d(-100%,0,0)":"translate3d(100%,0,0)",this.side=e,this.menuID=t,this.backdropID=n,this.onOpen=a,this.onClose=i}getMenuEl(){return document.getElementById(this.menuID)}getBackdropEl(){return document.getElementById(this.backdropID)}}let qr;const Vr=Mn(0),Hr=Mn(!1),Yr=Mn(0),Kr=Mn(0);const Xr=new SideMenuCtrl("left","side_menu","menu-close-overlay",(function(){rn()&&Or.sendWithNoCheck("moveLat",!0),qr=setTimeout(eo,2e3)}),(function(){Hr(!1),clearTimeout(qr),rn()&&Or.sendWithNoCheck("moveLat",!1)}));function Jr(e){return function(){return Xr.close().then((()=>ki.set(e)))}}function Qr(e){return function(){return Xr.close().then((()=>{e(),Xt()}))}}function Zr(){const e=!Hr();e&&Xn("/inbox/unread-count",{},!1).then((e=>{Vr(e),Xt()})),Hr(e)}function eo(){rn()&&Or.getCurrentPing().then((e=>{Kr(e),Yr(Or.getCurrentMoveLatency()),Xr.isOpen&&(Xt(),setTimeout(eo,2e3))}))}const to=qi((e=>{e.stopPropagation(),Xr.close()})),no=Symbol("newer"),ao=Symbol("older");class LRUMap{constructor(e,t){"number"!=typeof e&&(t=e,e=0),this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[no]&&(e===this.oldest&&(this.oldest=e[no]),e[no][ao]=e[ao]),e[ao]&&(e[ao][no]=e[no]),e[no]=void 0,e[ao]=this.newest,this.newest&&(this.newest[no]=e),this.newest=e)}assign(e){let t,n=this.limit||Number.MAX_VALUE;this._keymap.clear();let a=e[Symbol.iterator]();for(let e=a.next();!e.done;e=a.next()){let a=new io(e.value[0],e.value[1]);if(this._keymap.set(a.key,a),t?(t[no]=a,a[ao]=t):this.oldest=a,t=a,0==n--)throw new Error("overflow")}this.newest=t,this.size=this._keymap.size}get(e){var t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}set(e,t){var n=this._keymap.get(e);return n?(n.value=t,this._markEntryAsUsed(n),this):(this._keymap.set(e,n=new io(e,t)),this.newest?(this.newest[no]=n,n[ao]=this.newest):this.oldest=n,this.newest=n,++this.size,this.size>this.limit&&this.shift(),this)}shift(){var e=this.oldest;if(e)return this.oldest[no]?(this.oldest=this.oldest[no],this.oldest[ao]=void 0):(this.oldest=void 0,this.newest=void 0),e[no]=e[ao]=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]}toJSON(){for(var e=new Array(this.size),t=0,n=this.oldest;n;)e[t++]=[n.key,n.value],n=n[no];return e}}function io(e,t){this.key=e,this.value=t,this[no]=void 0,this[ao]=void 0}const ro=new LRUMap(100),oo=new RegExp(/^id\sname=([\w]+)\sversion=([\w.]+)/.source),so=a("Scan",{web:()=>import("./ScanWeb-a4838222.js").then((e=>new e.ScanWeb))});class ScanPlugin{constructor(e,t){this.variant=e,this.ttSize=lo(t),this.plugin=so}async start(){return new Promise((e=>{let t="Scan";const n=a=>{const i=a.output;if("string"!=typeof i)return;const r=oo.exec(i);r&&(t=`${r[1]} ${r[2]}`),i.startsWith("ready")&&(window.removeEventListener("scan",n,!1),e({engineName:t}))};window.addEventListener("scan",n,{passive:!0});const a=function(e){const t=e.toLowerCase();if("standard"===t||"fromposition"===t)return"normal";if("breakthrough"===t)return"bt";if("antidraughts"===t)return"losing";if("frysk"===t)return"frisian";return t}(this.variant);this.plugin.start({variant:a}).then((()=>this.setOption("tt-size",this.ttSize))).then((()=>this.setOption("bb-size",function(e){switch(e){case"normal":case"frisian":case"losing":return 3;case"bt":return 4;default:return 0}}(a)))).then((()=>this.send("hub"))).then((()=>this.send("init")))}))}setHash(e){this.ttSize=lo(e)}isReady(){return new Promise((e=>{const t=n=>{n.output.startsWith("pong")&&(window.removeEventListener("scan",t,!1),e())};window.addEventListener("scan",t,{passive:!0}),this.send("ping")}))}send(e){return this.plugin.cmd({cmd:e})}setOption(e,t){return this.send(`set-param name=${e} value=${t}`)}exit(){return this.plugin.exit()}}function lo(e){return Math.floor(Math.log2(1024*e*1024/16))}function co(e){const t=new Array(50),n=e.split(":");for(let e=0;e<n.length;e++)if(n[e].length>1){const a=n[e].slice(0,1);if("W"===a||"B"===a){const i=n[e].slice(1).split(",");for(let e=0;e<i.length;e++){const n=i[e].slice(0,1);"K"===n?t[parseInt(i[e].slice(1))-1]=a:"G"!==n&&"P"!==n&&(t[parseInt(i[e])-1]=a.toLowerCase())}}}return t}function uo(e){let t=e.slice(0,1);const n=co(e);for(let e=0;e<n.length;e++)t+=void 0!==n[e]?n[e]:"e";return t}const ho=[1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5],mo=[1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10];function po(e,t,n,a){const i=co(e),r=(e,t,a,i,o,s,l)=>{const c=mo[a],u=ho[a],d=mo[i],h=ho[i],m=d>c,p=h>u||h===u&&c%2==0,f=n&&d!==c&&h===u&&Math.abs(d-c)%2==0,g=n&&h!==u&&d===c;let v=s?i:a,b=0,y=!1;for(;(t||b<1)&&(0===b||void 0!==s||v!==i&&!y);){const n=mo[v];if(m)v+=5,v+=f?5:p?n%2==1?1:0:n%2==0?-1:0;else if(g)if(p){if(!(ho[v]<5))return;v+=1}else{if(!(ho[v]>1))return;v-=1}else v-=5,f?v-=5:v+=p?n%2==1?1:0:n%2==0?-1:0;if(v<0||v>49)return;if(!g&&!f&&1!==Math.abs(mo[v]-n))return;if(e[v]){if(v!==i)return;void 0===s&&(y=!0),b=0}else b++;if(void 0!==s)if(l){if(s===v)return v}else if((!o||-1===o.indexOf(v))&&void 0!==r(e,t,v,s))return v}return v===i||y?a:void 0},o=(e,t,n,a)=>{const i=e[n],s="W"===i||"B"===i;for(let l=0;l<t.length;l++){const c=t[l];if(void 0!==r(e,s,n,c))for(let u=0;u<t.length;u++){const d=l!==u?t[u]:1===t.length?a:-1;if(-1!==d){const h=[];let m;do{if(m=r(e,s,n,c,h,d,l===u&&1===t.length),void 0!==m){const r=t.slice();r.splice(l,1);const s=e.slice();s[c]="x",s[m]=i,s[n]="";const u=[m].concat(o(s,r,m,a));if(u.length===t.length)return u;h.push(m)}}while(void 0!==m)}}}return[]};let s=0;return t.split(" ").map((t=>{s++;if(-1!==t.indexOf("x")){const n=a[e+s+t];if(n)return n;const r=t.split("x").map((e=>parseInt(e)-1)),l=r[0],c=r[1];let u=[(l+1).toString()];if(r.length>3&&1===s){const e=o(i,r.slice(2),l,c);e&&(u=u.concat(e.map((e=>(e+1).toString()))))}else u.push((c+1).toString());const d=u.join("x");return a[e+s+t]=d,d}return t}))}function fo(){const e=window.deviceInfo.cpuCores;return Math.min(e>2?e-1:1,4)}function go(){}function vo(e){return Po[e[0]-1]+e[1]}const bo=(e,t)=>Co[e[0]+t[0]/2*(e[1]-1)-1],yo=e=>e<10?"0"+e.toString():e.toString(),wo=(e,t)=>ko(parseInt(e),t),ko=(e,t)=>[(e-1)%(t[0]/2)+1,(e-1+(t[0]/2-(e-1)%(t[0]/2)))/(t[1]/2)];function So(e,t,n,a){const i=t[0]/2,r=i-.5;return[(n?(e[1]%2!=0?-.5:-1)+e[0]:r-((e[1]%2!=0?-.5:-1)+e[0]))*a.width/i,(n?e[1]-1:t[1]-e[1])*a.height/t[1]]}const Co=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],To=["b8","d8","f8","h8","a7","c7","e7","g7","b6","d6","f6","h6","a5","c5","e5","g5","b4","d4","f4","h4","a3","c3","e3","g3","b2","d2","f2","h2","a1","c1","e1","g1"],Mo={1:"b8",2:"d8",3:"f8",4:"h8",5:"a7",6:"c7",7:"e7",8:"g7",9:"b6",10:"d6",11:"f6",12:"h6",13:"a5",14:"c5",15:"e5",16:"g5",17:"b4",18:"d4",19:"f4",20:"h4",21:"a3",22:"c3",23:"e3",24:"g3",25:"b2",26:"d2",27:"f2",28:"h2",29:"a1",30:"c1",31:"e1",32:"g1"},xo=["8","7","6","5","4","3","2","1"],Po=["a","b","c","d","e","f","g","h"];function Eo(e){return"white"===e?"black":"white"}function Oo(e,t){return void 0!==e&&-1!==e.indexOf(t)}function No(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function _o(e,t,n){if(e.otb){const a=e.orientation,i=e.otbMode,r=e.turnColor;return"facing"===i&&"white"===a&&"black"===t||"facing"===i&&"black"===a&&"white"===t||"flip"===i&&"white"===a&&"black"===r||"flip"===i&&"black"===a&&"white"===r?n+" rotate(180deg)":n}return n}function Lo(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function Io(e){return"translate3d("+e[0]+"px,"+e[1]+"px, 0)"}const Do=Lo([-99999,-99999]),jo=Io([-99999,-99999]);function Ao(e){const t=e.targetTouches[0];return[t.clientX,t.clientY]}function Bo(e,t,n,a){const i=wo(n,a),r=a[0],o=a[1];return"white"!==e&&(i[0]=r/2+1-i[0],i[1]=o+1-i[1]),{left:t.left+t.width*(2*(i[0]-1)+(i[1]%2!=0?1:0))/r,top:t.top+t.height*(i[1]-1)/o,width:t.width/r,height:t.height/o}}function Ro(e,t){let n=e.board.firstChild;for(;n;){if("PIECE"===n.tagName&&n.cgKey===t)return n;n=n.nextSibling}return null}function $o(e){for(const t in e)return!1;return!0}const zo=[[-1,-1,-1],[6,7,11],[7,8,12],[8,9,13],[9,10,14],[10,-1,15],[-1,11,16],[11,12,17],[12,13,18],[13,14,19],[14,15,20],[16,17,21],[17,18,22],[18,19,23],[19,20,24],[20,-1,25],[-1,21,26],[21,22,27],[22,23,28],[23,24,29],[24,25,30],[26,27,31],[27,28,32],[28,29,33],[29,30,34],[30,-1,35],[-1,31,36],[31,32,37],[32,33,38],[33,34,39],[34,35,40],[36,37,41],[37,38,42],[38,39,43],[39,40,44],[40,-1,45],[-1,41,46],[41,42,47],[42,43,48],[43,44,49],[44,45,50],[46,47,-1],[47,48,-1],[48,49,-1],[49,50,-1],[50,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1]],Fo=[[-1,-1,-1],[5,6,9],[6,7,10],[7,8,11],[8,-1,12],[-1,9,13],[9,10,14],[10,11,15],[11,12,16],[13,14,17],[14,15,18],[15,16,19],[16,-1,20],[-1,17,21],[17,18,22],[18,19,23],[19,20,24],[21,22,25],[22,23,26],[23,24,27],[24,-1,28],[-1,25,29],[25,26,30],[26,27,31],[27,28,32],[29,30,-1],[30,31,-1],[31,32,-1],[32,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1]],Uo=[[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,1,-1],[1,2,-1],[2,3,-1],[3,4,-1],[4,5,-1],[6,7,1],[7,8,2],[8,9,3],[9,10,4],[10,-1,5],[-1,11,6],[11,12,7],[12,13,8],[13,14,9],[14,15,10],[16,17,11],[17,18,12],[18,19,13],[19,20,14],[20,-1,15],[-1,21,16],[21,22,17],[22,23,18],[23,24,19],[24,25,20],[26,27,21],[27,28,22],[28,29,23],[29,30,24],[30,-1,25],[-1,31,26],[31,32,27],[32,33,28],[33,34,29],[34,35,30],[36,37,31],[37,38,32],[38,39,33],[39,40,34],[40,-1,35],[-1,41,36],[41,42,37],[42,43,38],[43,44,39],[44,45,40]],Wo=[[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,-1,-1],[-1,1,-1],[1,2,-1],[2,3,-1],[3,4,-1],[5,6,1],[6,7,2],[7,8,3],[8,-1,4],[-1,9,5],[9,10,6],[10,11,7],[11,12,8],[13,14,9],[14,15,10],[15,16,11],[16,-1,12],[-1,17,13],[17,18,14],[18,19,15],[19,20,16],[21,22,17],[22,23,18],[23,24,19],[24,-1,20],[-1,25,21],[25,26,22],[26,27,23],[27,28,24]],Go=[[-1,-1],[-1,2],[1,3],[2,4],[3,5],[4,-1],[-1,7],[6,8],[7,9],[8,10],[9,-1],[-1,12],[11,13],[12,14],[13,15],[14,-1],[-1,17],[16,18],[17,19],[18,20],[19,-1],[-1,22],[21,23],[22,24],[23,25],[24,-1],[-1,27],[26,28],[27,29],[28,30],[29,-1],[-1,32],[31,33],[32,34],[33,35],[34,-1],[-1,37],[36,38],[37,39],[38,40],[39,-1],[-1,42],[41,43],[42,44],[43,45],[44,-1],[-1,47],[46,48],[47,49],[48,50],[49,-1]],qo=[[-1,-1],[-1,2],[1,3],[2,4],[3,-1],[-1,6],[5,7],[6,8],[7,-1],[-1,10],[9,11],[10,12],[11,-1],[-1,14],[13,15],[14,16],[15,-1],[-1,18],[17,19],[18,20],[19,-1],[-1,22],[21,23],[22,24],[23,-1],[-1,26],[25,27],[26,28],[27,-1],[-1,30],[29,31],[30,32],[31,-1]],Vo={king:"d",man:"m",ghostman:"m",ghostking:"d",unsupport:"m"},Ho={M:"man",D:"king",P:"unsupport",B:"unsupport",N:"unsupport",R:"unsupport",Q:"unsupport",K:"unsupport",m:"man",d:"king",p:"unsupport",b:"unsupport",n:"unsupport",r:"unsupport",q:"unsupport",k:"unsupport"},Yo=["a","b","c","d","e","f","g","h","i","j"];function Ko(e,t){const n=t/2,a=parseInt(e,10)-1,i=t-Math.floor(a/n)-1,r=i+1;return`${Yo[2*(a%n)+(i%2==0?0:1)]}${r}`}function Xo(e,t){const n=t/2,a=Yo.indexOf(e[0]),i=parseInt(e[1])-1;if(i%2!=a%2)return null;return((t-i-1)*n+Math.floor(a/2)+1).toString().padStart(2,"0")}function Jo(e){return[e.substr(0,2),e.substr(2,2)]}function Qo(e){return ts(e)}function Zo(e){return Qo(e)}function es(e){return e.substr(2,2)}function ts(e){const t=[];if(e&&e.length>1)for(let n=0;n<e.length;n+=2)t.push(e.substr(n,2));return t}function ns(e){if(!e)return"";const t=e.includes("x"),n=e.split(t?"x":"-").map((e=>Mo[e]));return n.join(t?":":"-")}function as(e){return-1!==e.indexOf("x")?e.split("x").map((e=>1===e.length?"0"+e:e)).join(""):-1!==e.indexOf("-")?e.split("-").map((e=>1===e.length?"0"+e:e)).join(""):e}function is(e){if(!e)return e;const t=e.includes("x")?"x":"-",n=e.split(t);return n.length<2?e:n[0]+t+n[n.length-1]}function rs(e,t){const n=e.split(":"),a=t.split(":");if(n.length<3||a.length<3)return!1;for(let e=0;e<3;e++)if(n[e]!==a[e])return!1;return!0}function os(e){if(!(e&&e.startsWith("[")&&e.endsWith("]")&&e.includes("FEN")))return e;const t=e.indexOf('"'),n=e.lastIndexOf('"');return-1===t||-1===n||t===n?e:e.slice(t+1,n)}function ss(e){if(void 0===e)return null;if(p(e))return e;const t={};return e&&function(e){return"string"==typeof e}(e)&&e.split(" ").forEach((e=>{t[ls[e[0]]]=e.split("").slice(1).map((e=>ls[e]))})),t}const ls={a:"01",b:"02",c:"03",d:"04",e:"05",f:"06",g:"07",h:"08",i:"09",j:"10",k:"11",l:"12",m:"13",n:"14",o:"15",p:"16",q:"17",r:"18",s:"19",t:"20",u:"21",v:"22",w:"23",x:"24",y:"25",z:"26",A:"27",B:"28",C:"29",D:"30",E:"31",F:"32",G:"33",H:"34",I:"35",J:"36",K:"37",L:"38",M:"39",N:"40",O:"41",P:"42",Q:"43",R:"44",S:"45",T:"46",U:"47",V:"48",W:"49",X:"50"},cs="W31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50:B1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20",us="1m1m1m1m/m1m1m1m1/1m1m1m1m/8/8/M1M1M1M1/1M1M1M1M/M1M1M1M1 w";function ds(e,t){const n={};if(!e)return n;"start"===e&&(e=cs);for(const a of e.split(":")){if(a.length<=1)continue;const e=a.slice(0,1);let i;if("W"===e)i="white";else{if("B"!==e)continue;i="black"}const r=a.slice(1).split(",");for(const e of r){if(!e)continue;let a,r;switch(e.slice(0,1)){case"K":r="king",a=e.slice(1);break;case"G":r="ghostman",a=e.slice(1);break;case"P":r="ghostking",a=e.slice(1);break;default:r="man",a=e}1===a.length&&(a="0"+a);let o=parseInt(a);o||(o=To.indexOf(a)+1),o&&(!t||o<=t)&&(n[a]={color:i,role:r})}}return n}function hs(e,t,n){const a=t||50;let i="W",r="B";for(let t=1;t<=a;t++){const a=e[Co[t-1]];a&&("white"===a.color?(i.length>1&&(i+=","),"king"===a.role?i+="K":"ghostman"===a.role?i+="G":"ghostking"===a.role&&(i+="P"),i+=n?To[t-1]:t.toString()):(r.length>1&&(r+=","),"king"===a.role?r+="K":"ghostman"===a.role?r+="G":"ghostking"===a.role&&(r+="P"),r+=n?To[t-1]:t.toString()))}return i+":"+r}function ms(e,t,n){if(!e)return"";"start"===e&&(e=cs);const a=[];let i="",r="W",o="B";for(const s of e.split(":")){const l=s.slice(0,1);let c;if("W"===l)c=!0;else{if("B"!==l){a.push(s);continue}c=!1}if(1===s.length){i||a.length||(i=l);continue}const u=s.slice(1).split(",");for(const a of u){if(!a)continue;let i,s=a.slice(0,1);switch(s){case"K":case"G":case"P":i=a.slice(1);break;default:i=a,s=""}if(t){const t=parseInt(i);if(t&&(!n||t<=n))c?(r.length>1&&(r+=","),r+=s+To[t-1]):(o.length>1&&(o+=","),o+=s+To[t-1]);else if(!t&&To.includes(i))return e}else{const t=To.indexOf(i);if(-1!==t&&(!n||t<n))c?(r.length>1&&(r+=","),r+=s+(t+1).toString()):(o.length>1&&(o+=","),o+=s+(t+1).toString());else if(-1===t&&parseInt(i))return e}}}return(i?[i,r,o]:[r,o]).concat(a).join(":")}function ps(e){if(!e)return 0;"start"===e&&(e=cs);let t=0;for(const n of e.split(":")){if(n.length<=1)continue;let e=n.slice(0,1);if("W"===e||"B"===e){const a=n.slice(1).split(",");for(const n of a)e=n.slice(0,1),"G"!==e&&"P"!==e||t++}}return t}function fs(e){if(!e)return null;"start"===e&&(e=cs);const t=e.split(":"),n=t.length?t[t.length-1]:"";if(0!==n.indexOf("+"))return null;const a=n.split("+").filter((function(e){return 0!==e.length}));if(2!==a.length)return null;const i=parseInt(a[1].slice(0,1)),r=parseInt(a[0].slice(0,1)),o={white:{count:i},black:{count:r}};return i>0&&(o.white.key=a[1].slice(1)),r>0&&(o.black.key=a[0].slice(1)),o}const gs={m:"man",d:"king",p:"unsupport",r:"unsupport",n:"unsupport",b:"unsupport",q:"unsupport",k:"unsupport",M:"man",D:"king",P:"unsupport",R:"unsupport",N:"unsupport",B:"unsupport",Q:"unsupport",K:"unsupport"},vs={man:"m",king:"d",ghostman:"m",ghostking:"d",unsupport:"m"};const bs=[1,2,3,4,5,6,7,8],ys=[8,7,6,5,4,3,2,1];var ws={initial:cs,read:ds,write:hs,toggleCoordinates:ms,countGhosts:ps,readKingMoves:fs,convertChessFenToPeripheralPieces:function(e){const t=new Map;let n=8,a=0;for(let i=0;i<e.length;i++){const r=e[i];switch(r){case" ":return t;case"/":if(--n,0===n)return t;a=0;break;default:{const e=~~r;if(e)a+=e;else{++a;const e=r.toLowerCase();t.set(vo([a,n]),{role:"u?".includes(e)?void 0:gs[e],color:"?"===e?void 0:r===e?"black":"white"})}}}}return t},convertPeripheralPiecesToFen:function(e){return us},convertPiecesToChessFen:function(e,t){if(10===t)return us;const n=function(e,t){const n=new Map;for(const[a,i]of Object.entries(e)){const e=Ko(a,t);n.set(e,i)}return n}(e,t);return[8,7,6,5,4,3,2].reduce((function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),String(t))}),ys.map((e=>bs.map((t=>{const a=n.get(vo([t,e]));if(a){const e=vs[a.role];return"white"===a.color?e.toUpperCase():e}return"1"})).join(""))).join("/"))}};const ks=[50,100,150,200,300,400,500,1e3],Ss=[4,4,4,4,6,6,8,8],Cs=[100,100,90,90,80,70,60,50],Ts=[0,0,0,0,6,5,11,21],Ms=[50,120,400,1200,0,0,0,0],xs=[1,1,1,1,1,0,0,0],Ps=[3,2,0,0,0,0,0,0],Es=[0,0,0,0,0,0,9,21],Os=[20,50,150,450,2200,4400,0,0],Ns=[3,3,3,2,2,0,0,0],_s=[0,0,0,0,0,0,11,21],Ls=[50,200,600,1800,2400,9600,0,0],Is=[3,3,2,2,2,2,0,0],Ds=[1,1,1,1,0,0,0,0],js=[3,4,5,6,8,10,12,19],As=[4,5,7,8,11,14,17,0],Bs=[1,1,1,0,0,0,0,0],Rs=[0,0,0,0,0,0,0,0],$s=[0,0,0,0,0,0,0,0],zs={1:1100,2:1300,3:1650,4:1900,5:2100,6:2300,7:2500,8:2700};class Engine{constructor(e,t){this.ctrl=e,this.v=t,this.uciCache={},this.searchFen="",this.isInit=!1,this.listener=e=>{const n=e.output.match(/^done move=([0-9\-xX\s]+)/);n&&this.ctrl.onEngineMove(po(this.searchFen,n[1],"frisian"===t||"frysk"===t,this.uciCache)[0])},this.variant=t,this.scan=new ScanPlugin(t,16)}async init(){try{if(!this.isInit){if("web"!==n.getPlatform()){const e=await async function(){return Promise.resolve(window.deviceInfo.scanMaxMemory)}();this.scan.setHash(e)}await this.scan.start(),this.isInit=!0,window.addEventListener("scan",this.listener,{passive:!0}),await this.scan.setOption("threads",fo()),await this.newGame()}}catch(e){}}async newGame(){await this.scan.send("new-game"),await this.scan.isReady()}async search(e,t,n,a){this.searchFen=n;const i=uo(t),r=e,o=Ss[r-1],s=Cs[r-1],l=ks[r-1];let c,u,d,h,m;"frysk"===this.variant?(c=Ds[r-1],u=Is[r-1],d=_s[r-1],h=0,m="Wbbbbbeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeewwwww"===i&&a.length<4?1:Ls[r-1]):"frisian"===this.variant?(c=xs[r-1],u=Ns[r-1],d=Es[r-1],h=0,m=Os[r-1]):"antidraughts"===this.variant?(c=Bs[r-1],u=Rs[r-1],d=js[r-1],h=As[r-1],m=$s[r-1]):(c=xs[r-1],u=Ps[r-1],d=Ts[r-1],h=0,m=Ms[r-1]);const p=a.map((e=>e.length>4?e.slice(0,2)+"x"+e.slice(2):e.slice(0,2)+"-"+e.slice(2)));let f=`pos pos=${i}${p.length?' moves="'+p.join(" ")+'"':""}`;if("frysk"===this.variant||"frisian"===this.variant){const e=fs(t);let n="";(null==e?void 0:e.white.key)&&(null==e?void 0:e.white.count)&&(n+=`W${e.white.key}=${e.white.count}`),(null==e?void 0:e.black.key)&&(null==e?void 0:e.black.count)&&(n&&(n+=" "),n+=`B${e.black.key}=${e.black.count}`),n&&(f+=` wolf="${n}"`)}return this.scan.send(f).then((()=>u?this.scan.send(`level handicap=${u}`):Promise.resolve())).then((()=>h?this.scan.send(`level ply=${h}`):Promise.resolve())).then((()=>m?this.scan.send(`level nodes=${m}`):Promise.resolve())).then((()=>this.scan.setOption("eval",c?"pst":"pattern"))).then((()=>s?this.scan.setOption("book-margin",s):Promise.resolve())).then((()=>this.scan.setOption("book-ply",o))).then((()=>d?this.scan.send(`level depth=${d}`):Promise.resolve())).then((()=>l?this.scan.send("level move-time="+l/1e3):Promise.resolve())).then((()=>this.scan.send("go think")))}async exit(){return window.removeEventListener("scan",this.listener,!1),this.scan.exit()}}function Fs(e,t){var n;if(e){const a=e.title?e.title.endsWith("-64")?e.title.slice(0,e.title.length-3):e.title:"",i=(null===(n=e.user)||void 0===n?void 0:n.displayName)||e.name;return(a?a+" "+i:i)+(t?" ("+e.rating+")":"")}return kt("anonymous")}function Us(e,t=!1,n=!1,a){var i,r,o;let s=(null===(i=e.user)||void 0===i?void 0:i.displayName)||e.name||e.username||(null===(r=e.user)||void 0===r?void 0:r.username);if(s){if(null===(o=e.user)||void 0===o?void 0:o.title){const t=e.user.title;s=(t.endsWith("-64")?t.slice(0,t.length-3):t)+" "+s}return n&&(c=a||100,s=(l=s).length>c?l.slice(0,c)+"…":l),t&&(e.user||e.rating)&&(s+=" ("+(e.rating||e.user.rating),e.provisional&&(s+="?"),s+=")"),s}var l,c;if(e.ai){const n=Ws(e);return t?n+" ("+zs[e.ai]+")":n}return kt("anonymous")}function Ws(e){return kt("aiNameLevelAiLevel","Scan",e.ai)}const Gs="W:W31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50:B1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20:H0:F1",qs={key:"100",size:[10,10]},Vs={key:"64",size:[8,8]},Hs={standard:{name:"Standard",tinyName:"Std",id:1,gameType:20,link:"https://lidraughts.org/variant/standard",title:"Standard rules of international draughts (FMJD)",board:qs},fromPosition:{name:"From position",shortName:"Fen",tinyName:"Fen",id:3,gameType:99,title:"Custom starting position",board:qs},antidraughts:{name:"Antidraughts",tinyName:"Anti",id:6,gameType:98,link:"https://lidraughts.org/variant/antidraughts",alert:"This is an Antidraughts game!\n\nThe game can be won by losing all your pieces, or running out of moves.",title:"Lose all your pieces (or run out of moves) to win the game.",board:qs},frysk:{name:"Frysk!",tinyName:"Frysk",id:8,gameType:97,link:"https://lidraughts.org/variant/frysk",alert:"This is a Frysk! game!\n\nFrisian draughts starting with 5 pieces each.",title:"Frisian draughts starting with 5 pieces each.",initialFen:"W:W46,47,48,49,50:B1,2,3,4,5:H0:F1",board:qs},breakthrough:{name:"Breakthrough",shortName:"BT",tinyName:"BT",id:9,gameType:96,link:"https://lidraughts.org/variant/breakthrough",alert:"This is a Breakthrough game!\n\nThe first player who makes a king wins.",title:"The first player who makes a king wins.",board:qs},frisian:{name:"Frisian",tinyName:"Frisian",id:10,gameType:40,link:"https://lidraughts.org/variant/frisian",alert:"This is a Frisian Draughts game!\n\nPieces can also capture horizontally and vertically.",title:"Pieces can also capture horizontally and vertically.",board:qs},russian:{name:"Russian",tinyName:"Russian",id:11,gameType:25,link:"https://lidraughts.org/variant/russian",title:"Russian draughts",initialFen:"W:W21,22,23,24,25,26,27,28,29,30,31,32:B1,2,3,4,5,6,7,8,9,10,11,12:H0:F1",board:Vs},brazilian:{name:"Brazilian",tinyName:"Brazilian",id:12,gameType:26,link:"https://lidraughts.org/variant/brazilian",title:"Brazilian draughts",initialFen:"W:W21,22,23,24,25,26,27,28,29,30,31,32:B1,2,3,4,5,6,7,8,9,10,11,12:H0:F1",board:Vs}};function Ys(e){return e in Hs}function Ks(e){return Hs[e]||Hs.standard}function Xs(e){return Ks(e).board}function Js(e){const t=parseInt(e);for(const e of Object.keys(Hs)){if(Hs[e].id===t)return e}}function Qs(e){const t=Ks(e);return{key:e,board:t.board,name:t.name,short:t.shortName||t.tinyName||t.name,title:t.title}}function Zs(e){return Ks(e).initialFen||Gs}const el=new Set(["frysk","russian","brazilian"]),tl=new Set(["standard","antidraughts","frisian","breakthrough","russian","brazilian"]);class Siema{constructor(e){if(this.config=Siema.mergeSettings(e),this.selector="string"==typeof this.config.selector?document.querySelector(this.config.selector):this.config.selector,null===this.selector||null===this.selector.firstElementChild)throw new Error("Something wrong with your selector ??");this.resolveSlidesNumber(),this.selectorWidth=this.selector.offsetWidth,this.innerElements=[].slice.call(this.selector.firstElementChild.children),this.currentSlide=Math.max(0,Math.min(this.config.startIndex,this.innerElements.length-this.perPage)),this.transformProperty="transform",["resizeHandler","touchstartHandler","touchendHandler","touchmoveHandler"].forEach((e=>{this[e]=this[e].bind(this)})),this.init()}static mergeSettings(e){const t={selector:".siema",duration:200,easing:"ease-out",perPage:1,startIndex:0,draggable:!0,threshold:20,rtl:!1,onInit:()=>{},onChange:()=>{}},n=e;for(const e in n)t[e]=n[e];return t}attachEvents(){if(window.addEventListener("resize",this.resizeHandler),this.config.draggable){this.pointerDown=!1,this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:!1};const e={passive:!0};this.selector.addEventListener("touchstart",this.touchstartHandler,e),this.selector.addEventListener("touchend",this.touchendHandler,e),this.selector.addEventListener("touchmove",this.touchmoveHandler,e)}}detachEvents(){window.removeEventListener("resize",this.resizeHandler),this.selector.removeEventListener("touchstart",this.touchstartHandler),this.selector.removeEventListener("touchend",this.touchendHandler),this.selector.removeEventListener("touchmove",this.touchmoveHandler)}init(){this.attachEvents(),this.selector.style.overflow="hidden",this.selector.style.direction=this.config.rtl?"rtl":"ltr",this.buildSliderFrame(),this.config.onInit.call(this)}buildSliderFrame(){const e=this.selectorWidth/this.perPage,t=this.innerElements.length;this.sliderFrame=this.selector.firstElementChild,this.sliderFrame.style.width=e*t+"px";for(let e=0;e<this.innerElements.length;e++)this.buildSliderFrameItem(this.innerElements[e]);this.slideToCurrent()}buildSliderFrameItem(e){e.style.cssFloat=this.config.rtl?"right":"left",e.style.float=this.config.rtl?"right":"left",e.style.width=100/this.innerElements.length+"%"}resolveSlidesNumber(){if("number"==typeof this.config.perPage)this.perPage=this.config.perPage;else if("object"==typeof this.config.perPage){this.perPage=1;for(const e in this.config.perPage)window.innerWidth>=e&&(this.perPage=this.config.perPage[e])}}prev(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.max(this.currentSlide-e,0),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}next(e=1){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(this.currentSlide+e,this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}goTo(e){if(this.innerElements.length<=this.perPage)return;const t=this.currentSlide;this.currentSlide=Math.min(Math.max(e,0),this.innerElements.length-this.perPage),t!==this.currentSlide&&(this.slideToCurrent(),setTimeout((()=>this.config.onChange()),0))}slideToCurrent(){const e=this.currentSlide,t=(this.config.rtl?1:-1)*e*(this.selectorWidth/this.perPage);ni(this.sliderFrame,"transform",`translate3d(${t}px, 0, 0)`,this.config.duration,this.config.easing)}updateAfterDrag(){const e=(this.config.rtl?-1:1)*(this.drag.endX-this.drag.startX),t=Math.abs(e);e>0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide-1>=0?this.prev(1):e<0&&t>this.config.threshold&&this.innerElements.length>this.perPage&&this.currentSlide+1<=this.innerElements.length-this.perPage?this.next(1):this.slideToCurrent()}resizeHandler(){this.resolveSlidesNumber(),this.currentSlide+this.perPage>this.innerElements.length&&(this.currentSlide=this.innerElements.length<=this.perPage?0:this.innerElements.length-this.perPage),this.selectorWidth=this.selector.offsetWidth,this.buildSliderFrame()}clearDrag(){this.drag={startX:0,endX:0,startY:0,letItGo:null,preventClick:this.drag.preventClick}}touchstartHandler(e){-1!==["TEXTAREA","OPTION","INPUT","SELECT"].indexOf(e.target.nodeName)||(e.stopPropagation(),this.pointerDown=!0,this.drag.startX=e.touches[0].pageX,this.drag.startY=e.touches[0].pageY)}touchendHandler(e){e.stopPropagation(),this.pointerDown=!1,this.drag.endX&&this.updateAfterDrag(),this.clearDrag()}touchmoveHandler(e){if(e.stopPropagation(),null===this.drag.letItGo&&(this.drag.letItGo=Math.abs(this.drag.startY-e.touches[0].pageY)<Math.abs(this.drag.startX-e.touches[0].pageX)),this.pointerDown&&this.drag.letItGo){this.drag.endX=e.touches[0].pageX;const t=this.currentSlide*(this.selectorWidth/this.perPage),n=this.drag.endX-this.drag.startX,a=this.config.rtl?t+n:t-n;this.sliderFrame.style[this.transformProperty]=`translate3d(${(this.config.rtl?1:-1)*a}px, 0, 0)`}}remove(e,t){if(e<0||e>=this.innerElements.length)throw new Error("Item to remove doesn't exist ??");const n=e<this.currentSlide,a=this.currentSlide+this.perPage-1===e;(n||a)&&this.currentSlide--,this.innerElements.splice(e,1),this.buildSliderFrame(),t&&t.call(this)}insert(e,t,n){if(t<0||t>this.innerElements.length+1)throw new Error("Unable to inset it at this index ??");if(-1!==this.innerElements.indexOf(e))throw new Error("The same item in a carousel? Really? Nope ??");const a=t<=this.currentSlide>0&&this.innerElements.length;this.currentSlide=a?this.currentSlide+1:this.currentSlide,this.innerElements.splice(t,0,e),this.buildSliderFrame(),n&&n.call(this)}prepend(e,t){this.insert(e,0),t&&t.call(this)}append(e,t){this.insert(e,this.innerElements.length+1),t&&t.call(this)}destroy(e=!1,t){if(this.detachEvents(),this.selector.style.cursor="auto",e){for(let e=0;e<this.innerElements.length;e++)this.innerElements[e].removeAttribute("style");this.sliderFrame&&this.sliderFrame.removeAttribute("style"),this.selector.removeAttribute("style")}t&&t.call(this)}}function nl(e,t,n,a){const i=e[n],r=Number(n);if(void 0===i||isNaN(r))return new Array;const o=a&&null!==a&&("frisian"===a||"frysk"===a),s=10===t[0],l=s?Uo:Wo,c=s?zo:Fo,u=s?Go:qo,d=new Array;switch(i.role){case"man":for(let t=0;t<(o?3:2);t++){let n=l[r][t];if(-1!==n){const a=yo(n);"white"===i.color&&t<2&&d.push(a);const r=e[a];void 0!==r&&r.color===i.color||(n=l[n][t],-1!==n&&d.push(yo(n)))}}for(let t=0;t<(o?3:2);t++){let n=c[r][t];if(-1!==n){const a=yo(n);"black"===i.color&&t<2&&d.push(a);const r=e[a];void 0!==r&&r.color===i.color||(n=c[n][t],-1!==n&&d.push(yo(n)))}}if(o)for(let t=0;t<2;t++){let n=u[r][t];if(-1!==n){const a=e[yo(n)];void 0!==a&&a.color===i.color||(n=u[n][t],-1!==n&&d.push(yo(n)))}}break;case"king":for(let e=0;e<(o?3:2);e++){let t=l[r][e],n=0;for(;-1!==t;)(e<2||n>0)&&d.push(yo(t)),t=l[t][e],n++}for(let e=0;e<(o?3:2);e++){let t=c[r][e],n=0;for(;-1!==t;)(e<2||n>0)&&d.push(yo(t)),t=c[t][e],n++}if(o)for(let e=0;e<2;e++){let t=u[r][e],n=0;for(;-1!==t;)n>0&&d.push(yo(t)),t=u[t][e],n++}}return d}function al(e){e.orientation=Eo(e.orientation),e.animation.current=e.draggable.current=e.selected=null}function il(e,t){for(const n in t){const a=t[n];a?e.pieces[n]=a:delete e.pieces[n]}}function rl(e){e.premovable.current&&(e.premovable.current=null,setTimeout(e.premovable.events.unset||go))}function ol(e){e.predroppable.current&&(e.predroppable.current=null,setTimeout((()=>{e.predroppable.events.unset&&e.predroppable.events.unset()})))}function sl(e,t,n,a,i,r){const o=i-n,s=r-a,l=0===s?0:s>0?0===o&&Math.abs(s)>=2?2:1:0===o&&Math.abs(s)>=2?-2:-1,c=0===o?0:0===s?o>0?1:-1:a%2==0?o<0?-1:0:o>0?1:0;if(0===c&&0===l)return null;const u=[n+c,a+l];if(void 0===u)return null;const d=bo(u,t),h=e[d];return void 0!==h&&"ghostman"!==h.role&&"ghostking"!==h.role?d:sl(e,t,n+c,a+l,i,r)}function ll(e,t,n){if(pl(e,t,n)){if(wl(e,t,n))return dl(e,null),setTimeout((()=>{e.movable.events.after&&e.movable.events.after(t,n,{premove:!1})})),!0}else!function(e,t,n){return t!==n&&fl(e,t)&&Oo(nl(e.pieces,e.boardSize,t,e.premovable.variant),n)}(e,t,n)?ml(e,n)||fl(e,n)?dl(e,n):hl(e):(!function(e,t,n){ol(e),e.premovable.current=[t,n],setTimeout((()=>{e.premovable.events.set&&e.premovable.events.set(t,n)}),0)}(e,t,n),dl(e,null));return!1}function cl(e,t,n,a=!1){if(function(e,t,n){const a=e.pieces[t];return a&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===a.color&&e.turnColor===a.color)}(e,t,n)||a){const i=e.pieces[t];delete e.pieces[t],yl(e,i,n,a),setTimeout((()=>{e.movable.events.afterNewPiece&&e.movable.events.afterNewPiece(i.role,n,{premove:!1,predrop:!1})}))}else!function(e,t,n){const a=e.pieces[t];return a&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&e.movable.color===a.color&&e.turnColor!==a.color}(e,t,n)?(rl(e),ol(e)):function(e,t,n){rl(e),e.predroppable.current={role:t,key:n},setTimeout((()=>{e.predroppable.events.set&&e.predroppable.events.set(t,n)}),0)}(e,e.pieces[t].role,n);delete e.pieces[t],dl(e,null)}function ul(e,t,n){if(e.selected)if(e.selected!==t||e.draggable.enabled){if((e.selectable.enabled||n)&&e.selected!==t&&ll(e,e.selected,t)){const n=e.animateFrom?e.animateFrom+1:1;e.movable.captLen&&e.movable.captLen>(e.lastMove?e.lastMove.length-n:1)&&dl(e,t)}}else hl(e);else(ml(e,t)||fl(e,t))&&dl(e,t)}function dl(e,t){e.selected=t,t&&fl(e,t)?e.premovable.dests=nl(e.pieces,e.boardSize,t,e.premovable.variant):e.premovable.dests=null}function hl(e){e.selected=null,e.premovable.dests=null}function ml(e,t){const n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function pl(e,t,n){return t!==n&&ml(e,t)&&(e.movable.free||null!==e.movable.dests&&Oo(e.movable.dests[t],n))}function fl(e,t){const n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function gl(e){const t=e.premovable.current;if(!t)return!1;let n=!1;const a=t[0],i=t[1];if(pl(e,a,i)){const t=wl(e,a,i);if(t){const r={premove:!0};"boolean"!=typeof t&&(r.captured=t),setTimeout((()=>{e.movable.events.after&&e.movable.events.after(a,i,r)})),n=!0}}return rl(e),n}function vl(e){rl(e),ol(e),dl(e,null)}function bl(e,t,n,a){if(t===n||!e.pieces[t]){if(a){for(let t=0;t<Co.length;t++){const n=Co[t],a=e.pieces[n];!a||"ghostking"!==a.role&&"ghostman"!==a.role||delete e.pieces[n]}n===e.selected&&hl(e)}return!1}const i=e.movable.captLen&&e.movable.captLen>0,r=e.boardSize,o=i&&e.movable.captureUci&&e.movable.captureUci.find((e=>e.slice(0,2)===t&&e.slice(-2)===n)),s=wo(t,r),l=wo(o?o.slice(2,4):n,r),c=i?sl(e.pieces,r,s[0],s[1],l[0],l[1]):null,u=i&&c?e.pieces[c]:void 0,d=e.pieces[t];setTimeout((()=>{e.events.move&&e.events.move(t,n,u)}),0);const h=o?(o.length-2)/2:1,m=o?wo(o.slice(o.length-2),r):l,p=("russian"===(e.movable&&e.movable.variant||e.premovable&&e.premovable.variant)||!e.movable.captLen||e.movable.captLen<=h)&&"man"===d.role&&("white"===d.color&&1===m[1]||"black"===d.color&&m[1]===e.boardSize[1]),f=!e.movable.free&&p?{role:"king",color:d.color}:e.pieces[t];if(e.lastPromotion=f.role!=e.pieces[t].role?f.role:null,delete e.pieces[t],o&&c){delete e.pieces[c];for(let t=2;t+4<=o.length;t+=2){const n=wo(o.slice(t,t+2),r),a=wo(o.slice(t+2,t+4),r),i=sl(e.pieces,r,n[0],n[1],a[0],a[1]);i&&delete e.pieces[i]}e.pieces[n]=f}else if(e.pieces[n]=f,c){const t=e.pieces[c].color,n=e.pieces[c].role;if(delete e.pieces[c],!a&&null!==e.movable.captLen&&e.movable.captLen>1)"man"===n?e.pieces[c]={role:"ghostman",color:t}:"king"===n&&(e.pieces[c]={role:"ghostking",color:t});else for(let t=0;t<Co.length;t++){const n=Co[t],a=e.pieces[n];!a||"ghostking"!==a.role&&"ghostman"!==a.role||delete e.pieces[n]}}return e.lastMove&&e.lastMove.length&&i&&e.lastMove[e.lastMove.length-1]===t?(e.animateFrom=e.lastMove.length-1,o?e.lastMove=e.lastMove.concat(ts(o.slice(2))):e.lastMove.push(n)):(e.animateFrom=0,e.lastMove=o?ts(o):[t,n]),setTimeout(e.events.change||go),u||!0}function yl(e,t,n,a=!1){if(e.pieces[n]){if(!a)return!1;delete e.pieces[n]}return setTimeout((()=>{e.events.dropNewPiece&&e.events.dropNewPiece(t,n)})),e.pieces[n]=t,e.lastMove=[n,n],setTimeout(e.events.change||go),e.movable.dests={},e.turnColor=Eo(e.turnColor),!0}function wl(e,t,n){const a=bl(e,t,n);return a&&(e.movable.dests=null,(null===e.movable.captLen||e.movable.captLen<=1)&&(e.turnColor=Eo(e.turnColor)),e.animation.current=null),a}function kl(e){return e.boardSize[0]*e.boardSize[1]/2}function Sl(){return{variant:"standard",pieces:{},boardSize:[10,10],orientation:"white",turnColor:"white",check:null,lastMove:null,lastPromotion:null,animateFrom:null,selected:null,coordinates:2,coordSystem:1,otb:!1,otbMode:"none",shift:null,shiftView:null,viewOnly:!1,fixed:!1,edit:!1,exploding:null,highlight:{lastMove:!0,kingMoves:!0},animation:{enabled:!0,duration:200,current:null},movable:{free:!0,color:"both",dests:null,dropped:null,captLen:null,captureUci:null,showDests:!0,events:{}},premovable:{enabled:!0,showDests:!0,variant:null,dests:null,current:null,events:{}},predroppable:{enabled:!1,current:null,events:{}},draggable:{enabled:!0,distance:3,magnified:!0,centerPiece:!1,preventDefault:!0,showGhost:!0,deleteOnDropOff:!1,current:null},selectable:{enabled:!0},events:{},prev:{boardSize:null,orientation:null,bounds:null,turnColor:null,otbMode:null},peripheral:{isMoveRejected:!1,lastMove:null,lastPromotion:null,isVariantSupported:!1,isSynchronized:!0,isGettable:!1,isSettable:!1,pieces:new Map}}}function Cl(e,t){if(t){if(t.movable&&t.movable.dests&&(e.movable.dests=null),t.movable&&t.movable.captureUci&&(e.movable.captureUci=null),xl(e,t),t.variant&&(e.variant=t.variant),t.fen&&(e.pieces=ws.read(t.fen,kl(e)),e.highlight&&e.highlight.kingMoves)){const n=ws.readKingMoves(t.fen);n&&Ml(e,n)}void 0!==t.captureLength&&(e.movable.captLen=t.captureLength),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove&&(e.lastMove=null,e.animateFrom=null),e.selected&&dl(e,e.selected),t.edit&&(e.edit=t.edit),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1)}}function Tl(e,t){if(t){if(t.boardSize&&(e.boardSize=t.boardSize),void 0!==t.coordinates&&(e.coordinates=t.coordinates),void 0!==t.coordSystem&&(e.coordSystem=t.coordSystem),t.variant&&(e.movable.variant=t.variant,e.premovable.variant=t.variant,e.variant=t.variant),t.fen&&(e.pieces=ws.read(t.fen,kl(e))),e.highlight&&e.highlight.kingMoves){const n=t.kingMoves?t.kingMoves:t.fen?ws.readKingMoves(t.fen):null;null!==n&&function(e,t){const n=kl(e);for(let t=1;t<=n;t++){const n=e.pieces[Co[t-1]];n&&n.kingMoves&&(n.kingMoves=void 0)}Ml(e,t)}(e,n)}void 0!==t.orientation&&(e.orientation=t.orientation),void 0!==t.turnColor&&(e.turnColor=t.turnColor),void 0!==t.otb&&(e.otb=t.otb),void 0!==t.shift&&(e.shift=t.shift),void 0!==t.shiftView&&(e.shiftView=t.shiftView),void 0!==t.dests&&(e.movable.dests=t.dests),void 0!==t.movableColor&&(e.movable.color=t.movableColor),void 0!==t.captureLength&&(e.movable.captLen=t.captureLength),void 0!==t.captureUci&&(e.movable.captureUci=t.captureUci),Object.prototype.hasOwnProperty.call(t,"lastMove")&&!t.lastMove?(e.lastMove=null,e.animateFrom=null):t.lastMove&&(e.lastMove=t.lastMove,e.animateFrom=null),e.selected&&dl(e,e.selected)}}function Ml(e,t){if(t.white.count>0&&t.white.key){const n=e.pieces[t.white.key];n&&"king"===n.role&&"white"===n.color&&(n.kingMoves=t.white.count)}if(t.black.count>0&&t.black.key){const n=e.pieces[t.black.key];n&&"king"===n.role&&"black"===n.color&&(n.kingMoves=t.black.count)}}function xl(e,t){for(const n in t)Pl(e[n])&&Pl(t[n])?xl(e[n],t[n]):e[n]=t[n]}function Pl(e){return e&&"object"==typeof e}function El(e,t){const n=t.board,a="white"===e.orientation,i=e.boardSize,r=e.fixed?Ll(i):_l(t.bounds,i),o=e.fixed?Dl(i):Il(t.bounds,i),s=e.prev.boardSize&&(e.prev.boardSize[0]!==e.boardSize[0]||e.prev.boardSize[1]!==e.boardSize[1]);e.prev.boardSize=[e.boardSize[0],e.boardSize[1]];const l=e.prev.orientation&&e.prev.orientation!==e.orientation;e.prev.orientation=e.orientation;const c=e.prev.bounds&&e.prev.bounds!==t.bounds;e.prev.bounds=t.bounds;const u=c||l||s,d=e.pieces,h=e.animation.current&&e.animation.current.plan.anims,m=e.animation.current&&e.animation.current.plan.captures,p=e.animation.current&&e.animation.current.plan.tempRole,f=function(e){const t=new Map,n=e.peripheral.pieces,a=!n.size;if(e.peripheral.isSynchronized||a){const n=e.peripheral.isVariantSupported&&e.peripheral.isMoveRejected&&e.peripheral.lastMove;e.lastMove&&e.highlight.lastMove&&!n&&e.lastMove.forEach((e=>{e&&Fl(t,e,"last-move")}))}if(e.selected){Fl(t,e.selected,"selected");const n=e.movable.dests&&e.movable.dests[e.selected];n&&n.forEach((n=>{e.movable.showDests&&Fl(t,n,"move-dest"+(e.pieces[n]?" occupied":""))}));const a=e.premovable.dests;a&&a.forEach((n=>{e.movable.showDests&&Fl(t,n,"premove-dest"+(e.pieces[n]?" occupied":""))}))}const i=e.premovable.current;i&&i.forEach((e=>{Fl(t,e,"current-premove")}));e.exploding&&e.exploding.keys.forEach((n=>{Fl(t,n,"exploding"+e.exploding.stage)}));return t}(e),g=function(e){const t=new Map,n=e.pieces,a=e.peripheral.pieces,i=!a.size;if(e.peripheral.isSynchronized||i)e.peripheral.isVariantSupported&&e.peripheral.isMoveRejected&&e.peripheral.lastMove&&(zl(t,e.peripheral.lastMove[0],"rejected-move"),zl(t,e.peripheral.lastMove[1],"rejected-move"));else if(e.peripheral.isVariantSupported){for(const[i,r]of Object.entries(n)){const n=Ko(i,e.boardSize[0]),o=a.get(n);o?(o.role&&o.role!==r.role||o.color&&o.color!==r.color)&&zl(t,n,"piece-replace"):zl(t,n,"piece-add")}for(const i of a.keys()){const a=Xo(i,e.boardSize[0]);null!==a&&n[a]||zl(t,i,"piece-remove")}}return t}(e),v=new Set,b=new Set,y=new Map,w=new Map,k=Object.keys(d);let S,C,T,M,x,P,E,O,N,_,L=e.animation.current&&e.animation.current.lastMove&&e.animation.current.lastMove.length>2&&e.animation.current.lastMove[0]===e.animation.current.lastMove[e.animation.current.lastMove.length-1]?e.animation.current.lastMove[0]:void 0,I=!1;if(e.otb&&(N=e.prev.turnColor&&e.prev.turnColor!==e.turnColor,_=e.prev.otbMode&&e.prev.otbMode!==e.otbMode,e.prev.otbMode=e.otbMode,e.prev.turnColor=e.turnColor,I=!(!N&&!_)),l||s){const n=t.elements.coordRanks||t.elements.coordFiles;if(2===e.coordinates&&n){const a=n.parentElement;a&&Ul(a,e.boardSize,e.orientation,t,e.coordSystem)}else 1===e.coordinates?Wl(e,t):Gl(t)}let D=t.board.firstChild;for(;D;){const t=D.cgKey;if(C=d[t],S=f.get(t),T=h&&h[t],M=m&&m[t],x=p&&p[t],Bl(D))if(!D.cgDragging||e.draggable.current&&e.draggable.current.orig===t||(D.classList.remove("dragging"),D.classList.remove("magnified"),P=r(wo(t,i),a,0),jl(e,D,D.cgColor,P),D.cgDragging=!1),D.classList.contains("temporary")&&M){const e=$l(M)+" temporary";D.cgPiece!==e&&(D.className=e),v.add(t)}else if(C){const n=$l(C);if(T&&D.cgAnimating&&D.cgPiece===n){L=void 0;const n=wo(t,i);n[0]+=T[2],n[1]+=T[3],e.animation.current&&e.animation.current.plan.nextPlan&&e.animation.current.plan.nextPlan.anims[t]&&!$o(e.animation.current.plan.nextPlan.anims[t])&&(n[0]+=e.animation.current.plan.nextPlan.anims[t][2],n[1]+=e.animation.current.plan.nextPlan.anims[t][3]),D.classList.add("anim"),x?(D.className=D.className.replace(C.role,x),D.classList.add("temprole")):D.classList.contains("temprole")&&(D.classList.remove("temprole"),"king"===C.role?D.className=D.className.replace("man","king"):"man"===C.role&&(D.className=D.className.replace("king","man"))),P=r(n,a,T[4]),jl(e,D,D.cgColor,P)}else D.cgAnimating&&(D.cgAnimating=!1,D.classList.remove("anim"),D.classList.contains("temprole")&&(D.classList.remove("temprole"),"king"===C.role?D.className=D.className.replace("man","king"):"man"===C.role&&(D.className=D.className.replace("king","man"))),P=r(wo(t,i),a,0),jl(e,D,D.cgColor,P));D.cgPiece!==n||u||I||t===L?y.set(D.cgPiece,(y.get(D.cgPiece)||[]).concat(D)):v.add(t)}else y.set(D.cgPiece,(y.get(D.cgPiece)||[]).concat(D));else Rl(D)&&(u||S!==D.className?w.set(D.className,(w.get(D.className)||[]).concat(D)):b.add(t));D=D.nextSibling}f.forEach(((t,o)=>{if(!b.has(o))if(E=w.get(t),O=E&&E.pop(),O)O.cgKey=o,P=r(wo(o,i),a,0),Al(e,O,P);else{const s=document.createElement("square");s.className=t,s.cgKey=o,P=r(wo(o,i),a,0),Al(e,s,P),n.insertBefore(s,n.firstChild)}})),function(e){const t=e.board.children;if(t&&t.length)for(let n=t.length-1;n>=0;n--){const a=t[n];"CHESSSQUARE"===a.tagName&&e.board.removeChild(a)}}(t),g.forEach(((t,r)=>{const s=document.createElement("chesssquare");s.className=t,s.cgKey=r,P=o(function(e,t){return[e.charCodeAt(0)-96,t[1]-(e.charCodeAt(1)-48)+1]}(r,i),a),Al(e,s,P),n.insertBefore(s,n.firstChild)}));for(let t=0,o=k.length;t<o;t++){const o=k[t],s=d[o];if(T=h&&h[o],M=m&&m[o],x=p&&p[o],!v.has(o)&&!M)if(E=y.get($l(s)),O=E&&E.pop(),O){O.cgKey=o;const t=wo(o,i);let n;T?(O.cgAnimating=!0,O.classList.add("anim"),t[0]+=T[2],t[1]+=T[3],n=T[4],e.animation.current&&e.animation.current.plan.nextPlan&&e.animation.current.plan.nextPlan.anims[o]&&!$o(e.animation.current.plan.nextPlan.anims[o])&&(t[0]+=e.animation.current.plan.nextPlan.anims[o][2],t[1]+=e.animation.current.plan.nextPlan.anims[o][3])):n=0,P=r(t,a,n),jl(e,O,O.cgColor,P)}else{const t=document.createElement("piece"),l=$l(s),c=wo(o,i);let u;t.className=l,t.cgPiece=l,t.cgColor=s.color,t.cgKey=o,T?(t.cgAnimating=!0,c[0]+=T[2],c[1]+=T[3],u=T[4],x&&(t.className=t.className.replace(s.role,x),t.classList.add("temprole"))):u=0,P=r(c,a,u),jl(e,t,s.color,P),n.appendChild(t)}}for(const t in m){M=m[t];const o=t;if(M&&!v.has(o)){const t=document.createElement("piece"),s=$l(M)+" temporary",l=wo(o,i);t.className=s,t.cgPiece=s,t.cgKey=o,P=r(l,a,0),jl(e,t,M.color,P),n.appendChild(t)}}const j=e=>n.removeChild(e);y.forEach((e=>e.forEach(j))),w.forEach((e=>e.forEach(j)))}function Ol(e,t,n,a,i,r){const o=t[0]/2-.5;return 0!==r?[(n?r-.5+e[0]:o-(r-.5+e[0]))*a,(n?e[1]-1:t[1]-e[1])*i]:[(n?(e[1]%2!=0?-.5:-1)+e[0]:o-((e[1]%2!=0?-.5:-1)+e[0]))*a,(n?e[1]-1:t[1]-e[1])*i]}function Nl(e,t,n,a,i){return[(n?e[0]-1:t[0]-e[0])*a,(n?e[1]-1:t[1]-e[1])*i]}const _l=(e,t)=>{const n=e.width/(t[0]/2),a=e.height/t[1];return(e,i,r)=>Ol(e,t,i,n,a,r)},Ll=e=>(t,n,a)=>Ol(t,e,n,200/e[0],100/e[1],a),Il=(e,t)=>{const n=e.width/t[0],a=e.height/t[1];return(e,i)=>Nl(e,t,i,n,a)},Dl=e=>(t,n)=>Nl(t,e,n,100/e[0],100/e[1]);function jl(e,t,n,a){e.fixed?(t.style.left=a[0]+"%",t.style.top=a[1]+"%"):t.style.transform=_o(e,n,Lo(a))}function Al(e,t,n){e.fixed?(t.style.left=n[0]+"%",t.style.top=n[1]+"%"):t.style.transform=Lo(n)}function Bl(e){return"PIECE"===e.tagName}function Rl(e){return"SQUARE"===e.tagName}function $l(e){return"ghostman"===e.role?`${e.color} man ghost`:"ghostking"===e.role?e.kingMoves&&e.kingMoves>0?`${e.color} king ghost king${e.kingMoves}`:`${e.color} king ghost`:"king"===e.role&&e.kingMoves&&e.kingMoves>0?`${e.color} king king${e.kingMoves}`:`${e.color} ${e.role}`}function zl(e,t,n){e.set(t,(e.get(t)||"")+" "+n)}function Fl(e,t,n){e.set(t,(e.get(t)||"")+" "+n)}function Ul(e,t,n,a,i){let r,o;if(1===i)r=ql(xo,"ranks is64"+("black"===n?" black":""),(e=>e%2==1?"coord-odd":"coord-even")),o=ql(Po,"files is64"+("black"===n?" black":""),(e=>e%2==0?"coord-odd":"coord-even"));else if("black"===n){const e=[],n=[],a=t[0]/2,i=t[1]/2;for(let t=1;t<=a;t++)e.push(t);for(let e=0;e<i;e++)n.push(a+t[0]*e+1);r=ql(n,"ranks is100 black",(()=>"coord-odd")),o=ql(e,"files is100 black",(()=>"coord-even"))}else{const e=[],n=[],a=t[0]/2,i=t[0]*t[1]/2,s=t[1]/2;for(let t=i-a+1;t<=i;t++)e.push(t);for(let e=0;e<s;e++)n.push(a+t[0]*e);r=ql(n,"ranks is100",(()=>"coord-even")),o=ql(e,"files is100",(()=>"coord-odd"))}a&&(a.elements.coordRanks&&e.removeChild(a.elements.coordRanks),a.elements.coordFiles&&e.removeChild(a.elements.coordFiles),Gl(a),a.elements.coordRanks=r,a.elements.coordFiles=o),e.appendChild(r),e.appendChild(o)}function Wl(e,t){if(!t)return;Gl(t);const n="black"!==e.orientation,a=kl(e);for(let i=1;i<=a;i++){const a=document.createElement("fieldnumber"),r=i.toString();a.className="coord-odd",a.textContent=1===e.coordSystem?Mo[r]:r;const o=_l(t.bounds,e.boardSize)(wo(Co[i-1],e.boardSize),n,0);a.style.transform=Lo(o),t.board.appendChild(a)}}function Gl(e){e.elements.coordRanks&&delete e.elements.coordRanks,e.elements.coordFiles&&delete e.elements.coordFiles;const t=e.board.children;if(t&&t.length)for(let n=t.length-1;n>=0;n--){const a=t[n];"FIELDNUMBER"===a.tagName&&e.board.removeChild(a)}}function ql(e,t,n){const a=document.createElement("li-coords");return a.className=t,e.forEach(((e,t)=>{const i=document.createElement("li-coord");i.className=n(t),i.textContent=String(e),a.appendChild(i)})),a}function Vl(e,t,n=!1,a=!1){return t.state.animation.enabled?function(e,t,n=!1,a=!1){const i=t.state,r=Object.assign({},i.pieces),o=e(i),s=void 0!==t.dom?function(e,t,n=!1,a=!1){const i=[],r=[];let o=[],s=[];const l={},c={},u=t.boardSize;let d,h,m,p=0;for(m in e)l[m]=Kl(m,u,e[m]),"ghostman"!==e[m].role&&"ghostking"!==e[m].role||p++;for(const e of Co)d=t.pieces[e],h=l[e],d?h?Xl(d,h.piece)||("white"===h.piece.color?i.push(h):r.push(h),"white"===d.color?o.push(Kl(e,u,d)):s.push(Kl(e,u,d))):"white"===d.color?o.push(Kl(e,u,d)):s.push(Kl(e,u,d)):h&&("white"===h.piece.color?i.push(h):r.push(h));const f={anims:{},captures:{},tempRole:{}};let g={anims:{},captures:{},tempRole:{}};o.length>1&&i.length>0&&(o=o.sort(((e,t)=>No(i[0].pos,e.pos)-No(i[0].pos,t.pos))));s.length>1&&r.length>0&&(s=s.sort(((e,t)=>No(r[0].pos,e.pos)-No(r[0].pos,t.pos))));const v=!a&&(0===p||t.animateFrom)&&t.lastMove&&t.lastMove.length>2,b=t.animateFrom||0;if(!n&&v&&t.lastMove&&t.lastMove[b]===t.lastMove[t.lastMove.length-1]){const e=t.lastMove[b];d=t.pieces[e],h=l[e],"white"===d.color&&0!==r.length?(i.push(h),o.push(Kl(e,u,d))):"black"===d.color&&0!==i.length&&(r.push(h),s.push(Kl(e,u,d)))}const y=i.concat(r);return o.concat(s).forEach((a=>{var i,r;if(i=a,r=y.filter((e=>!c[e.key]&&a.piece.color===e.piece.color&&(a.piece.role===e.piece.role||"man"===e.piece.role&&"king"===a.piece.role&&Ql(a,u)||"king"===e.piece.role&&"man"===a.piece.role&&Ql(e,u)))),h=r.sort(((e,t)=>No(i.pos,e.pos)-No(i.pos,t.pos)))[0],h&&!n){c[h.key]=!0;const n="man"===h.piece.role&&"king"===a.piece.role&&Ql(a,u)?"man":void 0;if(v&&t.lastMove&&t.lastMove[b]===h.key&&t.lastMove[t.lastMove.length-1]===a.key){let i,r=wo(t.lastMove[b+1],u);f.anims[a.key]=Zl(h.pos,r),f.nextPlan=g,n&&(f.tempRole[a.key]=n);const o=new Array;let s=sl(e,u,h.pos[0],h.pos[1],r[0],r[1]);null!==s&&(o.push(s),e[s]=Jl(e[s])),f.captures={},y.forEach((e=>{e.piece.color!==a.piece.color&&(-1!==o.indexOf(e.key)?f.captures[e.key]=Jl(e.piece):f.captures[e.key]=e.piece)}));let l={anims:{},captures:{},tempRole:{}};for(m=b+2;m<t.lastMove.length;m++)i=wo(t.lastMove[m],u),g.anims[a.key]=Zl(r,i),g.anims[a.key][2]=r[0]-a.pos[0],g.anims[a.key][3]=r[1]-a.pos[1],g.nextPlan=l,n&&(g.tempRole[a.key]=n),s=sl(e,u,r[0],r[1],i[0],i[1]),null!==s&&(o.push(s),e[s]=Jl(e[s])),g.captures={},y.forEach((e=>{e.piece.color!==a.piece.color&&(-1!==o.indexOf(e.key)?g.captures[e.key]=Jl(e.piece):g.captures[e.key]=e.piece)})),r=i,g=l,l={anims:{},captures:{},tempRole:{}}}else f.anims[a.key]=Zl(h.pos,a.pos),n&&(f.tempRole[a.key]=n)}})),f}(r,i,n,a):void 0;if(void 0===s||$o(s.anims))null===i.animation.current||function(e,t){if(null===e&&null===t)return!0;if(null===e||null===t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(i.animation.current.lastMove,i.lastMove)||(i.animation.current=null),t.redraw();else{const e=i.animation.current&&null!==i.animation.current.start;i.animation.current={start:null,frequency:(s.nextPlan&&!$o(s.nextPlan.anims)?2.2:1)/i.animation.duration,plan:s,lastMove:i.lastMove},e||Ht(t.applyAnim)}return o}(e,t,n,a):Hl(e,t)}function Hl(e,t){const n=e(t.state);return t.redraw(),n}function Yl(e){const t=e.animation.current;if(!t)return 0;let n,a=t.plan;const i=a.nextPlan&&!$o(a.nextPlan.anims)?2.2:1,r=e.animation.duration/i;for(n=r;a.nextPlan&&!$o(a.nextPlan.anims);)a=a.nextPlan,n+=r;return n}function Kl(e,t,n){return{key:e,pos:wo(e,t),piece:n}}function Xl(e,t){return e.role===t.role&&e.color===t.color}function Jl(e){return"man"===e.role?{role:"ghostman",color:e.color,promoted:e.promoted,kingMoves:e.kingMoves}:"king"===e.role?{role:"ghostking",color:e.color,promoted:e.promoted,kingMoves:e.kingMoves}:{role:e.role,color:e.color,promoted:e.promoted,kingMoves:e.kingMoves}}function Ql(e,t){return"white"===e.piece.color&&1===e.pos[1]||"black"===e.piece.color&&e.pos[1]===t[1]}function Zl(e,t){return e[1]%2==0&&t[1]%2==0?[e[0]-t[0],e[1]-t[1],0,0,-.5]:e[1]%2!=0&&t[1]%2==0?[e[0]-t[0]+.5,e[1]-t[1],0,0,-.5]:e[1]%2==0&&t[1]%2!=0?[e[0]-t[0]-.5,e[1]-t[1],0,0,0]:[e[0]-t[0],e[1]-t[1],0,0,0]}function ec(e,t){if(t.touches&&t.touches.length>1)return;const n=e.state;n.draggable.preventDefault&&t.preventDefault();const a=n.draggable.current;a&&a.orig&&(a.epos=Ao(t),!a.started&&No(a.epos,a.rel)>=n.draggable.distance&&(a.started=!0,ic(e)))}function tc(e,t){const n=e.state,a=n.draggable,i=a.current;if(!i)return;if(i.originTarget!==t.target&&!i.newPiece)return;n.draggable.preventDefault&&t.preventDefault();const r=i.over;if(rl(n),ol(n),i.started&&r)if(i.newPiece)cl(n,i.orig,r,i.force);else{ll(n,i.orig,r);const e=n.animateFrom?n.animateFrom+1:1;n.movable.captLen&&n.movable.captLen>(n.lastMove?n.lastMove.length-e:1)&&dl(n,r)}else i.started&&a.deleteOnDropOff?(delete n.pieces[i.orig],setTimeout(n.events.change||go,0)):i.newPiece&&delete n.pieces[i.orig];(!i||i.orig!==i.previouslySelected||i.orig!==r&&r)&&n.selectable.enabled||hl(n),n.draggable.current=null,Ht((()=>rc(e.dom))),e.redraw()}function nc(e){const t=e.state;e.dom&&rc(e.dom),t.draggable.current&&(t.draggable.current=null,hl(t))}function ac(e,t,n){if("object"!=typeof n)throw new Error("function getKeyAtDomPos require bounds object arg");const a="white"===e.orientation,i=e.boardSize;let r=Math.ceil(i[1]*((t[1]-n.top)/n.height));a||(r=i[1]+1-r);let o=Math.ceil(i[0]*((t[0]-n.left)/n.width));if(a||(o=i[0]+1-o),r%2!=0){if(o%2!=0)return null;o/=2}else{if(o%2==0)return null;o=(o+1)/2}return o>0&&o<=i[0]/2&&r>0&&r<=i[1]?bo([o,r],i):null}function ic(e){const t=e.state,n=t.boardSize,a=e.dom,i=t.draggable.current;i&&a&&(i.scheduledAnimationFrame||(i.scheduledAnimationFrame=!0,requestAnimationFrame((()=>{const r=a.bounds,o="white"===t.orientation;if(i.scheduledAnimationFrame=!1,i.orig){if(t.pieces[i.orig]!==i.piece)return void nc(e);t.animation.current&&t.animation.current.plan.anims[i.orig]&&(t.animation.current=null);const s=i.element;if(i.started&&s){if(!s.cgDragging){s.cgDragging=!0,s.classList.add("dragging"),t.draggable.magnified&&s.classList.add("magnified");const e=a.elements.ghost;if(e&&i.showGhost){e.className=`ghost ${i.piece.color} ${i.piece.role}`;const a=So(wo(i.orig,n),n,"white"===t.orientation,r);e.style.transform=_o(t,i.piece.color,Lo(a))}}i.pos=[i.epos[0]-i.rel[0],i.epos[1]-i.rel[1]],i.over=ac(t,i.epos,r);const e=So(i.origPos,n,o,r);e[0]+=i.pos[0]+i.dec[0],e[1]+=i.pos[1]+i.dec[1],s.style.transform=_o(t,i.piece.color,Io(e));const l=a.elements.shadow;if(l){if(i.over&&i.over!==i.prevOver){const e=r.width/8,t=So(wo(i.over,n),n,o,r);l.style.transform=Io([t[0]-e/2,t[1]-e/2])}else i.over||(l.style.transform=jo);i.prevOver=i.over}}ic(e)}}))))}function rc(e){e&&(e.elements.shadow&&(e.elements.shadow.style.transform=jo),e.elements.ghost&&(e.elements.ghost.style.transform=Do))}var oc,sc;function lc(e){return new DataView(Uint8Array.from(e).buffer)}function cc(e){return Array.from(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function uc(e){const t=[];let n,a,i=1,r=0;for(n=0;n<e.length;n++)a=e.charCodeAt(n),(a>47&&a<58||a>64&&a<71||a>96&&a<103)&&(r=r<<4^15&(a>64?a+9:a),(i^=1)&&t.push(255&r));return lc(t)}function dc(e){return cc(e).map((e=>{let t=e.toString(16);return 1==t.length&&(t="0"+t),t})).join("")}function hc(e){if("string"==typeof e)return e;if("number"==typeof e)return`0000${e.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`;throw new Error("Invalid UUID")}function mc(e){const t={};if(e)return e.forEach(((e,n)=>{t[n.toString()]=e})),t}!function(e){e[e.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",e[e.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",e[e.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"}(oc||(oc={})),function(e){e[e.CONNECTION_PRIORITY_BALANCED=0]="CONNECTION_PRIORITY_BALANCED",e[e.CONNECTION_PRIORITY_HIGH=1]="CONNECTION_PRIORITY_HIGH",e[e.CONNECTION_PRIORITY_LOW_POWER=2]="CONNECTION_PRIORITY_LOW_POWER"}(sc||(sc={}));const pc=a("BluetoothLe",{web:()=>import("./web-987cd505.js").then((e=>new e.BluetoothLeWeb))});function fc(e){return e?(()=>{let e=Promise.resolve();return t=>new Promise(((n,a)=>{e=e.then((()=>t())).then(n).catch(a)}))})():e=>e()}function gc(e){if("string"!=typeof e)throw new Error(`Invalid UUID type ${typeof e}. Expected string.`);if(!((e=e.toLowerCase()).search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${e}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return e}const vc=new class BleClientClass{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=fc(!0)}enableQueue(){this.queue=fc(!0)}disableQueue(){this.queue=fc(!1)}async initialize(e){await this.queue((async()=>{await pc.initialize(e)}))}async isEnabled(){return await this.queue((async()=>(await pc.isEnabled()).value))}async requestEnable(){await this.queue((async()=>{await pc.requestEnable()}))}async enable(){await this.queue((async()=>{await pc.enable()}))}async disable(){await this.queue((async()=>{await pc.disable()}))}async startEnabledNotifications(e){await this.queue((async()=>{var t;const n="onEnabledChanged";await(null===(t=this.eventListeners.get(n))||void 0===t?void 0:t.remove());const a=await pc.addListener(n,(t=>{e(t.value)}));this.eventListeners.set(n,a),await pc.startEnabledNotifications()}))}async stopEnabledNotifications(){await this.queue((async()=>{var e;const t="onEnabledChanged";await(null===(e=this.eventListeners.get(t))||void 0===e?void 0:e.remove()),this.eventListeners.delete(t),await pc.stopEnabledNotifications()}))}async isLocationEnabled(){return await this.queue((async()=>(await pc.isLocationEnabled()).value))}async openLocationSettings(){await this.queue((async()=>{await pc.openLocationSettings()}))}async openBluetoothSettings(){await this.queue((async()=>{await pc.openBluetoothSettings()}))}async openAppSettings(){await this.queue((async()=>{await pc.openAppSettings()}))}async setDisplayStrings(e){await this.queue((async()=>{await pc.setDisplayStrings(e)}))}async requestDevice(e){e=e?this.validateRequestBleDeviceOptions(e):void 0;return await this.queue((async()=>await pc.requestDevice(e)))}async requestLEScan(e,t){e=this.validateRequestBleDeviceOptions(e),await this.queue((async()=>{var n;await(null===(n=this.scanListener)||void 0===n?void 0:n.remove()),this.scanListener=await pc.addListener("onScanResult",(e=>{const n=Object.assign(Object.assign({},e),{manufacturerData:this.convertObject(e.manufacturerData),serviceData:this.convertObject(e.serviceData),rawAdvertisement:e.rawAdvertisement?this.convertValue(e.rawAdvertisement):void 0});t(n)})),await pc.requestLEScan(e)}))}async stopLEScan(){await this.queue((async()=>{var e;await(null===(e=this.scanListener)||void 0===e?void 0:e.remove()),this.scanListener=null,await pc.stopLEScan()}))}async getDevices(e){if(!Array.isArray(e))throw new Error("deviceIds must be an array");return this.queue((async()=>(await pc.getDevices({deviceIds:e})).devices))}async getConnectedDevices(e){if(!Array.isArray(e))throw new Error("services must be an array");return e=e.map(gc),this.queue((async()=>(await pc.getConnectedDevices({services:e})).devices))}async getBondedDevices(){return this.queue((async()=>(await pc.getBondedDevices()).devices))}async connect(e,t,n){await this.queue((async()=>{var a;if(t){const n=`disconnected|${e}`;await(null===(a=this.eventListeners.get(n))||void 0===a?void 0:a.remove());const i=await pc.addListener(n,(()=>{t(e)}));this.eventListeners.set(n,i)}await pc.connect(Object.assign({deviceId:e},n))}))}async createBond(e,t){await this.queue((async()=>{await pc.createBond(Object.assign({deviceId:e},t))}))}async isBonded(e){return await this.queue((async()=>(await pc.isBonded({deviceId:e})).value))}async disconnect(e){await this.queue((async()=>{await pc.disconnect({deviceId:e})}))}async getServices(e){return await this.queue((async()=>(await pc.getServices({deviceId:e})).services))}async discoverServices(e){await this.queue((async()=>{await pc.discoverServices({deviceId:e})}))}async getMtu(e){return await this.queue((async()=>(await pc.getMtu({deviceId:e})).value))}async requestConnectionPriority(e,t){await this.queue((async()=>{await pc.requestConnectionPriority({deviceId:e,connectionPriority:t})}))}async readRssi(e){return await this.queue((async()=>{const t=await pc.readRssi({deviceId:e});return parseFloat(t.value)}))}async read(e,t,n,a){t=gc(t),n=gc(n);return await this.queue((async()=>{const i=await pc.read(Object.assign({deviceId:e,service:t,characteristic:n},a));return this.convertValue(i.value)}))}async write(e,t,a,i,r){return t=gc(t),a=gc(a),this.queue((async()=>{if(!(null==i?void 0:i.buffer))throw new Error("Invalid data.");let o=i;"web"!==n.getPlatform()&&(o=dc(i)),await pc.write(Object.assign({deviceId:e,service:t,characteristic:a,value:o},r))}))}async writeWithoutResponse(e,t,a,i,r){t=gc(t),a=gc(a),await this.queue((async()=>{if(!(null==i?void 0:i.buffer))throw new Error("Invalid data.");let o=i;"web"!==n.getPlatform()&&(o=dc(i)),await pc.writeWithoutResponse(Object.assign({deviceId:e,service:t,characteristic:a,value:o},r))}))}async readDescriptor(e,t,n,a,i){t=gc(t),n=gc(n),a=gc(a);return await this.queue((async()=>{const r=await pc.readDescriptor(Object.assign({deviceId:e,service:t,characteristic:n,descriptor:a},i));return this.convertValue(r.value)}))}async writeDescriptor(e,t,a,i,r,o){return t=gc(t),a=gc(a),i=gc(i),this.queue((async()=>{if(!(null==r?void 0:r.buffer))throw new Error("Invalid data.");let s=r;"web"!==n.getPlatform()&&(s=dc(r)),await pc.writeDescriptor(Object.assign({deviceId:e,service:t,characteristic:a,descriptor:i,value:s},o))}))}async startNotifications(e,t,n,a,i){t=gc(t),n=gc(n),await this.queue((async()=>{var r;const o=`notification|${e}|${t}|${n}`;await(null===(r=this.eventListeners.get(o))||void 0===r?void 0:r.remove());const s=await pc.addListener(o,(e=>{a(this.convertValue(null==e?void 0:e.value))}));this.eventListeners.set(o,s),await pc.startNotifications(Object.assign({deviceId:e,service:t,characteristic:n},i))}))}async stopNotifications(e,t,n){t=gc(t),n=gc(n),await this.queue((async()=>{var a;const i=`notification|${e}|${t}|${n}`;await(null===(a=this.eventListeners.get(i))||void 0===a?void 0:a.remove()),this.eventListeners.delete(i),await pc.stopNotifications({deviceId:e,service:t,characteristic:n})}))}validateRequestBleDeviceOptions(e){return e.services&&(e.services=e.services.map(gc)),e.optionalServices&&(e.optionalServices=e.optionalServices.map(gc)),e}convertValue(e){return"string"==typeof e?uc(e):void 0===e?new DataView(new ArrayBuffer(0)):e}convertObject(e){if(void 0===e)return;const t={};for(const n of Object.keys(e))t[n]=this.convertValue(e[n]);return t}};class DummyFeatures{get getState(){return!1}get setState(){return!1}get option(){return!1}}class DummyVariants{get standard(){return!1}get antidraughts(){return!1}get breakthrough(){return!1}get frisian(){return!1}get frysk(){return!1}get russian(){return!1}get brazilian(){return!1}get english(){return!1}}const bc=[][Symbol.iterator]();const yc=new class DummyProtocol{constructor(){this._features=new DummyFeatures,this._variants=new DummyVariants}init(){}features(){return this._features}variants(){return this._variants}options(){return bc}onPeripheralCommand(){}onCentralStateCreated(){}onCentralStateChanged(){}onCentralStateShifted(){}onCentralStateEnded(){}onMoveRejectedByCentral(){}onCentralGetState(){}onCentralSetState(){}onCentralOptionsReset(){}};class BaseProtocol{transitionTo(e){this.state=e,this.state.setContext(this),this.state.onEnter()}init(e){}features(){return yc.features()}variants(){return yc.variants()}options(){return yc.options()}onPeripheralCommand(e){var t;null===(t=this.state)||void 0===t||t.onPeripheralCommand(e)}onCentralStateCreated(e){var t;null===(t=this.state)||void 0===t||t.onCentralStateCreated(e)}onCentralStateChanged(){var e;null===(e=this.state)||void 0===e||e.onCentralStateChanged()}onCentralStateShifted(e){var t;null===(t=this.state)||void 0===t||t.onCentralStateShifted(e)}onCentralStateEnded(e){var t;null===(t=this.state)||void 0===t||t.onCentralStateEnded(e)}onMoveRejectedByCentral(){var e;null===(e=this.state)||void 0===e||e.onMoveRejectedByCentral()}onCentralGetState(){var e;null===(e=this.state)||void 0===e||e.onCentralGetState()}onCentralSetState(){var e;null===(e=this.state)||void 0===e||e.onCentralSetState()}onCentralOptionsReset(){var e;null===(e=this.state)||void 0===e||e.onCentralOptionsReset()}}const wc=new BaseProtocol;class BaseState{constructor(){this.context=wc}setContext(e){this.context=e}transitionTo(e){this.context.transitionTo(e)}onEnter(){}onPeripheralCommand(e){}onCentralStateCreated(e){}onCentralStateChanged(){}onCentralStateShifted(e){}onCentralStateEnded(e){}onMoveRejectedByCentral(){}onCentralGetState(){}onCentralSetState(){}onCentralOptionsReset(){}}function kc(e){return"white"===e.turnColor?"w":"b"}function Sc(e){return[ws.convertPiecesToChessFen(e.pieces,e.boardSize[0]),kc(e)].join(" ")}function Cc(e,t){e.peripheral.isMoveRejected=t}function Tc(e,t){const n=Jo(t),a=function(e){const t=e.substr(4,1);return Ho[t]}(t);e.peripheral.lastMove=n,e.peripheral.lastPromotion=a||null}function Mc(e,t){e.peripheral.isSynchronized=t}function xc(e,t){e.peripheral.isGettable=t}function Pc(e,t){e.peripheral.isSettable=t}function Ec(e,t){e.peripheral.pieces=ws.convertChessFenToPeripheralPieces(t)}function Oc(e){return function(e,t,n){const a=Ko(e[e.length-2],t),i=Ko(e[e.length-1],t);return n?a+i+Vo[n]:a+i}(e.lastMove,e.boardSize[0],e.lastPromotion?e.lastPromotion:void 0)}function Nc(e){Hc.sendCommandToPeripheral(e)}function _c(e,t){const n=function(e,t){const n=Jo(e),a=Xo(n[0],t),i=Xo(n[1],t);return null!==a&&null!==i?[a,i]:null!==a?[a]:null!==i?[i]:[]}(t,e.boardSize[0]);return 2===n.length&&(Xc.sendMoveToCentral(n[0],n[1]),!0)}function Lc(){Xc.sendStateChangeToCentral()}function Ic(){Xc.sendOptionsUpdateToCentral()}function Dc(e){return e.substring(e.indexOf(" ")+1)}function*jc(e){for(const t of Object.keys(e))yield e[t]}var Ac,Bc,Rc,$c,zc,Fc,Uc,Wc;!function(e){e.LastMove="last_move",e.Msg="msg",e.UndoRedo="undo_redo",e.Side="side",e.GetState="get_state",e.SetState="set_state",e.Option="option"}(Ac||(Ac={})),function(e){e.DraughtsStandard="draughts_standard",e.AntiDraughts="anti_draughts",e.DraughtsBreakthrough="draughts_breakthrough",e.DraughtsFrisian="draughts_frisian",e.DraughtsFrysk="draughts_frysk",e.DraughtsRussian="draughts_russian",e.DraughtsBrazilian="draughts_brazilian",e.DraughtsEnglish="draughts_english"}(Bc||(Bc={})),function(e){e.Ok="ok",e.Nok="nok",e.Feature="feature",e.Variant="variant",e.SetVariant="set_variant",e.Begin="begin",e.State="state",e.Sync="sync",e.Unsync="unsync",e.UnsyncSettable="unsync_settable",e.End="end",e.Move="move",e.Promote="promote",e.Err="err",e.LastMove="last_move",e.Check="check",e.Msg="msg",e.Undo="undo",e.Redo="redo",e.Side="side",e.GetState="get_state",e.SetState="set_state",e.OptionsBegin="options_begin",e.OptionsEnd="options_end",e.OptionsReset="options_reset",e.Option="option",e.SetOption="set_option"}(Rc||(Rc={})),function(e){e.Undefined="undefined",e.Checkmate="checkmate",e.Draw="draw",e.Timeout="timeout",e.Resign="resign",e.Abort="abort"}($c||($c={})),function(e){e.White="w",e.Black="b",e.Both="?"}(zc||(zc={})),function(e){e.Bool="bool",e.Enum="enum",e.Str="str",e.Int="int",e.Float="float"}(Fc||(Fc={})),function(e){e.True="true",e.False="false"}(Uc||(Uc={}));class Support{constructor(e){this.name=e,this.isSupported=!1}}class CppFeatures{constructor(){this.lastMove=new Support(Ac.LastMove),this.msg=new Support(Ac.Msg),this.undoRedo=new Support(Ac.UndoRedo),this.side=new Support(Ac.Side),this.getState=new Support(Ac.GetState),this.setState=new Support(Ac.SetState),this.option=new Support(Ac.Option)}}class CppWrappedFeatures{constructor(e){this._features=e}get getState(){return this._features.getState.isSupported}get setState(){return this._features.setState.isSupported}get option(){return this._features.option.isSupported}}class CppVariants{constructor(){this.standard=new Support(Bc.DraughtsStandard),this.antidraughts=new Support(Bc.AntiDraughts),this.breakthrough=new Support(Bc.DraughtsBreakthrough),this.frisian=new Support(Bc.DraughtsFrisian),this.frysk=new Support(Bc.DraughtsFrysk),this.russian=new Support(Bc.DraughtsRussian),this.brazilian=new Support(Bc.DraughtsBrazilian),this.english=new Support(Bc.DraughtsEnglish)}}class CppWrappedVariants{constructor(e){this._variants=e}get standard(){return this._variants.standard.isSupported}get antidraughts(){return this._variants.antidraughts.isSupported}get breakthrough(){return this._variants.breakthrough.isSupported}get frisian(){return this._variants.frisian.isSupported}get frysk(){return this._variants.frysk.isSupported}get russian(){return this._variants.russian.isSupported}get brazilian(){return this._variants.brazilian.isSupported}get english(){return this._variants.english.isSupported}}!function(e){e[e.Bool=0]="Bool",e[e.Enum=1]="Enum",e[e.Str=2]="Str",e[e.Int=3]="Int",e[e.Float=4]="Float"}(Wc||(Wc={}));class TimerWrapper{start(e,t){this.stop(),this._handle=setTimeout((()=>{this._handle=void 0,e()}),t)}stop(){void 0!==this._handle&&(clearTimeout(this._handle),this._handle=void 0)}isActive(){return void 0!==this._handle}}class CppTypedOption{constructor(e,t){this._name=e,this._value=t,this._defaultValue=t,this._timer=new TimerWrapper,this._isHandled=!1}get name(){return this._name}get value(){return this._value}set value(e){this._value=e,this._timer.isActive()?this._isHandled=!1:this._handleValue()}set peripheralValue(e){this._value=e,this._timer.stop()}reset(){this._value=this._defaultValue,this._timer.stop()}_handleValue(){this._isHandled=!0,this._timer.start((()=>this._handleTimeout()),100),Nc(`${Rc.SetOption} ${this._name} ${this.valueString}`)}_handleTimeout(){this._isHandled||this._handleValue()}}class CppBoolOption extends CppTypedOption{constructor(e,t){super(e,t)}get valueString(){return this._value?Uc.True:Uc.False}get type(){return Wc.Bool}}class CppEnumOption extends CppTypedOption{constructor(e,t,n){super(e,t),this._values=n}get valueString(){return this._value}get type(){return Wc.Enum}get values(){return this._values}}class CppStrOption extends CppTypedOption{constructor(e,t){super(e,t)}get valueString(){return this._value}get type(){return Wc.Str}}class CppNumOption extends CppTypedOption{constructor(e,t,n,a,i){super(e,t),this._min=n,this._max=a,this._step=i}get min(){return this._min}get max(){return this._max}get step(){return this._step}}class CppIntOption extends CppNumOption{constructor(e,t,n,a,i){super(e,t,n,a,i)}get valueString(){return this._value.toString()}get type(){return Wc.Int}}class CppFloatOption extends CppNumOption{constructor(e,t,n,a,i){super(e,t,n,a,i)}get valueString(){return this._value.toFixed(2)}get type(){return Wc.Float}}class CppOptions{constructor(){this._map=new Map}get iterator(){return this._map.values()}add(e){try{const t=e.split(" "),n=t[0],a=t[1];return a===Fc.Bool?this._add(new CppBoolOption(n,t[2]===Uc.True)):a===Fc.Enum?this._add(new CppEnumOption(n,t[2],t.slice(3))):a===Fc.Str?this._add(new CppStrOption(n,t.slice(2).join(" "))):a===Fc.Int?this._add(new CppIntOption(n,parseInt(t[2],10),parseInt(t[3],10),parseInt(t[4],10),t.length>5?parseInt(t[5],10):void 0)):a===Fc.Float&&this._add(new CppFloatOption(n,parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]),t.length>5?parseFloat(t[5]):void 0)),!0}catch(e){return!1}}set(e){try{const t=e.split(" "),n=t[0],a=t[1],i=this._map.get(n);return i instanceof CppBoolOption?i.peripheralValue=a===Uc.True:i instanceof CppEnumOption?i.peripheralValue=a:i instanceof CppStrOption?i.peripheralValue=t.slice(1).join(" "):i instanceof CppIntOption?i.peripheralValue=parseInt(a,10):i instanceof CppFloatOption&&(i.peripheralValue=parseFloat(a)),!0}catch(e){return!1}}reset(){this._map.forEach((e=>{e.reset()}))}_add(e){this._map.set(e.name,e)}}class BleChessState extends BaseState{setState(e){this.context._roundState=e}getState(){return this.context._roundState}getFeatures(){return this.context._features}getVariants(){return this.context._variants}getOptions(){return this.context._options}getVariant(e){return this.context._variantsMap[e]||this.context._variants.standard}getEndReason(e){return(null==e?void 0:e.name)&&this.context._endReasonsMap[e.name]}onPeripheralCommand(e){e.startsWith(Rc.Msg)||e.startsWith(Rc.Err)?W.show({text:Dc(e)}):e.startsWith(Rc.SetOption)?(this.getOptions().set(Dc(e))||W.show({text:`${kt("unexpected")}: ${e}`}),Ic()):e.startsWith(Rc.OptionsReset)?(this.getOptions().reset(),Ic()):W.show({text:`${kt("unexpected")}: ${this.constructor.name}: ${e}`})}onCentralStateCreated(e){this.setState(e)}onCentralOptionsReset(){this.getOptions().reset(),Nc(Rc.OptionsReset)}}class Init extends BleChessState{onEnter(){const e=new CheckSupportsIteration(jc(this.getVariants()),Rc.Variant,new CheckOptions),t=new CheckSupportsIteration(jc(this.getFeatures()),Rc.Feature,e);this.transitionTo(t)}}class CheckSupportsIteration extends BleChessState{constructor(e,t,n){super(),this.iterator=e,this.current=e.next(),this.command=t,this.nextState=n}onEnter(){this.handleCurrent()}onPeripheralCommand(e){e===Rc.Ok?(this.current.value.isSupported=!0,this.current=this.iterator.next(),this.handleCurrent()):e===Rc.Nok?(this.current.value.isSupported=!1,this.current=this.iterator.next(),this.handleCurrent()):super.onPeripheralCommand(e)}handleCurrent(){this.current.done?this.transitionTo(this.nextState):Nc(`${this.command} ${this.current.value.name}`)}}class CheckOptions extends BleChessState{onEnter(){this.getFeatures().option.isSupported?Nc(Rc.OptionsBegin):this.transitionTo(new Initialized)}onPeripheralCommand(e){e.startsWith(Rc.OptionsEnd)?(this.transitionTo(new Initialized),Ic()):e.startsWith(Rc.Option)?this.getOptions().add(Dc(e))||W.show({text:`${kt("unexpected")}: ${e}`}):e.startsWith(Rc.SetOption)?this.getOptions().set(Dc(e))||W.show({text:`${kt("unexpected")}: ${e}`}):super.onPeripheralCommand(e)}}class Initialized extends BleChessState{onEnter(){const e=(t=this.getState(),0!==Object.keys(t.pieces).length);var t;this.transitionTo(e?new RoundBegin:new Idle)}}class Idle extends BleChessState{onCentralStateCreated(e){this.setState(e),this.transitionTo(new RoundBegin)}onCentralGetState(){this.transitionTo(new GetState)}}class GetState extends Idle{onEnter(){Nc(`${Rc.GetState}`),xc(this.getState(),!1),Lc()}onPeripheralCommand(e){if(e.startsWith(Rc.State)){const t=this.getState();Ec(t,Dc(e)),xc(t,function(e){const t=e.peripheral.pieces;for(const e of t.values())if(void 0===e.role||void 0===e.color)return!1;return!0}(t)),Lc()}else super.onPeripheralCommand(e)}}class Round extends Idle{onCentralStateShifted(e){const t=this.getState();if(Cc(t,!1),!this.getFeatures().undoRedo.isSupported)return this.transitionTo(new Idle),Nc(`${Rc.End} ${$c.Abort}`),void W.show({text:kt("shiftUnsupported")});Nc(`${"undo"==e?Rc.Undo:Rc.Redo} ${Sc(t)}`),this.getFeatures().lastMove.isSupported&&t.lastMove&&Nc(`${Rc.LastMove} ${Oc(t)}`)}onCentralStateEnded(e){const t=this.getEndReason(e);t&&(this.transitionTo(new Idle),Nc(`${Rc.End} ${t}`))}onCentralSetState(){Nc(`${Rc.SetState}`),Pc(this.getState(),!1),Lc()}onPeripheralCommand(e){if(e.startsWith(Rc.State)){const t=this.getState();Ec(t,Dc(e)),Cc(t,!1),Lc()}else if(e.startsWith(Rc.Sync)){const t=this.getState();Ec(t,Dc(e)),Mc(t,!0),Pc(t,!1),Cc(t,!1),Lc(),W.show({text:kt("synchronized")})}else if(e.startsWith(Rc.UnsyncSettable)){const t=this.getState(),n=t.peripheral.isSynchronized;Ec(t,Dc(e)),Mc(t,!1),Pc(t,!0),Cc(t,!1),Lc(),n&&W.show({text:kt("unsynchronized")})}else if(e.startsWith(Rc.Unsync)){const t=this.getState(),n=t.peripheral.isSynchronized;Ec(t,Dc(e)),Mc(t,!1),Pc(t,!1),Cc(t,!1),Lc(),n&&W.show({text:kt("unsynchronized")})}else super.onPeripheralCommand(e)}}class RoundBegin extends Round{onEnter(){const e=this.getState(),t=this.getVariant(e.variant);var n,a;if(Nc(`${Rc.SetVariant} ${t.name}`),n=e,a=t.isSupported,n.peripheral.isVariantSupported=a,!t.isSupported)return this.transitionTo(new Idle),void W.show({text:kt("variantUnsupported")});if(this.transitionTo(new RoundOngoing),this.getFeatures().side.isSupported){const t=e.otb?zc.Both:"white"===e.orientation?zc.White:zc.Black;Nc(`${Rc.Side} ${t}`)}Nc(`${Rc.Begin} ${Sc(e)}`),this.getFeatures().lastMove.isSupported&&e.lastMove&&Nc(`${Rc.LastMove} ${Oc(e)}`)}}class RoundOngoing extends Round{onCentralStateChanged(){const e=this.getState();Nc(`${Rc.Move} ${Oc(e)}`),Cc(e,!1),Lc()}onPeripheralCommand(e){if(e.startsWith(Rc.Move)){const t=this.getState(),n=Dc(e);Cc(t,!1),Tc(t,n),this.transitionTo(new CheckPeripheralMove),_c(t,n)||this.context.onMoveRejectedByCentral()}else super.onPeripheralCommand(e)}}class CheckPeripheralMove extends Round{onCentralStateChanged(){const e=this.getState();this.transitionTo(new RoundOngoing),e.lastPromotion&&!e.peripheral.lastPromotion?Nc(`${Rc.Promote} ${Oc(e)}`):Nc(Rc.Ok)}onMoveRejectedByCentral(){const e=this.getState();this.transitionTo(new RoundOngoing),Nc(Rc.Nok),Cc(e,!0),Lc(),W.show({text:kt("rejected")})}}const Gc=[{uuids:{srv:"f5351050-b2c9-11ec-a0c0-b3bc53b08d33",txCh:"f53513ca-b2c9-11ec-a0c1-639b8957db99",rxCh:"f535147e-b2c9-11ec-a0c2-8bbd706ec4e6"},protocol:class CppProtocol extends BaseProtocol{constructor(){super(...arguments),this._roundState=Sl(),this._features=new CppFeatures,this._wrappedFeatures=new CppWrappedFeatures(this._features),this._variants=new CppVariants,this._wrappedVariants=new CppWrappedVariants(this._variants),this._variantsMap={standard:this._variants.standard,antidraughts:this._variants.antidraughts,breakthrough:this._variants.breakthrough,frisian:this._variants.frisian,frysk:this._variants.frysk,russian:this._variants.russian,brazilian:this._variants.brazilian,english:this._variants.english},this._endReasonsMap={mate:$c.Checkmate,stalemate:$c.Draw,draw:$c.Draw,timeout:$c.Timeout,outoftime:$c.Timeout,resign:$c.Resign,aborted:$c.Abort,noStart:$c.Undefined,unknownFinish:$c.Undefined,cheat:$c.Undefined,variantEnd:$c.Undefined},this._options=new CppOptions}init(e){this._roundState=e,this.transitionTo(new Init)}features(){return this._wrappedFeatures}variants(){return this._wrappedVariants}options(){return this._options.iterator}}}],qc={uuids:{srv:"0000180f-0000-1000-8000-00805f9b34fb",levelCh:"00002a19-0000-1000-8000-00805f9b34fb"},level:void 0};const Vc=new class BluetoothConnection{constructor(){this.isConnected=!1,this.protocol=yc,this.centralState=Sl(),this.lastMove=null,this.batteryService=qc}getDeviceId(){return ct.general.bluetooth.deviceId()}async onDisconnect(e){this.isConnected&&(this.isConnected=!1,this.protocol=yc,this.batteryService.level=void 0,Xt(),W.show({text:kt("disconnectedFromBluetoothDevice")}),ct.general.bluetooth.useDevice()&&this.connect())}async requestDevice(){return await vc.requestDevice({services:Gc.map((e=>e.uuids.srv))})}async setupChessService(){const e=await vc.getServices(this.getDeviceId());for(const t of Gc)if(e.some((e=>t.uuids.srv===e.uuid)))return this.uuids=t.uuids,void(this.protocol=new t.protocol)}async setupBatteryService(){if((await vc.getServices(this.getDeviceId())).some((e=>this.batteryService.uuids.srv===e.uuid))){const e=await vc.read(this.getDeviceId(),this.batteryService.uuids.srv,this.batteryService.uuids.levelCh);this.batteryService.level=e.getUint8(0),await this.registerBatteryCallback()}}async connect(){await vc.connect(this.getDeviceId(),(e=>this.onDisconnect(e))),await this.setupChessService(),await this.registerChessCallback(),await this.setupBatteryService(),this.protocol.init(this.centralState),this.isConnected=!0,Xt(),W.show({text:kt("connectedToBluetoothDevice")})}async disconnect(){this.isConnected&&(await this.unregisterChessCallback(),await this.unregisterBatteryCallback(),await vc.disconnect(this.getDeviceId()))}async sendCommandToPeripheral(e){var t;await vc.write(this.getDeviceId(),this.uuids.srv,this.uuids.txCh,(t=e,lc(t.split("").map((e=>e.charCodeAt(0))))))}async reciveData(e){var t;this.protocol.onPeripheralCommand((t=e,String.fromCharCode(...cc(t))))}async registerChessCallback(){await vc.startNotifications(this.getDeviceId(),this.uuids.srv,this.uuids.rxCh,(e=>this.reciveData(e)))}async unregisterChessCallback(){await vc.stopNotifications(this.getDeviceId(),this.uuids.srv,this.uuids.rxCh)}async registerBatteryCallback(){await vc.startNotifications(this.getDeviceId(),this.batteryService.uuids.srv,this.batteryService.uuids.levelCh,(e=>{this.batteryService.level=e.getUint8(0),Xt()}))}async unregisterBatteryCallback(){void 0!==this.batteryService.level&&await vc.stopNotifications(this.getDeviceId(),this.batteryService.uuids.srv,this.batteryService.uuids.levelCh)}};var Hc={protocol:()=>Vc.protocol,saveCentralState(e){Vc.centralState=e,this.saveLastMove()},saveLastMove(){Vc.lastMove=Vc.centralState.lastMove},isRepeatedLastMove:()=>Vc.lastMove===Vc.centralState.lastMove,sendCommandToPeripheral(e){Vc.sendCommandToPeripheral(e)},state:()=>Vc.centralState,features:()=>Vc.protocol.features(),variants:()=>Vc.protocol.variants(),options:()=>Vc.protocol.options(),isConnected:()=>Vc.isConnected,batteryLevel:()=>Vc.batteryService.level,init(){ct.general.bluetooth.useDevice()&&(vc.initialize({androidNeverForLocation:!0}),Vc.connect())},onSettingChange(e){e?(vc.initialize({androidNeverForLocation:!0}),Vc.requestDevice().then((e=>{ct.general.bluetooth.deviceId(e.deviceId),Vc.connect()})).catch((()=>{ct.general.bluetooth.useDevice(!1),Xt()}))):Vc.disconnect()},updateSettings(){Xt()}};let Yc,Kc;var Xc={onCentralStateCreated(e){Hc.protocol().onCentralStateCreated(e),Hc.saveCentralState(e)},onCentralStateChanged(){Hc.isRepeatedLastMove()||(Hc.state().shiftView?Hc.state().shiftView=null:(Hc.state().shift?(Hc.protocol().onCentralStateShifted(Hc.state().shift),Hc.state().shift=null):Hc.protocol().onCentralStateChanged(),Hc.saveLastMove()))},onCentralStateEnded(e){Hc.protocol().onCentralStateEnded(e)},onMoveRejectedByCentral(){Hc.protocol().onMoveRejectedByCentral()},onCentralGetState(){Hc.protocol().onCentralGetState()},onCentralSetState(){Hc.protocol().onCentralSetState()},sendMoveToCentral(e,t,n){null==Yc||Yc(e,t,n)},sendStateChangeToCentral(){null==Kc||Kc(),(this.features().getState||this.features().setState)&&Xt()},sendOptionsUpdateToCentral(){Hc.updateSettings()},state:()=>Hc.state(),features:()=>Hc.features(),variants:()=>Hc.variants(),options:()=>Hc.options(),subscribe(e,t){Yc=e,Kc=t},unsubscribe(){Yc=void 0,Kc=void 0},isConnected:()=>Hc.isConnected(),batteryLevel:()=>Hc.batteryLevel()};const Jc={man:1,king:2,ghostman:0,ghostking:0,unsupport:0};class Draughtsground{constructor(e){this.detach=()=>{this.dom=void 0,window.removeEventListener("resize",this.onOrientationChange)},this.applyAnim=e=>{const t=this.state;let n=t.animation.current;if(null===n)return void this.redrawSync();null===n.start&&(n.start=e);let a=1-(e-n.start)*n.frequency;if(a<=0&&(n.plan.nextPlan&&!$o(n.plan.nextPlan.anims)?(t.animation.current={start:e,frequency:2.2/t.animation.duration,plan:n.plan.nextPlan,lastMove:t.lastMove},n=t.animation.current,a=1):t.animation.current=null),null!==t.animation.current){a>.999&&(a=.999);const e=(i=a)<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1;for(const t in n.plan.anims){const a=n.plan.anims[t];a[2]=a[0]*e,a[3]=a[1]*e}this.redrawSync(),Ht(this.applyAnim)}else this.redrawSync();var i},this.setBounds=e=>{this.dom&&(this.dom.bounds=e)},this.redrawSync=()=>{this.dom&&El(this.state,this.dom)},this.redraw=()=>{Ht(this.redrawSync)},this.getFen=e=>ws.write(this.state.pieces,kl(this.state),e),this.toggleOrientation=()=>{Vl(al,this)},this.externalMove=(e,t)=>{Vl((n=>ll(n,e,t)),this)||Xc.onMoveRejectedByCentral()},this.playPremove=()=>{if(this.state.premovable.current){const e=this.state.premovable.current?this.state.premovable.current[1]:"00";if(Vl(gl,this))return this.state.movable.captLen&&this.state.movable.captLen>1&&dl(this.state,e),!0;this.redraw()}return!1},this.playPredrop=e=>{if(this.state.predroppable.current){const t=function(e,t){const n=e.predroppable.current;if(!n)return!1;let a=!1;if(t(n)){const t={role:n.role,color:e.movable.color};yl(e,t,n.key)&&(setTimeout((()=>{e.movable.events.afterNewPiece&&e.movable.events.afterNewPiece(n.role,n.key,{premove:!1,predrop:!0})})),a=!0)}return ol(e),a}(this.state,e);return this.redraw(),t}return!1},this.cancelPremove=()=>{Hl(rl,this)},this.cancelPredrop=()=>{Hl(ol,this)},this.setCheck=e=>{Hl((t=>function(e,t){if(!0===t&&(t=e.turnColor),t)for(const n in e.pieces)"king"===e.pieces[n].role&&e.pieces[n].color===t&&(e.check=n);else e.check=null}(t,e)),this)},this.cancelMove=()=>{nc(this),Hl((e=>vl(e)),this)},this.stop=e=>{nc(this),Hl((e=>function(e){e.movable.color=null,e.movable.dests={},vl(e)}(e)),this),Xc.onCentralStateEnded(e)},this.explode=e=>{this.dom&&(this.state.exploding={stage:1,keys:e},this.redraw(),setTimeout((()=>{this.state.exploding&&(this.state.exploding.stage=2,this.redraw()),setTimeout((()=>{this.state.exploding=null,this.redraw()}),120)}),120))},this.onOrientationChange=()=>{const e=this.dom;e&&requestAnimationFrame((()=>{e.bounds=e.board.getBoundingClientRect(),this.redraw()}))},this.state=function(e){const t=Sl();return Cl(t,e||{}),t}(e)}attach(e,t){const n=this.state.fixed||this.state.viewOnly,a=this.state.edit,i=document.createElement("div");if(i.className="cg-board",i.className+=n?" view-only":" manipulable",e.appendChild(i),this.dom={board:i,elements:{},bounds:t},this.redrawSync(),!n){const t=document.createElement("div");t.className="cg-square-target",t.style.transform=jo,e.appendChild(t),this.dom.elements.shadow=t}if(!n&&this.state.draggable.showGhost){const t=document.createElement("piece");t.className="ghost",t.style.transform=Do,e.appendChild(t),this.dom.elements.ghost=t}2===this.state.coordinates?Ul(e,this.state.boardSize,this.state.orientation,this.dom,this.state.coordSystem):1===this.state.coordinates&&Wl(this.state,this.dom),n||(i.addEventListener("touchstart",(e=>function(e,t){if(t.touches&&t.touches.length>1)return;t.preventDefault();const n=e.state,a=e.dom;if(!a)return;const i=a.bounds,r=Ao(t),o=ac(n,r,i);if(!o)return;const s=n.selected,l=!!n.premovable.current,c=!!n.predroppable.current;n.selected&&pl(n,n.selected,o)?Vl((e=>ul(e,o)),e):ul(n,o);const u=n.selected===o;if(n.pieces[o]&&u&&function(e,t){const n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(n,o)){const l=Bo(n.orientation,i,o,n.boardSize),c=wo(o,n.boardSize);n.draggable.current={previouslySelected:s,orig:o,piece:n.pieces[o],rel:r,epos:r,pos:[0,0],origPos:c,dec:n.draggable.magnified?[r[0]-(l.left+l.width),r[1]-(l.top+2*l.height)]:[r[0]-(l.left+l.width/2),r[1]-(l.top+l.height/2)],started:!1===n.selectable.enabled,over:o,prevOver:null,element:Ro(a,o),originTarget:t.target,showGhost:n.draggable.showGhost,scheduledAnimationFrame:!1},n.draggable.magnified&&n.draggable.centerPiece&&(n.draggable.current.dec[1]=r[1]-(l.top+l.height)),n.draggable.current.started&&ic(e)}else l&&rl(n),c&&ol(n);e.redraw()}(this,e))),i.addEventListener("touchmove",(e=>ec(this,e))),i.addEventListener("touchend",(e=>tc(this,e))),i.addEventListener("touchcancel",(()=>nc(this)))),n||(Xc.subscribe(this.externalMove,this.redraw),a?Xc.features().getState&&Xc.onCentralGetState():Xc.onCentralStateCreated(this.state)),window.addEventListener("resize",this.onOrientationChange)}getMaterialDiff(){const e={white:{pieces:{king:0,man:0},score:0},black:{pieces:{king:0,man:0},score:0}},t=Object.keys(this.state.pieces);for(let n=0;n<t.length;n++){const a=this.state.pieces[t[n]];if("ghostman"!==a.role&&"ghostking"!==a.role){const t=e[Eo(a.color)];t.pieces[a.role]>0?t.pieces[a.role]--:e[a.color].pieces[a.role]++}}return e.white.score=this.getScore(this.state.pieces),e.black.score=-e.white.score,e}set(e,t=!1){Vl((t=>Tl(t,e)),this,!1,t),this.state.selected&&!this.state.pieces[this.state.selected]&&(this.state.selected=null),Xc.onCentralStateChanged()}reconfigure(e,t){t?Vl((t=>Cl(t,e)),this):(Cl(this.state,e),this.redraw()),Xc.onCentralStateCreated(this.state)}setOtbMode(e){Vl((t=>{t.otbMode=e}),this)}setPieces(e){Vl((t=>il(t,e)),this)}setLastPromotion(e){this.state.lastPromotion=e||null}dragNewPiece(e,t,n=!1){!function(e,t,n,a){const i="00",r=e.state,o=r.boardSize,s=e.dom;if(!s)return;r.pieces[i]=t,e.redrawSync();const l=Ao(n),c="white"===r.orientation,u=s.bounds,d=Bo(r.orientation,u,i,o),h=[(c?-1:o[0])*d.width+u.left,(c?0:o[1]-1)*d.height+u.top];r.draggable.current={orig:i,origPos:wo(i,o),piece:t,rel:h,epos:l,pos:[l[0]-h[0],l[1]-h[1]],dec:r.draggable.magnified?[-d.width,2*-d.height]:[-d.width/2,-d.height/2],over:null,prevOver:null,started:!0,element:Ro(s,i),originTarget:n.target,previouslySelected:null,newPiece:!0,force:a||!1,showGhost:!1},ic(e)}(this,t,e,n)}selectSquare(e){e?Vl((t=>ul(t,e)),this):this.state.selected&&(hl(this.state),this.redraw())}apiMove(e,t,n,a,i){Vl((r=>{!function(e,t,n,a){bl(e,t,n,a)}(r,e,t,i),n&&il(r,n),a&&(Tl(r,a),Xc.onCentralStateChanged())}),this)}apiNewPiece(e,t,n){Vl((a=>{!function(e,t,n){yl(e,t,n)}(a,e,t),n&&Tl(a,n)}),this)}getScore(e){let t,n=0;for(t in e)n+=Jc[e[t].role]*("white"===e[t].color?1:-1);return n}}const Qc={oninit({attrs:e}){this.pieceTheme=ct.general.theme.piece(),this.boardTheme=ct.general.theme.board(),this.ground=new Draughtsground(function({fen:e,lastMove:t,orientation:n,variant:a,fixed:i=!0}){return{batchRAF:Ht,viewOnly:!0,fixed:i,minimalDom:!0,coordinates:0,fen:e,boardSize:Xs(a).size,lastMove:t?Qo(t):null,orientation:n||"white"}}(e))},oncreate({attrs:e,dom:t}){const n=e.fixed?{top:0,bottom:0,left:0,right:0,height:0,width:0,x:0,y:0,toJSON:ln}:t.getBoundingClientRect();void 0!==e.delay?setTimeout((()=>{this.ground.attach(t,n)}),e.delay):this.ground.attach(t,n)},onbeforeupdate:({attrs:e},{attrs:t})=>e.fen!==t.fen||e.lastMove!==t.lastMove||e.orientation!==t.orientation,onupdate({attrs:e}){this.ground.set(Object.assign(Object.assign({},e),{lastMove:e.lastMove?Qo(e.lastMove):void 0}))},onremove(){this.ground.detach()},view({attrs:e}){const t=["display_board",e.customPieceTheme||this.pieceTheme,`board-${this.boardTheme}`,e.variant,"is"+Xs(e.variant).key].join(" ");return Rn("div",{className:t})}};let Zc,eu=null,tu=!1;var nu={lastJoined:()=>Zc,resetLastJoined(){Zc=void 0},open:function(e){ki.backbutton.stack.push(lu),Za.refresh(),tu=!0,setTimeout((()=>{eu&&!Ji()&&eu.goTo(void 0!==e?e:0)}),500)},close:lu,view:()=>tu?Rn("div#games_menu.overlay_popup_wrapper",{onbeforeremove:iu},Rn.fragment({key:Qi()?"portrait":"landscape"},[Rn("div.wrapper_overlay_close",{oncreate:au}),pu(),Rn("div#wrapper_games",gu())])):null};const au=qi((()=>lu()));function iu({dom:e}){return e.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)}))}let ru;function ou({dom:e}){Qi()&&(eu=new Siema({selector:e,duration:250,loop:!1,perPage:Ji()?2:1,startIndex:0,threshold:50,draggable:!0,onChange:()=>{clearTimeout(ru),ru=setTimeout((()=>{Ht(fu)}),300)}}),Ht(fu),Xt())}function su(){eu&&(eu.destroy(),eu=null)}function lu(e){"backbutton"!==e&&tu&&ki.backbutton.stack.pop(),tu=!1}function cu(e,t,n,a){return Rn("div.boardWrapper",Rn(Qc,{fen:e,lastMove:n,orientation:t,variant:a||"standard"}))}function uu(e){return e.isMyTurn?e.secondsLeft?Rn("time",{},Ot(He(new Date,e.secondsLeft))):kt("yourTurn"):kt("waitingForOpponent")}function du(e){const t=e.opponent.ai?"n":un(e.perf),n=Us(e.opponent,!1),a=["card","standard",e.color].join(" "),i=["timeIndication",e.isMyTurn?"myTurn":"opponentTurn"].join(" ");return Rn("div",{className:a,key:"game."+e.gameId,oncreate:Yi((()=>function(e){Zc=e,ro.set(e.fullId,{fen:e.fen,orientation:e.color,variant:e.variant.key}),lu(),ki.set("/game/"+e.fullId)}(e)))},[cu(e.fen,e.color,e.lastMove,e.variant.key),Rn("div.infos",[Rn("div.icon-game",{"data-icon":t||""}),Rn("div.description",[Rn("h2.title",n),Rn("p",[Rn("span.variant",e.variant.name),Rn("span",{className:i},uu(e))])])])])}function hu(e){if(!e.challenger)return null;const t=e.rated?kt("rated"):kt("casual"),n=e.challenger.provisional?"?":"",a=`${e.challenger.id} (${e.challenger.rating}${n})`;return Rn("div.card.standard.challenge",{key:"incoming."+e.id},[cu(e.initialFen||Gs,"white",void 0,e.variant.key),Rn("div.infos",[Rn("div.icon-game",{"data-icon":un(e.speed)}),Rn("div.description",[Rn("h2.title",kt("playerisInvitingYou",a)),Rn("p.variant",[Rn("span.time-indication[data-icon=p]",ja.challengeTime(e))," • ",Rn("span.variantName",e.variant.name)," • ",Rn("span",t)])]),Rn("div.actions",[Rn("button",{oncreate:Vi((()=>{return wa(t=e.id).then((e=>{ki.set("/game"+e.url.round)})).then((()=>ja.remove(t))).then((()=>lu()));var t}))},kt("accept")),Rn("button",{oncreate:Vi((t=>{return(n=e.id,ya(n).then((()=>{ja.remove(n)}))).then((()=>{Ui(t,(()=>lu()),".card",250)}));var n}))},kt("decline"))])])])}function mu(e){const t=e.rated?kt("rated"):kt("casual");return Rn("div.card.standard.challenge.sending",{key:"sending."+e.id},[cu(e.initialFen||Gs,"white",void 0,e.variant.key),Rn("div.infos",[Rn("div.icon-game",{"data-icon":un(e.speed)}),Rn("div.description",[Rn("h2.title",e.destUser?function(e){const t=e.provisional?"?":"";return`${e.id} (${e.rating}${t})`}(e.destUser):kt("openChallenge")),Rn("p.variant",[Rn("span.time-indication[data-icon=p]",ja.challengeTime(e))," • ",Rn("span.variantName",e.variant.name)," • ",Rn("span",t)])]),Rn("div.actions",[e.destUser?null:Rn("button",{oncreate:Vi((()=>{lu(),ki.set(`/game/${e.id}`)}))},kt("viewInFullSize")),Rn("button",{oncreate:Vi((t=>{return(n=e.id,ba(n).then((()=>{ja.remove(n)}))).then((()=>{Ui(t,(()=>lu()),".card",250)}));var n}))},kt("cancel"))])])])}function pu(){return Qi()?Rn("div.#games_menu__dots"):null}function fu(){if(Qi()&&eu){const e=Ji()?Math.ceil(eu.innerElements.length/2):eu.innerElements.length,t=document.getElementById("games_menu__dots");if(t){const n=e-t.childElementCount;if(0!==n)for(let e=0,a=Math.abs(n);e<a;e++)if(n>0){const e=document.createElement("i");e.className="dot",t.appendChild(e)}else{const e=t.firstChild;e&&t.removeChild(e)}const a=t.childNodes;for(let e=0;e<a.length;e++){const t=a[e];e===eu.currentSlide?t.className="dot current":t.className="dot"}}}}function gu(){const e=Za.nowPlaying(),t=ja.incoming(),n=ja.sending().filter(ja.isPersistent),a=t.map((e=>hu(e))).filter(wn),i=n.map((e=>mu(e))),r=[...a,...e.map((e=>du(e))),...i];return Rn("div.games_carousel",{oncreate:ou,onremove:su},Qi()?Rn("div",r.map((e=>Rn("div",e)))):r)}var vu={booleanChoice:[{label:"no",value:!1},{label:"yes",value:!0}],renderRadio(e,t,n,a,i,r){const o=t+"_"+n;return[Rn("input.radio[type=radio]",{name:t,id:o,className:n,value:n,checked:a,onchange:i,disabled:r}),Rn("label",{for:o},kt(e))]},renderSelect(e,t,n,a,i,r){const o=a();return[Rn("label",{for:"select_"+t},kt(e)),Rn("select",{id:"select_"+t,disabled:i,onchange(e){const t=e.target.value;a(t),r&&r(t),setTimeout(Xt,10)}},n.map((e=>bu(e[0],e[1],o,e[2],e[3]))))]},renderSelectOption(e,t,n,a,i,r){const o=a();return Rn("div.check_container",{className:i?"disabled":""},[Rn("label",{for:"select_"+t},kt(e)),Rn("select",{id:"select_"+t,disabled:i,onchange(e){const t=e.target.value;a(t),r&&r(t),setTimeout(Xt,10)}},n.map((e=>bu(e[0],e[1],o,e[2],e[3]))))])},renderTextEditOption(e,t,n,a,i){const r=n();return Rn("div.check_container",{className:i?"disabled":""},[Rn("label",{for:"textedit_"+t},e),Rn("button",{type:"button",disabled:i,onclick(){const t=prompt(e,r);null!==t&&t!==r&&(n(t),a(t),setTimeout(Xt,10))}},r)])},renderCheckbox(e,t,n,a,i){const r=n();return Rn("div.check_container",{className:i?"disabled":""},[Rn("label",{for:t},e),Rn("input[type=checkbox]",{id:t,name:t,disabled:i,checked:r,onchange:()=>{const e=!r;n(e),a&&a(e),Xt()}})])},renderMultipleChoiceButton(e,t,n,a=!1,i){const r=n();return Rn("div.form-multipleChoiceContainer",[Rn("label",e),Rn("div.form-multipleChoice",{className:a?"wrap":""},t.map((e=>Rn("div",{className:e.value===r?"selected":"",oncreate:qi((()=>{n(e.value),i&&i(e.value)}))},[e.dataIcon?Rn("span.withIcon",{"data-icon":e.dataIcon}):void 0,void 0!==e.labelArg?kt(e.label,e.labelArg):kt(e.label)]))))])},renderSliderOption(e,t,n,a,i,r,o,s){const l=r();return Rn("div.forms-rangeSlider",{className:s?"disabled":""},[Rn("label",{for:t},e),Rn("input[type=range]",{id:t,value:l,disabled:s,min:n,max:a,step:i,oninput(e){const t=~~e.target.value;r(t),o&&o(t),setTimeout(Xt,10)}}),Rn("div.forms-sliderValue",l)])},renderSlider(e,t,n,a,i,r,o,s){const l=r();return Rn("div.forms-rangeSlider",{className:s?"disabled":""},[Rn("label",{for:t},e),Rn("input[type=range]",{id:t,value:l,disabled:s,min:n,max:a,step:i,oninput(e){const t=~~e.target.value;r(t),o&&o(t),setTimeout(Xt,10)}}),Rn("div.forms-sliderValue",`${l} / ${a}`)])}};function bu(e,t,n,a,i){const r=a&&i?kt(e,a,i):a?kt(e,a):kt(e);return Rn("option",{key:t,value:t,selected:n===t},r)}function yu(e,t,n,a,i){if(!a)return null;const r={overlay_popup:!0,native_scroller:!0};let o;if("object"==typeof e)o=Xi(Object.assign(Object.assign({},r),e));else{if("string"!=typeof e)throw new Error("First popup argument must be either a string or an object");o=Xi(r)+" "+e}const s=Xi({popup_content:!0,noheader:!t});return Rn("div",{className:"overlay_popup_wrapper fade-in",onbeforeremove:e=>(e.dom.classList.add("fading_out"),new Promise((e=>{setTimeout(e,500)})))},Rn("div",{className:"popup_overlay_close",oncreate:i?qi(i):ln}),Rn("div",{className:o},t?Rn("header",null,t()):null,Rn("div",{className:s},n())))}let wu=!1;const ku=ct.gameSetup.human;let Su=ku.preset(),Cu=null;var Tu={open:Mu,close:xu,openRealTime(e){ku.timeMode("1"),e&&(Su=e),Mu()},openCorrespondence(){Cu=Su,Su="custom",ku.timeMode("2"),Mu()},view:()=>yu("game_form_popup",void 0,Eu,wu,xu)};function Mu(){Za.hasCurrentBan()||(0===ka.length&&Sa().then(Xt),ki.backbutton.stack.push(xu),wu=!0)}function xu(e){"backbutton"!==e&&wu&&ki.backbutton.stack.pop(),wu=!1,Cu&&(Su=Cu,Cu=null)}function Pu(e){xu(),Nr(e)&&1===e.timeMode?sh.startSeeking(e):fa(e).then((()=>ki.set("/?tab=1"))).catch(on)}function Eu(){const e=ku,t=t=>an((()=>{const n=t.target.value;Su=n,e.preset(n)}));return[Rn("div.newGame-preset_switch",[Rn("div.nice-radio",vu.renderRadio(kt("quickPairing"),"preset","quick","quick"===Su,t)),Rn("div.nice-radio",vu.renderRadio(kt("custom"),"preset","custom","custom"===Su,t))]),"quick"===Su?Ou((()=>{Su="custom",ku.preset("custom")})):Nu("human",e,e.availableVariants,e.availableTimeModes.filter((e=>"1"===e[1]||Za.isConnected())))]}function Ou(e){return Rn("div.newGame-pools",{className:ka.length?"":"loading"},ka.length?ka.map((e=>function(e){return Rn("div.newGame-pool",{key:"pool-"+e.id,oncreate:qi((()=>{var t;Pu((t=e,{mode:Za.isConnected()?1:0,variant:1,timeMode:1,time:t.lim,increment:t.inc,days:1,color:"random",fromPool:!0})),xu()}))},[Rn("div.newGame-clock",e.id),Rn("div.newGame-perf",e.perf)])}(e))).concat(Rn("div.newGame-pool",{key:"pool-custom",oncreate:qi(e)},Rn("div.newGame-custom",kt("custom")))):zn.getVdom("monochrome"))}function Nu(e,t,n,a){const i=t.timeMode(),r="1"===i,o=t.variant(),s=r&&"0.25"===t.time()&&"0"===t.increment();s&&"1"!==o&&t.mode("0"),Za.isConnected()||ku.timeMode("1"),"0"===i&&ku.mode("0");const l=!Za.isConnected()||"0"===i||s&&"1"!==o?[["casual","0"]]:[["casual","0"],["rated","1"]];1===l.length&&t.mode(l[0][1]);const c=[Rn("div.select_input",vu.renderSelect("side",e+"color",[["randomColor","random"],["white","white"],["black","black"]],t.color)),Rn("div.select_input",vu.renderSelect("variant",e+"variant",n,t.variant))];c.push(Rn("div.select_input",vu.renderSelect("mode",e+"mode",l,t.mode))),Za.isConnected()&&c.push(Rn("div.rating_range",[Rn("div.title",kt("ratingRange")),Rn("div.select_input.inline",vu.renderSelect("Min",e+"rating_min",ku.availableRatingRanges.min,t.ratingRangeMin,!1)),Rn("div.select_input.inline",vu.renderSelect("Max",e+"rating_max",ku.availableRatingRanges.max,t.ratingRangeMax,!1))]));const u=[Rn("div.select_input",vu.renderSelect("clock",e+"timeMode",a,t.timeMode))];return r&&u.push(Rn("div.select_input.inline",vu.renderSelect("time",e+"time",ct.gameSetup.availableTimes,t.time,!1)),Rn("div.select_input.inline",vu.renderSelect("increment",e+"increment",ct.gameSetup.availableIncrements.map(tt),t.increment,!1))),"2"===i&&Za.isConnected()&&u.push(Rn("div.select_input.large_label",vu.renderSelect("daysPerTurn",e+"days",ct.gameSetup.availableDays.map(tt),t.days,!1))),Rn("form.game_form",{onsubmit(e){e.preventDefault(),ct.gameSetup.isTimeValid(t)?(xu(),Pu(da(t))):W.show({text:"Invalid clock settings",position:"center",duration:"short"})}},[Rn("fieldset",c),Rn("fieldset",u),Rn("div.popupActionWrapper",[Rn("button[type=submit].defaultButton",kt("createAGame"))])])}const _u="W:W:B:H0:F1";function Lu(e){const t=e.split(":");return{color:t[0].toLowerCase(),halfmove:Number(t.length>3?t[3].slice(1):0),moves:Number(t.length>4?t[4].slice(1):1)}}function Iu(e,t="standard"){const n=ms(e,!1).split(":");if(!function(e){if(e.length<3||e.length>6)return!1;if("W"!==e[0]&&"B"!==e[0])return!1;if(e.length>4&&(isNaN(Number(e[4].slice(1)))||parseInt(e[4],10)<=0))return!1;if(e.length>3&&(isNaN(Number(e[3].slice(1)))||parseInt(e[3],10)<0))return!1;return!0}(n))return!1;return!!function(e){for(let t=0;t<e.length;t++){let n=e[t],a=n.slice(0,1);if("W"!==a&&"B"!==a||(n=n.slice(1),a=n.slice(0,1)),"K"!==a&&"G"!==a&&"P"!==a||(n=n.slice(1)),n.length){const e=Number(n);if(isNaN(e)||e<1||e>50)return!1}}return!0}(n[1].split(",").concat(n[2].split(",")))&&("frisian"!==t&&"frysk"!==t||function(e){if(e.length<4)return!0;if(0===e[e.length-1].indexOf("+")&&-1!==e[e.length-1].indexOf("+",1))return!1;return!0}(n))}function Du(e,t){const n={white:0,black:0},a=t[0]*t[1]/2,i=t[0]/2,r=ds(e,a),o=[],s=[];for(let e=1;e<=i;e++)o.push(e<10?"0"+e.toString():e.toString());for(let e=a-i+1;e<=a;e++)s.push(e<10?"0"+e.toString():e.toString());for(const e in r)if(r[e]&&("king"===r[e].role||"man"===r[e].role)){if("man"===r[e].role){if("white"===r[e].color&&o.includes(e))return!1;if("black"===r[e].color&&s.includes(e))return!1}n[r[e].color]++}return 0!==n.white&&0!==n.black&&n.white+n.black<50}function ju(e){if(e){const{color:t}=Lu(e);return"w"===t?"white":"black"}return"white"}function Au(e){if(e){const{color:t,moves:n}=Lu(e);return 2*n-("w"===t?2:1)}return 0}function Bu(e){return"w"===e.split(" ")[1]?"white":"black"}let Ru,$u,zu,Fu="";const Uu=Mn(!1);function Wu(e){e?(Ru=e,Fu=kt("challengeToPlay")):(Ru=void 0,Fu=kt("playWithAFriend")),ki.backbutton.stack.push(Gu),Uu(!0),$u=void 0,zu=void 0}function Gu(e){"backbutton"!==e&&Uu()&&ki.backbutton.stack.pop(),Uu(!1)}function qu(){return function(e,t){const n=ct.gameSetup.challenge,a=e?`/setup/friend?user=${e}`:"/setup/friend",i={variant:n.variant(),timeMode:n.timeMode(),days:n.days(),time:n.time(),increment:n.increment(),color:n.color(),mode:Za.isConnected()?n.mode():"0"};return t&&(i.fen=t),Xn(a,{method:"POST",body:JSON.stringify(i)},!0)}(Ru,$u).then((e=>{e.challenge.destUser&&ja.isPersistent(e.challenge)?nu.open(Za.nowPlaying().length+ja.all().length):ki.set(`/game/${e.challenge.id}`)})).catch(on)}function Vu(){const e="invite",t=ct.gameSetup.challenge,n=ct.gameSetup.challenge.availableVariants,a=ct.gameSetup.challenge.availableTimeModes,i=t.timeMode(),r="1"===i,o="2"===i,s=t.variant(),l=r&&"0.25"===t.time()&&"0"===t.increment();l&&"1"!==s&&t.mode("0");const c=!Za.isConnected()||"0"===i||l&&"1"!==s?[["casual","0"]]:[["casual","0"],["rated","1"]],u=[Rn("div.select_input",vu.renderSelect("side",e+"color",[["randomColor","random"],["white","white"],["black","black"]],t.color)),Rn("div.select_input",vu.renderSelect("variant",e+"variant",n,t.variant)),"3"===t.variant()?Rn("div.setupPosition",Ru?Rn("input[type=text][name=fen]",{placeholder:kt("pasteTheFenStringHere"),oninput:e=>{const n=ms(os(e.target.value),!1);Iu(n,Js(t.variant())||"standard")?($u=n,zu=void 0):zu=kt("invalidFen"),Xt()}}):Rn("div",Rn("button.withIcon",{oncreate:qi((()=>{Gu(),ki.set("/editor")}))},[Rn("span.fa.fa-pencil"),kt("boardEditor")])),zu?Rn("div.setupFenError",zu):null,$u?[Rn("div",{style:{width:"100px",height:"100px"},oncreate:qi((()=>{Gu(),$u&&ki.set(`/editor/${encodeURIComponent($u)}`)}))},[Rn(Qc,{fen:$u,variant:Js(t.variant())||"standard",orientation:"white"})])]:null):null,"3"!==t.variant()?Rn("div.select_input",vu.renderSelect("mode",e+"mode",c,t.mode)):null],d=[Rn("div.select_input",vu.renderSelect("clock",e+"timeMode",a,t.timeMode))];return r&&d.push(Rn("div.select_input.inline",vu.renderSelect("time",e+"time",ct.gameSetup.availableTimes,t.time,!1)),Rn("div.select_input.inline",vu.renderSelect("increment",e+"increment",ct.gameSetup.availableIncrements.map(tt),t.increment,!1))),o&&d.push(Rn("div.select_input.large_label",vu.renderSelect("daysPerTurn",e+"days",ct.gameSetup.availableDays.map(tt),t.days,!1))),Rn("form#invite_form.game_form",{onsubmit(e){e.preventDefault(),ct.gameSetup.isTimeValid(t)?(Gu(),qu()):W.show({text:"Invalid clock settings",position:"center",duration:"short"})}},[Rn("fieldset",u),Rn("fieldset#clock",d),Rn("div.popupActionWrapper",[Rn("button[type=submit].defaultButton",Fu)])])}var Hu={view:()=>yu("invite_form_popup game_form_popup",void 0,Vu,Uu(),Gu),open:Wu,openFromPosition(e){Wu(),$u=e,ct.gameSetup.challenge.variant("3"),ct.gameSetup.challenge.mode("0")}};const Yu=a("Browser",{web:()=>import("./web-6a68ea4f.js").then((e=>new e.BrowserWeb))});function Ku(e,t=!1){const n=`${zt.apiEndPoint}${e}`;Za.isKidMode()?Xu(n):Za.isConnected()&&!t?Xn("/auth/token",{method:"POST"},!0).then((t=>{Yu.open({url:`${t.url}?referrer=${encodeURIComponent(e)}`})})).catch((()=>{Yu.open({url:n})})):Yu.open({url:n})}function Xu(e){window.open(e,"_blank")}const Ju=/&/g,Qu=/</g,Zu=/>/g,ed=/'/g,td=/"/g,nd=/[&<>"']/;function ad(e){const t=(n=e,nd.test(String(n))?n.replace(Ju,"&amp;").replace(Qu,"&lt;").replace(Zu,"&gt;").replace(ed,"&apos;").replace(td,"&quot;"):n);var n;return t.replace(od,sd).replace(id,rd)}const id=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:(?:https?):\/\/|lidraughts\.org\/)[-A-Z0-9+\u0026\u2019@#/%?=()~_|!:,.;]*[-A-Z0-9+\u0026@#/%=~()_|])/gi;function rd(e,t,n){if(-1!==n.indexOf("&quot;"))return e;return t+`<a class="external_link" onClick="window.open('${0===n.indexOf("http")?n:"https://"+n}', '_blank')">${n.replace(/^(?:https:\/\/)?(.+)$/,"$1")}</a>`}const od=/(^|[^\w@#/])@([\w-]{2,})/g;function sd(e,t,n){return n.length>20?e:t+`<a href="?/@/${n}">@${n}</a>`}const ld={ultraBullet:{name:"UltraBullet",shortName:"UltraBullet"},bullet:{name:"Bullet",shortName:"Bullet"},blitz:{name:"Blitz",shortName:"Blitz"},rapid:{name:"Rapid",shortName:"Rapid"},classical:{name:"Classical",shortName:"Classic"},correspondence:{name:"Correspondence",shortName:"Corresp."},frisian:{name:"Frisian",shortName:"Frisian"},frysk:{name:"Frysk!",shortName:"Frysk!"},breakthrough:{name:"Breakthrough",shortName:"Breakthrough"},antidraughts:{name:"Antidraughts",shortName:"Antidraughts"},russian:{name:"Russian",shortName:"Russian"},brazilian:{name:"Brazilian",shortName:"Brazilian"}},cd=Object.keys(ld).map((e=>[e,ld[e].name,ld[e].shortName]));function ud(e){const t=ld[e];return t?t.name:""}function dd(e){const t=ld[e];return t?t.shortName:""}const hd=110,md={AD:"Andorra",AE:"United Arab Emirates",AF:"Afghanistan",AG:"Antigua and Barbuda",AI:"Anguilla",AL:"Albania",AM:"Armenia","AM-RA":"Artsakh",AO:"Angola",AQ:"Antarctica",AR:"Argentina",AS:"American Samoa",AT:"Austria",AU:"Australia",AW:"Aruba",AX:"Aland Islands",AZ:"Azerbaijan",BA:"Bosnia-Herzegovina",BB:"Barbados",BD:"Bangladesh",BE:"Belgium",BF:"Burkina Faso",BG:"Bulgaria",BH:"Bahrain",BI:"Burundi",BJ:"Benin",BL:"Saint Barthelemy",BM:"Bermuda",BN:"Brunei",BO:"Bolivia",BQ:"Bonaire: Sint Eustatius and Saba",BR:"Brazil",BS:"Bahamas",BT:"Bhutan",BV:"Bouvet Island",BW:"Botswana",BY:"Belarus",BZ:"Belize",CA:"Canada","CA-QC":"Quebec",CC:"Cocos (Keeling) Islands",CD:"Congo (Democratic Rep.)",CF:"Central African Republic",CG:"Congo (Brazzaville)",CH:"Switzerland",CI:"Cote d'Ivoire",CK:"Cook Islands",CL:"Chile",CM:"Cameroon",CN:"China",CO:"Colombia",CR:"Costa Rica",CU:"Cuba",CV:"Cape Verde",CW:"Curaçao",CX:"Christmas Island",CY:"Cyprus",CZ:"Czechia",DE:"Germany",DJ:"Djibouti",DK:"Denmark",DM:"Dominica",DO:"Dominican Republic",DZ:"Algeria",EC:"Ecuador",EE:"Estonia",EG:"Egypt",EH:"Western Sahara",ER:"Eritrea",ES:"Spain","ES-AN":"Andalusia","ES-CT":"Catalonia","ES-EU":"Basque","ES-GA":"Galicia",ET:"Ethiopia",FI:"Finland",FJ:"Fiji",FK:"Falkland Islands",FM:"Micronesia",FO:"Faroe Islands",FR:"France",GA:"Gabon",GB:"United Kingdom","GB-ENG":"England","GB-NIR":"Northern Ireland","GB-SCT":"Scotland","GB-WLS":"Wales",GD:"Grenada",GE:"Georgia",GF:"French Guiana",GG:"Guernsey",GH:"Ghana",GI:"Gibraltar",GL:"Greenland",GM:"Gambia",GN:"Guinea",GP:"Guadeloupe",GQ:"Equatorial Guinea",GR:"Greece",GS:"South Georgia and the South Sandwich Islands",GT:"Guatemala",GU:"Guam",GW:"Guinea-Bissau",GY:"Guyana",HK:"Hong Kong",HM:"Heard Island and McDonald Islands",HN:"Honduras",HR:"Croatia",HT:"Haiti",HU:"Hungary",ID:"Indonesia",IE:"Ireland",IL:"Israel",IM:"Isle of Man",IN:"India",IO:"British Indian Ocean Territory",IQ:"Iraq",IR:"Iran",IS:"Iceland",IT:"Italy",JE:"Jersey",JM:"Jamaica",JO:"Jordan",JP:"Japan",KE:"Kenya",KG:"Kyrgyzstan",KH:"Cambodia",KI:"Kiribati",KM:"Comoros",KN:"Saint Kitts and Nevis",KP:"North Korea",KR:"South Korea",KW:"Kuwait",KY:"Cayman Islands",KZ:"Kazakhstan",LA:"Laos",LB:"Lebanon",LC:"Saint Lucia",LI:"Liechtenstein",LK:"Sri Lanka",LR:"Liberia",LS:"Lesotho",LT:"Lithuania",LU:"Luxembourg",LV:"Latvia",LY:"Libya",MA:"Morocco",MC:"Monaco",MD:"Moldova",ME:"Montenegro",MF:"Saint Martin",MG:"Madagascar",MH:"Marshall Islands",MK:"North Macedonia",ML:"Mali",MM:"Myanmar",MN:"Mongolia",MO:"Macau, China",MP:"Northern Mariana Islands",MQ:"Martinique",MR:"Mauritania",MS:"Montserrat",MT:"Malta",MU:"Mauritius",MV:"Maldives",MW:"Malawi",MX:"Mexico",MY:"Malaysia",MZ:"Mozambique",NA:"Namibia",NC:"New Caledonia",NE:"Niger",NF:"Norfolk Island",NG:"Nigeria",NI:"Nicaragua",NL:"Netherlands",NO:"Norway",NP:"Nepal",NR:"Nauru",NU:"Niue",NZ:"New Zealand",OM:"Oman",PA:"Panama",PE:"Peru",PF:"French Polynesia",PG:"Papua New Guinea",PH:"Philippines",PK:"Pakistan",PL:"Poland",PM:"Saint Pierre and Miquelon",PN:"Pitcairn",PR:"Puerto Rico",PS:"Palestine",PT:"Portugal",PW:"Palau",PY:"Paraguay",QA:"Qatar",RE:"Reunion",RO:"Romania",RS:"Serbia",RU:"Russia","RU-TAT":"Tatarstan",RW:"Rwanda",SA:"Saudi Arabia",SB:"Solomon Islands",SC:"Seychelles",SD:"Sudan",SE:"Sweden",SG:"Singapore",SH:"Saint Helena",SI:"Slovenia",SJ:"Svalbard and Jan Mayen",SK:"Slovakia",SL:"Sierra Leone",SM:"San Marino",SN:"Senegal",SO:"Somalia",SR:"Suriname",SS:"South Sudan",ST:"Sao Tome and Principe",SV:"El Salvador",SX:"Sint Maarten",SY:"Syria",SZ:"Eswatini",TC:"Turks and Caicos",TD:"Chad",TF:"French Southern Territories",TG:"Togo",TH:"Thailand",TJ:"Tajikistan",TK:"Tokelau",TL:"Timor-Leste",TM:"Turkmenistan",TN:"Tunisia",TO:"Tonga",TR:"Turkey",TT:"Trinidad and Tobago",TV:"Tuvalu",TW:"Chinese Taipei",TZ:"Tanzania",UA:"Ukraine",UG:"Uganda",UM:"United States Minor Outlying Islands",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VA:"Holy See",VC:"Saint Vincent and the Grenadines",VE:"Venezuela",VG:"British Virgin Islands",VI:"U.S. Virgin Islands",VN:"Vietnam",VU:"Vanuatu",WF:"Wallis and Futuna",WS:"Samoa",XK:"Kosovo",YE:"Yemen",YT:"Mayotte",ZA:"South Africa",ZM:"Zambia",ZW:"Zimbabwe",EU:"European Union",_adygea:"Adygea","_belarus-wrw":"Belarus White-red-white",_earth:"Earth","_east-turkestan":"East Turkestan",_lidraughts:"Lidraughts",_pirate:"Pirate",_rainbow:"Rainbow","_russia-wbw":"Russia White-blue-white",_transgender:"Transgender","_united-nations":"United Nations"};function pd(e,t="all",n=1,a=!1){return Xn(`/@/${e}/${t}`,{query:{page:n}},a)}function fd(e,t=1){return Xn(`/@/${e}/following`,{query:{page:t}})}function gd(e,t=1){return Xn(`/@/${e}/followers`,{query:{page:t}})}function vd(e){return Xn("/rel/follow/"+e,{method:"POST"})}function bd(e){return Xn("/rel/unfollow/"+e,{method:"POST"})}function yd(e,t=!0){return Xn(`/api/user/${e}`,void 0,t)}function wd(e){return Xn(`/@/${e}/tv`)}function kd(e,t){return Xn(`/@/${e}/perf/${t}?graph=1`,void 0,!1)}function Sd(e){const t=Mn(null);function n(e){const n=t();n&&Object.assign(n,e),Xt()}const a=Za.get();return a&&a.id===e&&t(a),yd(e).then((e=>{t(e),Xt()})).then(Za.refresh).catch((e=>{rn()&&on(e)})),{user:t,isMe:()=>Za.getUserId()===e,toggleFollowing(){const e=t();e&&Cd(e)&&e.following?bd(e.id).then(n):e&&vd(e.id).then(n)},toggleBlocking(){const e=t();e&&Cd(e)&&e.blocking?function(e){return Xn("/rel/unblock/"+e,{method:"POST"})}(e.id).then(n):e&&function(e){return Xn("/rel/block/"+e,{method:"POST"})}(e.id).then(n)},goToGames(){const e=t();if(e){const t={username:e.username};e.patron&&(t.patron="1"),e.title&&(t.title=e.title),ki.set(`/@/${e.id}/games?${sn(t)}`)}},goToUserTV(){const e=t();e&&ki.set(`/@/${e.id}/tv`)},challenge(){const e=t();e&&Hu.open(e.id)},composeMessage(){const e=t();e&&ki.set(`/inbox/new/${e.id}`)},followers(){const e=t();if(e){const t={username:e.username};e.title&&(t.title=e.title),ki.set(`/@/${e.id}/related?${sn(t)}`)}}}}function Cd(e){return void 0!==e.count}function Td(e,t){const n=Md(e.online,e.patron,e.username,e.title),a=t.isMe()?null:Rd(n);return Hd(a?null:n,a)}function Md(e,t,n,a){const i=rn()&&e?"online":"offline",r=Rn("span",t?{className:"userStatus patron "+i,"data-icon":""}:{className:"fa fa-circle userStatus "+i});return Rn("div.title",[void 0===e?null:r,Rn("span",[...xd(a),n])])}function xd(e){if(!e)return[];const t=e.endsWith("-64");return[Rn("span."+("userTitle"+("BOT"===e?".bot":t?".title64":"")),t?e.slice(0,e.length-3):e),Rn.trust("&nbsp;")]}function Pd(e,t){return Rn("div",{id:"userProfile",className:"native_scroller page"},function(e){return e.engine||e.booster?Rn("section",{className:"warnings"},e.engine?Rn("div",{className:"warning","data-icon":"j"},kt("thisPlayerUsesDraughtsComputerAssistance")):null,e.booster?Rn("div",{className:"warning","data-icon":"j"},kt("thisPlayerArtificiallyIncreasesTheirRating")):null):null}(e),function(e){if(e.profile){const t=[e.profile.firstName,e.profile.lastName].filter((e=>null!=e)).join(" "),n=null!=e.profile.country?md[e.profile.country]:null,a=e.profile.location,i=kt("memberSince")+" "+xt(new Date(e.createdAt));return Rn("section",{className:"profileSection"},t?Rn("h3",{className:"fullname"},t):null,null!=e.profile.bio?Rn("p",{className:"profileBio"},Rn.trust(ad(e.profile.bio))):null,Rn("div",null,null!=e.profile.fmjdRating?Rn("p",null,"FMJD rating: ",Rn("strong",null,e.profile.fmjdRating)):null,null!=e.profile.kndbRating?Rn("p",null,"KNDB rating: ",Rn("strong",null,e.profile.kndbRating)):null,Rn("p",{className:"location"},a,null!=n&&rn()?Rn("span",{className:"country"},null!=a?",":""," ",Rn("img",{className:"flag",src:kn(`images/flags/${e.profile.country}.png`)}),n):null),Rn("p",null,i),e.seenAt?Rn("p",null,Rn.trust(kt("lastSeenActive",`<small>${Ot(new Date(e.seenAt))}</small>`))):null))}return null}(e),function(e){let t=null,n=null;Cd(e)?(t=e.playTime?kt("tpTimeSpentPlaying",Et(e.playTime.total)):null,n=e.playTime&&e.playTime.tv>0?kt("tpTimeSpentOnTV",Et(e.playTime.tv)):null):function(e){return void 0!==e.prefs}(e)&&(t=e.playTime?kt("tpTimeSpentPlaying",Et(e.playTime.total)):null);return Rn("section",{className:"profileSection"},Cd(e)&&e.completionRate?Rn("p",null,kt("gameCompletionRate",e.completionRate+"%")):null,t?Rn("p",null,t):null,n?Rn("p",null,n):null)}(e),function(e,t){return Rn("section",{className:"profileSection websiteLinks"},e.isMe()?Rn("p",null,Rn("a",{className:"external_link",oncreate:Hi((()=>Ku("/account/profile")))},kt("editProfile"))):Rn("p",null,Rn("a",{className:"external_link",oncreate:Hi((()=>Ku(`/@/${t.id}`)))},"More on lidraughts.org")),t.patron?Rn("p",null,Rn("a",{className:"external_link",oncreate:Hi((()=>Ku("/patron")))},"Lidraughts Patron")):null)}(t,e),function(e){function t(e){return-1!==["blitz","bullet","rapid","classical","correspondence"].indexOf(e.key)||e.perf.games>0}return Rn("section",{id:"userProfileRatings",className:"perfs"},function(e){const t=cd.map((t=>{const n=e.perfs[t[0]];return{key:t[0],name:t[1],perf:n||"-"}}));e.perfs.puzzle&&t.push({key:"puzzle",name:"Training",perf:e.perfs.puzzle});e.perfs.puzzlefrisian&&t.push({key:"puzzlefrisian",name:"Frisian Training",perf:e.perfs.puzzlefrisian});return t}(e).filter(t).map((t=>function(e,t,n,a){const i=function(e,t){return"puzzle"!==e&&"puzzlefrisian"!==e&&t.games>0}(e,n);return Rn("div",{className:"profilePerf"+(i?" nav":""),"data-icon":un(e),oncreate:Hi((()=>{i&&ki.set(`/@/${a.id}/${e}/perf`)}))},[Rn("span.name",t),Rn("div.rating",[n.rating,n.rd>=hd?"?":null,Ki(n.prog),Rn("span.nb","/ "+n.games)])])}(t.key,t.name,t.perf,e))))}(e),function(e,t){return Rn("section",{id:"userProfileActions",className:"items_list_block noPadding"},Cd(t)?Rn("div",{className:"list_item nav",oncreate:Hi(e.goToGames)},Ct("nbGames",t.count.all)):null,Za.isConnected()&&e.isMe()?Rn("div",{className:"list_item",oncreate:Hi((()=>ki.set("/inbox")))},Rn("span",{className:"fa fa-envelope"}),kt("inbox")):null,Za.isConnected()&&e.isMe()?Rn("div",{className:"list_item",oncreate:Hi((()=>ki.set("/account/preferences")))},Rn("span",{className:"fa fa-cog"}),kt("preferences")):null,Rn("div",{className:"list_item nav",oncreate:Hi(e.followers)},Rn("span",{className:"fa fa-users"}),Ct("nbFollowers",t.nbFollowers)),e.isMe()?null:Rn("div",{className:"list_item nav","data-icon":"1",oncreate:Hi(e.goToUserTV)},kt("watchGames")),Za.isConnected()&&!e.isMe()?Rn("div",{className:"list_item","data-icon":"U",oncreate:Hi(e.challenge)},kt("challengeToPlay")):null,Za.isConnected()&&!e.isMe()?Rn("div",{className:"list_item nav",oncreate:Hi(e.composeMessage)},Rn("span",{className:"fa fa-comment"}),kt("composeMessage")):null,Za.isConnected()&&Cd(t)&&t.followable&&!e.isMe()?Rn("div",{className:["list_item",t.blocking?"disabled":""].join(" ")},Rn("div",{className:"check_container"},Rn("label",{htmlFor:"user_following"},kt("follow")),Rn("input",{id:"user_following",type:"checkbox",checked:t.following,disabled:t.blocking,onchange:e.toggleFollowing}))):null,Za.isConnected()&&Cd(t)&&!e.isMe()?Rn("div",{className:["list_item",t.following?"disabled":""].join(" ")},Rn("div",{className:"check_container"},Rn("label",{htmlFor:"user_blocking"},kt("block")),Rn("input",{id:"user_blocking",type:"checkbox",checked:t.blocking,disabled:t.following,onchange:e.toggleBlocking}))):null,Za.isConnected()&&!e.isMe()?Rn("div",{className:"list_item","data-icon":"!",oncreate:Hi((()=>Ku(`/report?username=${t.username}`)))},kt("reportXToModerators",t.username)):null,Za.isConnected()&&e.isMe()?Rn("div",{className:"list_item",oncreate:Hi(Za.logout)},Rn("span",{className:"fa fa-power-off"}),kt("logOut")):null)}(t,e))}let Ed=!1;var Od={open:function(){ki.backbutton.stack.push(Nd),Ed=!0},close:Nd,view:()=>yu({onlineFriends:!0,native_scroller:!1},(function(){return[Rn("span",Ct("nbFriendsOnline",ea.count()))]}),_d,Ed,Nd)};function Nd(e){"backbutton"!==e&&Ed&&ki.backbutton.stack.pop(),Ed=!1}function _d(){const e=ea.list();return e.length?Rn("ul",null,e.map(Ld)):Rn("div",{className:"native_scroller nofriend"},kt("noFriendsOnline"))}function Ld(e){const t=e.name.toLowerCase();return Rn("li",{className:"list_item",key:t,oncreate:Hi((function(){Nd(),ki.set("/@/"+t)}))},Rn("div",{className:"friend_name"},e.patron?Rn("span",{className:"patron is-green","data-icon":""}):null,Rn("span",null,xd(e.title),e.name)),Rn("div",{className:"onlineFriends_actions"},e.playing?Rn("span",{className:"friend_tv","data-icon":"1",oncreate:Hi((function(e){e.stopPropagation(),Nd(),ki.set("/@/"+t+"/tv")}))}," "):null,Rn("span",{"data-icon":"U",oncreate:Hi((e=>{e.stopPropagation(),Nd(),Hu.open(t)}))}),Rn("span",{"data-icon":"c",oncreate:Hi((e=>{e.stopPropagation(),Nd(),ki.set(`/inbox/new/${t}`)}))})))}const Id=Rn("div",{className:"svg_icon"},Rn("div",{className:"svg_icon_inner"},Rn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Rn("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})))),Dd=Rn("div",{className:"svg_icon"},Rn("div",{className:"svg_icon_inner"},Rn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Rn("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),jd=Rn("div",{className:"svg_icon"},Rn("div",{className:"svg_icon_inner"},Rn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Rn("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})))),Ad=Rn("div",{className:"svg_icon"},Rn("div",{className:"svg_icon_inner"},Rn("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},Rn("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))));function Bd(){return Rn("button.fa.fa-navicon.main_header_button.menu_button",{oncreate:qi(Xr.toggle)})}function Rd(e){return Rn("div.back_button",[Rn("button",{oncreate:qi(ki.backHistory)},Id),void 0!==e?"string"==typeof e?Rn("div.main_header_title",e):e:null])}function $d(e,t){return Za.isConnected()?Rn("button.main_header_button.bookmarkButton",{oncreate:qi(e,(()=>W.show({text:kt("bookmarkThisGame"),duration:"short",position:"top"})))},Rn("span",{"data-icon":t?"t":"s"})):null}function zd(){if(!ct.general.bluetooth.useDevice())return null;const e=Xc.isConnected(),t=Xc.batteryLevel(),n=()=>{"/settings/bluetooth"!==ki.get()&&ki.set("/settings/bluetooth")},a=[Rn("button.main_header_button.fa."+(e?"fa-bluetooth":"fa-bluetooth-b"),{oncreate:qi(n),disabled:!e})];if(e&&void 0!==t){let e="fa-battery-full";t<=5?e="fa-battery-empty":t<=35?e="fa-battery-quarter":t<=65?e="fa-battery-half":t<=95&&(e="fa-battery-three-quarters"),a.unshift(Rn(`button.main_header_button.fa.${e}`,{oncreate:qi(n)}))}return a}let Fd;function Ud(e){Fd=e}function Wd(){Fd=Fd||ct.general.theme.board();const e=Za.myTurnGames().length,t=ja.incoming().length,n=["main_header_button","game_menu_button",Fd,t?"new_challenge":""].join(" ");return Rn("button",{className:n,"data-button":"games"},!t&&e?Rn("span",{className:"chip nb_playing"},e):null,t?Rn("span",{className:"chip nb_challenges"},t):null)}function Gd(e){const t=lr(e,".main_header_button"),n=null==t?void 0:t.dataset.button;if(t&&n)if("games"===n){const e=ja.all().length;Za.nowPlaying().length||e?nu.open():Tu.open()}else"friends"===n&&Od.open()}function qd(){const e=qi(Gd,void 0,void 0,cr(".main_header_button"));return Za.isConnected()&&ea.count()?Rn("div",{className:"buttons",oncreate:e},zd(),function(){const e=ea.count();return Rn("button",{className:"main_header_button friends_button","data-icon":"f","data-button":"friends"},e>0?Rn("span",{className:"chip nb_friends"},e):null)}(),Wd()):Rn("div",{className:"buttons",oncreate:e},zd(),Wd())}function Vd(e,t){return Rn("nav",[t||Bd(),"string"==typeof e?Rn("div.main_header_title",e):e,qd()])}function Hd(e,t){return[Rn("nav",[t||Bd(),e?Rn("div",{className:"main_header_title"},e):null,qd()])]}const Yd=Rn("div",{className:"loader_circles"},[1,2,3].map((e=>Rn("div",{className:"circle_"+e}))));function Kd(e){return Rn("nav",null,Bd(),Rn("div",{className:"main_header_title reconnecting"+(e?"withTitle":"")},e?Rn("span",null,e):null,Yd),qd())}function Xd(e){return[Rn("nav",[Bd(),Rn("div.main_header_title.reconnecting",{className:e?"withTitle":""}),e?Rn("div.main_header_title",e):null,qd()])]}function Jd(e){return Rn("nav",[Rd(Rn("div.main_header_title.reconnecting",{className:e?"withTitle":""},[e?Rn("span",e):null,Yd])),qd()])}function Qd(e){const t=e.online?"online":"offline";return Rn("div",{className:"user"},e.patron?Rn("span",{className:"patron userStatus "+t,"data-icon":""}):Rn("span",{className:"fa fa-circle userStatus "+t}),xd(e.title),e.username)}const Zd="setup.custom.last";let eh,th=0,nh=0,ah=!1,ih=null,rh=null;const oh={redirect:e=>{uh(),null!==ih&&On.set(Zd,ih),Or.redirectToGame(e)},n:(e,t)=>{th=t.d,nh=t.r,Xt()}};var sh={startSeeking(e){ch(e)},appCancelSeeking(){ah&&hh()},onNewOpponent(e){if("pool"===e.game.source){const t=e.clock;ch({id:t.initial/60+"+"+t.increment})}else{ch(ih&&Nr(ih)?ih:On.get(Zd)||da(ct.gameSetup.human),e.game.id)}},view:()=>yu("",void 0,(function(){const e=Ct("nbPlayers",th,th?void 0:"?"),t=Ct("nbGamesInPlay",nh,nh?void 0:"?");return Rn("div.lobby-waitingPopup",null===ih?"Something went wrong. Please try again":[Rn("div.lobby-waitingForOpponent",kt("waitingForOpponent")),Rn("br"),lh(ih),Rn("br"),zn.getVdom(),Rn("div.lobby-nbPlayers",Or.isConnected()?[Rn("div",Rn.trust(e.replace(/(\d+)/,"<strong>$1</strong>"))),Rn("div",Rn.trust(t.replace(/(\d+)/,"<strong>$1</strong>")))]:Rn("div",[kt("reconnecting"),Yd])),Rn("button[data-icon=L]",{oncreate:qi((()=>dh()))},kt("cancel"))])}),ah)};function lh(e){const t=ct.gameSetup.human.availableVariants.find((t=>t[1]===String(e.variant))),n=t&&t[0]||"Standard",a=e.timeMode,i=0===e.mode?kt("casual"):kt("rated"),r=e.time;let o;o=1===a?function(e){return"0.75"===e?"¾":"0.5"===e?"½":"0.25"===e?"¼":e}(String(r))+"+"+e.increment:2===a?Ct("nbDays",e.days):"∞";const s=` • ${n} • ${i}`;return Rn("div.gameInfos",[Rn("span[data-icon=p]",o),s])}function ch(e,t){var n;ki.backbutton.stack.push(dh),ah=!0,fr(),null===(n=Za.refresh())||void 0===n||n.then((()=>function(e,t){ih=e,rh&&mh();eh=Or.createLobby(yr,(()=>{ah&&(rh||(t?function(e,t){const n=Za.get(),a=n?ha(n,t):null;Xn(`/setup/hook/${Zt()}/like/${e}?rr=${a||""}`,{method:"POST"},!0)}(t,e):fa(e).then((e=>{rh=e.hook.id})).catch(on)))}),oh)}(e,t)))}function uh(e){"backbutton"!==e&&ah&&ki.backbutton.stack.pop(),ah=!1}function dh(e){uh(e),hh(),ki.reload(),gr()}function hh(){null!==ih&&rh&&mh()}function mh(){var e,t;e="cancel",t=rh,eh&&eh.send(e,t),rh=null}const ph=a("Badge");let fh=!0;function gh(e,t,a,i,r,o){window.lidraughts.cpuArch=o,window.deviceInfo={platform:t.platform,osVersion:t.osVersion,identifier:a.identifier,appVersion:e.version,cpuCores:i,scanMaxMemory:16*Math.ceil(r/16)},"ios"===n.getPlatform()&&m.setAccessoryBarVisible({isVisible:!0}),Tn((()=>{ji(),oa.load()})),s.addListener("appStateChange",(e=>{e.isActive?(oa.resume(),aa=!0,Za.refresh().then((()=>{"ios"===n.getPlatform()&&ph.setNumber({badge:Za.myTurnGames().length})})),Or.cancelDelayedDisconnect(),Or.connect(),Xt()):(aa=!1,Or.delayedDisconnect(18e4),sh.appCancelSeeking())})),u.addListener("networkStatusChange",(e=>{e.connected?bh():ia()&&!rn()&&(Or.disconnect(),Xt())})),s.addListener("backButton",ki.backbutton),window.addEventListener("resize",U(vh),!1),rn()?bh():Za.restoreStoredSession()}function vh(){Ei=null,Pi=void 0,Xt()}function bh(){ia()&&(fh?(fh=!1,function(){const e=window.deviceInfo.appVersion||"web-dev";Xn("/api/status",{query:{v:e}}).then((t=>{if(t.mustUpgrade){const t="warn_bug_"+e,n=Number(On.get(t))||0;0===n?ua.alert({title:"Alert",message:"A new version of lidraughts mobile is available. Please upgrade as soon as possible."}).then((()=>{On.set(t,1)})):10===n?On.remove(t):On.set(t,n+1)}else if(t.api.current>zt.apiVersion){const e=t.api.olds.find((e=>e.version===zt.apiVersion));if(e){const t=new Date,n=new Date(e.unsupportedAt),a=new Date(e.deprecatedAt),i="warn_old_"+e.version,r=Number(On.get(i))||0;t>n?ua.alert({title:"Alert",message:kt("apiUnsupported")}):t>a&&(0===r?ua.alert({title:"Alert",message:kt("apiDeprecated",xt(n))}).then((()=>{On.set(i,1)})):15===r?On.remove(i):On.set(i,r+1))}}}))}(),wh(),Za.rememberLogin().then((()=>{Qn.register(),ja.refresh(),"ios"===n.getPlatform()&&ph.setNumber({badge:Za.myTurnGames().length}),Xt()})).catch((()=>{"ios"===n.getPlatform()&&ph.setNumber({badge:0})}))):(Or.connect(),Za.refresh()))}let yh=1;function wh(){return Sa().then(Xt).catch((()=>{yh<=5&&(yh++,setTimeout(wh,1e3*yh))}))}var kh,Sh;!function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE",e.ExternalCache="EXTERNAL_CACHE",e.LibraryNoCloud="LIBRARY_NO_CLOUD",e.Temporary="TEMPORARY"}(kh||(kh={})),function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"}(Sh||(Sh={}));const Ch=a("Filesystem",{web:()=>import("./web-8fc9d095.js").then((e=>new e.FilesystemWeb))});var Th,Mh;!function(e=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||e?void 0!==window.cordova&&function(e){e.CapacitorUtils.Synapse=new Proxy({},{get:(t,n)=>e.cordova.plugins[n]})}(window):function(e){e.CapacitorUtils.Synapse=new Proxy({},{get:(t,n)=>new Proxy({},{get:(t,a)=>(t,i,r)=>{const o=e.Capacitor.Plugins[n];void 0!==o?"function"==typeof o[a]?(async()=>{try{const e=await o[a](t);i(e)}catch(e){r(e)}})():r(new Error(`Method ${a} not found in Capacitor plugin ${n}`)):r(new Error(`Capacitor plugin ${n} not found`))}})})}(window))}(),function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"}(Th||(Th={})),function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"}(Mh||(Mh={}));const xh=a("StatusBar"),Ph="https://roepstoep.github.io/lidrobile-themes";let Eh,Oh;function Nh(e){return"dark"!==e&&"light"!==e&&"system"!==e}function _h(e,t){return Promise.all(t.map((t=>Ch.readFile({path:e+"-"+t,directory:kh.Data}).then((e=>"string"==typeof e.data?Promise.resolve(e.data):e.data.text())))))}function Lh(e){return Ch.readdir({path:"",directory:kh.Data}).then((({files:t})=>t.map((e=>e.name)).filter((t=>t.startsWith(e)))))}function Ih(e){return[e.key+"_64."+e.ext,e.key+"_100."+e.ext]}function Dh(e,t,n){const a=Bh(e,t);return _h(e,a).catch((()=>Promise.all(a.map((t=>function(e,t,n){return new Promise(((a,i)=>{const r=new XMLHttpRequest,o="bg"===e?"/background":"/board";r.open("GET",`${Ph}${o}/${t}`,!0),r.responseType="blob",n&&(r.onprogress=n),r.onload=()=>{if(200===r.status){const n=r.response;if(n){const i=new FileReader;i.readAsDataURL(n),i.onloadend=()=>{const n=i.result;Ch.writeFile({path:e+"-"+t,data:n,directory:kh.Data}).then((()=>a()))}}else i("could not get file")}else i(`Request returned ${r.status}`)},r.send()}))}(e,t,n)))).then((()=>_h(e,a))))).then((n=>{Ah(e,t,a,n)}))}function jh(e){W.show({text:"Cannot load theme file",duration:"short"})}function Ah(e,t,n,a){Eh||(Eh=document.createElement("style"),Eh.type="text/css",document.head.appendChild(Eh));const i=a,r="png"===n[0].split(".").pop()?"data:image/png;base64,":"data:image/jpeg;base64,",o=i.map((e=>r+e)),s="bg"===e?`.view-container.transp.${t} > main { background-image: url(${o[0]}); }`:`:root { --board-background-64: url(${o[0]}); --board-background-100: url(${o[1]}); }\n.board-${t}.is64 > .cg-board { background-image: var(--board-background-64); }\n.board-${t}.is100 > .cg-board { background-image: var(--board-background-100); }\n.game_menu_button.${t}::before { background-image: var(--board-background-64); background-size: 40px; }`;Eh.appendChild(document.createTextNode(s))}function Bh(e,t){const n=("bg"===e?ct.general.theme.availableBackgroundThemes:ct.general.theme.availableBoardThemes).find((e=>e.key===t));return"bg"===e?[(a=n,a.key+"."+a.ext)]:Ih(n);var a}function Rh(){if(void 0===Oh){const e=window.matchMedia("(prefers-color-scheme: light)");Oh=e.matches?"light":"dark",e.addEventListener("change",(e=>{Oh=e.matches?"light":"dark"}))}return Oh}function $h(e){const t="system"===e?Rh():e;return Promise.all(["android"===n.getPlatform()?xh.setBackgroundColor({color:"light"===t?"#edebe9":"dark"===t?"#161512":"#000000"}):Promise.resolve(),xh.setStyle({style:"light"===t?Th.Light:Th.Dark})]).then((()=>{}))}var zh={init(){!function(e){e(si)}((e=>{e.add("",(({params:e})=>{import("./home-797f0cbc.js").then((t=>{hi(t.default,e)}))})),e.add("timeline",(({params:e})=>{import("./timeline-1fba8e10.js").then((t=>{hi(t.default,e)}))})),e.add("otb",(({params:e})=>{import("./otb-24401367.js").then((t=>{hi(t.default,e)}))})),e.add("otb/variant/:variant/fen/:fen",(({params:e})=>{import("./otb-24401367.js").then((t=>{hi(t.default,e)}))})),e.add("ai",(({params:e})=>{import("./ai-962b88a4.js").then((t=>{hi(t.default,e)}))})),e.add("ai/variant/:variant/fen/:fen/color/:color",(({params:e})=>{import("./ai-962b88a4.js").then((t=>{hi(t.default,e)}))})),e.add("game/:id",(({params:e})=>{import("./game-3b7a6b7f.js").then((t=>{hi(t.default,e)}))})),e.add("tournament/:tournamentId/game/:id",(({params:e})=>{import("./game-3b7a6b7f.js").then((t=>{hi(t.default,e)}))})),e.add("analyse/fen/:fen",(({params:e})=>{import("./analyse-3b059cb0.js").then((t=>{hi(t.default,e)}))})),e.add("analyse/variant/:variant/fen/:fen",(({params:e})=>{import("./analyse-3b059cb0.js").then((t=>{hi(t.default,e)}))})),e.add("analyse/variant/:variant",(({params:e})=>{import("./analyse-3b059cb0.js").then((t=>{hi(t.default,e)}))})),e.add("analyse/:source/:id/:color",(({params:e})=>{import("./analyse-3b059cb0.js").then((t=>{hi(t.default,e)}))})),e.add("analyse/:source/:id",(({params:e})=>{import("./analyse-3b059cb0.js").then((t=>{hi(t.default,e)}))})),e.add("analyse",(({params:e})=>{import("./analyse-3b059cb0.js").then((t=>{hi(t.default,e)}))})),e.add("importer",(({params:e})=>{import("./importer-c0fa0dfa.js").then((t=>{hi(t.default,e)}))})),e.add("tv",(({params:e})=>{import("./tv-98b40cbf.js").then((t=>{hi(t.default,e)}))})),e.add("tv/:channel",(({params:e})=>{import("./tv-98b40cbf.js").then((t=>{hi(t.default,e)}))})),e.add("@/:id",(({params:e})=>{import("./user-0faec753.js").then((t=>{hi(t.default,e)}))})),e.add("@/:id/related",(({params:e})=>{import("./related-fe1f4bec.js").then((t=>{hi(t.default,e)}))})),e.add("@/:id/games",(({params:e})=>{import("./games-76f3e967.js").then((t=>{hi(t.default,e)}))})),e.add("@/:id/games/:filter",(({params:e})=>{import("./games-76f3e967.js").then((t=>{hi(t.default,e)}))})),e.add("@/:id/:perf/perf",(({params:e})=>{import("./perfStats-93f70724.js").then((t=>{hi(t.default,e)}))})),e.add("@/:id/tv",(({params:e})=>{import("./userTv-1e4bb781.js").then((t=>{hi(t.default,e)}))})),e.add("about",(({params:e})=>{import("./about-cc529c27.js").then((t=>{hi(t.default,e)}))})),e.add("account/preferences",(({params:e})=>{import("./preferences-f4db8240.js").then((t=>{hi(t.default,e)}))})),e.add("account/preferences/game-display",(({params:e})=>{import("./gameDisplay-27ef15a0.js").then((t=>{hi(t.default,e)}))})),e.add("account/preferences/game-behavior",(({params:e})=>{import("./gameBehavior-4dbab411.js").then((t=>{hi(t.default,e)}))})),e.add("account/preferences/clock",(({params:e})=>{import("./clock-54d34252.js").then((t=>{hi(t.default,e)}))})),e.add("account/preferences/privacy",(({params:e})=>{import("./privacy-db5ddd59.js").then((t=>{hi(t.default,e)}))})),e.add("account/preferences/kidMode",(({params:e})=>{import("./kid-3e237f16.js").then((t=>{hi(t.default,e)}))})),e.add("clock",(({params:e})=>{import("./clock-8602e64a.js").then((t=>{hi(t.default,e)}))})),e.add("editor",(({params:e})=>{import("./editor-f1227f80.js").then((t=>{hi(t.default,e)}))})),e.add("editor/variant/:variant/fen/:fen",(({params:e})=>{import("./editor-f1227f80.js").then((t=>{hi(t.default,e)}))})),e.add("editor/variant/:variant",(({params:e})=>{import("./editor-f1227f80.js").then((t=>{hi(t.default,e)}))})),e.add("editor/:fen",(({params:e})=>{import("./editor-f1227f80.js").then((t=>{hi(t.default,e)}))})),e.add("inbox",(({params:e})=>{import("./inbox-0e894e1f.js").then((t=>{hi(t.default,e)}))})),e.add("inbox/:id",(({params:e})=>{import("./thread-835ba74b.js").then((t=>{hi(t.default,e)}))})),e.add("inbox/new",(({params:e})=>{import("./compose-6467240e.js").then((t=>{hi(t.default,e)}))})),e.add("inbox/new/:userId",(({params:e})=>{import("./compose-6467240e.js").then((t=>{hi(t.default,e)}))})),e.add("players",(({params:e})=>{import("./players-59dcf008.js").then((t=>{hi(t.default,e)}))})),e.add("search",(({params:e})=>{import("./search-a8917e66.js").then((t=>{hi(t.default,e)}))})),e.add("settings",(({params:e})=>{import("./settings-a701f062.js").then((t=>{hi(t.default,e)}))})),e.add("settings/gameDisplay",(({params:e})=>{import("./gameDisplay-0402c8af.js").then((t=>{hi(t.default,e)}))})),e.add("settings/clock",(({params:e})=>{import("./clock-2aaf8894.js").then((t=>{hi(t.default,e)}))})),e.add("settings/gameBehavior",(({params:e})=>{import("./gameBehavior-0b6b182a.js").then((t=>{hi(t.default,e)}))})),e.add("settings/bluetooth",(({params:e})=>{import("./bluetooth-0ba7e98f.js").then((t=>{hi(t.default,e)}))})),e.add("settings/soundNotifications",(({params:e})=>{import("./soundNotifications-68016a49.js").then((t=>{hi(t.default,e)}))})),e.add("settings/background",(({params:e})=>{import("./background-282dd4d3.js").then((t=>{hi(t.default,e)}))})),e.add("settings/themes/board",(({params:e})=>{import("./boardTheme-51fac626.js").then((t=>{hi(t.default,e)}))})),e.add("settings/themes/piece",(({params:e})=>{import("./pieceThemes-343d14a9.js").then((t=>{hi(t.default,e)}))})),e.add("settings/lang",(({params:e})=>{import("./lang-a766d5e1.js").then((t=>{hi(t.default,e)}))})),e.add("teams",(({params:e})=>{import("./teamsList-54562e8a.js").then((t=>{hi(t.default,e)}))})),e.add("teams/:id",(({params:e})=>{import("./teamDetail-bb64cc88.js").then((t=>{hi(t.default,e)}))})),e.add("training",(({params:e})=>{import("./training-59e74aa8.js").then((t=>{hi(t.default,e)}))})),e.add("training/variant/:variant",(({params:e})=>{import("./training-59e74aa8.js").then((t=>{hi(t.default,e)}))})),e.add("training/:id/variant/:variant",(({params:e})=>{import("./training-59e74aa8.js").then((t=>{hi(t.default,e)}))})),e.add("training/:id",(({params:e})=>{import("./training-59e74aa8.js").then((t=>{hi(t.default,e)}))})),e.add("tournament",(({params:e})=>{import("./tournamentList-00c70f84.js").then((t=>{hi(t.default,e)}))})),e.add("tournament/:id",(({params:e})=>{import("./tournamentDetail-0c51fb07.js").then((t=>{hi(t.default,e)}))})),e.add("study",(({params:e})=>{import("./studyIndex-78c2f701.js").then((t=>{hi(t.default,e)}))})),e.add("study/:id",(({params:e})=>{import("./study-f50de57a.js").then((t=>{hi(t.default,e)}))})),e.add("study/:id/:chapterId",(({params:e})=>{import("./study-f50de57a.js").then((t=>{hi(t.default,e)}))}))})),window.addEventListener("popstate",mi)}};let Fh=!1,Uh=!1,Wh=null;var Gh={open:function(){ki.backbutton.stack.push($i(Hh,"loginModal")),Fh=!0,Uh=!1,Wh=null},close:Hh,view:()=>Fh?Rn("div.modal#loginModal",{oncreate:Ri},[Rn("header",[Rn("button.modal_close",{oncreate:qi($i(Hh,"loginModal"))},Dd),Rn("h2",kt("signIn"))]),Rn("div.modal_content",[Rn("form.defaultForm.login",{onsubmit:qh},[Wh&&!Vh(Wh)?Rn("div.form-error",Wh):null,"InvalidTotpToken"===Wh?Rn("div.form-error",kt("invalidAuthenticationCode")):null,Rn("div.field",[Rn("input#username",{type:Vh(Wh)?"hidden":"text",className:Wh?"form-error":"",placeholder:kt("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),Rn("div.field",[Rn("input#password",{type:Vh(Wh)?"hidden":"password",className:Wh?"form-error":"",placeholder:kt("password"),required:!0})]),Vh(Wh)?[Rn("div.field",[Rn("input#token[type=number]",{className:"MissingTotpToken"!==Wh?"form-error":"",placeholder:kt("authenticationCode"),pattern:"\\d{6}",required:!0})]),Rn("p.twofactorhelp",[Rn("i.fa.fa-mobile-phone"),Rn.trust("&nbsp"),"Open the two-factor authentication app on your device to view your authentication code and verify your identity."])]:null,Rn("div.submit",[Rn("button.defaultButton",{disabled:Uh},kt("signIn"))])]),Rn("div.loginActions",[Rn("a",{oncreate:qi(Qh.open)},[kt("signUp")]),Rn("a",{href:"https://lidraughts.org/password/reset"},[kt("passwordReset")])])])]):null};function qh(e){var t;if(Uh)return!1;e.preventDefault();const n=e.target,a=n.username.value.trim(),i=n.password.value,r=n.token?n.token.value:null;a&&i&&(Xt(),m.hide(),Uh=!0,null===(t=Za.login(a,i,r))||void 0===t||t.then((()=>(Uh=!1,Hh(),W.show({text:kt("loginSuccessful"),position:"top",duration:"short"}),Gt.afterLogin.dispatch(),Xt(),Or.reconnectCurrent(),Qn.register(),ja.refresh(),Za.refresh()))).then((()=>{var e;const t=null===(e=Za.get())||void 0===e?void 0:e.prefs;if(t){ct.analyse.fullCapture(!!t.fullCapture),ct.game.draughtsResult(!!t.gameResult);const e=t.coordSystem;"number"==typeof e&&ct.game.coordSystem(e)}})).catch((e=>{Uh=!1,e.body.ipban?Hh():400!==e.status&&401!==e.status?on(e):e.body.global&&(Wh=e.body.global[0],Xt())})))}function Vh(e){return"MissingTotpToken"===e||"InvalidTotpToken"===e}function Hh(e){m.hide(),"backbutton"!==e&&Fh&&ki.backbutton.stack.pop(),Fh=!1}let Yh=!1,Kh=!1,Xh=!1,Jh=null;var Qh={open:function(){ki.backbutton.stack.push($i(am,"signupModal")),Jh=null,Yh=!0,Kh=!1},close:am,view:()=>Yh?Rn("div.modal#signupModal",{oncreate:Ri},[Rn("header",[Rn("button.modal_close",{oncreate:qi($i(am,"signupModal"))},Dd),Rn("h2",kt("signUp"))]),Rn("div#signupModalContent.modal_content",{},Xh?[Rn("h1.signup-emailCheck.withIcon[data-icon=E]",kt("checkYourEmail")),Rn("p",kt("weHaveSentYouAnEmailClickTheLink")),Rn("p",kt("ifYouDoNotSeeTheEmailCheckOtherPlaces")),Rn("p",[kt("itCanTakeAWhileToArrive")," ",kt("refreshInboxAfterFiveMinutes")]),Rn("p",[kt("notReceivingIt")," ",kt("visitUrlToRequestManualConfirmation","https://lidraughts.org/contact")])]:[Rn("p.signupWarning.withIcon[data-icon=!]",[kt("computersAreNotAllowedToPlay")]),Rn("p.tosWarning",[St("byRegisteringYouAgreeToBeBoundByOur",Rn("a",{oncreate:qi((()=>window.open("https://lidraughts.org/terms-of-service","_blank")))},kt("termsOfService")))]),Rn("form.defaultForm.login",{onsubmit:nm},[Rn("div.field",[Jh&&Jh.username?Rn("div.form-error",Jh.username[0]):null,Rn("input#pseudo[type=text]",{className:Jh&&Jh.username?"form-error":"",placeholder:kt("username"),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0,onfocus:tm,oninput:U(Zh,500)})]),Rn("div.field",[Jh&&Jh.email?Rn("div.form-error",Jh.email[0]):null,Rn("input#email[type=email]",{onfocus:tm,className:Jh&&Jh.email?"form-error":"",placeholder:kt("email"),autocapitalize:"off",autocorrect:"off",spellcheck:!1,required:!0})]),Rn("div.field",[Jh&&Jh.password?Rn("div.form-error",Jh.password[0]):null,Rn("input#password[type=password]",{onfocus:tm,className:Jh&&Jh.password?"form-error":"",placeholder:kt("password"),required:!0})]),Rn("div.submit",[Rn("button.defaultButton",{disabled:Kh},kt("signUp"))])])])]):null};function Zh(e){const t=(e.target.value||"").trim();var n;t&&t.match(/^[a-z0-9][\w-]{1,29}$/i)?(n=t,Xn("/player/autocomplete?exists=1",{query:{term:n}})).then((e=>{em(e)})):em(!1)}function em(e){Jh=e?{username:[kt("usernameAlreadyUsed")]}:null,Xt()}function tm(e){setTimeout((()=>{e.target.scrollIntoView(!0)}),300)}function nm(e){e.preventDefault();const t=e.target,n=t[0].value.trim(),a=t[1].value.trim(),i=t[2].value;!Kh&&n&&a&&i&&(m.hide(),Kh=!0,Jh=null,Xt(),Za.signup(n,a,i).then((e=>{Kh=!1,e&&function(e){return void 0!==e.email_confirm}(e)?(Xh=!0,Xt()):(W.show({text:kt("loginSuccessful"),duration:"short"}),Or.reconnectCurrent(),Xt(),Gh.close(),am())})).catch((e=>{Kh=!1,void 0!==e.body.error?(Jh=e.body.error,Xt()):on(e)})))}function am(e){!0===Xh&&Gh.close(),m.hide(),"backbutton"!==e&&Yh&&ki.backbutton.stack.pop(),Yh=!1}var im={init(){s.addListener("appUrlOpen",(({url:e})=>{setTimeout((()=>{const t=new URL(e),n=t.pathname;if(!rm.run(n)){const e=om.exec(n);if(e&&!lm.includes(e[1].toLowerCase())){const n=e[2],a=sm.exec(t.hash),i={};n&&(i.color=n.substring(1)),a&&(i.ply=a[1]);const r=Un(i);ki.set(`/game/${e[1]}?${r}`)}}}),100)}))}};const rm=new ii,om=/^\/(\w{8})(\/black|\/white)?$/,sm=/^#(\d+)$/,lm=["features","practice","streamer"];rm.add("analysis",(()=>ki.set("/analyse"))),rm.add("analysis/:variant",(({params:e})=>{const t=e.variant;if(ct.analyse.supportedVariants.includes(t))ki.set(`/analyse/variant/${t}`);else{const e=encodeURIComponent(t);ki.set(`/analyse/fen/${e}`)}})),rm.add("analysis/:variant/:fen",(({params:e})=>{const t=encodeURIComponent(e.fen);ct.analyse.supportedVariants.includes(e.variant)?ki.set(`/analyse/variant/${e.variant}/fen/${t}`):ki.set(`/analyse/fen/${t}`)})),rm.add("editor",(()=>ki.set("/editor"))),rm.add("editor/:variant",(({params:e})=>{const t=e.variant;if(ct.analyse.supportedVariants.includes(t))ki.set(`/editor/variant/${t}`);else{const e=encodeURIComponent(t);ki.set(`/editor/${e}`)}})),rm.add("editor/:variant/:fen",(({params:e})=>{const t=encodeURIComponent(e.fen);ct.analyse.supportedVariants.includes(e.variant)?ki.set(`/editor/variant/${e.variant}/fen/${t}`):ki.set(`/editor/${t}`)})),rm.add("inbox",(()=>ki.set("/inbox"))),rm.add("inbox/new",(()=>ki.set("/inbox/new"))),rm.add("challenge/:id",(({params:e})=>ki.set(`/game/${e.id}`))),rm.add("study",(()=>ki.set("/study"))),rm.add("study/:id",(({params:e})=>ki.set(`/study/${e.id}`))),rm.add("study/:id/:chapterId",(({params:e})=>ki.set(`/study/${e.id}/${e.chapterId}`))),rm.add("player",(()=>ki.set("/players"))),rm.add("tournament",(()=>ki.set("/tournament"))),rm.add("tournament/:id",(({params:e})=>ki.set(`/tournament/${e.id}`))),rm.add("training",(()=>ki.set("/training"))),rm.add("training/:variant",(({params:e})=>{const t=e.variant;ct.training.supportedVariants.includes(t)?ki.set(`/training/variant/${t}`):ki.set(`/training/${t}`)})),rm.add("training/:variant/:id",(({params:e})=>{ct.training.supportedVariants.includes(e.variant)?ki.set(`/training/${e.id}/variant/${e.variant}`):ki.set(`/training/${e.id}`)})),rm.add("tv",(()=>ki.set("/tv"))),rm.add("tv/:channel",(({params:e})=>ki.set(`/tv/${e.channel}`))),rm.add("@/:id",(({params:e})=>ki.set(`/@/${e.id}`))),rm.add("@/:id/tv",(({params:e})=>ki.set(`/@/${e.id}/tv`))),rm.add("@/:id/all",(({params:e})=>ki.set(`/@/${e.id}/games`))),rm.add("@/:id/perf/:key",(({params:e})=>ki.set(`/@/${e.id}/${e.key}/perf`))),rm.add("signup/confirm/:token",(({params:e})=>{const t=e.token;t&&Za.confirmEmail(t).then((e=>{Qh.close(),ki.set(`/@/${e.id}`),setTimeout((()=>{W.show({text:kt("loginSuccessful"),position:"center",duration:"long"})}),1e3)})).catch(on)}));const cm=a("CPUInfo");(async function(){await Ke.migrate();const e=await Ke.get(it);Object.assign(lt,e)})().then((()=>Promise.all([s.getInfo().catch((()=>({version:zt.packageVersion}))),l.getInfo(),l.getId(),"ios"===n.getPlatform()?cm.nbCores().then((e=>e.value)).catch((()=>1)):Promise.resolve(navigator.hardwareConcurrency||1),so.getMaxMemory().then((e=>e.value)).catch((()=>16)),so.getCPUArch().then((e=>e.value)).catch((()=>"x86"))]))).then((([e,t,n,a,i,r])=>gh(e,t,n,a,i,r))).then((()=>{zh.init(),im.init()})).then((function(){const e=ct.general.theme.background(),t=ct.general.theme.board();if($h(e),Nh(e)){const t=Bh("bg",e);_h("bg",t).then((n=>{Ah("bg",e,t,n)})).catch((()=>{ct.general.theme.background("dark")}))}if(!ct.general.theme.bundledBoardThemes.includes(t)){const e=Bh("board",t);_h("board",e).then((n=>{Ah("board",t,e,n)})).catch((()=>{ct.general.theme.board("brown")}))}})).then((async function(){const e=import("./i18n/"+dt+".js").then((({default:e})=>{Object.assign(ht,e)})),t=ct.general.locale();return t&&void 0!==At[t]?e.then((()=>Dt(t))):e.then((()=>l.getLanguageCode())).then((({value:e})=>Dt(Lt(e)||dt)))})).then(Hc.init).then((()=>mi())).then((()=>{setTimeout((()=>{c.hide()}),500)}));export{Yr as $,s as A,Ct as B,un as C,Tu as D,Hu as E,Xu as F,or as G,Sn as H,Bi as I,Hd as J,n as K,Ur as L,ji as M,u as N,Wr as O,Gr as P,Fr as Q,$r as R,Xr as S,Hr as T,Yi as U,ea as V,WebPlugin as W,Vr as X,sn as Y,ni as Z,Kr as _,Gt as a,$d as a$,Gh as a0,Zr as a1,Jr as a2,Qr as a3,nu as a4,Od as a5,W as a6,yu as a7,vu as a8,Qc as a9,rr as aA,Di as aB,Ii as aC,Gs as aD,yn as aE,bn as aF,mn as aG,gn as aH,oa as aI,el as aJ,Zs as aK,hn as aL,Zo as aM,Qi as aN,nr as aO,fr as aP,gr as aQ,Vd as aR,ju as aS,Qd as aT,Us as aU,kn as aV,md as aW,Xc as aX,ps as aY,Ht as aZ,Vi as a_,Js as aa,tt as ab,pa as ac,on as ad,zr as ae,Dd as af,Mn as ag,za as ah,Xi as ai,to as aj,Qh as ak,sh as al,Rh as am,Rd as an,Ot as ao,Ku as ap,Md as aq,St as ar,Ke as as,Xn as at,ns as au,dd as av,Ks as aw,dn as ax,xd as ay,vn as az,Za as b,Bu as b$,Bd as b0,qd as b1,ir as b2,zs as b3,Ys as b4,Yd as b5,Ws as b6,Kd as b7,_r as b8,wo as b9,Jd as bA,On as bB,ua as bC,Qo as bD,Oa as bE,Ma as bF,ws as bG,es as bH,ph as bI,Au as bJ,ms as bK,nn as bL,tn as bM,ad as bN,fo as bO,as as bP,Pa as bQ,Je as bR,ts as bS,ds as bT,sl as bU,hs as bV,uo as bW,fs as bX,ScanPlugin as bY,po as bZ,is as b_,Xs as ba,$i as bb,m as bc,Tn as bd,Ri as be,LRUMap as bf,Jn as bg,Gn as bh,a as bi,br as bj,Draughtsground as bk,fn as bl,xn as bm,Qs as bn,zt as bo,Engine as bp,pn as bq,wa as br,ja as bs,ya as bt,ba as bu,va as bv,Ta as bw,Li as bx,_i as by,ro as bz,Ca as c,jd as c$,Zt as c0,SideMenuCtrl as c1,tl as c2,Du as c3,Pt as c4,ss as c5,Iu as c6,rs as c7,Sd as c8,Td as c9,Ar as cA,Id as cB,ud as cC,cr as cD,lr as cE,Hc as cF,Wc as cG,Nh as cH,Dh as cI,jh as cJ,$h as cK,Lh as cL,Ih as cM,Ud as cN,At as cO,Lt as cP,Bt as cQ,It as cR,Ea as cS,Dt as cT,Yl as cU,Cn as cV,zi as cW,Fi as cX,sr as cY,Xd as cZ,wn as c_,Pd as ca,bd as cb,vd as cc,gd as cd,fd as ce,pd as cf,yd as cg,Ai as ch,Fs as ci,Ki as cj,kd as ck,wd as cl,xh as cm,Gi as cn,os as co,ec as cp,tc as cq,Lu as cr,Ji as cs,Ir as ct,Lr as cu,ar as cv,Dr as cw,jr as cx,Br as cy,Rr as cz,U as d,Ad as d0,o as d1,Sh as d2,mc as d3,hc as d4,uc as d5,ct as e,Kn as f,Yn as g,Pn as h,ia as i,xa as j,rn as k,Sa as l,ki as m,ln as n,Rn as o,kt as p,Hi as q,Xt as r,Or as s,Na as t,_u as u,zn as v,Nt as w,Mt as x,Ou as y,qi as z};
