import{aY as n,c7 as e}from"./main.js";import{c as t,x as i,y as c,b as r,p as l,d as o}from"./axis-d343de69.js";const s="";function u(n){return n.length/2}function d(n){return n.slice(0,2)}function f(n){return n.slice(2)}function h(n){return n.slice(0,-2)}function a(n,e){return 0===n.indexOf(e)}function p(n){let e="";for(const t in n)e+=n[t].id;return e}function m(n,e){const t=function(n){return n.children[0]}(n);return t?e(t):void 0}function y(n,e){const t=[n];let i,c=n;for(;i=e(c);)t.push(i),c=i;return t}function g(n){return n.children[0]}function v(n,e){return n.children.find((n=>n.id===e))}function k(n){return n[n.length-1]}function x(n,e){let t="";for(const i in n){if(!e(n[i]))break;t+=n[i].id}return t}function C(n,e){n.children=n.children.filter((n=>n.id!==e))}function P(n){const e={nodes:1,comments:(n.comments||[]).length};return n.children.forEach((n=>{const t=P(n);e.nodes+=t.nodes,e.comments+=t.comments})),e}function b(n,e=!1){return{id:n.id,ply:n.ply,displayPly:n.displayPly,uci:n.uci,fen:n.fen,children:e?n.children:[],comments:n.comments,gamebook:n.gamebook,dests:n.dests,destsUci:n.destsUci,captLen:n.captLen,threat:n.threat,ceval:n.ceval,eval:n.eval,opening:n.opening,glyphs:n.glyphs,clock:n.clock,parentClock:n.parentClock,shapes:n.shapes,comp:n.comp,san:n.san,threefold:n.threefold,draw:n.draw,fail:n.fail,puzzle:n.puzzle,pdnMoves:n.pdnMoves,player:n.player,end:n.end}}function E(e){let t=b(e);if(0!==e.children.length){const i=e.children[0];n(i.fen)>0&&(i.displayPly=i.ply+1),n(e.fen)>0?(A(t,i),t.children=i.children,t=E(t)):t.children.push(E(i));for(let n=1;n<e.children.length;n++)t.children.push(E(e.children[n]))}return t}function A(e,t,i=!1){if(e.mergedNodes?e.mergedNodes.push(b(t)):e.mergedNodes=[b(e),b(t)],e.id=e.id.slice(0,1)+t.id.slice(1,2),e.fen=t.fen,e.dests=t.dests,e.destsUci=t.destsUci,e.san&&t.san){const n=e.san.indexOf("x"),i=t.san.indexOf("x");-1!==n&&-1!==i&&(e.san=e.san.slice(0,n)+t.san.slice(i))}e.uci&&t.uci&&(t.uci.length>e.uci.length&&0===t.uci.indexOf(e.uci)?e.uci=t.uci:e.uci.slice(-2)===t.uci.slice(0,2)?e.uci=e.uci+t.uci.slice(2):e.uci=e.uci+t.uci.slice(-2)),e.displayPly&&0===n(t.fen)&&(e.ply=e.displayPly),t.captLen&&(e.captLen=t.captLen),e.clock=t.clock,e.parentClock=t.parentClock,e.puzzle=t.puzzle,e.eval=t.eval,t.glyphs&&(e.glyphs=t.glyphs),t.comments&&t.comments.forEach((function(n){e.comments?e.comments.filter((function(e){return e.text===n.text})).length||e.comments.push(n):e.comments=[n]})),i&&t.children&&(t.children.forEach((function(e){0!==n(e.fen)&&(e.displayPly=e.ply+1)})),e.children?e.children.concat(t.children):e.children=t.children)}function U(e){const t=b(e[0],!0),i=e.length;let c,r=t;for(t.id="",c=1;c<i;c++){const t=b(e[c],!0);0!==n(r.fen)?(A(r,t,!0),r.ply=t.ply):(0!==n(t.fen)&&(t.displayPly=t.ply+1),r.children?(r.children.forEach((function(e){0!==n(e.fen)&&(e.displayPly=e.ply+1)})),r.children.unshift(t)):r.children=[t],r=t)}return r.children=r.children||[],t}function N(t,i,c){let r;return t.eval=i.eval,i.glyphs&&(t.glyphs=i.glyphs),i.comments&&i.comments.forEach((function(n){t.comments?t.comments.filter((function(e){return e.text===n.text})).length||t.comments.push(n):t.comments=[n]})),i.children.forEach((function(l){const o=v(t,l.id);if(o)r=N(o,l,c);else if(c){let o=!1;for(let s=0;!o&&s<t.children.length;s++)if(n(t.children[s].fen)>0){let u=c.children.length?c.children[0]:void 0;for(;u&&!e(u.fen,i.fen);)u=u.children.length?u.children[0]:void 0;if(u&&e(u.fen,i.fen)&&u.children.length&&n(u.children[0].fen)>0){const n=u.children[0].ply;let i=u.children[0];const d=b(i);for(;i&&i.ply<=n&&!e(d.fen,t.children[s].fen);)i=i.children.length?i.children[0]:void 0,i&&A(d,i);if(e(d.fen,t.children[s].fen)){for(;i&&i.ply<=n;)i=i.children.length?i.children[0]:void 0,i&&A(t.children[s],i);const e=v(t,l.id);e&&(N(e,l,c),r=t.children[s],o=!0)}}}o||t.children.push(l)}else t.children.push(l)})),r}function z(n,e){return!!(e<=0||n.children[1])||!!n.children[0]&&z(n.children[0],e-1)}function L(n){return y(n,g)}function w(n,e){const t=n=>{e(n),n.children.forEach(t)};t(n)}function O(e){function t(){return function(n,e){const t=n=>e(n)?n:m(n,t);return t(n)}(e,(n=>!n.children.length))}function i(n){return c(e,n)}function c(n,e){if(""===e)return n;const t=v(n,d(e));return t?c(t,f(e)):n}function r(n){return l(e,n)}function l(n,e){if(""===e)return n;const t=v(n,d(e));return t?l(t,f(e)):void 0}function o(n,e){const t=d(e),i=v(n,t);return i?t+o(i,f(e)):""}function s(n,e){if(""===e)return!0;const t=d(e),i=n.children[0];return!(!i||i.id!==t)&&s(i,f(e))}function u(n,e){if(""===e)return n;const t=d(e),i=n.children[0];return i&&i.id===t?u(i,f(e)):n}function a(n){return y(e,(e=>{const t=d(n);if(""!==t)return n=f(n),v(e,t)}))}function p(n,e){const t=r(n);if(t)return e(t),t}function g(n,e){let t=1;do{n.id=n.id.substr(0,1)+String.fromCharCode(85+t),t++}while(e.children.some((e=>e!==n&&e.id===n.id)))}function k(e,t){let i=t+e.id,c=r(i);const l=n(e.fen);if(c&&l>0){const n=r(t);n&&n.children.some((n=>n.san===e.san&&n.fen!==e.fen))&&(g(e,n),i=t+e.id,c=r(i))}if(c)return void 0!==e.dests&&void 0===c.dests&&(c.dests=e.dests),void 0!==e.destsUci&&void 0===c.destsUci&&(c.destsUci=e.destsUci),void 0!==e.clock&&void 0===c.clock&&(c.clock=e.clock),i;l>0&&(e.displayPly=e.ply+1);const o=r(t);if(o&&o.uci&&n(o.fen)>0){const n=t.length>=2?r(t.substr(0,t.length-2)):void 0,i=n?function(n,e){for(let t=0;t<n.children.length;t++){const i=n.children[t];if(i.id===e.id&&i.uci===e.uci&&i.fen===e.fen&&i.san===e.san)return t}return-1}(n,o):-1;if(A(o,e),e.uci=o.uci,n&&-1!==i){let e=-1;for(let t=0;t<n.children.length;t++)if(t!==i){const i=n.children[t];if(i.san===o.san&&i.fen===o.fen){e=t;break}}-1!==e?(n.children[e].uci=o.uci,o.id=n.children[e].id,n.children.splice(i,1)):n.children.some((n=>n.san===o.san&&n.fen!==o.fen))&&g(o,n)}return t.length<2?o.id:t.substr(0,t.length-2)+o.id}if(!o&&t.length>=2){const n=r(t.substr(0,t.length-2));if(n&&n.captLen&&n.captLen>1&&n.children.length&&(c=n.children.find((function(n){return n.fen===e.fen&&n.san===e.san})),c))return void 0!==e.dests&&void 0===c.dests&&(c.dests=e.dests),void 0!==e.destsUci&&void 0===c.destsUci&&(c.destsUci=e.destsUci),void 0!==e.clock&&void 0===c.clock&&(c.clock=e.clock),t.substr(0,t.length-2)+c.id}return p(t,(n=>n.children.push(e)))?i:void 0}function x(n,e){return p(e,(e=>{const t=(e.comments||[]).filter((e=>e.id!==n));e.comments=t.length?t:void 0}))}function P(n){return i(h(n))}return{root:e,firstPly:()=>e.ply,lastPly:()=>t().ply,lastNode:t,nodeAtPath:i,getNodeList:a,longestValidPath:n=>o(e,n),getOpening:function(n){let e;return n.forEach((n=>{e=n.opening||e})),e},updateAt:p,setAmbs:g,addNode:k,addNodes:function n(e,t){const i=e[0];if(!i)return t;const c=k(i,t);return c?n(e.slice(1),c):void 0},setShapes:(n,e)=>p(e,(e=>{e.shapes=n})),setCommentAt:function(n,e){return n.text?p(e,(e=>{e.comments=e.comments||[];const t=e.comments.find((e=>e.id===n.id));t?t.text=n.text:e.comments.push(n)})):x(n.id,e)},deleteCommentAt:x,setGlyphsAt:function(n,e){return p(e,(e=>{e.glyphs=n}))},setClockAt:function(n,e){return p(e,(e=>{e.clock=n}))},pathIsMainline:function(n){return s(e,n)},lastMainlineNode:n=>u(e,n),pathExists:function(n){return!!r(n)},deleteNodeAt:function(n){const e=P(n),t=function(n){return n.slice(-2)}(n);C(e,t)},promoteAt:function(n,e){const t=a(n);for(let n=t.length-2;n>=0;n--){const i=t[n+1],c=t[n];if(c.children[0].id!==i.id&&(C(c,i.id),c.children.unshift(i),!e))break}},getCurrentNodesAfterPly:function(n,e,t){const i=[];for(const c in n){const r=n[c],l=r.displayPly||r.ply;if(l<=t&&e[c].id!==r.id)break;l>t&&i.push(r)}return i},merge(n){N(e,n)},removeCeval(){w(e,(n=>{n.ceval=void 0,n.threat=void 0}))},removeComputerVariations(){L(e).forEach((n=>{n.children=n.children.filter((n=>!n.comp))}))},parentNode:P,getParentClock:function(n,e){if(!("parentClock"in n)||!n.parentClock){const t=e&&P(e);n.parentClock=t?"clock"in t?t.clock:void 0:n.clock}return n.parentClock}}}function S(){var n=i,e=null,s=t(0),u=c,d=t(!0),f=null,h=r,a=null;function p(t){var i,c,r,o,p,m=t.length,y=!1,g=new Array(m),v=new Array(m);for(null==f&&(a=h(p=l())),i=0;i<=m;++i){if(!(i<m&&d(o=t[i],i,t))===y)if(y=!y)c=i,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),r=i-1;r>=c;--r)a.point(g[r],v[r]);a.lineEnd(),a.areaEnd()}y&&(g[i]=+n(o,i,t),v[i]=+s(o,i,t),a.point(e?+e(o,i,t):g[i],u?+u(o,i,t):v[i]))}if(p)return a=null,p+""||null}function m(){return o().defined(d).curve(h).context(f)}return p.x=function(i){return arguments.length?(n="function"==typeof i?i:t(+i),e=null,p):n},p.x0=function(e){return arguments.length?(n="function"==typeof e?e:t(+e),p):n},p.x1=function(n){return arguments.length?(e=null==n?null:"function"==typeof n?n:t(+n),p):e},p.y=function(n){return arguments.length?(s="function"==typeof n?n:t(+n),u=null,p):s},p.y0=function(n){return arguments.length?(s="function"==typeof n?n:t(+n),p):s},p.y1=function(n){return arguments.length?(u=null==n?null:"function"==typeof n?n:t(+n),p):u},p.lineX0=p.lineY0=function(){return m().x(n).y(s)},p.lineY1=function(){return m().x(n).y(u)},p.lineX1=function(){return m().x(e).y(s)},p.defined=function(n){return arguments.length?(d="function"==typeof n?n:t(!!n),p):d},p.curve=function(n){return arguments.length?(h=n,null!=f&&(a=h(f)),p):h},p.context=function(n){return arguments.length?(null==n?f=a=null:a=h(f=n),p):f},p}export{U as a,O as b,a as c,S as d,P as e,p as f,E as g,z as h,h as i,v as j,N as k,k as l,L as m,s as r,u as s,x as t,w as u,m as w};
