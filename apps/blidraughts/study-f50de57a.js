import{aR as t,an as s,o as e,z as a,a6 as r,U as n,B as o,c$ as i,d0 as d,ci as u,G as l,m as c,H as m,aP as h,r as p,ad as b,by as y,bx as f,aQ as v,s as w,aN as j,bK as M}from"./main.js";import{l as C,C as g,E as k}from"./layout-26cca27d.js";import{A as x,a as T,o as $,l as N}from"./AnalyseCtrl-23c25d16.js";import{c as A}from"./studyXhr-5c18575b.js";import"./continuePopup-d2e303e3.js";import"./notes-2c1d8afe.js";import"./TabView-6f41acb9.js";import"./chat-1f5c68bb.js";import"./game-3e605d21.js";import"./area-59c9c857.js";import"./axis-d343de69.js";import"./Board-25b97c43.js";import"./draughts-5f7918a7.js";import"./vibrate-985a16e3.js";import"./index-28ac80d9.js";var F={oninit({attrs:t}){const{studyCtrl:s}=t,e=Object.keys(s.data.members).length;this.showMembers=e<=5},onbeforeupdate:({attrs:t})=>t.studyCtrl.sideMenu.isOpen,view({attrs:t}){const{studyCtrl:s}=t,a=s.data,r=function(t){return Object.keys(t).map((s=>t[s])).sort(((t,s)=>"r"===t.role&&"w"===s.role?1:"w"===t.role&&"r"===s.role?-1:t.addedAt>s.addedAt?1:-1))}(a.members);return e("aside#studyMenu",{oncreate:({dom:t})=>{g(t,s.sideMenu)}},[e("div.native_scroller",[e("h2.study-menu-title.study-members",{oncreate:n((()=>this.showMembers=!this.showMembers))},[e("span",o("nbMembers",r.length)),this.showMembers?i:d]),this.showMembers?e("ul",r.map((t=>e("li.study-menu-link",{className:"w"===t.role?"contrib":"viewer"},[e("span.bullet.fa",{className:"w"===t.role?"fa-user":"fa-eye"}),e("span",t.user?u(t.user):"?")])))):null,e("h2.study-menu-title.study-chapters",o("nbChapters",a.chapters.length)),e("ol",{oncreate:n((t=>{const e=l(t),r=e&&e.dataset.id;r&&s.sideMenu.close().then((()=>{const t=s.analyseCtrl.currentTab(s.analyseCtrl.availableTabs()).id;c.set(`/study/${a.id}/${r}?tabId=${t}`,!0)}))}),void 0,l)},a.chapters.map(((t,s)=>e("li.study-menu-link",{"data-id":t.id,className:a.chapter.id===t.id?"current":""},[e("span.bullet",s+1),e("span",t.name)]))))])])}};var P={oninit(t){const s=t.attrs.id,e=t.attrs.chapterId,a=performance.now(),r=m(t.attrs.ply),n=t.attrs.tabId;h(),A(s,e).then((t=>{const s=performance.now()-a;setTimeout((()=>{this.ctrl=new x(t.analysis,t.study,"online",t.study.chapter.setup.orientation,!0,r||0,n),this.handlers=k(this.ctrl.study.sideMenu),p()}),Math.max(400-s,0))})).catch((t=>{404===t.status?(this.notFound=!0,p()):b(t)}))},oncreate(t){c.getPreviousPath().startsWith("/study/")?y(t.dom):f(t.dom)},onremove(){v(),w.destroy(),this.ctrl&&(this.ctrl.unload(),this.ctrl=void 0)},view(n){if(this.notFound)return C.free(t(null,s("Not Found")),e("div"));const o=j(),i=this.ctrl;return i?C.board(function(n){const o=n.name,i=n.chapters.find((t=>t.id===n.chapter.id)).name;return t(null,s(e("div.main_header_title.withSub",{},[e("h1.header-gameTitle",{oncreate:a((()=>{r.show({text:`${o}: ${i}`,duration:"long",position:"top"})}))},o),e("h2.header-subTitle",i)])))}(i.study.data),T(i,o),void 0,[...$(i),e(F,{studyCtrl:i.study}),e("div#studyMenu-backdrop.menu-backdrop",{oncreate:a((()=>i.study.sideMenu.close()))})],this.handlers):N(o,void 0,M(n.attrs.curFen,!1),n.attrs.variant)}};export{P as default};
