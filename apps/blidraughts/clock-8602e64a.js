import{a7 as e,o as a,z as c,a8 as n,p as t,e as o,m as i,cm as l,r as s,ag as r,cn as u,bi as k,I as d,aP as m,K as g,A as f,aQ as p}from"./main.js";import{l as b}from"./layout-26cca27d.js";import{c as h,a as v,f as w,i as S}from"./clockSet-8fd6c224.js";var T={controller(e,a){let c=!1;function n(e){"backbutton"!==e&&c&&i.backbutton.stack.pop(),c=!1}return{open:function(){a().isRunning()&&!a().flagged()||(i.backbutton.stack.push(n),c=!0)},close:n,isOpen:function(){return c},reload:e}},view:i=>i.isOpen()?e("new_offline_game clock_settings",void 0,(function(){return a("div",null,a("div",{className:"action"},a("div",{className:"select_input"},n.renderSelect(t("clock"),"clock",o.clock.availableClocks,o.clock.clockType,!1,N)),h(o.clock.clockType(),N)),a("button",{className:"newClockButton","data-icon":"E",oncreate:c((function(){i.reload(),i.close()}))},"Set Clock"))}),i.isOpen(),i.close):null};function N(){l.hide(),s()}function j(){}function y(e,c){const n=e.getState(),t="white"===c?n.whiteStage:n.blackStage;return a("div",{className:"clockStageInfo"},a("span",null,"Stage ",t+1))}function C(e){return null!==e?a("div",{className:"clockStageInfo"},a("span",null,"Moves remaining: ",e)):null}function R(e,a){("white"!==e.clockObj().activeSide()&&"black"===a||"black"!==e.clockObj().activeSide()&&"white"===a)&&e.clockTap(a)}const M=k("FullScreen");function O(){l.hide()}const A={oncreate:d,async oninit(){m(),"android"===g.getPlatform()&&M.hideSystemUI(),O(),this.appStateListener=await f.addListener("appStateChange",(e=>{e.isActive&&O()})),window.addEventListener("resize",O),this.ctrl=function(){const e=r(o.clock.clockType()),a=r(v[e()](j));let c=1;function n(){a()&&a().isRunning()&&!a().flagged()||(e(o.clock.clockType()),a(v[e()](j)),c=1)}return{startStop:function(){a().startStop()},clockSettingsCtrl:T.controller(n,a),clockObj:a,reload:n,goHome:function(){a().isRunning()&&!a().flagged()||i.set("/")},clockTap:function(e){a().clockHit(e),c+=.5},clockType:e,getMove:function(){return Math.floor(c)}}}()},onremove(){const e=this.ctrl.clockObj();void 0!==e&&e.clear(),p(),this.appStateListener.remove(),window.removeEventListener("resize",O),l.show(),"android"===g.getPlatform()&&M.showSystemUI()},view(){return b.clock((()=>function(e){const n=e.clockObj();if(!n)return null;const t="white"===n.activeSide(),o="black"===n.activeSide(),i="white"===n.flagged(),l="black"===n.flagged(),s=i||l,r=["clockTapArea","white",t?"active":"",n.isRunning()?"running":"",i?"flagged":""].join(" "),k=["clockTapArea","black",o?"active":"",n.isRunning()?"running":"",l?"flagged":""].join(" "),d=["clockTime",i?"flagged":"",n.whiteTime()>=3600?"long":""].join(" "),m=["clockTime",n.whiteTime()<6e4&&!i?"short":"noshort"].join(" "),g=["clockTime",l?"flagged":"",n.blackTime()>=3600?"long":""].join(" "),f=["clockTime",n.blackTime()<6e4&&!l?"short":"noshort"].join(" ");return a("div",{className:"clockContainer"},a("div",{className:r,oncreate:u((()=>R(e,"white")))},S(n)?y(n,"white"):null,S(n)?C(n.whiteMoves()):null,a("div",{className:"clockTapAreaContent"},a("span",{className:d},i?"b":w(e.clockType(),n.whiteTime()/1e3)),a("span",{className:m},"."+Math.trunc(n.whiteTime()/100%10)))),a("div",{className:"clockControls"},a("button",{className:"fa"+(n.isRunning()?" fa-pause":" fa-play"),oncreate:c((()=>e.startStop())),disabled:s||!n.activeSide()}),a("button",{className:"fa fa-refresh"+(n.isRunning()&&!s?" disabled":""),oncreate:c(e.reload)}),a("button",{className:"fa fa-cog"+(n.isRunning()&&!s?" disabled":""),oncreate:c(e.clockSettingsCtrl.open)}),a("button",{hey:"home",className:"fa fa-home"+(n.isRunning()&&!s?" disabled":""),oncreate:c(e.goHome)}),a("span",{className:"moveNumber"},e.getMove())),a("div",{className:k,oncreate:u((()=>R(e,"black")))},a("div",{className:"clockTapAreaContent"},a("span",{className:g},l?"b":w(e.clockType(),n.blackTime()/1e3)),a("span",{className:f},"."+Math.trunc(n.blackTime()/100%10))),S(n)?y(n,"black"):null,S(n)?C(n.blackMoves()):null))}(this.ctrl)),(()=>{return e=this.ctrl,[T.view(e.clockSettingsCtrl)];var e}))}};export{A as default};
