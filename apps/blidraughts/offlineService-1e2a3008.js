import{as as n,at as t,a6 as e,m as i,e as r}from"./main.js";var o={fetch:function(t,e){return n.get(`${a}.${t}.${e}`)},save:function(t,e,i){return n.set(`${a}.${t}.${e}`,i)},clean:function(t,e){return n.remove(`${a}.${t}.${e}`)}};const a="offlinePuzzles";function u(n){return t(`/training/${n.variant}/${n.id}/round2`,{method:"POST",body:JSON.stringify({win:n.win?1:0})})}function s(n,e,i){return t(`/training/${i}/${n}/vote`,{method:"POST",body:JSON.stringify({vote:e?1:0})})}function c(n,e){return t(`/training/${e}/${n}/load`,{cache:"reload"})}function l(){return t("/training/daily",void 0)}function d(n){return t(`/training/${n}/new`)}function f(n,t,e){return h(n,t,e).catch((()=>b((()=>p(n,t,e)))))}function h(n,t,e){return b((()=>n.fetch(t.id,e)))}function v(n,t,e){return n.fetch(t.id,e).then((n=>n&&n.unsolved||[]))}function g(n,t,e){return n.fetch(t.id,e).then((n=>n&&n.unsolved.length||0))}function $(n,t,e){return n.fetch(t.id,e.variant).then((i=>i?n.save(t.id,e.variant,Object.assign(Object.assign({},i),{solved:i.solved.concat([{id:e.id,win:e.win,variant:e.variant}]),unsolved:i.unsolved.filter((n=>n.puzzle.id!==e.id))})).then((()=>p(n,t,e.variant))):null))}function z(n,t,e){return p(n,t,e).then((()=>n.clean(t.id,e).then((()=>f(n,t,e)))))}function m(n){"string"==typeof n?e.show({text:n,position:"center",duration:"long"}):e.show({text:"Could not load puzzle",position:"center",duration:"short"}),i.set("/")}function p(n,e,i){return n.fetch(e.id,i).then((o=>{const a=o?o.unsolved:[],u=o?o.solved:[],s=Math.max(r.training.puzzleBufferLen-a.length,0),c=u.length>0?function(n,e){return t(`/training/${n}/batch`,{method:"POST",body:JSON.stringify({solutions:e})})}(i,u):Promise.resolve(),l=a.map((n=>n.puzzle.id)),d=l.length>0?Math.max(...l):void 0;return c.then((()=>!o||s>0?function(n,e,i){return t(`/training/${n}/batch`,{method:"GET",query:{nb:e,after:i},cache:"reload"})}(i,s,d):Promise.resolve({puzzles:[],user:o.user}))).then((t=>n.save(e.id,i,{user:t.user,unsolved:a.concat(t.puzzles),solved:[]}))).catch((()=>o))}))}function b(n){return new Promise(((t,e)=>{n().then((n=>{n&&n.unsolved.length>0?t(n.unsolved[0]):e(`No additional offline puzzle available. Go online to get another ${r.training.puzzleBufferLen}`)})).catch(e)}))}export{f as a,$ as b,g as c,o as d,c as e,l as f,v as g,h as l,d as n,m as p,u as r,z as s,s as v};
