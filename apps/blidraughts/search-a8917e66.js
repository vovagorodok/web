import{at as e,Y as a,e as n,r as s,aZ as t,ad as o,bF as r,ao as l,o as i,p as c,h as u,v as m,q as p,z as d,B as g,cD as h,cE as b,a6 as y,m as f,I as v,s as M,J as w}from"./main.js";import{l as k}from"./layout-26cca27d.js";import{G as S}from"./GameItem-86ec5af2.js";import{i as _}from"./game-3e605d21.js";function x(a,n=1){return e("/games/search",{method:"GET",query:Object.assign({},a,{page:n})},!1)}let N;function T(e){let l=!1;const i={"players.a":"","players.b":"","players.white":"","players.black":"","players.winner":"",ratingMin:"",ratingMax:"",hasAi:"",source:"",perf:"",turnsMin:"",turnsMax:"",durationMin:"",durationMax:"","clock.initMin":"","clock.initMax":"","clock.incMin":"","clock.incMax":"",status:"",winnerColor:"",dateMin:"",dateMax:"","sort.field":"d","sort.order":"desc",analysed:""};Object.assign(i,e);const c=a(i),u=N&&c===N.queryString,m={paginator:void 0,games:[],scrollPos:0,queryString:c,searching:!1},p=n.general.theme.board(),d=()=>{N=m};function g(){m.searching||(m.searching=!0,s(),setTimeout((()=>{const e=document.getElementById("searchContent");e&&(e.scrollTop=99999)}),250),x(i).then(q).then((e=>{m.queryString=a(i),m.searching=!1,m.paginator=e.paginator,e.paginator?m.games=e.paginator.currentPageResults:m.games=[],function(){const e=`/search?${m.queryString}`;try{window.history.replaceState(window.history.state,"","?="+e)}catch(e){}}(),d(),setTimeout(s,500)})).catch((e=>{m.searching=!1,s(),o(e)})))}return u?setTimeout((()=>{Object.assign(m,N),s()}),300):Object.keys(e).length>0&&g(),{searchState:m,query:i,search:g,toggleBookmark:function(e){r(e).then((()=>{const a=m.games.findIndex((a=>a.id===e)),n=m.games[a];if(n){const e=Object.assign({},n,{bookmarked:!n.bookmarked});m.games[a]=e,s()}}))},more:function(){const e=m.paginator;e&&e.nextPage&&x(i,e.nextPage).then(q).then((e=>{m.paginator=e.paginator,m.paginator&&(m.games=m.games.concat(m.paginator.currentPageResults),s()),d()})).catch(o)},boardTheme:p,handleChange:e=>a=>{const n=a.target.value.trim();Object.assign(i,{[e]:n}),s()},toggleAnalysis:()=>{i.analysed="1"===i.analysed?"":"1",s()},onScroll:e=>{const a=e.target;m.scrollPos=a.scrollTop,d()},onGamesLoaded:()=>{u&&!l&&t((()=>{const e=document.getElementById("searchContent");e&&(e.scrollTop=N.scrollPos),l=!0}))}}}function q(e){return e.paginator&&e.paginator.currentPageResults&&e.paginator.currentPageResults.forEach((e=>{e.date=l(new Date(e.timestamp))})),e}function B(e){const a=function(e){const a=[],n=e["players.a"],s=e["players.b"];n&&a.push({value:n,label:n});s&&a.push({value:s,label:s});return a}(e.query),n="1"===e.query.hasAi;return i("div",{id:"searchContent",className:"native_scroller searchWraper",onscroll:u(e.onScroll,30)},i("form",{id:"advancedSearchForm",onsubmit:a=>{a.preventDefault(),e.search()}},i("div",{className:"game_search_row"},i("label",null,c("players")),i("div",{className:"game_search_input_wrapper"},i("div",{className:"game_search_input"},i("input",{type:"text",name:"players.a",value:e.query["players.a"],oninput:u(e.handleChange("players.a"),200),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1})),i("div",{className:"game_search_input"},i("input",{type:"text",name:"players.b",value:e.query["players.b"],oninput:u(e.handleChange("players.b"),200),autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:!1})))),C(e,c("white"),!!a.length,{name:"players.white",options:a}),C(e,c("black"),!!a.length,{name:"players.black",options:a}),C(e,c("winner"),!!a.length,{name:"players.winner",options:a}),C(e,c("ratingRange"),!0,{name:"ratingMin",options:j,placeholder:c("from")},{name:"ratingMax",options:j,placeholder:c("to")}),C(e,c("opponent"),!0,{name:"hasAi",options:I()}),C(e,c("aiLevel"),n,{name:"aiLevelMin",options:F(),placeholder:c("from")},{name:"aiLevelMax",options:F(),placeholder:c("to")}),C(e,c("source"),!0,{name:"source",options:G}),C(e,c("variant"),!0,{name:"perf",options:L}),C(e,c("mode"),!0,{name:"mode",options:A()}),C(e,c("numberOfTurns"),!0,{name:"turnsMin",options:R(),placeholder:c("from")},{name:"turnsMax",options:R(),placeholder:c("to")}),C(e,c("duration"),!0,{name:"durationMin",options:z(),placeholder:c("from")},{name:"durationMax",options:z(),placeholder:c("to")}),C(e,c("clockInitialTime"),!0,{name:"clock.initMin",options:D(),placeholder:c("from")},{name:"clock.initMax",options:D(),placeholder:c("to")}),C(e,c("clockIncrement"),!0,{name:"clock.incMin",options:H(),placeholder:c("from")},{name:"clock.incMax",options:H(),placeholder:c("to")}),C(e,c("result"),!0,{name:"status",options:V}),C(e,c("winner"),!0,{name:"winnerColor",options:U()}),C(e,c("date"),!0,{name:"dateMin",options:W,placeholder:c("from"),noEmpty:!0},{name:"dateMax",options:W,placeholder:c("to")}),C(e,c("sortBy"),!0,{name:"sort.field",options:$(),noEmpty:!0},{name:"sort.order",options:J(),noEmpty:!0}),i("div",{className:"game_search_row"},i("label",null,c("computerAnalysis")),i("div",{className:"game_search_input_wrapper"},i("div",{className:"game_search_input full"},i("div",{className:"check_container"},i("input",{type:"checkbox",name:"analysed",checked:"1"===e.query.analysed,onchange:e.toggleAnalysis}))))),i("button",{className:"fatButton",type:"submit"},i("span",{className:"fa fa-search"}),c("search"))),function(e){const a=e.searchState.searching?m.getVdom("monochrome"):void 0===e.searchState.paginator?null:0===e.searchState.games.length?i("div.search-empty",c("noGameFound")):i.fragment({oncreate:e.onGamesLoaded},[e.searchState.games.map(((a,n)=>i(S,{key:a.id,g:a,index:n,boardTheme:e.boardTheme})))]);return i("ul.searchGamesList",{className:e.searchState.searching?"searching":"",oncreate:p((a=>function(e,a){const n=function(e){const a=e.target;return"BUTTON"===a.tagName?a:void 0}(a),s=b(a,".userGame"),t=(null==s?void 0:s.dataset).id;if(n)e.toggleBookmark(t);else if(t){const a=e.searchState.games.find((e=>e.id===t));a&&(_(a.variant.key)?f.set(`/analyse/online/${t}`):y.show({text:c("unsupportedVariant",a.variant.name),position:"center",duration:"short"}))}}(e,a)),void 0,h(".userGame"))},a)}(e),function(e){return e.searchState.paginator&&e.searchState.paginator.nextPage?i("div.moreButton",[i("button",{oncreate:d(e.more)},i("span.fa.fa-arrow-down"))]):null}(e))}function C(e,a,n,s,t){if(!n)return null;const o=e.query[s.name];return i("div",{className:"game_search_row"},i("label",null,a),i("div",{className:"game_search_input_wrapper"},i("div",{className:"game_search_select"+(t?"":" full")},i("label",null,""===o&&s.placeholder?s.placeholder:""),i("select",{value:o,name:s.name,onchange:e.handleChange(s.name)},s.noEmpty?null:i("option",{value:""}),s.options.map(E))),t?i("div",{className:"game_search_select"},i("label",null,""===e.query[t.name]&&t.placeholder?t.placeholder:""),i("select",{value:e.query[t.name],name:t.name,onchange:e.handleChange(t.name)},t.noEmpty?null:i("option",{value:""}),t.options.map(E))):null))}function E(e){return i("option",{key:e.value,value:e.value},e.label)}const P={ratings:["600","700","800","900","1000","1100","1200","1300","1400","1500","1600","1700","1800","1900","2000","2100","2200","2300","2400","2500","2600","2700","2800","2900"],opponents:[["0","human"],["1","computer"]],aiLevels:["1","2","3","4","5","6","7","8"],sources:[["1","Lobby"],["2","Friend"],["3","Ai"],["6","Position"],["7","Import"],["5","Tournament"],["10","Simul"],["12","Pool"],["13","Swiss"]],perfs:[["0","UltraBullet"],["1","Bullet"],["2","Blitz"],["6","Rapid"],["3","Classical"],["4","Correspondence"],["11","Frisian"],["16","Frysk!"],["13","Antidraughts"],["17","Breakthrough"],["22","Russian"],["23","Brazilian"]],modes:[["0","casual"],["1","rated"]],turns:["1","2","3","4","5","10","15","20","25","30","35","40","45","50","60","70","80","90","100","125","150","175","200","225","250","275","300"],durations:[["30","nbSeconds"],["60","nbMinutes"],["120","nbMinutes"],["160","nbMinutes"],["300","nbMinutes"],["600","nbMinutes"],["900","nbMinutes"],["1200","nbMinutes"],["1800","nbMinutes"],["3600","nbHours"],["7200","nbHours"],["10800","nbHours"]],times:[["0","nbSeconds"],["30","nbSeconds"],["45","nbSeconds"],["60","nbMinutes"],["120","nbMinutes"],["180","nbMinutes"],["300","nbMinutes"],["600","nbMinutes"],["900","nbMinutes"],["1200","nbMinutes"],["1800","nbMinutes"],["2700","nbMinutes"],["3600","nbMinutes"],["5400","nbMinutes"],["7200","nbMinutes"],["9000","nbMinutes"],["10800","nbMinutes"]],increments:[["0","nbSeconds"],["1","nbSeconds"],["2","nbSeconds"],["3","nbSeconds"],["5","nbSeconds"],["10","nbSeconds"],["15","nbSeconds"],["20","nbSeconds"],["30","nbSeconds"],["45","nbSeconds"],["60","nbSeconds"],["90","nbSeconds"],["120","nbSeconds"],["150","nbSeconds"],["180","nbSeconds"]],results:[["30","Win"],["31","Resign"],["34","Draw"],["35","Clock Flag"],["60","Variant End"]],winners:[["1","white"],["2","black"],["3","none"]],dates:[["0d","Now"],["1h","1 hour ago"],["2h","2 hours ago"],["6h","6 hours ago"],["1d","1 day ago"],["2d","2 days ago"],["3d","3 days ago"],["4d","4 days ago"],["5d","5 days ago"],["6d","6 days ago"],["1w","1 week ago"],["2w","2 weeks ago"],["3w","3 weeks ago"],["4w","4 weeks ago"],["5w","5 weeks ago"],["6w","6 weeks ago"],["1m","1 month ago"],["2m","2 months ago"],["3m","3 months ago"],["4m","4 months ago"],["5m","5 months ago"],["6m","6 months ago"],["1y","1 year ago"],["2y","2 years ago"],["3y","3 years ago"],["4y","4 years ago"],["5y","5 years ago"]],sortFields:[["d","date"],["t","numberOfTurns"],["a","averageElo"]],sortOrders:[["desc","descending"],["asc","ascending"]]},O=(e,a)=>{const n=parseInt(e)||0;return g(a,"nbMinutes"===a?Math.floor(n/60):"nbHours"===a?Math.floor(n/3600):n)},j=P.ratings.map((e=>({value:e,label:e}))),I=()=>P.opponents.map((e=>({value:e[0],label:c(e[1])}))),F=()=>P.aiLevels.map((e=>({value:e,label:c("level")+" "+e}))),G=P.sources.map((e=>({value:e[0],label:e[1]}))),L=P.perfs.map((e=>({value:e[0],label:e[1]}))),A=()=>P.modes.map((e=>({value:e[0],label:c(e[1])}))),R=()=>P.turns.map((e=>({value:e,label:g("nbTurns",parseInt(e))}))),z=()=>P.durations.map((e=>({value:e[0],label:O(e[0],e[1])}))),D=()=>P.times.map((e=>({value:e[0],label:O(e[0],e[1])}))),H=()=>P.increments.map((e=>({value:e[0],label:O(e[0],e[1])}))),V=P.results.map((e=>({value:e[0],label:e[1]}))),U=()=>P.winners.map((e=>({value:e[0],label:c(e[1])}))),W=P.dates.map((e=>({value:e[0],label:e[1]}))),$=()=>P.sortFields.map((e=>({value:e[0],label:c(e[1])}))),J=()=>P.sortOrders.map((e=>({value:e[0],label:c(e[1])})));var Y={oncreate:v,oninit({attrs:e}){M.createDefault(),this.ctrl=T(e)},view(){return k.free(w(c("advancedSearch")),B(this.ctrl))}};export{Y as default};
