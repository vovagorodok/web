import{o as e,a6 as t,p as a,cv as s,bN as n,aT as r,ao as o,q as c,r as l,cw as i,ad as d,ag as m,cx as u,m as p,cy as f,I as h,s as v,J as N,an as b}from"./main.js";import{l as x}from"./layout-26cca27d.js";function D(n){const r=n.thread();return r?e("div",{className:"threadWrapper native_scroller"},r.posts.map(g),e("div",{className:"responseWrapper"},e("form",{id:"responseForm",onsubmit:e=>{e.preventDefault();const s=e.target;if(s[1].value.length>=3)return n.sendResponse(s);t.show({text:a("error.minLength",3),position:"center",duration:"short"})}},e("input",{id:"id",value:n.id(),type:"hidden"}),e("textarea",{id:"body",className:"responseBody composeTextarea"}),e("button",{className:"fatButton sendResponse",oncreate:s,type:"submit"},e("span",{className:"fa fa-check"}),a("send")),function(t){return t.deleteAttempted()?e("div",{className:"negotiation confirmDeleteDialog"},e("button",{className:"fatButton confirmDelete",oncreate:c((()=>{t.deleteThread(t.id())}))},e("span",{className:"fa fa-trash-o"}),"Delete"),e("button",{className:"fatButton cancelDelete",oncreate:c((()=>{t.deleteAttempted(!1),l()}))},e("span",{className:"fa fa-ban"}),a("cancel"))):e("button",{className:"fatButton deleteThread",oncreate:c((()=>{t.deleteAttempted(!0),l()}))},e("span",{className:"fa fa-trash-o"}),"Delete")}(n)))):null}function g(t,a,s){let c="postWrapper";return 0===a&&(c+=" first"),a===s.length-1&&(c+=" last"),e("div",{className:c},e("div",{className:"infos"},r(t.sender),e("span",{className:"arrow","data-icon":"H"}),r(t.receiver)," – ",(l=t.createdAt,o(new Date(l)))),e("div",{className:"text"},e.trust(n(t.text).replace(/\n/g,"<br>"))));var l}function y(e){const t=e[0].value,a=e[1].value;a&&u(t,a).then((e=>{e.ok?p.set("/inbox/"+t):l()})).catch(d)}function w(e){f(e).then((()=>p.set("/inbox/"))).catch(d)}var A={oncreate:h,oninit({attrs:e}){v.createDefault(),this.ctrl=function(e){const t=m(e),a=m(null),s=m(!1);return i(t()).then((e=>{a(e),l()})).catch(d),{id:t,thread:a,deleteAttempted:s,sendResponse:y,deleteThread:w}}(e.id)},view(){const e=this.ctrl.thread(),t=N(null,b(e?e.name:void 0)),a=D(this.ctrl);return x.free(t,a)}};export{A as default};
